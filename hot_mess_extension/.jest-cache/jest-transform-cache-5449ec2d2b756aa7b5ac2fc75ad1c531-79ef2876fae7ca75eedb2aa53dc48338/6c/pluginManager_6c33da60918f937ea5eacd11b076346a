72f6ae296b4ff80c9a1be8a30032f982
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.PluginManager = void 0;
const vscode = __importStar(require("vscode"));
const events_1 = require("events");
const plugin_1 = require("../../types/plugin");
class PluginManager {
    extensionContext;
    workspaceRoot;
    plugins = new Map();
    pluginConfigs = new Map();
    eventEmitter = new events_1.EventEmitter();
    pluginAPI;
    context;
    constructor(extensionContext, workspaceRoot) {
        this.extensionContext = extensionContext;
        this.workspaceRoot = workspaceRoot;
        this.pluginAPI = this.createPluginAPI();
        this.context = this.createPluginContext();
        this.initializeBuiltinPlugins().catch(error => {
            console.error('Failed to initialize plugin manager:', error);
        });
    }
    createPluginAPI() {
        return {
            // VS Code API
            vscode: vscode,
            // Plugin metadata methods
            getPluginPath: () => this.extensionContext.extensionPath,
            getPluginVersion: () => this.extensionContext.extension.packageJSON.version,
            getPluginMetadata: () => ({
                id: this.extensionContext.extension.id,
                name: this.extensionContext.extension.packageJSON.displayName || this.extensionContext.extension.packageJSON.name,
                version: this.extensionContext.extension.packageJSON.version,
                description: this.extensionContext.extension.packageJSON.description || '',
                author: this.extensionContext.extension.packageJSON.author || '',
                license: this.extensionContext.extension.packageJSON.license || '',
                enabled: true,
                capabilities: []
            }),
            // Command registration
            registerCommand: (id, callback) => {
                const disposable = vscode.commands.registerCommand(id, callback);
                this.extensionContext.subscriptions.push(disposable);
                return disposable;
            },
            registerProvider: (type, provider) => {
                // Implementation depends on provider type
                return { dispose: () => { } };
            },
            // Core services
            getInsightsEngine: () => this.getInsightsEngine(),
            getCollaborationService: () => this.getCollaborationService(),
            getExecutionService: () => this.getExecutionService(),
            // Utilities
            showNotification: (message, type) => {
                switch (type) {
                    case 'info':
                        vscode.window.showInformationMessage(message);
                        break;
                    case 'warning':
                        vscode.window.showWarningMessage(message);
                        break;
                    case 'error':
                        vscode.window.showErrorMessage(message);
                        break;
                }
            },
            showProgress: async (title, task) => {
                return await vscode.window.withProgress({
                    location: vscode.ProgressLocation.Notification,
                    title,
                    cancellable: true
                }, task);
            },
            openFile: async (filePath) => {
                const doc = await vscode.workspace.openTextDocument(filePath);
                await vscode.window.showTextDocument(doc);
            },
            writeFile: async (filePath, content) => {
                const uri = vscode.Uri.file(filePath);
                await vscode.workspace.fs.writeFile(uri, Buffer.from(content));
            },
            // Plugin extension points
            registerAnalyzer: (analyzer) => this.registerAnalyzer(analyzer),
            registerFormatter: (formatter) => this.registerFormatter(formatter),
            registerTransformer: (transformer) => this.registerTransformer(transformer),
            registerValidator: (validator) => this.registerValidator(validator),
            // VS Code workspace and window APIs
            createOutputChannel: (name) => vscode.window.createOutputChannel(name),
            showMessage: (message, level) => {
                switch (level) {
                    case 'warning':
                        vscode.window.showWarningMessage(message);
                        break;
                    case 'error':
                        vscode.window.showErrorMessage(message);
                        break;
                    default: vscode.window.showInformationMessage(message);
                }
            },
            getConfiguration: (section) => vscode.workspace.getConfiguration(section),
            onDidChangeConfiguration: (callback) => vscode.workspace.onDidChangeConfiguration(callback),
            createStatusBarItem: (alignment, priority) => vscode.window.createStatusBarItem(alignment, priority),
            createTreeView: (viewId, options) => vscode.window.createTreeView(viewId, options),
            createWebviewPanel: (viewType, title, showOptions, options) => {
                if (typeof showOptions === 'object' && showOptions && 'viewColumn' in showOptions) {
                    const webviewOptions = showOptions;
                    return vscode.window.createWebviewPanel(viewType, title, webviewOptions.viewColumn, { ...options, ...webviewOptions });
                }
                else {
                    return vscode.window.createWebviewPanel(viewType, title, showOptions, options);
                }
            },
            executeCommand: (command, ...args) => vscode.commands.executeCommand(command, ...args),
            openExternal: (uri) => vscode.env.openExternal(uri),
            showTextDocument: (document, column, preserveFocus) => vscode.window.showTextDocument(document, column, preserveFocus),
            showQuickPick: (items, options) => vscode.window.showQuickPick(items, options),
            showInputBox: (options) => vscode.window.showInputBox(options),
            withProgress: (options, task) => vscode.window.withProgress(options, task),
            createTerminal: (name, shellPath, shellArgs) => vscode.window.createTerminal(name, shellPath, shellArgs),
            createFileSystemWatcher: (globPattern, ignoreCreateEvents, ignoreChangeEvents, ignoreDeleteEvents) => vscode.workspace.createFileSystemWatcher(globPattern, ignoreCreateEvents, ignoreChangeEvents, ignoreDeleteEvents),
            findFiles: (include, exclude, maxResults, token) => vscode.workspace.findFiles(include, exclude, maxResults, token),
            openTextDocument: (uri) => vscode.workspace.openTextDocument(uri),
            saveAll: (includeUntitled) => vscode.workspace.saveAll(includeUntitled),
            applyEdit: (edit) => vscode.workspace.applyEdit(edit),
            createDiagnosticCollection: (name) => vscode.languages.createDiagnosticCollection(name),
            // Provider registrations
            registerCodeActionsProvider: (selector, provider) => vscode.languages.registerCodeActionsProvider(selector, provider),
            registerCompletionItemProvider: (selector, provider, ...triggerCharacters) => vscode.languages.registerCompletionItemProvider(selector, provider, ...triggerCharacters),
            registerDefinitionProvider: (selector, provider) => vscode.languages.registerDefinitionProvider(selector, provider),
            registerHoverProvider: (selector, provider) => vscode.languages.registerHoverProvider(selector, provider),
            registerDocumentFormattingEditProvider: (selector, provider) => vscode.languages.registerDocumentFormattingEditProvider(selector, provider),
            registerDocumentRangeFormattingEditProvider: (selector, provider) => vscode.languages.registerDocumentRangeFormattingEditProvider(selector, provider),
            registerRenameProvider: (selector, provider) => vscode.languages.registerRenameProvider(selector, provider),
            registerReferenceProvider: (selector, provider) => vscode.languages.registerReferenceProvider(selector, provider),
            registerDocumentSymbolProvider: (selector, provider) => vscode.languages.registerDocumentSymbolProvider(selector, provider),
            registerDocumentHighlightProvider: (selector, provider) => vscode.languages.registerDocumentHighlightProvider(selector, provider),
            registerDocumentLinkProvider: (selector, provider) => vscode.languages.registerDocumentLinkProvider(selector, provider),
            registerSignatureHelpProvider: (selector, provider, ...triggerCharacters) => vscode.languages.registerSignatureHelpProvider(selector, provider, ...triggerCharacters),
            // Debug and task APIs
            registerDebugConfigurationProvider: (type, provider) => vscode.debug.registerDebugConfigurationProvider(type, provider),
            registerDebugAdapterDescriptorFactory: (type, factory) => vscode.debug.registerDebugAdapterDescriptorFactory(type, factory),
            registerTaskProvider: (type, provider) => vscode.tasks.registerTaskProvider(type, provider),
            createTask: (definition, name, source, execution, problemMatchers) => new vscode.Task(definition, vscode.TaskScope.Workspace, name, source, execution, problemMatchers),
            executeTask: (task) => vscode.tasks.executeTask(task),
            onDidStartTask: (callback) => vscode.tasks.onDidStartTask(callback),
            onDidEndTask: (callback) => vscode.tasks.onDidEndTask(callback),
            onDidStartTaskProcess: (callback) => vscode.tasks.onDidStartTaskProcess(callback),
            onDidEndTaskProcess: (callback) => vscode.tasks.onDidEndTaskProcess(callback),
            // Additional provider methods
            createTreeDataProvider: (viewId, treeDataProvider) => ({ dispose: () => { } }),
            createCustomTextEditorProvider: (viewType, provider) => ({ dispose: () => { } }),
            createCustomEditorProvider: (viewType, provider, options) => ({ dispose: () => { } }),
            createWebviewViewProvider: (viewId, provider) => ({ dispose: () => { } }),
            createAuthenticationProvider: (id, label, provider, options) => ({ dispose: () => { } }),
            createSourceControlResourceGroup: (id, label) => ({}),
            createSourceControl: (id, label, rootUri) => ({}),
            createCommentController: (id, label) => ({}),
            createNotebookController: (id, notebookType, label) => ({}),
            createNotebookCellExecution: (uri) => ({}),
            createNotebookCellOutput: (items) => ({}),
            createNotebookCellOutputItem: (data, mime) => ({}),
            createNotebookDocument: (uri, notebookType, metadata) => ({}),
            createNotebookEdit: (uri, edit) => ({}),
            createNotebookRange: (start, end) => ({}),
            createNotebookCell: (kind, value, languageId, outputs, metadata, executionSummary) => ({}),
            createNotebookCellData: (kind, value, languageId, outputs, metadata, executionSummary) => ({}),
            createNotebookData: (cells, metadata) => ({}),
            createNotebookDocumentFilter: (pattern, scheme, language) => ({}),
            createNotebookDocumentMetadata: (metadata) => ({}),
            // Events
            emit: (event, data) => this.eventEmitter.emit(event, data),
            on: (event, handler) => this.eventEmitter.on(event, handler),
            off: (event, handler) => {
                if (handler) {
                    this.eventEmitter.off(event, handler);
                }
                else {
                    this.eventEmitter.removeAllListeners(event);
                }
            }
        };
    }
    createPluginContext() {
        return {
            subscriptions: this.extensionContext.subscriptions,
            workspaceState: this.extensionContext.workspaceState,
            globalState: this.extensionContext.globalState,
            secrets: this.extensionContext.secrets,
            extensionUri: this.extensionContext.extensionUri,
            extensionPath: this.extensionContext.extensionPath,
            environmentVariableCollection: this.extensionContext.environmentVariableCollection,
            asAbsolutePath: (relativePath) => this.extensionContext.asAbsolutePath(relativePath),
            storageUri: this.extensionContext.storageUri,
            storagePath: this.extensionContext.storagePath,
            globalStorageUri: this.extensionContext.globalStorageUri,
            globalStoragePath: this.extensionContext.globalStoragePath,
            logUri: this.extensionContext.logUri,
            logPath: this.extensionContext.logPath,
            extensionMode: this.extensionContext.extensionMode,
            extension: this.extensionContext.extension,
            workspaceRoot: this.workspaceRoot,
            currentFile: vscode.window.activeTextEditor?.document.fileName,
            selectedText: vscode.window.activeTextEditor?.document.getText(vscode.window.activeTextEditor?.selection),
            executionHistory: [],
            aiInsights: [],
            collaborationData: {},
            customData: {}
        };
    }
    // Plugin Registry implementation
    async register(plugin) {
        const { id } = plugin.metadata;
        if (this.plugins.has(id)) {
            throw new Error(`Plugin with ID '${id}' is already registered`);
        }
        // Validate plugin
        await this.validatePlugin(plugin);
        // Store plugin
        this.plugins.set(id, plugin);
        // Set default config
        if (!this.pluginConfigs.has(id)) {
            this.pluginConfigs.set(id, {
                enabled: plugin.metadata.enabled,
                settings: plugin.metadata.config || {},
                permissions: [],
                resources: {}
            });
        }
        // Activate if enabled
        if (this.isEnabled(id)) {
            await this.activatePlugin(id);
        }
        this.emitEvent(plugin_1.PLUGIN_EVENTS.ACTIVATED, { pluginId: id });
    }
    async unregister(pluginId) {
        const plugin = this.plugins.get(pluginId);
        if (!plugin) {
            throw new Error(`Plugin with ID '${pluginId}' not found`);
        }
        // Deactivate if active
        if (this.isEnabled(pluginId)) {
            await this.deactivatePlugin(pluginId);
        }
        // Remove from storage
        this.plugins.delete(pluginId);
        this.pluginConfigs.delete(pluginId);
        this.emitEvent(plugin_1.PLUGIN_EVENTS.DEACTIVATED, { pluginId });
    }
    get(pluginId) {
        return this.plugins.get(pluginId);
    }
    getAll() {
        return Array.from(this.plugins.values());
    }
    getPlugin(pluginId) {
        return this.plugins.get(pluginId);
    }
    getAllPlugins() {
        return Array.from(this.plugins.values());
    }
    getByCapability(capability) {
        return this.getAll().filter(plugin => plugin.metadata.capabilities.some(cap => cap.type === capability));
    }
    isEnabled(pluginId) {
        const config = this.pluginConfigs.get(pluginId);
        return config?.enabled ?? false;
    }
    async enable(pluginId) {
        const config = this.pluginConfigs.get(pluginId);
        if (!config) {
            throw new Error(`Plugin '${pluginId}' not found`);
        }
        config.enabled = true;
        await this.activatePlugin(pluginId);
        this.savePluginConfig(pluginId, config);
    }
    async disable(pluginId) {
        const config = this.pluginConfigs.get(pluginId);
        if (!config) {
            throw new Error(`Plugin '${pluginId}' not found`);
        }
        config.enabled = false;
        await this.deactivatePlugin(pluginId);
        this.savePluginConfig(pluginId, config);
    }
    // Plugin lifecycle
    async activatePlugin(pluginId) {
        const plugin = this.plugins.get(pluginId);
        if (!plugin) {
            throw new Error(`Plugin '${pluginId}' not found`);
        }
        try {
            await plugin.activate(this.pluginAPI, this.context);
            // Register plugin capabilities
            this.registerPluginCapabilities(plugin);
            // Execute activation hook
            if (plugin.hooks?.onActivate) {
                await plugin.hooks.onActivate(this.context);
            }
        }
        catch (error) {
            this.emitEvent(plugin_1.PLUGIN_EVENTS.ERROR, {
                pluginId,
                error: error.message
            });
            throw error;
        }
    }
    async deactivatePlugin(pluginId) {
        const plugin = this.plugins.get(pluginId);
        if (!plugin) {
            return;
        }
        try {
            // Execute deactivation hook
            if (plugin.hooks?.onDeactivate) {
                await plugin.hooks.onDeactivate(this.context);
            }
            await plugin.deactivate(this.pluginAPI, this.context);
            // Unregister plugin capabilities
            this.unregisterPluginCapabilities(plugin);
        }
        catch (error) {
            this.emitEvent(plugin_1.PLUGIN_EVENTS.ERROR, {
                pluginId,
                error: error.message
            });
            throw error;
        }
    }
    registerPluginCapabilities(plugin) {
        const { id } = plugin.metadata;
        // Register commands
        if (plugin.commands) {
            plugin.commands.forEach(command => {
                this.registerCommand(command);
            });
        }
        // Register analyzers
        if (plugin.analyzers) {
            plugin.analyzers.forEach(analyzer => {
                this.registerAnalyzer(analyzer);
            });
        }
        // Register formatters
        if (plugin.formatters) {
            plugin.formatters.forEach(formatter => {
                this.registerFormatter(formatter);
            });
        }
        // Register transformers
        if (plugin.transformers) {
            plugin.transformers.forEach(transformer => {
                this.registerTransformer(transformer);
            });
        }
        // Register validators
        if (plugin.validators) {
            plugin.validators.forEach(validator => {
                this.registerValidator(validator);
            });
        }
    }
    unregisterPluginCapabilities(plugin) {
        // Implementation would remove registered capabilities
        // This is a simplified version
    }
    // Capability registration methods
    registerCommand(command) {
        // Register VSCode command
        const disposable = vscode.commands.registerCommand(`aiDebug.plugin.${command.id}`, async (...args) => {
            try {
                const result = await command.execute(this.context, args);
                this.emitEvent(plugin_1.PLUGIN_EVENTS.COMMAND_EXECUTED, {
                    commandId: command.id,
                    result
                });
                return result;
            }
            catch (error) {
                this.emitEvent(plugin_1.PLUGIN_EVENTS.ERROR, {
                    commandId: command.id,
                    error: error.message
                });
                throw error;
            }
        });
        this.extensionContext.subscriptions.push(disposable);
    }
    registerAnalyzer(analyzer) {
        // Store analyzer for use by insight engine
        this.eventEmitter.emit('analyzer:registered', analyzer);
    }
    registerFormatter(formatter) {
        // Store formatter for use by output system
        this.eventEmitter.emit('formatter:registered', formatter);
    }
    registerTransformer(transformer) {
        // Store transformer for use by processing pipeline
        this.eventEmitter.emit('transformer:registered', transformer);
    }
    registerValidator(validator) {
        // Store validator for use by validation system
        this.eventEmitter.emit('validator:registered', validator);
    }
    // Plugin validation
    async validatePlugin(plugin) {
        const { metadata } = plugin;
        if (!metadata.id || !metadata.name || !metadata.version) {
            throw new Error('Plugin must have id, name, and version');
        }
        if (!metadata.capabilities || metadata.capabilities.length === 0) {
            throw new Error('Plugin must declare at least one capability');
        }
        // Validate dependencies
        if (metadata.dependencies) {
            for (const dep of metadata.dependencies) {
                if (!this.plugins.has(dep)) {
                    throw new Error(`Missing dependency: ${dep}`);
                }
            }
        }
        // Validate required methods
        if (typeof plugin.activate !== 'function') {
            throw new Error('Plugin must have an activate method');
        }
        if (typeof plugin.deactivate !== 'function') {
            throw new Error('Plugin must have a deactivate method');
        }
    }
    // Configuration management
    savePluginConfig(pluginId, config) {
        const configs = this.extensionContext.globalState.get('pluginConfigs', {});
        configs[pluginId] = config;
        this.extensionContext.globalState.update('pluginConfigs', configs);
    }
    loadPluginConfigs() {
        const configs = this.extensionContext.globalState.get('pluginConfigs', {});
        for (const [pluginId, config] of Object.entries(configs)) {
            this.pluginConfigs.set(pluginId, config);
        }
    }
    // Event handling
    emitEvent(type, data) {
        const event = {
            type,
            pluginId: data?.pluginId || 'system',
            timestamp: new Date(),
            data,
            source: 'plugin-manager'
        };
        this.eventEmitter.emit(type, event);
    }
    // Development utilities
    createDevUtils(pluginId) {
        return {
            createTestSuite: (id) => this.createTestSuite(id),
            createLogger: (id) => this.createLogger(id),
            createProfiler: (id) => this.createProfiler(id),
            createStorage: (id) => this.createStorage(id),
            createScheduler: (id) => this.createScheduler(id)
        };
    }
    createLogger(pluginId) {
        return {
            info: (message, data) => {
                console.log(`[${pluginId}] ${message}`, data);
            },
            warn: (message, data) => {
                console.warn(`[${pluginId}] ${message}`, data);
            },
            error: (message, error) => {
                console.error(`[${pluginId}] ${message}`, error);
            },
            debug: (message, data) => {
                console.debug(`[${pluginId}] ${message}`, data);
            },
            trace: (message, data) => {
                console.trace(`[${pluginId}] ${message}`, data);
            },
            setLevel: (level) => {
                // Implementation would set the log level
            },
            createChild: (name) => {
                return this.createLogger(`${pluginId}:${name}`);
            }
        };
    }
    createStorage(pluginId) {
        const prefix = `plugin.${pluginId}.`;
        return {
            get: async (key) => {
                return this.extensionContext.globalState.get(prefix + key);
            },
            set: async (key, value) => {
                await this.extensionContext.globalState.update(prefix + key, value);
            },
            delete: async (key) => {
                await this.extensionContext.globalState.update(prefix + key, undefined);
            },
            clear: async () => {
                // Get all keys with this plugin's prefix and clear them
                const keys = this.extensionContext.globalState.keys();
                for (const key of keys) {
                    if (key.startsWith(prefix)) {
                        await this.extensionContext.globalState.update(key, undefined);
                    }
                }
            },
            keys: async () => {
                return this.extensionContext.globalState.keys()
                    .filter(key => key.startsWith(prefix))
                    .map(key => key.substring(prefix.length));
            },
            has: async (key) => {
                return this.extensionContext.globalState.keys().includes(prefix + key);
            },
            size: async () => {
                return this.extensionContext.globalState.keys()
                    .filter(key => key.startsWith(prefix)).length;
            }
        };
    }
    createScheduler(pluginId) {
        const timers = new Map();
        return {
            schedule: (task, delay) => {
                const id = `task_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                // Create timer
                const timer = setTimeout(async () => {
                    try {
                        await task();
                    }
                    catch (error) {
                        this.emitEvent(plugin_1.PLUGIN_EVENTS.ERROR, {
                            pluginId,
                            error: error.message,
                            source: 'scheduler'
                        });
                    }
                    timers.delete(id);
                }, delay);
                timers.set(id, timer);
                return {
                    id,
                    cancel: () => {
                        const timer = timers.get(id);
                        if (timer) {
                            clearTimeout(timer);
                            timers.delete(id);
                        }
                    },
                    reschedule: (newDelay) => {
                        const timer = timers.get(id);
                        if (timer) {
                            clearTimeout(timer);
                            const newTimer = setTimeout(async () => {
                                try {
                                    await task();
                                }
                                catch (error) {
                                    this.emitEvent(plugin_1.PLUGIN_EVENTS.ERROR, {
                                        pluginId,
                                        error: error.message,
                                        source: 'scheduler'
                                    });
                                }
                                timers.delete(id);
                            }, newDelay);
                            timers.set(id, newTimer);
                        }
                    }
                };
            },
            scheduleRepeating: (task, interval) => {
                const id = `repeat_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                const timer = setInterval(async () => {
                    try {
                        await task();
                    }
                    catch (error) {
                        this.emitEvent(plugin_1.PLUGIN_EVENTS.ERROR, {
                            pluginId,
                            error: error.message,
                            source: 'scheduler'
                        });
                    }
                }, interval);
                timers.set(id, timer);
                return {
                    id,
                    cancel: () => {
                        const timer = timers.get(id);
                        if (timer) {
                            clearInterval(timer);
                            timers.delete(id);
                        }
                    },
                    reschedule: (newInterval) => {
                        const timer = timers.get(id);
                        if (timer) {
                            clearInterval(timer);
                            const newTimer = setInterval(async () => {
                                try {
                                    await task();
                                }
                                catch (error) {
                                    this.emitEvent(plugin_1.PLUGIN_EVENTS.ERROR, {
                                        pluginId,
                                        error: error.message,
                                        source: 'scheduler'
                                    });
                                }
                            }, newInterval);
                            timers.set(id, newTimer);
                        }
                    }
                };
            },
            cancel: (scheduledTask) => {
                scheduledTask.cancel();
            },
            cancelAll: () => {
                for (const timer of timers.values()) {
                    clearInterval(timer);
                    clearTimeout(timer);
                }
                timers.clear();
            }
        };
    }
    createTestSuite(pluginId) {
        return {
            addTest: (name, test) => {
                // Implementation would add test to suite
            },
            addSetup: (setup) => {
                // Implementation would add setup
            },
            addTeardown: (teardown) => {
                // Implementation would add teardown
            }
        };
    }
    createProfiler(pluginId) {
        return {
            start: (name) => {
                const startTime = Date.now();
                return {
                    end: () => Date.now() - startTime,
                    mark: (markName) => {
                        // Implementation would record mark
                    }
                };
            },
            measure: (name, fn) => {
                const start = Date.now();
                const result = fn();
                console.log(`[${pluginId}] ${name}: ${Date.now() - start}ms`);
                return result;
            },
            measureAsync: async (name, fn) => {
                const start = Date.now();
                const result = await fn();
                console.log(`[${pluginId}] ${name}: ${Date.now() - start}ms`);
                return result;
            }
        };
    }
    // Integration with existing services
    getInsightsEngine() {
        // Return reference to existing AI insights engine
        return null; // Placeholder
    }
    getCollaborationService() {
        // Return reference to existing collaboration service
        return null; // Placeholder
    }
    getExecutionService() {
        // Return reference to existing execution service
        return null; // Placeholder
    }
    // Built-in plugins initialization
    async initializeBuiltinPlugins() {
        // Load built-in plugins
        this.loadPluginConfigs();
        // Register built-in plugins
        try {
            const { GitAnalyzerPlugin, TestAnalyzerPlugin, AIProviderPlugin } = await Promise.resolve().then(() => __importStar(require('./builtin')));
            // Register Git Analyzer Plugin
            const gitPlugin = new GitAnalyzerPlugin();
            await this.register(gitPlugin);
            // Register Test Analyzer Plugin
            const testPlugin = new TestAnalyzerPlugin();
            await this.register(testPlugin);
            // Register AI Provider Plugin
            const aiPlugin = new AIProviderPlugin();
            await this.register(aiPlugin);
            console.log('Built-in plugins initialized successfully');
        }
        catch (error) {
            console.error('Failed to initialize built-in plugins:', error);
        }
    }
    // Public API for extension
    async executePluginCommand(pluginId, commandId, args) {
        const plugin = this.plugins.get(pluginId);
        if (!plugin || !this.isEnabled(pluginId)) {
            throw new Error(`Plugin '${pluginId}' not found or not enabled`);
        }
        const command = plugin.commands?.find(cmd => cmd.id === commandId);
        if (!command) {
            throw new Error(`Command '${commandId}' not found in plugin '${pluginId}'`);
        }
        return await command.execute(this.context, args);
    }
    getPluginInsights(pluginId) {
        // Return insights generated by specific plugin
        return [];
    }
    async refreshPluginContext() {
        this.context = this.createPluginContext();
        // Notify all active plugins about context change
        for (const [pluginId, plugin] of this.plugins) {
            if (this.isEnabled(pluginId) && plugin.hooks?.onCommand) {
                // This is a simplified notification
                // In practice, you'd have a more sophisticated context update system
            }
        }
    }
}
exports.PluginManager = PluginManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2dyZWdkdW5uL3NyYy90ZXN0L2FpX2RlYnVnX2NvbnRleHQvdnNjb2RlL3NyYy9zZXJ2aWNlcy9wbHVnaW5zL3BsdWdpbk1hbmFnZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsK0NBQWlDO0FBQ2pDLG1DQUFzQztBQUN0QywrQ0FjNEI7QUFFNUIsTUFBYSxhQUFhO0lBUWQ7SUFDQTtJQVJGLE9BQU8sR0FBRyxJQUFJLEdBQUcsRUFBa0IsQ0FBQztJQUNwQyxhQUFhLEdBQUcsSUFBSSxHQUFHLEVBQXdCLENBQUM7SUFDaEQsWUFBWSxHQUFHLElBQUkscUJBQVksRUFBRSxDQUFDO0lBQ2xDLFNBQVMsQ0FBWTtJQUNyQixPQUFPLENBQWdCO0lBRS9CLFlBQ1UsZ0JBQXlDLEVBQ3pDLGFBQXFCO1FBRHJCLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBeUI7UUFDekMsa0JBQWEsR0FBYixhQUFhLENBQVE7UUFFN0IsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDeEMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztRQUMxQyxJQUFJLENBQUMsd0JBQXdCLEVBQUUsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDNUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxzQ0FBc0MsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUMvRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFTyxlQUFlO1FBQ3JCLE9BQU87WUFDTCxjQUFjO1lBQ2QsTUFBTSxFQUFFLE1BQWE7WUFFckIsMEJBQTBCO1lBQzFCLGFBQWEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsYUFBYTtZQUN4RCxnQkFBZ0IsRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxPQUFPO1lBQzNFLGlCQUFp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LFNBQVMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO1lBQ3pDLE1BQU0sSUFBSSxLQUFLLENBQUMsV0FBVyxRQUFRLDRCQUE0QixDQUFDLENBQUM7UUFDbkUsQ0FBQztRQUVELE1BQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsS0FBSyxTQUFTLENBQUMsQ0FBQztRQUNuRSxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDYixNQUFNLElBQUksS0FBSyxDQUFDLFlBQVksU0FBUywwQkFBMEIsUUFBUSxHQUFHLENBQUMsQ0FBQztRQUM5RSxDQUFDO1FBRUQsT0FBTyxNQUFNLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQztJQUNuRCxDQUFDO0lBRU0saUJBQWlCLENBQUMsUUFBZ0I7UUFDdkMsK0NBQStDO1FBQy9DLE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQztJQUVNLEtBQUssQ0FBQyxvQkFBb0I7UUFDL0IsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztRQUUxQyxpREFBaUQ7UUFDakQsS0FBSyxNQUFNLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUM5QyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLElBQUksTUFBTSxDQUFDLEtBQUssRUFBRSxTQUFTLEVBQUUsQ0FBQztnQkFDeEQsb0NBQW9DO2dCQUNwQyxxRUFBcUU7WUFDdkUsQ0FBQztRQUNILENBQUM7SUFDSCxDQUFDO0NBQ0Y7QUFwekJELHNDQW96QkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2dyZWdkdW5uL3NyYy90ZXN0L2FpX2RlYnVnX2NvbnRleHQvdnNjb2RlL3NyYy9zZXJ2aWNlcy9wbHVnaW5zL3BsdWdpbk1hbmFnZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgdnNjb2RlIGZyb20gJ3ZzY29kZSc7XG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdldmVudHMnO1xuaW1wb3J0IHsgXG4gIFBsdWdpbiwgXG4gIFBsdWdpbk1ldGFkYXRhLCBcbiAgUGx1Z2luUmVnaXN0cnksIFxuICBQbHVnaW5BUEksIFxuICBQbHVnaW5Db250ZXh0LCBcbiAgUGx1Z2luQ29uZmlnLCBcbiAgUGx1Z2luRXZlbnQsIFxuICBQbHVnaW5EZXZVdGlscyxcbiAgUGx1Z2luTG9nZ2VyLFxuICBQbHVnaW5TdG9yYWdlLFxuICBQbHVnaW5TY2hlZHVsZXIsXG4gIFBMVUdJTl9FVkVOVFMsXG4gIEV4ZWN1dGlvblJlY29yZFxufSBmcm9tICcuLi8uLi90eXBlcy9wbHVnaW4nO1xuXG5leHBvcnQgY2xhc3MgUGx1Z2luTWFuYWdlciBpbXBsZW1lbnRzIFBsdWdpblJlZ2lzdHJ5IHtcbiAgcHJpdmF0ZSBwbHVnaW5zID0gbmV3IE1hcDxzdHJpbmcsIFBsdWdpbj4oKTtcbiAgcHJpdmF0ZSBwbHVnaW5Db25maWdzID0gbmV3IE1hcDxzdHJpbmcsIFBsdWdpbkNvbmZpZz4oKTtcbiAgcHJpdmF0ZSBldmVudEVtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIHByaXZhdGUgcGx1Z2luQVBJOiBQbHVnaW5BUEk7XG4gIHByaXZhdGUgY29udGV4dDogUGx1Z2luQ29udGV4dDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGV4dGVuc2lvbkNvbnRleHQ6IHZzY29kZS5FeHRlbnNpb25Db250ZXh0LFxuICAgIHByaXZhdGUgd29ya3NwYWNlUm9vdDogc3RyaW5nXG4gICkge1xuICAgIHRoaXMucGx1Z2luQVBJID0gdGhpcy5jcmVhdGVQbHVnaW5BUEkoKTtcbiAgICB0aGlzLmNvbnRleHQgPSB0aGlzLmNyZWF0ZVBsdWdpbkNvbnRleHQoKTtcbiAgICB0aGlzLmluaXRpYWxpemVCdWlsdGluUGx1Z2lucygpLmNhdGNoKGVycm9yID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBpbml0aWFsaXplIHBsdWdpbiBtYW5hZ2VyOicsIGVycm9yKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUGx1Z2luQVBJKCk6IFBsdWdpbkFQSSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC8vIFZTIENvZGUgQVBJXG4gICAgICB2c2NvZGU6IHZzY29kZSBhcyBhbnksXG4gICAgICBcbiAgICAgIC8vIFBsdWdpbiBtZXRhZGF0YSBtZXRob2RzXG4gICAgICBnZXRQbHVnaW5QYXRoOiAoKSA9PiB0aGlzLmV4dGVuc2lvbkNvbnRleHQuZXh0ZW5zaW9uUGF0aCxcbiAgICAgIGdldFBsdWdpblZlcnNpb246ICgpID0+IHRoaXMuZXh0ZW5zaW9uQ29udGV4dC5leHRlbnNpb24ucGFja2FnZUpTT04udmVyc2lvbixcbiAgICAgIGdldFBsdWdpbk1ldGFkYXRhOiAoKSA9PiAoe1xuICAgICAgICBpZDogdGhpcy5leHRlbnNpb25Db250ZXh0LmV4dGVuc2lvbi5pZCxcbiAgICAgICAgbmFtZTogdGhpcy5leHRlbnNpb25Db250ZXh0LmV4dGVuc2lvbi5wYWNrYWdlSlNPTi5kaXNwbGF5TmFtZSB8fCB0aGlzLmV4dGVuc2lvbkNvbnRleHQuZXh0ZW5zaW9uLnBhY2thZ2VKU09OLm5hbWUsXG4gICAgICAgIHZlcnNpb246IHRoaXMuZXh0ZW5zaW9uQ29udGV4dC5leHRlbnNpb24ucGFja2FnZUpTT04udmVyc2lvbixcbiAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuZXh0ZW5zaW9uQ29udGV4dC5leHRlbnNpb24ucGFja2FnZUpTT04uZGVzY3JpcHRpb24gfHwgJycsXG4gICAgICAgIGF1dGhvcjogdGhpcy5leHRlbnNpb25Db250ZXh0LmV4dGVuc2lvbi5wYWNrYWdlSlNPTi5hdXRob3IgfHwgJycsXG4gICAgICAgIGxpY2Vuc2U6IHRoaXMuZXh0ZW5zaW9uQ29udGV4dC5leHRlbnNpb24ucGFja2FnZUpTT04ubGljZW5zZSB8fCAnJyxcbiAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgY2FwYWJpbGl0aWVzOiBbXVxuICAgICAgfSksXG4gICAgICBcbiAgICAgIC8vIENvbW1hbmQgcmVnaXN0cmF0aW9uXG4gICAgICByZWdpc3RlckNvbW1hbmQ6IChpZDogc3RyaW5nLCBjYWxsYmFjazogKC4uLmFyZ3M6IGFueVtdKSA9PiBhbnkpID0+IHtcbiAgICAgICAgY29uc3QgZGlzcG9zYWJsZSA9IHZzY29kZS5jb21tYW5kcy5yZWdpc3RlckNvbW1hbmQoaWQsIGNhbGxiYWNrKTtcbiAgICAgICAgdGhpcy5leHRlbnNpb25Db250ZXh0LnN1YnNjcmlwdGlvbnMucHVzaChkaXNwb3NhYmxlKTtcbiAgICAgICAgcmV0dXJuIGRpc3Bvc2FibGU7XG4gICAgICB9LFxuICAgICAgXG4gICAgICByZWdpc3RlclByb3ZpZGVyOiAodHlwZTogc3RyaW5nLCBwcm92aWRlcjogYW55KSA9PiB7XG4gICAgICAgIC8vIEltcGxlbWVudGF0aW9uIGRlcGVuZHMgb24gcHJvdmlkZXIgdHlwZVxuICAgICAgICByZXR1cm4geyBkaXNwb3NlOiAoKSA9PiB7fSB9O1xuICAgICAgfSxcbiAgICAgIC8vIENvcmUgc2VydmljZXNcbiAgICAgIGdldEluc2lnaHRzRW5naW5lOiAoKSA9PiB0aGlzLmdldEluc2lnaHRzRW5naW5lKCksXG4gICAgICBnZXRDb2xsYWJvcmF0aW9uU2VydmljZTogKCkgPT4gdGhpcy5nZXRDb2xsYWJvcmF0aW9uU2VydmljZSgpLFxuICAgICAgZ2V0RXhlY3V0aW9uU2VydmljZTogKCkgPT4gdGhpcy5nZXRFeGVjdXRpb25TZXJ2aWNlKCksXG5cbiAgICAgIC8vIFV0aWxpdGllc1xuICAgICAgc2hvd05vdGlmaWNhdGlvbjogKG1lc3NhZ2U6IHN0cmluZywgdHlwZTogJ2luZm8nIHwgJ3dhcm5pbmcnIHwgJ2Vycm9yJykgPT4ge1xuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICBjYXNlICdpbmZvJzpcbiAgICAgICAgICAgIHZzY29kZS53aW5kb3cuc2hvd0luZm9ybWF0aW9uTWVzc2FnZShtZXNzYWdlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ3dhcm5pbmcnOlxuICAgICAgICAgICAgdnNjb2RlLndpbmRvdy5zaG93V2FybmluZ01lc3NhZ2UobWVzc2FnZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdlcnJvcic6XG4gICAgICAgICAgICB2c2NvZGUud2luZG93LnNob3dFcnJvck1lc3NhZ2UobWVzc2FnZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIFxuICAgICAgc2hvd1Byb2dyZXNzOiBhc3luYyAodGl0bGU6IHN0cmluZywgdGFzazogKHByb2dyZXNzOiBhbnkpID0+IFByb21pc2U8YW55PikgPT4ge1xuICAgICAgICByZXR1cm4gYXdhaXQgdnNjb2RlLndpbmRvdy53aXRoUHJvZ3Jlc3Moe1xuICAgICAgICAgIGxvY2F0aW9uOiB2c2NvZGUuUHJvZ3Jlc3NMb2NhdGlvbi5Ob3RpZmljYXRpb24sXG4gICAgICAgICAgdGl0bGUsXG4gICAgICAgICAgY2FuY2VsbGFibGU6IHRydWVcbiAgICAgICAgfSwgdGFzayk7XG4gICAgICB9LFxuXG4gICAgICBvcGVuRmlsZTogYXN5bmMgKGZpbGVQYXRoOiBzdHJpbmcpID0+IHtcbiAgICAgICAgY29uc3QgZG9jID0gYXdhaXQgdnNjb2RlLndvcmtzcGFjZS5vcGVuVGV4dERvY3VtZW50KGZpbGVQYXRoKTtcbiAgICAgICAgYXdhaXQgdnNjb2RlLndpbmRvdy5zaG93VGV4dERvY3VtZW50KGRvYyk7XG4gICAgICB9LFxuXG4gICAgICB3cml0ZUZpbGU6IGFzeW5jIChmaWxlUGF0aDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpID0+IHtcbiAgICAgICAgY29uc3QgdXJpID0gdnNjb2RlLlVyaS5maWxlKGZpbGVQYXRoKTtcbiAgICAgICAgYXdhaXQgdnNjb2RlLndvcmtzcGFjZS5mcy53cml0ZUZpbGUodXJpLCBCdWZmZXIuZnJvbShjb250ZW50KSk7XG4gICAgICB9LFxuXG4gICAgICAvLyBQbHVnaW4gZXh0ZW5zaW9uIHBvaW50c1xuICAgICAgcmVnaXN0ZXJBbmFseXplcjogKGFuYWx5emVyKSA9PiB0aGlzLnJlZ2lzdGVyQW5hbHl6ZXIoYW5hbHl6ZXIpLFxuICAgICAgcmVnaXN0ZXJGb3JtYXR0ZXI6IChmb3JtYXR0ZXIpID0+IHRoaXMucmVnaXN0ZXJGb3JtYXR0ZXIoZm9ybWF0dGVyKSxcbiAgICAgIHJlZ2lzdGVyVHJhbnNmb3JtZXI6ICh0cmFuc2Zvcm1lcikgPT4gdGhpcy5yZWdpc3RlclRyYW5zZm9ybWVyKHRyYW5zZm9ybWVyKSxcbiAgICAgIHJlZ2lzdGVyVmFsaWRhdG9yOiAodmFsaWRhdG9yKSA9PiB0aGlzLnJlZ2lzdGVyVmFsaWRhdG9yKHZhbGlkYXRvciksXG5cbiAgICAgIC8vIFZTIENvZGUgd29ya3NwYWNlIGFuZCB3aW5kb3cgQVBJc1xuICAgICAgY3JlYXRlT3V0cHV0Q2hhbm5lbDogKG5hbWU6IHN0cmluZykgPT4gdnNjb2RlLndpbmRvdy5jcmVhdGVPdXRwdXRDaGFubmVsKG5hbWUpLFxuICAgICAgc2hvd01lc3NhZ2U6IChtZXNzYWdlOiBzdHJpbmcsIGxldmVsPzogJ2luZm8nIHwgJ3dhcm5pbmcnIHwgJ2Vycm9yJykgPT4ge1xuICAgICAgICBzd2l0Y2ggKGxldmVsKSB7XG4gICAgICAgICAgY2FzZSAnd2FybmluZyc6IHZzY29kZS53aW5kb3cuc2hvd1dhcm5pbmdNZXNzYWdlKG1lc3NhZ2UpOyBicmVhaztcbiAgICAgICAgICBjYXNlICdlcnJvcic6IHZzY29kZS53aW5kb3cuc2hvd0Vycm9yTWVzc2FnZShtZXNzYWdlKTsgYnJlYWs7XG4gICAgICAgICAgZGVmYXVsdDogdnNjb2RlLndpbmRvdy5zaG93SW5mb3JtYXRpb25NZXNzYWdlKG1lc3NhZ2UpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZ2V0Q29uZmlndXJhdGlvbjogKHNlY3Rpb24/OiBzdHJpbmcpID0+IHZzY29kZS53b3Jrc3BhY2UuZ2V0Q29uZmlndXJhdGlvbihzZWN0aW9uKSxcbiAgICAgIG9uRGlkQ2hhbmdlQ29uZmlndXJhdGlvbjogKGNhbGxiYWNrKSA9PiB2c2NvZGUud29ya3NwYWNlLm9uRGlkQ2hhbmdlQ29uZmlndXJhdGlvbihjYWxsYmFjayksXG4gICAgICBjcmVhdGVTdGF0dXNCYXJJdGVtOiAoYWxpZ25tZW50PywgcHJpb3JpdHk/KSA9PiB2c2NvZGUud2luZG93LmNyZWF0ZVN0YXR1c0Jhckl0ZW0oYWxpZ25tZW50LCBwcmlvcml0eSksXG4gICAgICBjcmVhdGVUcmVlVmlldzogKHZpZXdJZCwgb3B0aW9ucykgPT4gdnNjb2RlLndpbmRvdy5jcmVhdGVUcmVlVmlldyh2aWV3SWQsIG9wdGlvbnMpLFxuICAgICAgY3JlYXRlV2Vidmlld1BhbmVsOiAodmlld1R5cGUsIHRpdGxlLCBzaG93T3B0aW9ucywgb3B0aW9ucz8pID0+IHtcbiAgICAgICAgaWYgKHR5cGVvZiBzaG93T3B0aW9ucyA9PT0gJ29iamVjdCcgJiYgc2hvd09wdGlvbnMgJiYgJ3ZpZXdDb2x1bW4nIGluIHNob3dPcHRpb25zKSB7XG4gICAgICAgICAgY29uc3Qgd2Vidmlld09wdGlvbnMgPSBzaG93T3B0aW9ucyBhcyB7IHZpZXdDb2x1bW46IHZzY29kZS5WaWV3Q29sdW1uOyBwcmVzZXJ2ZUZvY3VzPzogYm9vbGVhbiB9O1xuICAgICAgICAgIHJldHVybiB2c2NvZGUud2luZG93LmNyZWF0ZVdlYnZpZXdQYW5lbCh2aWV3VHlwZSwgdGl0bGUsIHdlYnZpZXdPcHRpb25zLnZpZXdDb2x1bW4sIHsgLi4ub3B0aW9ucywgLi4ud2Vidmlld09wdGlvbnMgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHZzY29kZS53aW5kb3cuY3JlYXRlV2Vidmlld1BhbmVsKHZpZXdUeXBlLCB0aXRsZSwgc2hvd09wdGlvbnMgYXMgdnNjb2RlLlZpZXdDb2x1bW4sIG9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZXhlY3V0ZUNvbW1hbmQ6IChjb21tYW5kLCAuLi5hcmdzKSA9PiB2c2NvZGUuY29tbWFuZHMuZXhlY3V0ZUNvbW1hbmQoY29tbWFuZCwgLi4uYXJncyksXG4gICAgICBvcGVuRXh0ZXJuYWw6ICh1cmkpID0+IHZzY29kZS5lbnYub3BlbkV4dGVybmFsKHVyaSksXG4gICAgICBzaG93VGV4dERvY3VtZW50OiAoZG9jdW1lbnQsIGNvbHVtbj8sIHByZXNlcnZlRm9jdXM/KSA9PiB2c2NvZGUud2luZG93LnNob3dUZXh0RG9jdW1lbnQoZG9jdW1lbnQsIGNvbHVtbiwgcHJlc2VydmVGb2N1cyksXG4gICAgICBzaG93UXVpY2tQaWNrOiAoaXRlbXMsIG9wdGlvbnM/KSA9PiB2c2NvZGUud2luZG93LnNob3dRdWlja1BpY2soaXRlbXMsIG9wdGlvbnMpLFxuICAgICAgc2hvd0lucHV0Qm94OiAob3B0aW9ucz8pID0+IHZzY29kZS53aW5kb3cuc2hvd0lucHV0Qm94KG9wdGlvbnMpLFxuICAgICAgd2l0aFByb2dyZXNzOiAob3B0aW9ucywgdGFzaykgPT4gdnNjb2RlLndpbmRvdy53aXRoUHJvZ3Jlc3Mob3B0aW9ucywgdGFzayksXG4gICAgICBjcmVhdGVUZXJtaW5hbDogKG5hbWU/LCBzaGVsbFBhdGg/LCBzaGVsbEFyZ3M/KSA9PiB2c2NvZGUud2luZG93LmNyZWF0ZVRlcm1pbmFsKG5hbWUsIHNoZWxsUGF0aCwgc2hlbGxBcmdzKSxcbiAgICAgIGNyZWF0ZUZpbGVTeXN0ZW1XYXRjaGVyOiAoZ2xvYlBhdHRlcm4sIGlnbm9yZUNyZWF0ZUV2ZW50cz8sIGlnbm9yZUNoYW5nZUV2ZW50cz8sIGlnbm9yZURlbGV0ZUV2ZW50cz8pID0+IFxuICAgICAgICB2c2NvZGUud29ya3NwYWNlLmNyZWF0ZUZpbGVTeXN0ZW1XYXRjaGVyKGdsb2JQYXR0ZXJuLCBpZ25vcmVDcmVhdGVFdmVudHMsIGlnbm9yZUNoYW5nZUV2ZW50cywgaWdub3JlRGVsZXRlRXZlbnRzKSxcbiAgICAgIGZpbmRGaWxlczogKGluY2x1ZGUsIGV4Y2x1ZGU/LCBtYXhSZXN1bHRzPywgdG9rZW4/KSA9PiB2c2NvZGUud29ya3NwYWNlLmZpbmRGaWxlcyhpbmNsdWRlLCBleGNsdWRlLCBtYXhSZXN1bHRzLCB0b2tlbiksXG4gICAgICBvcGVuVGV4dERvY3VtZW50OiAodXJpKSA9PiB2c2NvZGUud29ya3NwYWNlLm9wZW5UZXh0RG9jdW1lbnQodXJpKSxcbiAgICAgIHNhdmVBbGw6IChpbmNsdWRlVW50aXRsZWQ/KSA9PiB2c2NvZGUud29ya3NwYWNlLnNhdmVBbGwoaW5jbHVkZVVudGl0bGVkKSxcbiAgICAgIGFwcGx5RWRpdDogKGVkaXQpID0+IHZzY29kZS53b3Jrc3BhY2UuYXBwbHlFZGl0KGVkaXQpLFxuICAgICAgY3JlYXRlRGlhZ25vc3RpY0NvbGxlY3Rpb246IChuYW1lPykgPT4gdnNjb2RlLmxhbmd1YWdlcy5jcmVhdGVEaWFnbm9zdGljQ29sbGVjdGlvbihuYW1lKSxcbiAgICAgIFxuICAgICAgLy8gUHJvdmlkZXIgcmVnaXN0cmF0aW9uc1xuICAgICAgcmVnaXN0ZXJDb2RlQWN0aW9uc1Byb3ZpZGVyOiAoc2VsZWN0b3IsIHByb3ZpZGVyKSA9PiB2c2NvZGUubGFuZ3VhZ2VzLnJlZ2lzdGVyQ29kZUFjdGlvbnNQcm92aWRlcihzZWxlY3RvciwgcHJvdmlkZXIpLFxuICAgICAgcmVnaXN0ZXJDb21wbGV0aW9uSXRlbVByb3ZpZGVyOiAoc2VsZWN0b3IsIHByb3ZpZGVyLCAuLi50cmlnZ2VyQ2hhcmFjdGVycykgPT4gXG4gICAgICAgIHZzY29kZS5sYW5ndWFnZXMucmVnaXN0ZXJDb21wbGV0aW9uSXRlbVByb3ZpZGVyKHNlbGVjdG9yLCBwcm92aWRlciwgLi4udHJpZ2dlckNoYXJhY3RlcnMpLFxuICAgICAgcmVnaXN0ZXJEZWZpbml0aW9uUHJvdmlkZXI6IChzZWxlY3RvciwgcHJvdmlkZXIpID0+IHZzY29kZS5sYW5ndWFnZXMucmVnaXN0ZXJEZWZpbml0aW9uUHJvdmlkZXIoc2VsZWN0b3IsIHByb3ZpZGVyKSxcbiAgICAgIHJlZ2lzdGVySG92ZXJQcm92aWRlcjogKHNlbGVjdG9yLCBwcm92aWRlcikgPT4gdnNjb2RlLmxhbmd1YWdlcy5yZWdpc3RlckhvdmVyUHJvdmlkZXIoc2VsZWN0b3IsIHByb3ZpZGVyKSxcbiAgICAgIHJlZ2lzdGVyRG9jdW1lbnRGb3JtYXR0aW5nRWRpdFByb3ZpZGVyOiAoc2VsZWN0b3IsIHByb3ZpZGVyKSA9PiBcbiAgICAgICAgdnNjb2RlLmxhbmd1YWdlcy5yZWdpc3RlckRvY3VtZW50Rm9ybWF0dGluZ0VkaXRQcm92aWRlcihzZWxlY3RvciwgcHJvdmlkZXIpLFxuICAgICAgcmVnaXN0ZXJEb2N1bWVudFJhbmdlRm9ybWF0dGluZ0VkaXRQcm92aWRlcjogKHNlbGVjdG9yLCBwcm92aWRlcikgPT4gXG4gICAgICAgIHZzY29kZS5sYW5ndWFnZXMucmVnaXN0ZXJEb2N1bWVudFJhbmdlRm9ybWF0dGluZ0VkaXRQcm92aWRlcihzZWxlY3RvciwgcHJvdmlkZXIpLFxuICAgICAgcmVnaXN0ZXJSZW5hbWVQcm92aWRlcjogKHNlbGVjdG9yLCBwcm92aWRlcikgPT4gdnNjb2RlLmxhbmd1YWdlcy5yZWdpc3RlclJlbmFtZVByb3ZpZGVyKHNlbGVjdG9yLCBwcm92aWRlciksXG4gICAgICByZWdpc3RlclJlZmVyZW5jZVByb3ZpZGVyOiAoc2VsZWN0b3IsIHByb3ZpZGVyKSA9PiB2c2NvZGUubGFuZ3VhZ2VzLnJlZ2lzdGVyUmVmZXJlbmNlUHJvdmlkZXIoc2VsZWN0b3IsIHByb3ZpZGVyKSxcbiAgICAgIHJlZ2lzdGVyRG9jdW1lbnRTeW1ib2xQcm92aWRlcjogKHNlbGVjdG9yLCBwcm92aWRlcikgPT4gdnNjb2RlLmxhbmd1YWdlcy5yZWdpc3RlckRvY3VtZW50U3ltYm9sUHJvdmlkZXIoc2VsZWN0b3IsIHByb3ZpZGVyKSxcbiAgICAgIHJlZ2lzdGVyRG9jdW1lbnRIaWdobGlnaHRQcm92aWRlcjogKHNlbGVjdG9yLCBwcm92aWRlcikgPT4gdnNjb2RlLmxhbmd1YWdlcy5yZWdpc3RlckRvY3VtZW50SGlnaGxpZ2h0UHJvdmlkZXIoc2VsZWN0b3IsIHByb3ZpZGVyKSxcbiAgICAgIHJlZ2lzdGVyRG9jdW1lbnRMaW5rUHJvdmlkZXI6IChzZWxlY3RvciwgcHJvdmlkZXIpID0+IHZzY29kZS5sYW5ndWFnZXMucmVnaXN0ZXJEb2N1bWVudExpbmtQcm92aWRlcihzZWxlY3RvciwgcHJvdmlkZXIpLFxuICAgICAgcmVnaXN0ZXJTaWduYXR1cmVIZWxwUHJvdmlkZXI6IChzZWxlY3RvciwgcHJvdmlkZXIsIC4uLnRyaWdnZXJDaGFyYWN0ZXJzKSA9PiBcbiAgICAgICAgdnNjb2RlLmxhbmd1YWdlcy5yZWdpc3RlclNpZ25hdHVyZUhlbHBQcm92aWRlcihzZWxlY3RvciwgcHJvdmlkZXIsIC4uLnRyaWdnZXJDaGFyYWN0ZXJzKSxcbiAgICAgIFxuICAgICAgLy8gRGVidWcgYW5kIHRhc2sgQVBJc1xuICAgICAgcmVnaXN0ZXJEZWJ1Z0NvbmZpZ3VyYXRpb25Qcm92aWRlcjogKHR5cGUsIHByb3ZpZGVyKSA9PiB2c2NvZGUuZGVidWcucmVnaXN0ZXJEZWJ1Z0NvbmZpZ3VyYXRpb25Qcm92aWRlcih0eXBlLCBwcm92aWRlciksXG4gICAgICByZWdpc3RlckRlYnVnQWRhcHRlckRlc2NyaXB0b3JGYWN0b3J5OiAodHlwZSwgZmFjdG9yeSkgPT4gdnNjb2RlLmRlYnVnLnJlZ2lzdGVyRGVidWdBZGFwdGVyRGVzY3JpcHRvckZhY3RvcnkodHlwZSwgZmFjdG9yeSksXG4gICAgICByZWdpc3RlclRhc2tQcm92aWRlcjogKHR5cGUsIHByb3ZpZGVyKSA9PiB2c2NvZGUudGFza3MucmVnaXN0ZXJUYXNrUHJvdmlkZXIodHlwZSwgcHJvdmlkZXIpLFxuICAgICAgY3JlYXRlVGFzazogKGRlZmluaXRpb24sIG5hbWUsIHNvdXJjZSwgZXhlY3V0aW9uLCBwcm9ibGVtTWF0Y2hlcnM/KSA9PiBuZXcgdnNjb2RlLlRhc2soZGVmaW5pdGlvbiwgdnNjb2RlLlRhc2tTY29wZS5Xb3Jrc3BhY2UsIG5hbWUsIHNvdXJjZSwgZXhlY3V0aW9uLCBwcm9ibGVtTWF0Y2hlcnMpLFxuICAgICAgZXhlY3V0ZVRhc2s6ICh0YXNrKSA9PiB2c2NvZGUudGFza3MuZXhlY3V0ZVRhc2sodGFzayksXG4gICAgICBvbkRpZFN0YXJ0VGFzazogKGNhbGxiYWNrKSA9PiB2c2NvZGUudGFza3Mub25EaWRTdGFydFRhc2soY2FsbGJhY2spLFxuICAgICAgb25EaWRFbmRUYXNrOiAoY2FsbGJhY2spID0+IHZzY29kZS50YXNrcy5vbkRpZEVuZFRhc2soY2FsbGJhY2spLFxuICAgICAgb25EaWRTdGFydFRhc2tQcm9jZXNzOiAoY2FsbGJhY2spID0+IHZzY29kZS50YXNrcy5vbkRpZFN0YXJ0VGFza1Byb2Nlc3MoY2FsbGJhY2spLFxuICAgICAgb25EaWRFbmRUYXNrUHJvY2VzczogKGNhbGxiYWNrKSA9PiB2c2NvZGUudGFza3Mub25EaWRFbmRUYXNrUHJvY2VzcyhjYWxsYmFjayksXG4gICAgICBcbiAgICAgIC8vIEFkZGl0aW9uYWwgcHJvdmlkZXIgbWV0aG9kc1xuICAgICAgY3JlYXRlVHJlZURhdGFQcm92aWRlcjogKHZpZXdJZCwgdHJlZURhdGFQcm92aWRlcikgPT4gKHsgZGlzcG9zZTogKCkgPT4ge30gfSksXG4gICAgICBjcmVhdGVDdXN0b21UZXh0RWRpdG9yUHJvdmlkZXI6ICh2aWV3VHlwZSwgcHJvdmlkZXIpID0+ICh7IGRpc3Bvc2U6ICgpID0+IHt9IH0pLFxuICAgICAgY3JlYXRlQ3VzdG9tRWRpdG9yUHJvdmlkZXI6ICh2aWV3VHlwZSwgcHJvdmlkZXIsIG9wdGlvbnM/KSA9PiAoeyBkaXNwb3NlOiAoKSA9PiB7fSB9KSxcbiAgICAgIGNyZWF0ZVdlYnZpZXdWaWV3UHJvdmlkZXI6ICh2aWV3SWQsIHByb3ZpZGVyKSA9PiAoeyBkaXNwb3NlOiAoKSA9PiB7fSB9KSxcbiAgICAgIGNyZWF0ZUF1dGhlbnRpY2F0aW9uUHJvdmlkZXI6IChpZCwgbGFiZWwsIHByb3ZpZGVyLCBvcHRpb25zPykgPT4gKHsgZGlzcG9zZTogKCkgPT4ge30gfSksXG4gICAgICBjcmVhdGVTb3VyY2VDb250cm9sUmVzb3VyY2VHcm91cDogKGlkLCBsYWJlbCkgPT4gKHt9IGFzIGFueSksXG4gICAgICBjcmVhdGVTb3VyY2VDb250cm9sOiAoaWQsIGxhYmVsLCByb290VXJpPykgPT4gKHt9IGFzIGFueSksXG4gICAgICBjcmVhdGVDb21tZW50Q29udHJvbGxlcjogKGlkLCBsYWJlbCkgPT4gKHt9IGFzIGFueSksXG4gICAgICBjcmVhdGVOb3RlYm9va0NvbnRyb2xsZXI6IChpZCwgbm90ZWJvb2tUeXBlLCBsYWJlbCkgPT4gKHt9IGFzIGFueSksXG4gICAgICBjcmVhdGVOb3RlYm9va0NlbGxFeGVjdXRpb246ICh1cmkpID0+ICh7fSBhcyBhbnkpLFxuICAgICAgY3JlYXRlTm90ZWJvb2tDZWxsT3V0cHV0OiAoaXRlbXMpID0+ICh7fSBhcyBhbnkpLFxuICAgICAgY3JlYXRlTm90ZWJvb2tDZWxsT3V0cHV0SXRlbTogKGRhdGEsIG1pbWUpID0+ICh7fSBhcyBhbnkpLFxuICAgICAgY3JlYXRlTm90ZWJvb2tEb2N1bWVudDogKHVyaSwgbm90ZWJvb2tUeXBlLCBtZXRhZGF0YT8pID0+ICh7fSBhcyBhbnkpLFxuICAgICAgY3JlYXRlTm90ZWJvb2tFZGl0OiAodXJpLCBlZGl0KSA9PiAoe30gYXMgYW55KSxcbiAgICAgIGNyZWF0ZU5vdGVib29rUmFuZ2U6IChzdGFydCwgZW5kKSA9PiAoe30gYXMgYW55KSxcbiAgICAgIGNyZWF0ZU5vdGVib29rQ2VsbDogKGtpbmQsIHZhbHVlLCBsYW5ndWFnZUlkLCBvdXRwdXRzPywgbWV0YWRhdGE/LCBleGVjdXRpb25TdW1tYXJ5PykgPT4gKHt9IGFzIGFueSksXG4gICAgICBjcmVhdGVOb3RlYm9va0NlbGxEYXRhOiAoa2luZCwgdmFsdWUsIGxhbmd1YWdlSWQsIG91dHB1dHM/LCBtZXRhZGF0YT8sIGV4ZWN1dGlvblN1bW1hcnk/KSA9PiAoe30gYXMgYW55KSxcbiAgICAgIGNyZWF0ZU5vdGVib29rRGF0YTogKGNlbGxzLCBtZXRhZGF0YT8pID0+ICh7fSBhcyBhbnkpLFxuICAgICAgY3JlYXRlTm90ZWJvb2tEb2N1bWVudEZpbHRlcjogKHBhdHRlcm4/LCBzY2hlbWU/LCBsYW5ndWFnZT8pID0+ICh7fSBhcyBhbnkpLFxuICAgICAgY3JlYXRlTm90ZWJvb2tEb2N1bWVudE1ldGFkYXRhOiAobWV0YWRhdGE/KSA9PiAoe30gYXMgYW55KSxcbiAgICAgIFxuICAgICAgLy8gRXZlbnRzXG4gICAgICBlbWl0OiAoZXZlbnQ6IHN0cmluZywgZGF0YT86IGFueSkgPT4gdGhpcy5ldmVudEVtaXR0ZXIuZW1pdChldmVudCwgZGF0YSksXG4gICAgICBvbjogKGV2ZW50OiBzdHJpbmcsIGhhbmRsZXI6IChkYXRhOiBhbnkpID0+IHZvaWQpID0+IHRoaXMuZXZlbnRFbWl0dGVyLm9uKGV2ZW50LCBoYW5kbGVyKSxcbiAgICAgIG9mZjogKGV2ZW50OiBzdHJpbmcsIGhhbmRsZXI/OiAoZGF0YTogYW55KSA9PiB2b2lkKSA9PiB7XG4gICAgICAgIGlmIChoYW5kbGVyKSB7XG4gICAgICAgICAgdGhpcy5ldmVudEVtaXR0ZXIub2ZmKGV2ZW50LCBoYW5kbGVyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmV2ZW50RW1pdHRlci5yZW1vdmVBbGxMaXN0ZW5lcnMoZXZlbnQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUGx1Z2luQ29udGV4dCgpOiBQbHVnaW5Db250ZXh0IHtcbiAgICByZXR1cm4ge1xuICAgICAgc3Vic2NyaXB0aW9uczogdGhpcy5leHRlbnNpb25Db250ZXh0LnN1YnNjcmlwdGlvbnMsXG4gICAgICB3b3Jrc3BhY2VTdGF0ZTogdGhpcy5leHRlbnNpb25Db250ZXh0LndvcmtzcGFjZVN0YXRlLFxuICAgICAgZ2xvYmFsU3RhdGU6IHRoaXMuZXh0ZW5zaW9uQ29udGV4dC5nbG9iYWxTdGF0ZSxcbiAgICAgIHNlY3JldHM6IHRoaXMuZXh0ZW5zaW9uQ29udGV4dC5zZWNyZXRzLFxuICAgICAgZXh0ZW5zaW9uVXJpOiB0aGlzLmV4dGVuc2lvbkNvbnRleHQuZXh0ZW5zaW9uVXJpLFxuICAgICAgZXh0ZW5zaW9uUGF0aDogdGhpcy5leHRlbnNpb25Db250ZXh0LmV4dGVuc2lvblBhdGgsXG4gICAgICBlbnZpcm9ubWVudFZhcmlhYmxlQ29sbGVjdGlvbjogdGhpcy5leHRlbnNpb25Db250ZXh0LmVudmlyb25tZW50VmFyaWFibGVDb2xsZWN0aW9uLFxuICAgICAgYXNBYnNvbHV0ZVBhdGg6IChyZWxhdGl2ZVBhdGg6IHN0cmluZykgPT4gdGhpcy5leHRlbnNpb25Db250ZXh0LmFzQWJzb2x1dGVQYXRoKHJlbGF0aXZlUGF0aCksXG4gICAgICBzdG9yYWdlVXJpOiB0aGlzLmV4dGVuc2lvbkNvbnRleHQuc3RvcmFnZVVyaSxcbiAgICAgIHN0b3JhZ2VQYXRoOiB0aGlzLmV4dGVuc2lvbkNvbnRleHQuc3RvcmFnZVBhdGgsXG4gICAgICBnbG9iYWxTdG9yYWdlVXJpOiB0aGlzLmV4dGVuc2lvbkNvbnRleHQuZ2xvYmFsU3RvcmFnZVVyaSxcbiAgICAgIGdsb2JhbFN0b3JhZ2VQYXRoOiB0aGlzLmV4dGVuc2lvbkNvbnRleHQuZ2xvYmFsU3RvcmFnZVBhdGgsXG4gICAgICBsb2dVcmk6IHRoaXMuZXh0ZW5zaW9uQ29udGV4dC5sb2dVcmksXG4gICAgICBsb2dQYXRoOiB0aGlzLmV4dGVuc2lvbkNvbnRleHQubG9nUGF0aCxcbiAgICAgIGV4dGVuc2lvbk1vZGU6IHRoaXMuZXh0ZW5zaW9uQ29udGV4dC5leHRlbnNpb25Nb2RlLFxuICAgICAgZXh0ZW5zaW9uOiB0aGlzLmV4dGVuc2lvbkNvbnRleHQuZXh0ZW5zaW9uLFxuICAgICAgd29ya3NwYWNlUm9vdDogdGhpcy53b3Jrc3BhY2VSb290LFxuICAgICAgY3VycmVudEZpbGU6IHZzY29kZS53aW5kb3cuYWN0aXZlVGV4dEVkaXRvcj8uZG9jdW1lbnQuZmlsZU5hbWUsXG4gICAgICBzZWxlY3RlZFRleHQ6IHZzY29kZS53aW5kb3cuYWN0aXZlVGV4dEVkaXRvcj8uZG9jdW1lbnQuZ2V0VGV4dChcbiAgICAgICAgdnNjb2RlLndpbmRvdy5hY3RpdmVUZXh0RWRpdG9yPy5zZWxlY3Rpb25cbiAgICAgICksXG4gICAgICBleGVjdXRpb25IaXN0b3J5OiBbXSxcbiAgICAgIGFpSW5zaWdodHM6IFtdLFxuICAgICAgY29sbGFib3JhdGlvbkRhdGE6IHt9LFxuICAgICAgY3VzdG9tRGF0YToge31cbiAgICB9O1xuICB9XG5cbiAgLy8gUGx1Z2luIFJlZ2lzdHJ5IGltcGxlbWVudGF0aW9uXG4gIGFzeW5jIHJlZ2lzdGVyKHBsdWdpbjogUGx1Z2luKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgeyBpZCB9ID0gcGx1Z2luLm1ldGFkYXRhO1xuICAgIFxuICAgIGlmICh0aGlzLnBsdWdpbnMuaGFzKGlkKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBQbHVnaW4gd2l0aCBJRCAnJHtpZH0nIGlzIGFscmVhZHkgcmVnaXN0ZXJlZGApO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIHBsdWdpblxuICAgIGF3YWl0IHRoaXMudmFsaWRhdGVQbHVnaW4ocGx1Z2luKTtcblxuICAgIC8vIFN0b3JlIHBsdWdpblxuICAgIHRoaXMucGx1Z2lucy5zZXQoaWQsIHBsdWdpbik7XG4gICAgXG4gICAgLy8gU2V0IGRlZmF1bHQgY29uZmlnXG4gICAgaWYgKCF0aGlzLnBsdWdpbkNvbmZpZ3MuaGFzKGlkKSkge1xuICAgICAgdGhpcy5wbHVnaW5Db25maWdzLnNldChpZCwge1xuICAgICAgICBlbmFibGVkOiBwbHVnaW4ubWV0YWRhdGEuZW5hYmxlZCxcbiAgICAgICAgc2V0dGluZ3M6IHBsdWdpbi5tZXRhZGF0YS5jb25maWcgfHwge30sXG4gICAgICAgIHBlcm1pc3Npb25zOiBbXSxcbiAgICAgICAgcmVzb3VyY2VzOiB7fVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQWN0aXZhdGUgaWYgZW5hYmxlZFxuICAgIGlmICh0aGlzLmlzRW5hYmxlZChpZCkpIHtcbiAgICAgIGF3YWl0IHRoaXMuYWN0aXZhdGVQbHVnaW4oaWQpO1xuICAgIH1cblxuICAgIHRoaXMuZW1pdEV2ZW50KFBMVUdJTl9FVkVOVFMuQUNUSVZBVEVELCB7IHBsdWdpbklkOiBpZCB9KTtcbiAgfVxuXG4gIGFzeW5jIHVucmVnaXN0ZXIocGx1Z2luSWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHBsdWdpbiA9IHRoaXMucGx1Z2lucy5nZXQocGx1Z2luSWQpO1xuICAgIGlmICghcGx1Z2luKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFBsdWdpbiB3aXRoIElEICcke3BsdWdpbklkfScgbm90IGZvdW5kYCk7XG4gICAgfVxuXG4gICAgLy8gRGVhY3RpdmF0ZSBpZiBhY3RpdmVcbiAgICBpZiAodGhpcy5pc0VuYWJsZWQocGx1Z2luSWQpKSB7XG4gICAgICBhd2FpdCB0aGlzLmRlYWN0aXZhdGVQbHVnaW4ocGx1Z2luSWQpO1xuICAgIH1cblxuICAgIC8vIFJlbW92ZSBmcm9tIHN0b3JhZ2VcbiAgICB0aGlzLnBsdWdpbnMuZGVsZXRlKHBsdWdpbklkKTtcbiAgICB0aGlzLnBsdWdpbkNvbmZpZ3MuZGVsZXRlKHBsdWdpbklkKTtcblxuICAgIHRoaXMuZW1pdEV2ZW50KFBMVUdJTl9FVkVOVFMuREVBQ1RJVkFURUQsIHsgcGx1Z2luSWQgfSk7XG4gIH1cblxuICBnZXQocGx1Z2luSWQ6IHN0cmluZyk6IFBsdWdpbiB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMucGx1Z2lucy5nZXQocGx1Z2luSWQpO1xuICB9XG5cbiAgZ2V0QWxsKCk6IFBsdWdpbltdIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLnBsdWdpbnMudmFsdWVzKCkpO1xuICB9XG5cbiAgZ2V0UGx1Z2luKHBsdWdpbklkOiBzdHJpbmcpOiBQbHVnaW4gfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLnBsdWdpbnMuZ2V0KHBsdWdpbklkKTtcbiAgfVxuXG4gIGdldEFsbFBsdWdpbnMoKTogUGx1Z2luW10ge1xuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMucGx1Z2lucy52YWx1ZXMoKSk7XG4gIH1cblxuICBnZXRCeUNhcGFiaWxpdHkoY2FwYWJpbGl0eTogc3RyaW5nKTogUGx1Z2luW10ge1xuICAgIHJldHVybiB0aGlzLmdldEFsbCgpLmZpbHRlcihwbHVnaW4gPT4gXG4gICAgICBwbHVnaW4ubWV0YWRhdGEuY2FwYWJpbGl0aWVzLnNvbWUoY2FwID0+IGNhcC50eXBlID09PSBjYXBhYmlsaXR5KVxuICAgICk7XG4gIH1cblxuICBpc0VuYWJsZWQocGx1Z2luSWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMucGx1Z2luQ29uZmlncy5nZXQocGx1Z2luSWQpO1xuICAgIHJldHVybiBjb25maWc/LmVuYWJsZWQgPz8gZmFsc2U7XG4gIH1cblxuICBhc3luYyBlbmFibGUocGx1Z2luSWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMucGx1Z2luQ29uZmlncy5nZXQocGx1Z2luSWQpO1xuICAgIGlmICghY29uZmlnKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFBsdWdpbiAnJHtwbHVnaW5JZH0nIG5vdCBmb3VuZGApO1xuICAgIH1cblxuICAgIGNvbmZpZy5lbmFibGVkID0gdHJ1ZTtcbiAgICBhd2FpdCB0aGlzLmFjdGl2YXRlUGx1Z2luKHBsdWdpbklkKTtcbiAgICB0aGlzLnNhdmVQbHVnaW5Db25maWcocGx1Z2luSWQsIGNvbmZpZyk7XG4gIH1cblxuICBhc3luYyBkaXNhYmxlKHBsdWdpbklkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBjb25maWcgPSB0aGlzLnBsdWdpbkNvbmZpZ3MuZ2V0KHBsdWdpbklkKTtcbiAgICBpZiAoIWNvbmZpZykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBQbHVnaW4gJyR7cGx1Z2luSWR9JyBub3QgZm91bmRgKTtcbiAgICB9XG5cbiAgICBjb25maWcuZW5hYmxlZCA9IGZhbHNlO1xuICAgIGF3YWl0IHRoaXMuZGVhY3RpdmF0ZVBsdWdpbihwbHVnaW5JZCk7XG4gICAgdGhpcy5zYXZlUGx1Z2luQ29uZmlnKHBsdWdpbklkLCBjb25maWcpO1xuICB9XG5cbiAgLy8gUGx1Z2luIGxpZmVjeWNsZVxuICBwcml2YXRlIGFzeW5jIGFjdGl2YXRlUGx1Z2luKHBsdWdpbklkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBwbHVnaW4gPSB0aGlzLnBsdWdpbnMuZ2V0KHBsdWdpbklkKTtcbiAgICBpZiAoIXBsdWdpbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBQbHVnaW4gJyR7cGx1Z2luSWR9JyBub3QgZm91bmRgKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgcGx1Z2luLmFjdGl2YXRlKHRoaXMucGx1Z2luQVBJLCB0aGlzLmNvbnRleHQpO1xuICAgICAgXG4gICAgICAvLyBSZWdpc3RlciBwbHVnaW4gY2FwYWJpbGl0aWVzXG4gICAgICB0aGlzLnJlZ2lzdGVyUGx1Z2luQ2FwYWJpbGl0aWVzKHBsdWdpbik7XG4gICAgICBcbiAgICAgIC8vIEV4ZWN1dGUgYWN0aXZhdGlvbiBob29rXG4gICAgICBpZiAocGx1Z2luLmhvb2tzPy5vbkFjdGl2YXRlKSB7XG4gICAgICAgIGF3YWl0IHBsdWdpbi5ob29rcy5vbkFjdGl2YXRlKHRoaXMuY29udGV4dCk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMuZW1pdEV2ZW50KFBMVUdJTl9FVkVOVFMuRVJST1IsIHsgXG4gICAgICAgIHBsdWdpbklkLCBcbiAgICAgICAgZXJyb3I6IChlcnJvciBhcyBFcnJvcikubWVzc2FnZSBcbiAgICAgIH0pO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBkZWFjdGl2YXRlUGx1Z2luKHBsdWdpbklkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBwbHVnaW4gPSB0aGlzLnBsdWdpbnMuZ2V0KHBsdWdpbklkKTtcbiAgICBpZiAoIXBsdWdpbikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBFeGVjdXRlIGRlYWN0aXZhdGlvbiBob29rXG4gICAgICBpZiAocGx1Z2luLmhvb2tzPy5vbkRlYWN0aXZhdGUpIHtcbiAgICAgICAgYXdhaXQgcGx1Z2luLmhvb2tzLm9uRGVhY3RpdmF0ZSh0aGlzLmNvbnRleHQpO1xuICAgICAgfVxuXG4gICAgICBhd2FpdCBwbHVnaW4uZGVhY3RpdmF0ZSh0aGlzLnBsdWdpbkFQSSwgdGhpcy5jb250ZXh0KTtcbiAgICAgIFxuICAgICAgLy8gVW5yZWdpc3RlciBwbHVnaW4gY2FwYWJpbGl0aWVzXG4gICAgICB0aGlzLnVucmVnaXN0ZXJQbHVnaW5DYXBhYmlsaXRpZXMocGx1Z2luKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5lbWl0RXZlbnQoUExVR0lOX0VWRU5UUy5FUlJPUiwgeyBcbiAgICAgICAgcGx1Z2luSWQsIFxuICAgICAgICBlcnJvcjogKGVycm9yIGFzIEVycm9yKS5tZXNzYWdlIFxuICAgICAgfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyUGx1Z2luQ2FwYWJpbGl0aWVzKHBsdWdpbjogUGx1Z2luKTogdm9pZCB7XG4gICAgY29uc3QgeyBpZCB9ID0gcGx1Z2luLm1ldGFkYXRhO1xuXG4gICAgLy8gUmVnaXN0ZXIgY29tbWFuZHNcbiAgICBpZiAocGx1Z2luLmNvbW1hbmRzKSB7XG4gICAgICBwbHVnaW4uY29tbWFuZHMuZm9yRWFjaChjb21tYW5kID0+IHtcbiAgICAgICAgdGhpcy5yZWdpc3RlckNvbW1hbmQoY29tbWFuZCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBSZWdpc3RlciBhbmFseXplcnNcbiAgICBpZiAocGx1Z2luLmFuYWx5emVycykge1xuICAgICAgcGx1Z2luLmFuYWx5emVycy5mb3JFYWNoKGFuYWx5emVyID0+IHtcbiAgICAgICAgdGhpcy5yZWdpc3RlckFuYWx5emVyKGFuYWx5emVyKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFJlZ2lzdGVyIGZvcm1hdHRlcnNcbiAgICBpZiAocGx1Z2luLmZvcm1hdHRlcnMpIHtcbiAgICAgIHBsdWdpbi5mb3JtYXR0ZXJzLmZvckVhY2goZm9ybWF0dGVyID0+IHtcbiAgICAgICAgdGhpcy5yZWdpc3RlckZvcm1hdHRlcihmb3JtYXR0ZXIpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gUmVnaXN0ZXIgdHJhbnNmb3JtZXJzXG4gICAgaWYgKHBsdWdpbi50cmFuc2Zvcm1lcnMpIHtcbiAgICAgIHBsdWdpbi50cmFuc2Zvcm1lcnMuZm9yRWFjaCh0cmFuc2Zvcm1lciA9PiB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXJUcmFuc2Zvcm1lcih0cmFuc2Zvcm1lcik7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBSZWdpc3RlciB2YWxpZGF0b3JzXG4gICAgaWYgKHBsdWdpbi52YWxpZGF0b3JzKSB7XG4gICAgICBwbHVnaW4udmFsaWRhdG9ycy5mb3JFYWNoKHZhbGlkYXRvciA9PiB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXJWYWxpZGF0b3IodmFsaWRhdG9yKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgdW5yZWdpc3RlclBsdWdpbkNhcGFiaWxpdGllcyhwbHVnaW46IFBsdWdpbik6IHZvaWQge1xuICAgIC8vIEltcGxlbWVudGF0aW9uIHdvdWxkIHJlbW92ZSByZWdpc3RlcmVkIGNhcGFiaWxpdGllc1xuICAgIC8vIFRoaXMgaXMgYSBzaW1wbGlmaWVkIHZlcnNpb25cbiAgfVxuXG4gIC8vIENhcGFiaWxpdHkgcmVnaXN0cmF0aW9uIG1ldGhvZHNcbiAgcHJpdmF0ZSByZWdpc3RlckNvbW1hbmQoY29tbWFuZDogYW55KTogdm9pZCB7XG4gICAgLy8gUmVnaXN0ZXIgVlNDb2RlIGNvbW1hbmRcbiAgICBjb25zdCBkaXNwb3NhYmxlID0gdnNjb2RlLmNvbW1hbmRzLnJlZ2lzdGVyQ29tbWFuZChcbiAgICAgIGBhaURlYnVnLnBsdWdpbi4ke2NvbW1hbmQuaWR9YCxcbiAgICAgIGFzeW5jICguLi5hcmdzOiBhbnlbXSkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbW1hbmQuZXhlY3V0ZSh0aGlzLmNvbnRleHQsIGFyZ3MpO1xuICAgICAgICAgIHRoaXMuZW1pdEV2ZW50KFBMVUdJTl9FVkVOVFMuQ09NTUFORF9FWEVDVVRFRCwge1xuICAgICAgICAgICAgY29tbWFuZElkOiBjb21tYW5kLmlkLFxuICAgICAgICAgICAgcmVzdWx0XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICB0aGlzLmVtaXRFdmVudChQTFVHSU5fRVZFTlRTLkVSUk9SLCB7XG4gICAgICAgICAgICBjb21tYW5kSWQ6IGNvbW1hbmQuaWQsXG4gICAgICAgICAgICBlcnJvcjogKGVycm9yIGFzIEVycm9yKS5tZXNzYWdlXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICApO1xuXG4gICAgdGhpcy5leHRlbnNpb25Db250ZXh0LnN1YnNjcmlwdGlvbnMucHVzaChkaXNwb3NhYmxlKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVnaXN0ZXJBbmFseXplcihhbmFseXplcjogYW55KTogdm9pZCB7XG4gICAgLy8gU3RvcmUgYW5hbHl6ZXIgZm9yIHVzZSBieSBpbnNpZ2h0IGVuZ2luZVxuICAgIHRoaXMuZXZlbnRFbWl0dGVyLmVtaXQoJ2FuYWx5emVyOnJlZ2lzdGVyZWQnLCBhbmFseXplcik7XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyRm9ybWF0dGVyKGZvcm1hdHRlcjogYW55KTogdm9pZCB7XG4gICAgLy8gU3RvcmUgZm9ybWF0dGVyIGZvciB1c2UgYnkgb3V0cHV0IHN5c3RlbVxuICAgIHRoaXMuZXZlbnRFbWl0dGVyLmVtaXQoJ2Zvcm1hdHRlcjpyZWdpc3RlcmVkJywgZm9ybWF0dGVyKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVnaXN0ZXJUcmFuc2Zvcm1lcih0cmFuc2Zvcm1lcjogYW55KTogdm9pZCB7XG4gICAgLy8gU3RvcmUgdHJhbnNmb3JtZXIgZm9yIHVzZSBieSBwcm9jZXNzaW5nIHBpcGVsaW5lXG4gICAgdGhpcy5ldmVudEVtaXR0ZXIuZW1pdCgndHJhbnNmb3JtZXI6cmVnaXN0ZXJlZCcsIHRyYW5zZm9ybWVyKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVnaXN0ZXJWYWxpZGF0b3IodmFsaWRhdG9yOiBhbnkpOiB2b2lkIHtcbiAgICAvLyBTdG9yZSB2YWxpZGF0b3IgZm9yIHVzZSBieSB2YWxpZGF0aW9uIHN5c3RlbVxuICAgIHRoaXMuZXZlbnRFbWl0dGVyLmVtaXQoJ3ZhbGlkYXRvcjpyZWdpc3RlcmVkJywgdmFsaWRhdG9yKTtcbiAgfVxuXG4gIC8vIFBsdWdpbiB2YWxpZGF0aW9uXG4gIHByaXZhdGUgYXN5bmMgdmFsaWRhdGVQbHVnaW4ocGx1Z2luOiBQbHVnaW4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCB7IG1ldGFkYXRhIH0gPSBwbHVnaW47XG4gICAgXG4gICAgaWYgKCFtZXRhZGF0YS5pZCB8fCAhbWV0YWRhdGEubmFtZSB8fCAhbWV0YWRhdGEudmVyc2lvbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdQbHVnaW4gbXVzdCBoYXZlIGlkLCBuYW1lLCBhbmQgdmVyc2lvbicpO1xuICAgIH1cblxuICAgIGlmICghbWV0YWRhdGEuY2FwYWJpbGl0aWVzIHx8IG1ldGFkYXRhLmNhcGFiaWxpdGllcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUGx1Z2luIG11c3QgZGVjbGFyZSBhdCBsZWFzdCBvbmUgY2FwYWJpbGl0eScpO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIGRlcGVuZGVuY2llc1xuICAgIGlmIChtZXRhZGF0YS5kZXBlbmRlbmNpZXMpIHtcbiAgICAgIGZvciAoY29uc3QgZGVwIG9mIG1ldGFkYXRhLmRlcGVuZGVuY2llcykge1xuICAgICAgICBpZiAoIXRoaXMucGx1Z2lucy5oYXMoZGVwKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTWlzc2luZyBkZXBlbmRlbmN5OiAke2RlcH1gKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIG1ldGhvZHNcbiAgICBpZiAodHlwZW9mIHBsdWdpbi5hY3RpdmF0ZSAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdQbHVnaW4gbXVzdCBoYXZlIGFuIGFjdGl2YXRlIG1ldGhvZCcpO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgcGx1Z2luLmRlYWN0aXZhdGUgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUGx1Z2luIG11c3QgaGF2ZSBhIGRlYWN0aXZhdGUgbWV0aG9kJyk7XG4gICAgfVxuICB9XG5cbiAgLy8gQ29uZmlndXJhdGlvbiBtYW5hZ2VtZW50XG4gIHByaXZhdGUgc2F2ZVBsdWdpbkNvbmZpZyhwbHVnaW5JZDogc3RyaW5nLCBjb25maWc6IFBsdWdpbkNvbmZpZyk6IHZvaWQge1xuICAgIGNvbnN0IGNvbmZpZ3MgPSB0aGlzLmV4dGVuc2lvbkNvbnRleHQuZ2xvYmFsU3RhdGUuZ2V0PFJlY29yZDxzdHJpbmcsIFBsdWdpbkNvbmZpZz4+KCdwbHVnaW5Db25maWdzJywge30pO1xuICAgIGNvbmZpZ3NbcGx1Z2luSWRdID0gY29uZmlnO1xuICAgIHRoaXMuZXh0ZW5zaW9uQ29udGV4dC5nbG9iYWxTdGF0ZS51cGRhdGUoJ3BsdWdpbkNvbmZpZ3MnLCBjb25maWdzKTtcbiAgfVxuXG4gIHByaXZhdGUgbG9hZFBsdWdpbkNvbmZpZ3MoKTogdm9pZCB7XG4gICAgY29uc3QgY29uZmlncyA9IHRoaXMuZXh0ZW5zaW9uQ29udGV4dC5nbG9iYWxTdGF0ZS5nZXQ8UmVjb3JkPHN0cmluZywgUGx1Z2luQ29uZmlnPj4oJ3BsdWdpbkNvbmZpZ3MnLCB7fSk7XG4gICAgZm9yIChjb25zdCBbcGx1Z2luSWQsIGNvbmZpZ10gb2YgT2JqZWN0LmVudHJpZXMoY29uZmlncykpIHtcbiAgICAgIHRoaXMucGx1Z2luQ29uZmlncy5zZXQocGx1Z2luSWQsIGNvbmZpZyk7XG4gICAgfVxuICB9XG5cbiAgLy8gRXZlbnQgaGFuZGxpbmdcbiAgcHJpdmF0ZSBlbWl0RXZlbnQodHlwZTogc3RyaW5nLCBkYXRhPzogYW55KTogdm9pZCB7XG4gICAgY29uc3QgZXZlbnQ6IFBsdWdpbkV2ZW50ID0ge1xuICAgICAgdHlwZSxcbiAgICAgIHBsdWdpbklkOiBkYXRhPy5wbHVnaW5JZCB8fCAnc3lzdGVtJyxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIGRhdGEsXG4gICAgICBzb3VyY2U6ICdwbHVnaW4tbWFuYWdlcidcbiAgICB9O1xuXG4gICAgdGhpcy5ldmVudEVtaXR0ZXIuZW1pdCh0eXBlLCBldmVudCk7XG4gIH1cblxuICAvLyBEZXZlbG9wbWVudCB1dGlsaXRpZXNcbiAgY3JlYXRlRGV2VXRpbHMocGx1Z2luSWQ6IHN0cmluZyk6IFBsdWdpbkRldlV0aWxzIHtcbiAgICByZXR1cm4ge1xuICAgICAgY3JlYXRlVGVzdFN1aXRlOiAoaWQ6IHN0cmluZykgPT4gdGhpcy5jcmVhdGVUZXN0U3VpdGUoaWQpLFxuICAgICAgY3JlYXRlTG9nZ2VyOiAoaWQ6IHN0cmluZykgPT4gdGhpcy5jcmVhdGVMb2dnZXIoaWQpLFxuICAgICAgY3JlYXRlUHJvZmlsZXI6IChpZDogc3RyaW5nKSA9PiB0aGlzLmNyZWF0ZVByb2ZpbGVyKGlkKSxcbiAgICAgIGNyZWF0ZVN0b3JhZ2U6IChpZDogc3RyaW5nKSA9PiB0aGlzLmNyZWF0ZVN0b3JhZ2UoaWQpLFxuICAgICAgY3JlYXRlU2NoZWR1bGVyOiAoaWQ6IHN0cmluZykgPT4gdGhpcy5jcmVhdGVTY2hlZHVsZXIoaWQpXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlTG9nZ2VyKHBsdWdpbklkOiBzdHJpbmcpOiBQbHVnaW5Mb2dnZXIge1xuICAgIHJldHVybiB7XG4gICAgICBpbmZvOiAobWVzc2FnZTogc3RyaW5nLCBkYXRhPzogYW55KSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBbJHtwbHVnaW5JZH1dICR7bWVzc2FnZX1gLCBkYXRhKTtcbiAgICAgIH0sXG4gICAgICB3YXJuOiAobWVzc2FnZTogc3RyaW5nLCBkYXRhPzogYW55KSA9PiB7XG4gICAgICAgIGNvbnNvbGUud2FybihgWyR7cGx1Z2luSWR9XSAke21lc3NhZ2V9YCwgZGF0YSk7XG4gICAgICB9LFxuICAgICAgZXJyb3I6IChtZXNzYWdlOiBzdHJpbmcsIGVycm9yPzogRXJyb3IpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgWyR7cGx1Z2luSWR9XSAke21lc3NhZ2V9YCwgZXJyb3IpO1xuICAgICAgfSxcbiAgICAgIGRlYnVnOiAobWVzc2FnZTogc3RyaW5nLCBkYXRhPzogYW55KSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZGVidWcoYFske3BsdWdpbklkfV0gJHttZXNzYWdlfWAsIGRhdGEpO1xuICAgICAgfSxcbiAgICAgIHRyYWNlOiAobWVzc2FnZTogc3RyaW5nLCBkYXRhPzogYW55KSA9PiB7XG4gICAgICAgIGNvbnNvbGUudHJhY2UoYFske3BsdWdpbklkfV0gJHttZXNzYWdlfWAsIGRhdGEpO1xuICAgICAgfSxcbiAgICAgIHNldExldmVsOiAobGV2ZWw6ICdkZWJ1ZycgfCAnaW5mbycgfCAnd2FybicgfCAnZXJyb3InIHwgJ3RyYWNlJykgPT4ge1xuICAgICAgICAvLyBJbXBsZW1lbnRhdGlvbiB3b3VsZCBzZXQgdGhlIGxvZyBsZXZlbFxuICAgICAgfSxcbiAgICAgIGNyZWF0ZUNoaWxkOiAobmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUxvZ2dlcihgJHtwbHVnaW5JZH06JHtuYW1lfWApO1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVN0b3JhZ2UocGx1Z2luSWQ6IHN0cmluZyk6IFBsdWdpblN0b3JhZ2Uge1xuICAgIGNvbnN0IHByZWZpeCA9IGBwbHVnaW4uJHtwbHVnaW5JZH0uYDtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgZ2V0OiBhc3luYyA8VD4oa2V5OiBzdHJpbmcpOiBQcm9taXNlPFQgfCB1bmRlZmluZWQ+ID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXh0ZW5zaW9uQ29udGV4dC5nbG9iYWxTdGF0ZS5nZXQ8VD4ocHJlZml4ICsga2V5KTtcbiAgICAgIH0sXG4gICAgICBzZXQ6IGFzeW5jIDxUPihrZXk6IHN0cmluZywgdmFsdWU6IFQpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5leHRlbnNpb25Db250ZXh0Lmdsb2JhbFN0YXRlLnVwZGF0ZShwcmVmaXggKyBrZXksIHZhbHVlKTtcbiAgICAgIH0sXG4gICAgICBkZWxldGU6IGFzeW5jIChrZXk6IHN0cmluZyk6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgICAgICBhd2FpdCB0aGlzLmV4dGVuc2lvbkNvbnRleHQuZ2xvYmFsU3RhdGUudXBkYXRlKHByZWZpeCArIGtleSwgdW5kZWZpbmVkKTtcbiAgICAgIH0sXG4gICAgICBjbGVhcjogYXN5bmMgKCk6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgICAgICAvLyBHZXQgYWxsIGtleXMgd2l0aCB0aGlzIHBsdWdpbidzIHByZWZpeCBhbmQgY2xlYXIgdGhlbVxuICAgICAgICBjb25zdCBrZXlzID0gdGhpcy5leHRlbnNpb25Db250ZXh0Lmdsb2JhbFN0YXRlLmtleXMoKTtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2Yga2V5cykge1xuICAgICAgICAgIGlmIChrZXkuc3RhcnRzV2l0aChwcmVmaXgpKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmV4dGVuc2lvbkNvbnRleHQuZ2xvYmFsU3RhdGUudXBkYXRlKGtleSwgdW5kZWZpbmVkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBrZXlzOiBhc3luYyAoKTogUHJvbWlzZTxzdHJpbmdbXT4gPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5leHRlbnNpb25Db250ZXh0Lmdsb2JhbFN0YXRlLmtleXMoKVxuICAgICAgICAgIC5maWx0ZXIoa2V5ID0+IGtleS5zdGFydHNXaXRoKHByZWZpeCkpXG4gICAgICAgICAgLm1hcChrZXkgPT4ga2V5LnN1YnN0cmluZyhwcmVmaXgubGVuZ3RoKSk7XG4gICAgICB9LFxuICAgICAgaGFzOiBhc3luYyAoa2V5OiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+ID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXh0ZW5zaW9uQ29udGV4dC5nbG9iYWxTdGF0ZS5rZXlzKCkuaW5jbHVkZXMocHJlZml4ICsga2V5KTtcbiAgICAgIH0sXG4gICAgICBzaXplOiBhc3luYyAoKTogUHJvbWlzZTxudW1iZXI+ID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXh0ZW5zaW9uQ29udGV4dC5nbG9iYWxTdGF0ZS5rZXlzKClcbiAgICAgICAgICAuZmlsdGVyKGtleSA9PiBrZXkuc3RhcnRzV2l0aChwcmVmaXgpKS5sZW5ndGg7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlU2NoZWR1bGVyKHBsdWdpbklkOiBzdHJpbmcpOiBQbHVnaW5TY2hlZHVsZXIge1xuICAgIGNvbnN0IHRpbWVycyA9IG5ldyBNYXA8c3RyaW5nLCBOb2RlSlMuVGltZW91dD4oKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgc2NoZWR1bGU6ICh0YXNrOiAoKSA9PiBQcm9taXNlPHZvaWQ+IHwgdm9pZCwgZGVsYXk6IG51bWJlcikgPT4ge1xuICAgICAgICBjb25zdCBpZCA9IGB0YXNrXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YDtcbiAgICAgICAgXG4gICAgICAgIC8vIENyZWF0ZSB0aW1lclxuICAgICAgICBjb25zdCB0aW1lciA9IHNldFRpbWVvdXQoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0YXNrKCk7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICB0aGlzLmVtaXRFdmVudChQTFVHSU5fRVZFTlRTLkVSUk9SLCB7XG4gICAgICAgICAgcGx1Z2luSWQsXG4gICAgICAgICAgZXJyb3I6IChlcnJvciBhcyBFcnJvcikubWVzc2FnZSxcbiAgICAgICAgICBzb3VyY2U6ICdzY2hlZHVsZXInXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRpbWVycy5kZWxldGUoaWQpO1xuICAgICAgICB9LCBkZWxheSk7XG5cbiAgICAgICAgdGltZXJzLnNldChpZCwgdGltZXIpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICBjYW5jZWw6ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRpbWVyID0gdGltZXJzLmdldChpZCk7XG4gICAgICAgICAgICBpZiAodGltZXIpIHtcbiAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgICAgICAgICAgdGltZXJzLmRlbGV0ZShpZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICByZXNjaGVkdWxlOiAobmV3RGVsYXk6IG51bWJlcikgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGltZXIgPSB0aW1lcnMuZ2V0KGlkKTtcbiAgICAgICAgICAgIGlmICh0aW1lcikge1xuICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgICAgICAgICAgICBjb25zdCBuZXdUaW1lciA9IHNldFRpbWVvdXQoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICBhd2FpdCB0YXNrKCk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdEV2ZW50KFBMVUdJTl9FVkVOVFMuRVJST1IsIHtcbiAgICAgICAgICAgICAgICAgICAgcGx1Z2luSWQsXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiAoZXJyb3IgYXMgRXJyb3IpLm1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZTogJ3NjaGVkdWxlcidcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aW1lcnMuZGVsZXRlKGlkKTtcbiAgICAgICAgICAgICAgfSwgbmV3RGVsYXkpO1xuICAgICAgICAgICAgICB0aW1lcnMuc2V0KGlkLCBuZXdUaW1lcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSxcbiAgICAgIHNjaGVkdWxlUmVwZWF0aW5nOiAodGFzazogKCkgPT4gUHJvbWlzZTx2b2lkPiB8IHZvaWQsIGludGVydmFsOiBudW1iZXIpID0+IHtcbiAgICAgICAgY29uc3QgaWQgPSBgcmVwZWF0XyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YDtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHRpbWVyID0gc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0YXNrKCk7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMuZW1pdEV2ZW50KFBMVUdJTl9FVkVOVFMuRVJST1IsIHtcbiAgICAgICAgICAgICAgcGx1Z2luSWQsXG4gICAgICAgICAgICAgIGVycm9yOiAoZXJyb3IgYXMgRXJyb3IpLm1lc3NhZ2UsXG4gICAgICAgICAgICAgIHNvdXJjZTogJ3NjaGVkdWxlcidcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgaW50ZXJ2YWwpO1xuXG4gICAgICAgIHRpbWVycy5zZXQoaWQsIHRpbWVyKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgaWQsXG4gICAgICAgICAgY2FuY2VsOiAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0aW1lciA9IHRpbWVycy5nZXQoaWQpO1xuICAgICAgICAgICAgaWYgKHRpbWVyKSB7XG4gICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGltZXIpO1xuICAgICAgICAgICAgICB0aW1lcnMuZGVsZXRlKGlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHJlc2NoZWR1bGU6IChuZXdJbnRlcnZhbDogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0aW1lciA9IHRpbWVycy5nZXQoaWQpO1xuICAgICAgICAgICAgaWYgKHRpbWVyKSB7XG4gICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGltZXIpO1xuICAgICAgICAgICAgICBjb25zdCBuZXdUaW1lciA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgYXdhaXQgdGFzaygpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICB0aGlzLmVtaXRFdmVudChQTFVHSU5fRVZFTlRTLkVSUk9SLCB7XG4gICAgICAgICAgICAgICAgICAgIHBsdWdpbklkLFxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogKGVycm9yIGFzIEVycm9yKS5tZXNzYWdlLFxuICAgICAgICAgICAgICAgICAgICBzb3VyY2U6ICdzY2hlZHVsZXInXG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0sIG5ld0ludGVydmFsKTtcbiAgICAgICAgICAgICAgdGltZXJzLnNldChpZCwgbmV3VGltZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0sXG4gICAgICBjYW5jZWw6IChzY2hlZHVsZWRUYXNrKSA9PiB7XG4gICAgICAgIHNjaGVkdWxlZFRhc2suY2FuY2VsKCk7XG4gICAgICB9LFxuICAgICAgY2FuY2VsQWxsOiAoKSA9PiB7XG4gICAgICAgIGZvciAoY29uc3QgdGltZXIgb2YgdGltZXJzLnZhbHVlcygpKSB7XG4gICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lcik7XG4gICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgICAgfVxuICAgICAgICB0aW1lcnMuY2xlYXIoKTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVUZXN0U3VpdGUocGx1Z2luSWQ6IHN0cmluZyk6IGFueSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFkZFRlc3Q6IChuYW1lOiBzdHJpbmcsIHRlc3Q6ICgpID0+IFByb21pc2U8dm9pZD4gfCB2b2lkKSA9PiB7XG4gICAgICAgIC8vIEltcGxlbWVudGF0aW9uIHdvdWxkIGFkZCB0ZXN0IHRvIHN1aXRlXG4gICAgICB9LFxuICAgICAgYWRkU2V0dXA6IChzZXR1cDogKCkgPT4gUHJvbWlzZTx2b2lkPiB8IHZvaWQpID0+IHtcbiAgICAgICAgLy8gSW1wbGVtZW50YXRpb24gd291bGQgYWRkIHNldHVwXG4gICAgICB9LFxuICAgICAgYWRkVGVhcmRvd246ICh0ZWFyZG93bjogKCkgPT4gUHJvbWlzZTx2b2lkPiB8IHZvaWQpID0+IHtcbiAgICAgICAgLy8gSW1wbGVtZW50YXRpb24gd291bGQgYWRkIHRlYXJkb3duXG4gICAgICB9XG4gICAgfTtcbiAgfVxuICBcbiAgcHJpdmF0ZSBjcmVhdGVQcm9maWxlcihwbHVnaW5JZDogc3RyaW5nKTogYW55IHtcbiAgICByZXR1cm4ge1xuICAgICAgc3RhcnQ6IChuYW1lOiBzdHJpbmcpID0+IHtcbiAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBlbmQ6ICgpID0+IERhdGUubm93KCkgLSBzdGFydFRpbWUsXG4gICAgICAgICAgbWFyazogKG1hcmtOYW1lOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIC8vIEltcGxlbWVudGF0aW9uIHdvdWxkIHJlY29yZCBtYXJrXG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSxcbiAgICAgIG1lYXN1cmU6IDxUPihuYW1lOiBzdHJpbmcsIGZuOiAoKSA9PiBUKTogVCA9PiB7XG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gZm4oKTtcbiAgICAgICAgY29uc29sZS5sb2coYFske3BsdWdpbklkfV0gJHtuYW1lfTogJHtEYXRlLm5vdygpIC0gc3RhcnR9bXNgKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH0sXG4gICAgICBtZWFzdXJlQXN5bmM6IGFzeW5jIDxUPihuYW1lOiBzdHJpbmcsIGZuOiAoKSA9PiBQcm9taXNlPFQ+KTogUHJvbWlzZTxUPiA9PiB7XG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZm4oKTtcbiAgICAgICAgY29uc29sZS5sb2coYFske3BsdWdpbklkfV0gJHtuYW1lfTogJHtEYXRlLm5vdygpIC0gc3RhcnR9bXNgKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLy8gSW50ZWdyYXRpb24gd2l0aCBleGlzdGluZyBzZXJ2aWNlc1xuICBwcml2YXRlIGdldEluc2lnaHRzRW5naW5lKCk6IGFueSB7XG4gICAgLy8gUmV0dXJuIHJlZmVyZW5jZSB0byBleGlzdGluZyBBSSBpbnNpZ2h0cyBlbmdpbmVcbiAgICByZXR1cm4gbnVsbDsgLy8gUGxhY2Vob2xkZXJcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q29sbGFib3JhdGlvblNlcnZpY2UoKTogYW55IHtcbiAgICAvLyBSZXR1cm4gcmVmZXJlbmNlIHRvIGV4aXN0aW5nIGNvbGxhYm9yYXRpb24gc2VydmljZVxuICAgIHJldHVybiBudWxsOyAvLyBQbGFjZWhvbGRlclxuICB9XG5cbiAgcHJpdmF0ZSBnZXRFeGVjdXRpb25TZXJ2aWNlKCk6IGFueSB7XG4gICAgLy8gUmV0dXJuIHJlZmVyZW5jZSB0byBleGlzdGluZyBleGVjdXRpb24gc2VydmljZVxuICAgIHJldHVybiBudWxsOyAvLyBQbGFjZWhvbGRlclxuICB9XG5cbiAgLy8gQnVpbHQtaW4gcGx1Z2lucyBpbml0aWFsaXphdGlvblxuICBwcml2YXRlIGFzeW5jIGluaXRpYWxpemVCdWlsdGluUGx1Z2lucygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBMb2FkIGJ1aWx0LWluIHBsdWdpbnNcbiAgICB0aGlzLmxvYWRQbHVnaW5Db25maWdzKCk7XG4gICAgXG4gICAgLy8gUmVnaXN0ZXIgYnVpbHQtaW4gcGx1Z2luc1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IEdpdEFuYWx5emVyUGx1Z2luLCBUZXN0QW5hbHl6ZXJQbHVnaW4sIEFJUHJvdmlkZXJQbHVnaW4gfSA9IGF3YWl0IGltcG9ydCgnLi9idWlsdGluJyk7XG4gICAgICBcbiAgICAgIC8vIFJlZ2lzdGVyIEdpdCBBbmFseXplciBQbHVnaW5cbiAgICAgIGNvbnN0IGdpdFBsdWdpbiA9IG5ldyBHaXRBbmFseXplclBsdWdpbigpO1xuICAgICAgYXdhaXQgdGhpcy5yZWdpc3RlcihnaXRQbHVnaW4pO1xuICAgICAgXG4gICAgICAvLyBSZWdpc3RlciBUZXN0IEFuYWx5emVyIFBsdWdpblxuICAgICAgY29uc3QgdGVzdFBsdWdpbiA9IG5ldyBUZXN0QW5hbHl6ZXJQbHVnaW4oKTtcbiAgICAgIGF3YWl0IHRoaXMucmVnaXN0ZXIodGVzdFBsdWdpbik7XG4gICAgICBcbiAgICAgIC8vIFJlZ2lzdGVyIEFJIFByb3ZpZGVyIFBsdWdpblxuICAgICAgY29uc3QgYWlQbHVnaW4gPSBuZXcgQUlQcm92aWRlclBsdWdpbigpO1xuICAgICAgYXdhaXQgdGhpcy5yZWdpc3RlcihhaVBsdWdpbik7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCdCdWlsdC1pbiBwbHVnaW5zIGluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseScpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBidWlsdC1pbiBwbHVnaW5zOicsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvLyBQdWJsaWMgQVBJIGZvciBleHRlbnNpb25cbiAgcHVibGljIGFzeW5jIGV4ZWN1dGVQbHVnaW5Db21tYW5kKHBsdWdpbklkOiBzdHJpbmcsIGNvbW1hbmRJZDogc3RyaW5nLCBhcmdzPzogYW55W10pOiBQcm9taXNlPGFueT4ge1xuICAgIGNvbnN0IHBsdWdpbiA9IHRoaXMucGx1Z2lucy5nZXQocGx1Z2luSWQpO1xuICAgIGlmICghcGx1Z2luIHx8ICF0aGlzLmlzRW5hYmxlZChwbHVnaW5JZCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgUGx1Z2luICcke3BsdWdpbklkfScgbm90IGZvdW5kIG9yIG5vdCBlbmFibGVkYCk7XG4gICAgfVxuXG4gICAgY29uc3QgY29tbWFuZCA9IHBsdWdpbi5jb21tYW5kcz8uZmluZChjbWQgPT4gY21kLmlkID09PSBjb21tYW5kSWQpO1xuICAgIGlmICghY29tbWFuZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb21tYW5kICcke2NvbW1hbmRJZH0nIG5vdCBmb3VuZCBpbiBwbHVnaW4gJyR7cGx1Z2luSWR9J2ApO1xuICAgIH1cblxuICAgIHJldHVybiBhd2FpdCBjb21tYW5kLmV4ZWN1dGUodGhpcy5jb250ZXh0LCBhcmdzKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRQbHVnaW5JbnNpZ2h0cyhwbHVnaW5JZDogc3RyaW5nKTogYW55W10ge1xuICAgIC8vIFJldHVybiBpbnNpZ2h0cyBnZW5lcmF0ZWQgYnkgc3BlY2lmaWMgcGx1Z2luXG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIHJlZnJlc2hQbHVnaW5Db250ZXh0KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMuY29udGV4dCA9IHRoaXMuY3JlYXRlUGx1Z2luQ29udGV4dCgpO1xuICAgIFxuICAgIC8vIE5vdGlmeSBhbGwgYWN0aXZlIHBsdWdpbnMgYWJvdXQgY29udGV4dCBjaGFuZ2VcbiAgICBmb3IgKGNvbnN0IFtwbHVnaW5JZCwgcGx1Z2luXSBvZiB0aGlzLnBsdWdpbnMpIHtcbiAgICAgIGlmICh0aGlzLmlzRW5hYmxlZChwbHVnaW5JZCkgJiYgcGx1Z2luLmhvb2tzPy5vbkNvbW1hbmQpIHtcbiAgICAgICAgLy8gVGhpcyBpcyBhIHNpbXBsaWZpZWQgbm90aWZpY2F0aW9uXG4gICAgICAgIC8vIEluIHByYWN0aWNlLCB5b3UnZCBoYXZlIGEgbW9yZSBzb3BoaXN0aWNhdGVkIGNvbnRleHQgdXBkYXRlIHN5c3RlbVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIl0sInZlcnNpb24iOjN9