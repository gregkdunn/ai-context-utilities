b59d987cdceaefefa1b63b5bb68023b8
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
// Mock dependencies
jest.mock('vscode');
jest.mock('child_process');
const GitDiffManager_1 = require("../GitDiffManager");
const vscode = __importStar(require("vscode"));
const child_process_1 = require("child_process");
describe('GitDiffManager', () => {
    let gitManager;
    let mockContext;
    let mockSpawn;
    beforeEach(() => {
        mockContext = {
            subscriptions: [],
            extensionUri: vscode.Uri.file('/test')
        };
        mockSpawn = child_process_1.spawn;
        // Mock vscode.workspace
        vscode.workspace.workspaceFolders = [{ uri: { fsPath: '/test/workspace' } }];
        // Mock vscode.extensions
        vscode.extensions.getExtension = jest.fn().mockReturnValue({
            isActive: true,
            exports: {
                getAPI: jest.fn().mockReturnValue({
                    repositories: [{ mockRepo: true }]
                })
            }
        });
        gitManager = new GitDiffManager_1.GitDiffManager(mockContext);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('getCommitHistory', () => {
        it('should return commit history', async () => {
            mockSpawn.mockImplementation(() => {
                const mockChild = {
                    stdout: {
                        on: (event, callback) => {
                            if (event === 'data') {
                                callback(Buffer.from('abc123|Initial commit|John Doe|2023-01-01|def456\n'));
                            }
                        }
                    },
                    stderr: {
                        on: jest.fn()
                    },
                    on: (event, callback) => {
                        if (event === 'close') {
                            callback(0);
                        }
                    }
                };
                return mockChild;
            });
            const result = await gitManager.getCommitHistory(10);
            expect(result).toHaveLength(1);
            expect(result[0]).toEqual({
                hash: 'abc123',
                message: 'Initial commit',
                author: 'John Doe',
                date: '2023-01-01',
                parents: ['def456']
            });
        });
        it('should handle empty commit history', async () => {
            mockSpawn.mockImplementation(() => {
                const mockChild = {
                    stdout: {
                        on: (event, callback) => {
                            if (event === 'data') {
                                callback(Buffer.from(''));
                            }
                        }
                    },
                    stderr: {
                        on: jest.fn()
                    },
                    on: (event, callback) => {
                        if (event === 'close') {
                            callback(0);
                        }
                    }
                };
                return mockChild;
            });
            const result = await gitManager.getCommitHistory(10);
            expect(result).toEqual([]);
        });
        it('should handle git command errors', async () => {
            mockSpawn.mockImplementation(() => {
                const mockChild = {
                    stdout: {
                        on: jest.fn()
                    },
                    stderr: {
                        on: (event, callback) => {
                            if (event === 'data') {
                                callback(Buffer.from('fatal: not a git repository'));
                            }
                        }
                    },
                    on: (event, callback) => {
                        if (event === 'close') {
                            callback(1);
                        }
                    }
                };
                return mockChild;
            });
            const result = await gitManager.getCommitHistory(10);
            expect(result).toEqual([]);
        });
    });
    describe('getBranches', () => {
        it('should return local and remote branches', async () => {
            mockSpawn.mockImplementation((command, args) => {
                const mockChild = {
                    stdout: {
                        on: (event, callback) => {
                            if (event === 'data') {
                                if (args.includes('-r')) {
                                    // Remote branches
                                    callback(Buffer.from('  origin/main\n  origin/develop\n'));
                                }
                                else {
                                    // Local branches
                                    callback(Buffer.from('* main\n  feature-branch\n'));
                                }
                            }
                        }
                    },
                    stderr: {
                        on: jest.fn()
                    },
                    on: (event, callback) => {
                        if (event === 'close') {
                            callback(0);
                        }
                    }
                };
                return mockChild;
            });
            const result = await gitManager.getBranches();
            expect(result).toHaveLength(3);
            expect(result).toContainEqual({ name: 'main', isRemote: false, isHead: true });
            expect(result).toContainEqual({ name: 'feature-branch', isRemote: false, isHead: false });
            expect(result).toContainEqual({ name: 'develop', isRemote: true, isHead: false });
        });
    });
    describe('getBranchDiff', () => {
        it('should return diff between branches', async () => {
            mockSpawn.mockImplementation((command, args) => {
                const mockChild = {
                    stdout: {
                        on: (event, callback) => {
                            if (event === 'data') {
                                if (args.includes('--name-status')) {
                                    callback(Buffer.from('M\tsrc/app/app.component.ts\nA\tsrc/app/new-file.ts\n'));
                                }
                                else if (args.includes('--stat')) {
                                    callback(Buffer.from('2 files changed, 10 insertions(+), 5 deletions(-)\n'));
                                }
                            }
                        }
                    },
                    stderr: {
                        on: jest.fn()
                    },
                    on: (event, callback) => {
                        if (event === 'close') {
                            callback(0);
                        }
                    }
                };
                return mockChild;
            });
            const result = await gitManager.getBranchDiff('main', 'feature-branch');
            expect(result.files).toHaveLength(2);
            expect(result.files[0]).toEqual({ path: 'src/app/app.component.ts', status: 'modified' });
            expect(result.files[1]).toEqual({ path: 'src/app/new-file.ts', status: 'added' });
            expect(result.additions).toBe(10);
            expect(result.deletions).toBe(5);
        });
    });
    describe('getInteractiveDiff', () => {
        it('should return formatted diff output', async () => {
            const diffOutput = `diff --git a/src/app/app.component.ts b/src/app/app.component.ts
index 1234567..abcdefg 100644
--- a/src/app/app.component.ts
+++ b/src/app/app.component.ts
@@ -1,4 +1,4 @@
-const oldCode = 'old';
+const newCode = 'new';`;
            mockSpawn.mockImplementation(() => {
                const mockChild = {
                    stdout: {
                        on: (event, callback) => {
                            if (event === 'data') {
                                callback(Buffer.from(diffOutput));
                            }
                        }
                    },
                    stderr: {
                        on: jest.fn()
                    },
                    on: (event, callback) => {
                        if (event === 'close') {
                            callback(0);
                        }
                    }
                };
                return mockChild;
            });
            const result = await gitManager.getInteractiveDiff('commit1', 'commit2');
            expect(result).toContain('diff --git');
            expect(result).toContain('const newCode = \'new\';');
        });
    });
    describe('getCurrentBranch', () => {
        it('should return current branch name', async () => {
            mockSpawn.mockImplementation(() => {
                const mockChild = {
                    stdout: {
                        on: (event, callback) => {
                            if (event === 'data') {
                                callback(Buffer.from('feature-branch\n'));
                            }
                        }
                    },
                    stderr: {
                        on: jest.fn()
                    },
                    on: (event, callback) => {
                        if (event === 'close') {
                            callback(0);
                        }
                    }
                };
                return mockChild;
            });
            const result = await gitManager.getCurrentBranch();
            expect(result).toBe('feature-branch');
        });
        it('should return default branch on error', async () => {
            mockSpawn.mockImplementation(() => {
                const mockChild = {
                    stdout: {
                        on: jest.fn()
                    },
                    stderr: {
                        on: (event, callback) => {
                            if (event === 'data') {
                                callback(Buffer.from('fatal: not a git repository'));
                            }
                        }
                    },
                    on: (event, callback) => {
                        if (event === 'close') {
                            callback(1);
                        }
                    }
                };
                return mockChild;
            });
            const result = await gitManager.getCurrentBranch();
            expect(result).toBe('main');
        });
    });
    describe('isGitRepository', () => {
        it('should return true for git repository', async () => {
            mockSpawn.mockImplementation(() => {
                const mockChild = {
                    stdout: {
                        on: (event, callback) => {
                            if (event === 'data') {
                                callback(Buffer.from('.git\n'));
                            }
                        }
                    },
                    stderr: {
                        on: jest.fn()
                    },
                    on: (event, callback) => {
                        if (event === 'close') {
                            callback(0);
                        }
                    }
                };
                return mockChild;
            });
            const result = await gitManager.isGitRepository();
            expect(result).toBe(true);
        });
        it('should return false for non-git repository', async () => {
            mockSpawn.mockImplementation(() => {
                const mockChild = {
                    stdout: {
                        on: jest.fn()
                    },
                    stderr: {
                        on: (event, callback) => {
                            if (event === 'data') {
                                callback(Buffer.from('fatal: not a git repository'));
                            }
                        }
                    },
                    on: (event, callback) => {
                        if (event === 'close') {
                            callback(1);
                        }
                    }
                };
                return mockChild;
            });
            const result = await gitManager.isGitRepository();
            expect(result).toBe(false);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2dyZWdkdW5uL3NyYy90ZXN0L2FpX2RlYnVnX2NvbnRleHQvdnNjb2RlL3NyYy9zZXJ2aWNlcy9naXQvX190ZXN0c19fL0dpdERpZmZNYW5hZ2VyLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFJQSxvQkFBb0I7QUFDcEIsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUNwQixJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBTjNCLHNEQUFtRDtBQUNuRCwrQ0FBaUM7QUFDakMsaURBQXNDO0FBTXRDLFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxHQUFHLEVBQUU7SUFDNUIsSUFBSSxVQUEwQixDQUFDO0lBQy9CLElBQUksV0FBb0MsQ0FBQztJQUN6QyxJQUFJLFNBQW9CLENBQUM7SUFFekIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNaLFdBQVcsR0FBRztZQUNWLGFBQWEsRUFBRSxFQUFFO1lBQ2pCLFlBQVksRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7U0FDbEMsQ0FBQztRQUVULFNBQVMsR0FBRyxxQkFBa0IsQ0FBQztRQUUvQix3QkFBd0I7UUFDdkIsTUFBTSxDQUFDLFNBQWlCLENBQUMsZ0JBQWdCLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxFQUFFLE1BQU0sRUFBRSxpQkFBaUIsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUV0Rix5QkFBeUI7UUFDeEIsTUFBTSxDQUFDLFVBQWtCLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUM7WUFDaEUsUUFBUSxFQUFFLElBQUk7WUFDZCxPQUFPLEVBQUU7Z0JBQ0wsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUM7b0JBQzlCLFlBQVksRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDO2lCQUNyQyxDQUFDO2FBQ0w7U0FDSixDQUFDLENBQUM7UUFFSCxVQUFVLEdBQUcsSUFBSSwrQkFBYyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ2pELENBQUMsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNYLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN6QixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7UUFDOUIsRUFBRSxDQUFDLDhCQUE4QixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzFDLFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUU7Z0JBQzlCLE1BQU0sU0FBUyxHQUFHO29CQUNkLE1BQU0sRUFBRTt3QkFDSixFQUFFLEVBQUUsQ0FBQyxLQUFhLEVBQUUsUUFBNkIsRUFBRSxFQUFFOzRCQUNqRCxJQUFJLEtBQUssS0FBSyxNQUFNLEVBQUUsQ0FBQztnQ0FDbkIsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsb0RBQW9ELENBQUMsQ0FBQyxDQUFDOzRCQUNoRixDQUFDO3dCQUNMLENBQUM7cUJBQ0o7b0JBQ0QsTUFBTSxFQUFFO3dCQUNKLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO3FCQUNoQjtvQkFDRCxFQUFFLEVBQUUsQ0FBQyxLQUFhLEVBQUUsUUFBZ0MsRUFBRSxFQUFFO3dCQUNwRCxJQUFJLEtBQUssS0FBSyxPQUFPLEVBQUUsQ0FBQzs0QkFDcEIsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUNoQixDQUFDO29CQUNMLENBQUM7aUJBQ0osQ0FBQztnQkFDRixPQUFPLFNBQVMsQ0FBQztZQUNyQixDQUFDLENBQUMsQ0FBQztZQUVILE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBRXJELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0IsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztnQkFDdEIsSUFBSSxFQUFFLFFBQVE7Z0JBQ2QsT0FBTyxFQUFFLGdCQUFnQjtnQkFDekIsTUFBTSxFQUFFLFVBQVU7Z0JBQ2xCLElBQUksRUFBRSxZQUFZO2dCQUNsQixPQUFPLEVBQUUsQ0FBQyxRQUFRLENBQUM7YUFDdEIsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsb0NBQW9DLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDaEQsU0FBUyxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRTtnQkFDOUIsTUFBTSxTQUFTLEdBQUc7b0JBQ2QsTUFBTSxFQUFFO3dCQUNKLEVBQUUsRUFBRSxDQUFDLEtBQWEsRUFBRSxRQUE2QixFQUFFLEVBQUU7NEJBQ2pELElBQUksS0FBSyxLQUFLLE1BQU0sRUFBRSxDQUFDO2dDQUNuQixRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDOzRCQUM5QixDQUFDO3dCQUNMLENBQUM7cUJBQ0o7b0JBQ0QsTUFBTSxFQUFFO3dCQUNKLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO3FCQUNoQjtvQkFDRCxFQUFFLEVBQUUsQ0FBQyxLQUFhLEVBQUUsUUFBZ0MsRUFBRSxFQUFFO3dCQUNwRCxJQUFJLEtBQUssS0FBSyxPQUFPLEVBQUUsQ0FBQzs0QkFDcEIsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUNoQixDQUFDO29CQUNMLENBQUM7aUJBQ0osQ0FBQztnQkFDRixPQUFPLFNBQVMsQ0FBQztZQUNyQixDQUFDLENBQUMsQ0FBQztZQUVILE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBRXJELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDL0IsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsa0NBQWtDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDOUMsU0FBUyxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRTtnQkFDOUIsTUFBTSxTQUFTLEdBQUc7b0JBQ2QsTUFBTSxFQUFFO3dCQUNKLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO3FCQUNoQjtvQkFDRCxNQUFNLEVBQUU7d0JBQ0osRUFBRSxFQUFFLENBQUMsS0FBYSxFQUFFLFFBQTZCLEVBQUUsRUFBRTs0QkFDakQsSUFBSSxLQUFLLEtBQUssTUFBTSxFQUFFLENBQUM7Z0NBQ25CLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLDZCQUE2QixDQUFDLENBQUMsQ0FBQzs0QkFDekQsQ0FBQzt3QkFDTCxDQUFDO3FCQUNKO29CQUNELEVBQUUsRUFBRSxDQUFDLEtBQWEsRUFBRSxRQUFnQyxFQUFFLEVBQUU7d0JBQ3BELElBQUksS0FBSyxLQUFLLE9BQU8sRUFBRSxDQUFDOzRCQUNwQixRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ2hCLENBQUM7b0JBQ0wsQ0FBQztpQkFDSixDQUFDO2dCQUNGLE9BQU8sU0FBUyxDQUFDO1lBQ3JCLENBQUMsQ0FBQyxDQUFDO1lBRUgsTUFBTSxNQUFNLEdBQUcsTUFBTSxVQUFVLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxDQUFDLENBQUM7WUFFckQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUMvQixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7UUFDekIsRUFBRSxDQUFDLHlDQUF5QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3JELFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUUsRUFBRTtnQkFDM0MsTUFBTSxTQUFTLEdBQUc7b0JBQ2QsTUFBTSxFQUFFO3dCQUNKLEVBQUUsRUFBRSxDQUFDLEtBQWEsRUFBRSxRQUE2QixFQUFFLEVBQUU7NEJBQ2pELElBQUksS0FBSyxLQUFLLE1BQU0sRUFBRSxDQUFDO2dDQUNuQixJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztvQ0FDdEIsa0JBQWtCO29DQUNsQixRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDLENBQUM7Z0NBQy9ELENBQUM7cUNBQU0sQ0FBQztvQ0FDSixpQkFBaUI7b0NBQ2pCLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLDRCQUE0QixDQUFDLENBQUMsQ0FBQztnQ0FDeEQsQ0FBQzs0QkFDTCxDQUFDO3dCQUNMLENBQUM7cUJBQ0o7b0JBQ0QsTUFBTSxFQUFFO3dCQUNKLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO3FCQUNoQjtvQkFDRCxFQUFFLEVBQUUsQ0FBQyxLQUFhLEVBQUUsUUFBZ0MsRUFBRSxFQUFFO3dCQUNwRCxJQUFJLEtBQUssS0FBSyxPQUFPLEVBQUUsQ0FBQzs0QkFDcEIsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUNoQixDQUFDO29CQUNMLENBQUM7aUJBQ0osQ0FBQztnQkFDRixPQUFPLFNBQVMsQ0FBQztZQUNyQixDQUFDLENBQUMsQ0FBQztZQUVILE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBRTlDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0IsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGNBQWMsQ0FBQyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUMvRSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsY0FBYyxDQUFDLEVBQUUsSUFBSSxFQUFFLGdCQUFnQixFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7WUFDMUYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGNBQWMsQ0FBQyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUN0RixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUU7UUFDM0IsRUFBRSxDQUFDLHFDQUFxQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2pELFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUUsRUFBRTtnQkFDM0MsTUFBTSxTQUFTLEdBQUc7b0JBQ2QsTUFBTSxFQUFFO3dCQUNKLEVBQUUsRUFBRSxDQUFDLEtBQWEsRUFBRSxRQUE2QixFQUFFLEVBQUU7NEJBQ2pELElBQUksS0FBSyxLQUFLLE1BQU0sRUFBRSxDQUFDO2dDQUNuQixJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLEVBQUUsQ0FBQztvQ0FDakMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsdURBQXVELENBQUMsQ0FBQyxDQUFDO2dDQUNuRixDQUFDO3FDQUFNLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO29DQUNqQyxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxxREFBcUQsQ0FBQyxDQUFDLENBQUM7Z0NBQ2pGLENBQUM7NEJBQ0wsQ0FBQzt3QkFDTCxDQUFDO3FCQUNKO29CQUNELE1BQU0sRUFBRTt3QkFDSixFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtxQkFDaEI7b0JBQ0QsRUFBRSxFQUFFLENBQUMsS0FBYSxFQUFFLFFBQWdDLEVBQUUsRUFBRTt3QkFDcEQsSUFBSSxLQUFLLEtBQUssT0FBTyxFQUFFLENBQUM7NEJBQ3BCLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDaEIsQ0FBQztvQkFDTCxDQUFDO2lCQUNKLENBQUM7Z0JBQ0YsT0FBTyxTQUFTLENBQUM7WUFDckIsQ0FBQyxDQUFDLENBQUM7WUFFSCxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFLGdCQUFnQixDQUFDLENBQUM7WUFFeEUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDckMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxJQUFJLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxDQUFDLENBQUM7WUFDMUYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxJQUFJLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7WUFDbEYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDbEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDckMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7UUFDaEMsRUFBRSxDQUFDLHFDQUFxQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2pELE1BQU0sVUFBVSxHQUFHOzs7Ozs7d0JBTVAsQ0FBQztZQUViLFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUU7Z0JBQzlCLE1BQU0sU0FBUyxHQUFHO29CQUNkLE1BQU0sRUFBRTt3QkFDSixFQUFFLEVBQUUsQ0FBQyxLQUFhLEVBQUUsUUFBNkIsRUFBRSxFQUFFOzRCQUNqRCxJQUFJLEtBQUssS0FBSyxNQUFNLEVBQUUsQ0FBQztnQ0FDbkIsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQzs0QkFDdEMsQ0FBQzt3QkFDTCxDQUFDO3FCQUNKO29CQUNELE1BQU0sRUFBRTt3QkFDSixFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtxQkFDaEI7b0JBQ0QsRUFBRSxFQUFFLENBQUMsS0FBYSxFQUFFLFFBQWdDLEVBQUUsRUFBRTt3QkFDcEQsSUFBSSxLQUFLLEtBQUssT0FBTyxFQUFFLENBQUM7NEJBQ3BCLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDaEIsQ0FBQztvQkFDTCxDQUFDO2lCQUNKLENBQUM7Z0JBQ0YsT0FBTyxTQUFTLENBQUM7WUFDckIsQ0FBQyxDQUFDLENBQUM7WUFFSCxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFFekUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUN2QyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBUyxDQUFDLDBCQUEwQixDQUFDLENBQUM7UUFDekQsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7UUFDOUIsRUFBRSxDQUFDLG1DQUFtQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQy9DLFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUU7Z0JBQzlCLE1BQU0sU0FBUyxHQUFHO29CQUNkLE1BQU0sRUFBRTt3QkFDSixFQUFFLEVBQUUsQ0FBQyxLQUFhLEVBQUUsUUFBNkIsRUFBRSxFQUFFOzRCQUNqRCxJQUFJLEtBQUssS0FBSyxNQUFNLEVBQUUsQ0FBQztnQ0FDbkIsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDOzRCQUM5QyxDQUFDO3dCQUNMLENBQUM7cUJBQ0o7b0JBQ0QsTUFBTSxFQUFFO3dCQUNKLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO3FCQUNoQjtvQkFDRCxFQUFFLEVBQUUsQ0FBQyxLQUFhLEVBQUUsUUFBZ0MsRUFBRSxFQUFFO3dCQUNwRCxJQUFJLEtBQUssS0FBSyxPQUFPLEVBQUUsQ0FBQzs0QkFDcEIsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUNoQixDQUFDO29CQUNMLENBQUM7aUJBQ0osQ0FBQztnQkFDRixPQUFPLFNBQVMsQ0FBQztZQUNyQixDQUFDLENBQUMsQ0FBQztZQUVILE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFFbkQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzFDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHVDQUF1QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ25ELFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUU7Z0JBQzlCLE1BQU0sU0FBUyxHQUFHO29CQUNkLE1BQU0sRUFBRTt3QkFDSixFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtxQkFDaEI7b0JBQ0QsTUFBTSxFQUFFO3dCQUNKLEVBQUUsRUFBRSxDQUFDLEtBQWEsRUFBRSxRQUE2QixFQUFFLEVBQUU7NEJBQ2pELElBQUksS0FBSyxLQUFLLE1BQU0sRUFBRSxDQUFDO2dDQUNuQixRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDLENBQUM7NEJBQ3pELENBQUM7d0JBQ0wsQ0FBQztxQkFDSjtvQkFDRCxFQUFFLEVBQUUsQ0FBQyxLQUFhLEVBQUUsUUFBZ0MsRUFBRSxFQUFFO3dCQUNwRCxJQUFJLEtBQUssS0FBSyxPQUFPLEVBQUUsQ0FBQzs0QkFDcEIsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUNoQixDQUFDO29CQUNMLENBQUM7aUJBQ0osQ0FBQztnQkFDRixPQUFPLFNBQVMsQ0FBQztZQUNyQixDQUFDLENBQUMsQ0FBQztZQUVILE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFFbkQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNoQyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtRQUM3QixFQUFFLENBQUMsdUNBQXVDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDbkQsU0FBUyxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRTtnQkFDOUIsTUFBTSxTQUFTLEdBQUc7b0JBQ2QsTUFBTSxFQUFFO3dCQUNKLEVBQUUsRUFBRSxDQUFDLEtBQWEsRUFBRSxRQUE2QixFQUFFLEVBQUU7NEJBQ2pELElBQUksS0FBSyxLQUFLLE1BQU0sRUFBRSxDQUFDO2dDQUNuQixRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDOzRCQUNwQyxDQUFDO3dCQUNMLENBQUM7cUJBQ0o7b0JBQ0QsTUFBTSxFQUFFO3dCQUNKLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO3FCQUNoQjtvQkFDRCxFQUFFLEVBQUUsQ0FBQyxLQUFhLEVBQUUsUUFBZ0MsRUFBRSxFQUFFO3dCQUNwRCxJQUFJLEtBQUssS0FBSyxPQUFPLEVBQUUsQ0FBQzs0QkFDcEIsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUNoQixDQUFDO29CQUNMLENBQUM7aUJBQ0osQ0FBQztnQkFDRixPQUFPLFNBQVMsQ0FBQztZQUNyQixDQUFDLENBQUMsQ0FBQztZQUVILE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBRWxELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDOUIsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNENBQTRDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDeEQsU0FBUyxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRTtnQkFDOUIsTUFBTSxTQUFTLEdBQUc7b0JBQ2QsTUFBTSxFQUFFO3dCQUNKLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO3FCQUNoQjtvQkFDRCxNQUFNLEVBQUU7d0JBQ0osRUFBRSxFQUFFLENBQUMsS0FBYSxFQUFFLFFBQTZCLEVBQUUsRUFBRTs0QkFDakQsSUFBSSxLQUFLLEtBQUssTUFBTSxFQUFFLENBQUM7Z0NBQ25CLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLDZCQUE2QixDQUFDLENBQUMsQ0FBQzs0QkFDekQsQ0FBQzt3QkFDTCxDQUFDO3FCQUNKO29CQUNELEVBQUUsRUFBRSxDQUFDLEtBQWEsRUFBRSxRQUFnQyxFQUFFLEVBQUU7d0JBQ3BELElBQUksS0FBSyxLQUFLLE9BQU8sRUFBRSxDQUFDOzRCQUNwQixRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ2hCLENBQUM7b0JBQ0wsQ0FBQztpQkFDSixDQUFDO2dCQUNGLE9BQU8sU0FBUyxDQUFDO1lBQ3JCLENBQUMsQ0FBQyxDQUFDO1lBRUgsTUFBTSxNQUFNLEdBQUcsTUFBTSxVQUFVLENBQUMsZUFBZSxFQUFFLENBQUM7WUFFbEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMvQixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2dyZWdkdW5uL3NyYy90ZXN0L2FpX2RlYnVnX2NvbnRleHQvdnNjb2RlL3NyYy9zZXJ2aWNlcy9naXQvX190ZXN0c19fL0dpdERpZmZNYW5hZ2VyLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgR2l0RGlmZk1hbmFnZXIgfSBmcm9tICcuLi9HaXREaWZmTWFuYWdlcic7XG5pbXBvcnQgKiBhcyB2c2NvZGUgZnJvbSAndnNjb2RlJztcbmltcG9ydCB7IHNwYXduIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5cbi8vIE1vY2sgZGVwZW5kZW5jaWVzXG5qZXN0Lm1vY2soJ3ZzY29kZScpO1xuamVzdC5tb2NrKCdjaGlsZF9wcm9jZXNzJyk7XG5cbmRlc2NyaWJlKCdHaXREaWZmTWFuYWdlcicsICgpID0+IHtcbiAgICBsZXQgZ2l0TWFuYWdlcjogR2l0RGlmZk1hbmFnZXI7XG4gICAgbGV0IG1vY2tDb250ZXh0OiB2c2NvZGUuRXh0ZW5zaW9uQ29udGV4dDtcbiAgICBsZXQgbW9ja1NwYXduOiBqZXN0Lk1vY2s7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgbW9ja0NvbnRleHQgPSB7XG4gICAgICAgICAgICBzdWJzY3JpcHRpb25zOiBbXSxcbiAgICAgICAgICAgIGV4dGVuc2lvblVyaTogdnNjb2RlLlVyaS5maWxlKCcvdGVzdCcpXG4gICAgICAgIH0gYXMgYW55O1xuXG4gICAgICAgIG1vY2tTcGF3biA9IHNwYXduIGFzIGplc3QuTW9jaztcbiAgICAgICAgXG4gICAgICAgIC8vIE1vY2sgdnNjb2RlLndvcmtzcGFjZVxuICAgICAgICAodnNjb2RlLndvcmtzcGFjZSBhcyBhbnkpLndvcmtzcGFjZUZvbGRlcnMgPSBbeyB1cmk6IHsgZnNQYXRoOiAnL3Rlc3Qvd29ya3NwYWNlJyB9IH1dO1xuICAgICAgICBcbiAgICAgICAgLy8gTW9jayB2c2NvZGUuZXh0ZW5zaW9uc1xuICAgICAgICAodnNjb2RlLmV4dGVuc2lvbnMgYXMgYW55KS5nZXRFeHRlbnNpb24gPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICAgICAgZXhwb3J0czoge1xuICAgICAgICAgICAgICAgIGdldEFQSTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgICAgICAgICAgIHJlcG9zaXRvcmllczogW3sgbW9ja1JlcG86IHRydWUgfV1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBnaXRNYW5hZ2VyID0gbmV3IEdpdERpZmZNYW5hZ2VyKG1vY2tDb250ZXh0KTtcbiAgICB9KTtcblxuICAgIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2dldENvbW1pdEhpc3RvcnknLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvbW1pdCBoaXN0b3J5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgbW9ja1NwYXduLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbW9ja0NoaWxkID0ge1xuICAgICAgICAgICAgICAgICAgICBzdGRvdXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uOiAoZXZlbnQ6IHN0cmluZywgY2FsbGJhY2s6IChkYXRhOiBhbnkpID0+IHZvaWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQgPT09ICdkYXRhJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhCdWZmZXIuZnJvbSgnYWJjMTIzfEluaXRpYWwgY29tbWl0fEpvaG4gRG9lfDIwMjMtMDEtMDF8ZGVmNDU2XFxuJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgc3RkZXJyOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvbjogamVzdC5mbigpXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uOiAoZXZlbnQ6IHN0cmluZywgY2FsbGJhY2s6IChjb2RlOiBudW1iZXIpID0+IHZvaWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudCA9PT0gJ2Nsb3NlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbW9ja0NoaWxkO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdpdE1hbmFnZXIuZ2V0Q29tbWl0SGlzdG9yeSgxMCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHRbMF0pLnRvRXF1YWwoe1xuICAgICAgICAgICAgICAgIGhhc2g6ICdhYmMxMjMnLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdJbml0aWFsIGNvbW1pdCcsXG4gICAgICAgICAgICAgICAgYXV0aG9yOiAnSm9obiBEb2UnLFxuICAgICAgICAgICAgICAgIGRhdGU6ICcyMDIzLTAxLTAxJyxcbiAgICAgICAgICAgICAgICBwYXJlbnRzOiBbJ2RlZjQ1NiddXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgY29tbWl0IGhpc3RvcnknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBtb2NrU3Bhd24ubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBtb2NrQ2hpbGQgPSB7XG4gICAgICAgICAgICAgICAgICAgIHN0ZG91dDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgb246IChldmVudDogc3RyaW5nLCBjYWxsYmFjazogKGRhdGE6IGFueSkgPT4gdm9pZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudCA9PT0gJ2RhdGEnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKEJ1ZmZlci5mcm9tKCcnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzdGRlcnI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uOiBqZXN0LmZuKClcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb246IChldmVudDogc3RyaW5nLCBjYWxsYmFjazogKGNvZGU6IG51bWJlcikgPT4gdm9pZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50ID09PSAnY2xvc2UnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHJldHVybiBtb2NrQ2hpbGQ7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2l0TWFuYWdlci5nZXRDb21taXRIaXN0b3J5KDEwKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChbXSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGdpdCBjb21tYW5kIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIG1vY2tTcGF3bi5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1vY2tDaGlsZCA9IHtcbiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvbjogamVzdC5mbigpXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHN0ZGVycjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgb246IChldmVudDogc3RyaW5nLCBjYWxsYmFjazogKGRhdGE6IGFueSkgPT4gdm9pZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudCA9PT0gJ2RhdGEnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKEJ1ZmZlci5mcm9tKCdmYXRhbDogbm90IGEgZ2l0IHJlcG9zaXRvcnknKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvbjogKGV2ZW50OiBzdHJpbmcsIGNhbGxiYWNrOiAoY29kZTogbnVtYmVyKSA9PiB2b2lkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQgPT09ICdjbG9zZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1vY2tDaGlsZDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnaXRNYW5hZ2VyLmdldENvbW1pdEhpc3RvcnkoMTApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKFtdKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZ2V0QnJhbmNoZXMnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGxvY2FsIGFuZCByZW1vdGUgYnJhbmNoZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBtb2NrU3Bhd24ubW9ja0ltcGxlbWVudGF0aW9uKChjb21tYW5kLCBhcmdzKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbW9ja0NoaWxkID0ge1xuICAgICAgICAgICAgICAgICAgICBzdGRvdXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uOiAoZXZlbnQ6IHN0cmluZywgY2FsbGJhY2s6IChkYXRhOiBhbnkpID0+IHZvaWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQgPT09ICdkYXRhJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJncy5pbmNsdWRlcygnLXInKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3RlIGJyYW5jaGVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhCdWZmZXIuZnJvbSgnICBvcmlnaW4vbWFpblxcbiAgb3JpZ2luL2RldmVsb3BcXG4nKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBMb2NhbCBicmFuY2hlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soQnVmZmVyLmZyb20oJyogbWFpblxcbiAgZmVhdHVyZS1icmFuY2hcXG4nKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHN0ZGVycjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgb246IGplc3QuZm4oKVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvbjogKGV2ZW50OiBzdHJpbmcsIGNhbGxiYWNrOiAoY29kZTogbnVtYmVyKSA9PiB2b2lkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQgPT09ICdjbG9zZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1vY2tDaGlsZDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnaXRNYW5hZ2VyLmdldEJyYW5jaGVzKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgzKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQ29udGFpbkVxdWFsKHsgbmFtZTogJ21haW4nLCBpc1JlbW90ZTogZmFsc2UsIGlzSGVhZDogdHJ1ZSB9KTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQ29udGFpbkVxdWFsKHsgbmFtZTogJ2ZlYXR1cmUtYnJhbmNoJywgaXNSZW1vdGU6IGZhbHNlLCBpc0hlYWQ6IGZhbHNlIH0pO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9Db250YWluRXF1YWwoeyBuYW1lOiAnZGV2ZWxvcCcsIGlzUmVtb3RlOiB0cnVlLCBpc0hlYWQ6IGZhbHNlIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdnZXRCcmFuY2hEaWZmJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBkaWZmIGJldHdlZW4gYnJhbmNoZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBtb2NrU3Bhd24ubW9ja0ltcGxlbWVudGF0aW9uKChjb21tYW5kLCBhcmdzKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbW9ja0NoaWxkID0ge1xuICAgICAgICAgICAgICAgICAgICBzdGRvdXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uOiAoZXZlbnQ6IHN0cmluZywgY2FsbGJhY2s6IChkYXRhOiBhbnkpID0+IHZvaWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQgPT09ICdkYXRhJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJncy5pbmNsdWRlcygnLS1uYW1lLXN0YXR1cycpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhCdWZmZXIuZnJvbSgnTVxcdHNyYy9hcHAvYXBwLmNvbXBvbmVudC50c1xcbkFcXHRzcmMvYXBwL25ldy1maWxlLnRzXFxuJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFyZ3MuaW5jbHVkZXMoJy0tc3RhdCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhCdWZmZXIuZnJvbSgnMiBmaWxlcyBjaGFuZ2VkLCAxMCBpbnNlcnRpb25zKCspLCA1IGRlbGV0aW9ucygtKVxcbicpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgc3RkZXJyOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvbjogamVzdC5mbigpXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uOiAoZXZlbnQ6IHN0cmluZywgY2FsbGJhY2s6IChjb2RlOiBudW1iZXIpID0+IHZvaWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudCA9PT0gJ2Nsb3NlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbW9ja0NoaWxkO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdpdE1hbmFnZXIuZ2V0QnJhbmNoRGlmZignbWFpbicsICdmZWF0dXJlLWJyYW5jaCcpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmZpbGVzKS50b0hhdmVMZW5ndGgoMik7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmZpbGVzWzBdKS50b0VxdWFsKHsgcGF0aDogJ3NyYy9hcHAvYXBwLmNvbXBvbmVudC50cycsIHN0YXR1czogJ21vZGlmaWVkJyB9KTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuZmlsZXNbMV0pLnRvRXF1YWwoeyBwYXRoOiAnc3JjL2FwcC9uZXctZmlsZS50cycsIHN0YXR1czogJ2FkZGVkJyB9KTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuYWRkaXRpb25zKS50b0JlKDEwKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuZGVsZXRpb25zKS50b0JlKDUpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdnZXRJbnRlcmFjdGl2ZURpZmYnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGZvcm1hdHRlZCBkaWZmIG91dHB1dCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGRpZmZPdXRwdXQgPSBgZGlmZiAtLWdpdCBhL3NyYy9hcHAvYXBwLmNvbXBvbmVudC50cyBiL3NyYy9hcHAvYXBwLmNvbXBvbmVudC50c1xuaW5kZXggMTIzNDU2Ny4uYWJjZGVmZyAxMDA2NDRcbi0tLSBhL3NyYy9hcHAvYXBwLmNvbXBvbmVudC50c1xuKysrIGIvc3JjL2FwcC9hcHAuY29tcG9uZW50LnRzXG5AQCAtMSw0ICsxLDQgQEBcbi1jb25zdCBvbGRDb2RlID0gJ29sZCc7XG4rY29uc3QgbmV3Q29kZSA9ICduZXcnO2A7XG5cbiAgICAgICAgICAgIG1vY2tTcGF3bi5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1vY2tDaGlsZCA9IHtcbiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvbjogKGV2ZW50OiBzdHJpbmcsIGNhbGxiYWNrOiAoZGF0YTogYW55KSA9PiB2b2lkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50ID09PSAnZGF0YScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soQnVmZmVyLmZyb20oZGlmZk91dHB1dCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgc3RkZXJyOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvbjogamVzdC5mbigpXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uOiAoZXZlbnQ6IHN0cmluZywgY2FsbGJhY2s6IChjb2RlOiBudW1iZXIpID0+IHZvaWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudCA9PT0gJ2Nsb3NlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbW9ja0NoaWxkO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdpdE1hbmFnZXIuZ2V0SW50ZXJhY3RpdmVEaWZmKCdjb21taXQxJywgJ2NvbW1pdDInKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9Db250YWluKCdkaWZmIC0tZ2l0Jyk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0NvbnRhaW4oJ2NvbnN0IG5ld0NvZGUgPSBcXCduZXdcXCc7Jyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2dldEN1cnJlbnRCcmFuY2gnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGN1cnJlbnQgYnJhbmNoIG5hbWUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBtb2NrU3Bhd24ubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBtb2NrQ2hpbGQgPSB7XG4gICAgICAgICAgICAgICAgICAgIHN0ZG91dDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgb246IChldmVudDogc3RyaW5nLCBjYWxsYmFjazogKGRhdGE6IGFueSkgPT4gdm9pZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudCA9PT0gJ2RhdGEnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKEJ1ZmZlci5mcm9tKCdmZWF0dXJlLWJyYW5jaFxcbicpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHN0ZGVycjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgb246IGplc3QuZm4oKVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvbjogKGV2ZW50OiBzdHJpbmcsIGNhbGxiYWNrOiAoY29kZTogbnVtYmVyKSA9PiB2b2lkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQgPT09ICdjbG9zZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1vY2tDaGlsZDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnaXRNYW5hZ2VyLmdldEN1cnJlbnRCcmFuY2goKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgnZmVhdHVyZS1icmFuY2gnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gZGVmYXVsdCBicmFuY2ggb24gZXJyb3InLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBtb2NrU3Bhd24ubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBtb2NrQ2hpbGQgPSB7XG4gICAgICAgICAgICAgICAgICAgIHN0ZG91dDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgb246IGplc3QuZm4oKVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzdGRlcnI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uOiAoZXZlbnQ6IHN0cmluZywgY2FsbGJhY2s6IChkYXRhOiBhbnkpID0+IHZvaWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQgPT09ICdkYXRhJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhCdWZmZXIuZnJvbSgnZmF0YWw6IG5vdCBhIGdpdCByZXBvc2l0b3J5JykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb246IChldmVudDogc3RyaW5nLCBjYWxsYmFjazogKGNvZGU6IG51bWJlcikgPT4gdm9pZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50ID09PSAnY2xvc2UnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHJldHVybiBtb2NrQ2hpbGQ7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2l0TWFuYWdlci5nZXRDdXJyZW50QnJhbmNoKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ21haW4nKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnaXNHaXRSZXBvc2l0b3J5JywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiB0cnVlIGZvciBnaXQgcmVwb3NpdG9yeScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIG1vY2tTcGF3bi5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1vY2tDaGlsZCA9IHtcbiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvbjogKGV2ZW50OiBzdHJpbmcsIGNhbGxiYWNrOiAoZGF0YTogYW55KSA9PiB2b2lkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50ID09PSAnZGF0YScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soQnVmZmVyLmZyb20oJy5naXRcXG4nKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzdGRlcnI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uOiBqZXN0LmZuKClcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb246IChldmVudDogc3RyaW5nLCBjYWxsYmFjazogKGNvZGU6IG51bWJlcikgPT4gdm9pZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50ID09PSAnY2xvc2UnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHJldHVybiBtb2NrQ2hpbGQ7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2l0TWFuYWdlci5pc0dpdFJlcG9zaXRvcnkoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gZmFsc2UgZm9yIG5vbi1naXQgcmVwb3NpdG9yeScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIG1vY2tTcGF3bi5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1vY2tDaGlsZCA9IHtcbiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvbjogamVzdC5mbigpXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHN0ZGVycjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgb246IChldmVudDogc3RyaW5nLCBjYWxsYmFjazogKGRhdGE6IGFueSkgPT4gdm9pZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudCA9PT0gJ2RhdGEnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKEJ1ZmZlci5mcm9tKCdmYXRhbDogbm90IGEgZ2l0IHJlcG9zaXRvcnknKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvbjogKGV2ZW50OiBzdHJpbmcsIGNhbGxiYWNrOiAoY29kZTogbnVtYmVyKSA9PiB2b2lkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQgPT09ICdjbG9zZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1vY2tDaGlsZDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnaXRNYW5hZ2VyLmlzR2l0UmVwb3NpdG9yeSgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==