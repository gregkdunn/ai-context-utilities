05651b91cea27e940a7856cb0e34c403
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.activate = activate;
exports.deactivate = deactivate;
const vscode = __importStar(require("vscode"));
const provider_1 = require("./webview/provider");
const projectDetector_1 = require("./utils/projectDetector");
const shellRunner_1 = require("./utils/shellRunner");
const fileManager_1 = require("./utils/fileManager");
const statusTracker_1 = require("./utils/statusTracker");
const commandCoordinator_1 = require("./utils/commandCoordinator");
const pluginManager_1 = require("./services/plugins/pluginManager");
const pluginMarketplace_1 = require("./services/plugins/pluginMarketplace");
const pluginDiscovery_1 = require("./services/plugins/pluginDiscovery");
// Phase 5 Features
const NxAffectedManager_1 = require("./services/nx/NxAffectedManager");
const NxCommandProvider_1 = require("./services/nx/NxCommandProvider");
const NxStatusBar_1 = require("./services/nx/NxStatusBar");
const GitDiffManager_1 = require("./services/git/GitDiffManager");
const GitCommandProvider_1 = require("./services/git/GitCommandProvider");
const FlipperDetectionManager_1 = require("./services/flipper/FlipperDetectionManager");
let webviewProvider;
let statusTracker;
let commandCoordinator;
let pluginManager;
let pluginMarketplace;
let pluginDiscovery;
// Phase 5 Features
let nxAffectedManager;
let nxCommandProvider;
let nxStatusBar;
let gitDiffManager;
let gitCommandProvider;
let flipperDetectionManager;
async function activate(context) {
    console.log('AI Debug Utilities extension is now active');
    try {
        // Get workspace path
        const workspaceRoot = vscode.workspace.workspaceFolders?.[0]?.uri.fsPath || '';
        // Create output channel
        const outputChannel = vscode.window.createOutputChannel('AI Debug Utilities');
        // Initialize core utilities with required parameters
        const projectDetector = new projectDetector_1.ProjectDetector(workspaceRoot);
        const commandRunner = new shellRunner_1.CommandRunner(outputChannel);
        const fileManager = new fileManager_1.FileManager(outputChannel);
        // Initialize status tracking and coordination
        statusTracker = new statusTracker_1.StatusTracker();
        commandCoordinator = new commandCoordinator_1.CommandCoordinator(statusTracker, context);
        // Initialize plugin system
        pluginManager = new pluginManager_1.PluginManager(context, workspaceRoot);
        pluginMarketplace = new pluginMarketplace_1.PluginMarketplaceService(context);
        pluginDiscovery = new pluginDiscovery_1.PluginDiscoveryService(context);
        // Initialize Phase 5 Features
        nxAffectedManager = new NxAffectedManager_1.NxAffectedManager(context);
        nxCommandProvider = new NxCommandProvider_1.NxCommandProvider(nxAffectedManager);
        nxStatusBar = new NxStatusBar_1.NxStatusBar(context, nxAffectedManager);
        gitDiffManager = new GitDiffManager_1.GitDiffManager(context);
        gitCommandProvider = new GitCommandProvider_1.GitCommandProvider(gitDiffManager);
        flipperDetectionManager = new FlipperDetectionManager_1.FlipperDetectionManager(context);
        // Check if this is an NX workspace
        const isNxWorkspace = await projectDetector.findNxWorkspace();
        if (isNxWorkspace) {
            // Set context for when clauses
            vscode.commands.executeCommand('setContext', 'workspaceHasNxProject', true);
            // Initialize webview provider
            webviewProvider = new provider_1.WebviewProvider(context.extensionUri, projectDetector, commandRunner, fileManager, statusTracker);
            // Register webview provider
            context.subscriptions.push(vscode.window.registerWebviewViewProvider('aiDebugUtilities', webviewProvider));
            // Register commands
            registerCommands(context, webviewProvider, projectDetector, commandRunner, fileManager, statusTracker, commandCoordinator, pluginManager, pluginMarketplace);
            // Register Phase 5 commands
            const nxCommands = nxCommandProvider.register();
            const gitCommands = gitCommandProvider.register();
            context.subscriptions.push(...nxCommands, ...gitCommands);
            console.log('AI Debug Utilities: NX workspace detected, extension fully activated');
            // Show welcome notification
            const config = vscode.workspace.getConfiguration('aiDebugUtilities');
            if (config.get('showNotifications')) {
                vscode.window.showInformationMessage('AI Debug Utilities activated! Open the panel to get started.', 'Open Panel').then(selection => {
                    if (selection === 'Open Panel') {
                        vscode.commands.executeCommand('aiDebugUtilities.openPanel');
                    }
                });
            }
        }
        else {
            vscode.commands.executeCommand('setContext', 'workspaceHasNxProject', false);
            console.log('AI Debug Utilities: No NX workspace detected, extension remains dormant');
        }
    }
    catch (error) {
        console.error('Error activating AI Debug Utilities:', error);
        vscode.commands.executeCommand('setContext', 'workspaceHasNxProject', false);
    }
}
function registerCommands(context, webviewProvider, projectDetector, commandRunner, fileManager, statusTracker, commandCoordinator, pluginManager, pluginMarketplace) {
    // Open panel command
    const openPanelCommand = vscode.commands.registerCommand('aiDebugUtilities.openPanel', () => {
        webviewProvider.show();
    });
    // Run AI Debug command
    const runAiDebugCommand = vscode.commands.registerCommand('aiDebugUtilities.runAiDebug', async () => {
        const project = await projectDetector.getCurrentProject();
        if (project) {
            await webviewProvider.runCommand('aiDebug', { project: project.name });
        }
        else {
            vscode.window.showWarningMessage('No NX project detected. Please select a project first.');
        }
    });
    // Run NX Test command
    const runNxTestCommand = vscode.commands.registerCommand('aiDebugUtilities.runNxTest', async () => {
        const project = await projectDetector.getCurrentProject();
        if (project) {
            await webviewProvider.runCommand('nxTest', { project: project.name });
        }
        else {
            vscode.window.showWarningMessage('No NX project detected. Please select a project first.');
        }
    });
    // Run Git Diff command
    const runGitDiffCommand = vscode.commands.registerCommand('aiDebugUtilities.runGitDiff', async () => {
        await webviewProvider.runCommand('gitDiff', {});
    });
    // Run Prepare to Push command
    const runPrepareToPushCommand = vscode.commands.registerCommand('aiDebugUtilities.runPrepareToPush', async () => {
        const project = await projectDetector.getCurrentProject();
        if (project) {
            await webviewProvider.runCommand('prepareToPush', { project: project.name });
        }
        else {
            vscode.window.showWarningMessage('No NX project detected. Please select a project first.');
        }
    });
    // Status tracking commands
    const showStatusCommand = vscode.commands.registerCommand('aiDebugUtilities.showStatus', () => {
        const report = statusTracker.generateStatusReport();
        const panel = vscode.window.createWebviewPanel('aiDebugStatus', 'AI Debug Status Report', vscode.ViewColumn.One, {});
        panel.webview.html = `
            <!DOCTYPE html>
            <html>
            <head>
                <title>Status Report</title>
                <style>
                    body { font-family: monospace; white-space: pre-wrap; padding: 20px; }
                    .report { background: #1e1e1e; color: #d4d4d4; padding: 20px; border-radius: 5px; }
                </style>
            </head>
            <body>
                <div class="report">${report.replace(/\n/g, '<br>')}</div>
            </body>
            </html>
        `;
    });
    // Plugin management commands
    const pluginManagerCommand = vscode.commands.registerCommand('aiDebugUtilities.pluginManager', async () => {
        const plugins = pluginManager.getAll();
        const items = plugins.map(plugin => ({
            label: plugin.metadata.name,
            description: plugin.metadata.description,
            detail: `v${plugin.metadata.version} - ${plugin.metadata.author}`,
            plugin
        }));
        const selected = await vscode.window.showQuickPick(items, {
            placeHolder: 'Select a plugin to manage',
            canPickMany: false
        });
        if (selected) {
            const actions = [
                { label: 'Enable/Disable', action: 'toggle' },
                { label: 'View Details', action: 'details' },
                { label: 'Uninstall', action: 'uninstall' }
            ];
            const action = await vscode.window.showQuickPick(actions, {
                placeHolder: `What would you like to do with ${selected.plugin.metadata.name}?`
            });
            if (action) {
                switch (action.action) {
                    case 'toggle':
                        if (pluginManager.isEnabled(selected.plugin.metadata.id)) {
                            await pluginManager.disable(selected.plugin.metadata.id);
                            vscode.window.showInformationMessage(`${selected.plugin.metadata.name} disabled`);
                        }
                        else {
                            await pluginManager.enable(selected.plugin.metadata.id);
                            vscode.window.showInformationMessage(`${selected.plugin.metadata.name} enabled`);
                        }
                        break;
                    case 'details':
                        const details = `# ${selected.plugin.metadata.name}\n\n` +
                            `**Version:** ${selected.plugin.metadata.version}\n` +
                            `**Author:** ${selected.plugin.metadata.author}\n` +
                            `**Description:** ${selected.plugin.metadata.description}\n\n` +
                            `**Capabilities:**\n` +
                            selected.plugin.metadata.capabilities.map(cap => `- ${cap.name}: ${cap.description}`).join('\n');
                        const doc = await vscode.workspace.openTextDocument({
                            content: details,
                            language: 'markdown'
                        });
                        await vscode.window.showTextDocument(doc);
                        break;
                    case 'uninstall':
                        const confirm = await vscode.window.showWarningMessage(`Are you sure you want to uninstall ${selected.plugin.metadata.name}?`, { modal: true }, 'Yes', 'No');
                        if (confirm === 'Yes') {
                            await pluginManager.unregister(selected.plugin.metadata.id);
                            vscode.window.showInformationMessage(`${selected.plugin.metadata.name} uninstalled`);
                        }
                        break;
                }
            }
        }
    });
    const pluginMarketplaceCommand = vscode.commands.registerCommand('aiDebugUtilities.pluginMarketplace', async () => {
        const query = await vscode.window.showInputBox({
            prompt: 'Search for plugins',
            placeHolder: 'Enter search terms (e.g., "git", "test", "ai")',
            value: ''
        });
        if (query !== undefined) {
            const plugins = await pluginMarketplace.searchPlugins(query || '');
            const items = plugins.map(plugin => ({
                label: plugin.name,
                description: plugin.description,
                detail: `v${plugin.version} - ${plugin.author} (${plugin.downloads} downloads, ${plugin.rating}/5 stars)`,
                plugin
            }));
            const selected = await vscode.window.showQuickPick(items, {
                placeHolder: 'Select a plugin to install',
                canPickMany: false
            });
            if (selected) {
                const actions = [
                    { label: 'Install', action: 'install' },
                    { label: 'View Details', action: 'details' }
                ];
                const action = await vscode.window.showQuickPick(actions, {
                    placeHolder: `What would you like to do with ${selected.plugin.name}?`
                });
                if (action) {
                    switch (action.action) {
                        case 'install':
                            try {
                                await pluginMarketplace.installPlugin(selected.plugin.id);
                                vscode.window.showInformationMessage(`${selected.plugin.name} installed successfully!`);
                            }
                            catch (error) {
                                vscode.window.showErrorMessage(`Failed to install ${selected.plugin.name}: ${error.message}`);
                            }
                            break;
                        case 'details':
                            const details = `# ${selected.plugin.name}\n\n` +
                                `**Version:** ${selected.plugin.version}\n` +
                                `**Author:** ${selected.plugin.author}\n` +
                                `**Description:** ${selected.plugin.description}\n` +
                                `**Downloads:** ${selected.plugin.downloads}\n` +
                                `**Rating:** ${selected.plugin.rating}/5\n\n` +
                                `**Tags:** ${selected.plugin.tags.join(', ')}\n\n` +
                                `**README:**\n${selected.plugin.readme}`;
                            const doc = await vscode.workspace.openTextDocument({
                                content: details,
                                language: 'markdown'
                            });
                            await vscode.window.showTextDocument(doc);
                            break;
                    }
                }
            }
        }
    });
    const runPluginCommand = vscode.commands.registerCommand('aiDebugUtilities.runPluginCommand', async () => {
        const plugins = pluginManager.getAll().filter(p => pluginManager.isEnabled(p.metadata.id));
        const commands = plugins.flatMap(plugin => (plugin.commands || []).map(cmd => ({
            label: cmd.title,
            description: cmd.description,
            detail: `Plugin: ${plugin.metadata.name}`,
            pluginId: plugin.metadata.id,
            commandId: cmd.id
        })));
        const selected = await vscode.window.showQuickPick(commands, {
            placeHolder: 'Select a plugin command to run',
            canPickMany: false
        });
        if (selected) {
            try {
                const result = await pluginManager.executePluginCommand(selected.pluginId, selected.commandId);
                vscode.window.showInformationMessage(`Command executed successfully: ${selected.label}`);
            }
            catch (error) {
                vscode.window.showErrorMessage(`Failed to execute command: ${error.message}`);
            }
        }
    });
    const clearHistoryCommand = vscode.commands.registerCommand('aiDebugUtilities.clearHistory', async () => {
        const result = await vscode.window.showWarningMessage('Are you sure you want to clear the command history?', { modal: true }, 'Yes', 'No');
        if (result === 'Yes') {
            statusTracker.clearHistory();
            vscode.window.showInformationMessage('Command history cleared.');
        }
    });
    const cancelAllCommand = vscode.commands.registerCommand('aiDebugUtilities.cancelAll', () => {
        commandCoordinator.cancelAllCommands();
        vscode.window.showInformationMessage('All running commands cancelled.');
    });
    const healthReportCommand = vscode.commands.registerCommand('aiDebugUtilities.healthReport', () => {
        const report = commandCoordinator.createHealthReport();
        const panel = vscode.window.createWebviewPanel('aiDebugHealth', 'Command Execution Health Report', vscode.ViewColumn.One, {});
        panel.webview.html = `
            <!DOCTYPE html>
            <html>
            <head>
                <title>Health Report</title>
                <style>
                    body { font-family: monospace; white-space: pre-wrap; padding: 20px; }
                    .report { background: #1e1e1e; color: #d4d4d4; padding: 20px; border-radius: 5px; }
                </style>
            </head>
            <body>
                <div class="report">${report.replace(/\n/g, '<br>')}</div>
            </body>
            </html>
        `;
    });
    // Add all commands to subscriptions
    context.subscriptions.push(openPanelCommand, runAiDebugCommand, runNxTestCommand, runGitDiffCommand, runPrepareToPushCommand, showStatusCommand, clearHistoryCommand, cancelAllCommand, healthReportCommand, pluginManagerCommand, pluginMarketplaceCommand, runPluginCommand);
}
function deactivate() {
    console.log('AI Debug Utilities extension is now deactivated');
    // Clean up resources
    if (statusTracker) {
        statusTracker.dispose();
    }
    if (commandCoordinator) {
        commandCoordinator.dispose();
    }
    // Clean up plugin system
    if (pluginManager) {
        try {
            const allPlugins = pluginManager.getAll();
            if (allPlugins && Array.isArray(allPlugins)) {
                for (const plugin of allPlugins) {
                    if (plugin?.metadata?.id && pluginManager.isEnabled(plugin.metadata.id)) {
                        pluginManager.disable(plugin.metadata.id).catch(error => {
                            console.error(`Failed to disable plugin ${plugin.metadata.id}:`, error);
                        });
                    }
                }
            }
        }
        catch (error) {
            console.error('Error during plugin cleanup:', error);
        }
    }
    // Clean up Phase 5 Features
    if (nxAffectedManager) {
        nxAffectedManager.dispose();
    }
    if (nxStatusBar) {
        nxStatusBar.dispose();
    }
    if (gitDiffManager) {
        gitDiffManager.dispose();
    }
    if (flipperDetectionManager) {
        flipperDetectionManager.dispose();
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2dyZWdkdW5uL3NyYy90ZXN0L2FpX2RlYnVnX2NvbnRleHQvdnNjb2RlL3NyYy9leHRlbnNpb24udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFrQ0EsNEJBbUZDO0FBd1NELGdDQTJDQztBQXhjRCwrQ0FBaUM7QUFDakMsaURBQXFEO0FBQ3JELDZEQUEwRDtBQUMxRCxxREFBb0Q7QUFDcEQscURBQWtEO0FBQ2xELHlEQUFzRDtBQUN0RCxtRUFBZ0U7QUFDaEUsb0VBQWlFO0FBQ2pFLDRFQUFnRjtBQUNoRix3RUFBNEU7QUFFNUUsbUJBQW1CO0FBQ25CLHVFQUFvRTtBQUNwRSx1RUFBb0U7QUFDcEUsMkRBQXdEO0FBQ3hELGtFQUErRDtBQUMvRCwwRUFBdUU7QUFDdkUsd0ZBQXFGO0FBRXJGLElBQUksZUFBZ0MsQ0FBQztBQUNyQyxJQUFJLGFBQTRCLENBQUM7QUFDakMsSUFBSSxrQkFBc0MsQ0FBQztBQUMzQyxJQUFJLGFBQTRCLENBQUM7QUFDakMsSUFBSSxpQkFBMkMsQ0FBQztBQUNoRCxJQUFJLGVBQXVDLENBQUM7QUFFNUMsbUJBQW1CO0FBQ25CLElBQUksaUJBQW9DLENBQUM7QUFDekMsSUFBSSxpQkFBb0MsQ0FBQztBQUN6QyxJQUFJLFdBQXdCLENBQUM7QUFDN0IsSUFBSSxjQUE4QixDQUFDO0FBQ25DLElBQUksa0JBQXNDLENBQUM7QUFDM0MsSUFBSSx1QkFBZ0QsQ0FBQztBQUU5QyxLQUFLLFVBQVUsUUFBUSxDQUFDLE9BQWdDO0lBQzNELE9BQU8sQ0FBQyxHQUFHLENBQUMsNENBQTRDLENBQUMsQ0FBQztJQUUxRCxJQUFJLENBQUM7UUFDRCxxQkFBcUI7UUFDckIsTUFBTSxhQUFhLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxNQUFNLElBQUksRUFBRSxDQUFDO1FBRS9FLHdCQUF3QjtRQUN4QixNQUFNLGFBQWEsR0FBRyxNQUFNLENB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T0FBTyxDQUFDLEtBQUssQ0FBQyw4QkFBOEIsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN6RCxDQUFDO0lBQ0wsQ0FBQztJQUVELDRCQUE0QjtJQUM1QixJQUFJLGlCQUFpQixFQUFFLENBQUM7UUFDcEIsaUJBQWlCLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDaEMsQ0FBQztJQUNELElBQUksV0FBVyxFQUFFLENBQUM7UUFDZCxXQUFXLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDMUIsQ0FBQztJQUNELElBQUksY0FBYyxFQUFFLENBQUM7UUFDakIsY0FBYyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFDRCxJQUFJLHVCQUF1QixFQUFFLENBQUM7UUFDMUIsdUJBQXVCLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDdEMsQ0FBQztBQUNMLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2dyZWdkdW5uL3NyYy90ZXN0L2FpX2RlYnVnX2NvbnRleHQvdnNjb2RlL3NyYy9leHRlbnNpb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgdnNjb2RlIGZyb20gJ3ZzY29kZSc7XG5pbXBvcnQgeyBXZWJ2aWV3UHJvdmlkZXIgfSBmcm9tICcuL3dlYnZpZXcvcHJvdmlkZXInO1xuaW1wb3J0IHsgUHJvamVjdERldGVjdG9yIH0gZnJvbSAnLi91dGlscy9wcm9qZWN0RGV0ZWN0b3InO1xuaW1wb3J0IHsgQ29tbWFuZFJ1bm5lciB9IGZyb20gJy4vdXRpbHMvc2hlbGxSdW5uZXInO1xuaW1wb3J0IHsgRmlsZU1hbmFnZXIgfSBmcm9tICcuL3V0aWxzL2ZpbGVNYW5hZ2VyJztcbmltcG9ydCB7IFN0YXR1c1RyYWNrZXIgfSBmcm9tICcuL3V0aWxzL3N0YXR1c1RyYWNrZXInO1xuaW1wb3J0IHsgQ29tbWFuZENvb3JkaW5hdG9yIH0gZnJvbSAnLi91dGlscy9jb21tYW5kQ29vcmRpbmF0b3InO1xuaW1wb3J0IHsgUGx1Z2luTWFuYWdlciB9IGZyb20gJy4vc2VydmljZXMvcGx1Z2lucy9wbHVnaW5NYW5hZ2VyJztcbmltcG9ydCB7IFBsdWdpbk1hcmtldHBsYWNlU2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvcGx1Z2lucy9wbHVnaW5NYXJrZXRwbGFjZSc7XG5pbXBvcnQgeyBQbHVnaW5EaXNjb3ZlcnlTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy9wbHVnaW5zL3BsdWdpbkRpc2NvdmVyeSc7XG5cbi8vIFBoYXNlIDUgRmVhdHVyZXNcbmltcG9ydCB7IE54QWZmZWN0ZWRNYW5hZ2VyIH0gZnJvbSAnLi9zZXJ2aWNlcy9ueC9OeEFmZmVjdGVkTWFuYWdlcic7XG5pbXBvcnQgeyBOeENvbW1hbmRQcm92aWRlciB9IGZyb20gJy4vc2VydmljZXMvbngvTnhDb21tYW5kUHJvdmlkZXInO1xuaW1wb3J0IHsgTnhTdGF0dXNCYXIgfSBmcm9tICcuL3NlcnZpY2VzL254L054U3RhdHVzQmFyJztcbmltcG9ydCB7IEdpdERpZmZNYW5hZ2VyIH0gZnJvbSAnLi9zZXJ2aWNlcy9naXQvR2l0RGlmZk1hbmFnZXInO1xuaW1wb3J0IHsgR2l0Q29tbWFuZFByb3ZpZGVyIH0gZnJvbSAnLi9zZXJ2aWNlcy9naXQvR2l0Q29tbWFuZFByb3ZpZGVyJztcbmltcG9ydCB7IEZsaXBwZXJEZXRlY3Rpb25NYW5hZ2VyIH0gZnJvbSAnLi9zZXJ2aWNlcy9mbGlwcGVyL0ZsaXBwZXJEZXRlY3Rpb25NYW5hZ2VyJztcblxubGV0IHdlYnZpZXdQcm92aWRlcjogV2Vidmlld1Byb3ZpZGVyO1xubGV0IHN0YXR1c1RyYWNrZXI6IFN0YXR1c1RyYWNrZXI7XG5sZXQgY29tbWFuZENvb3JkaW5hdG9yOiBDb21tYW5kQ29vcmRpbmF0b3I7XG5sZXQgcGx1Z2luTWFuYWdlcjogUGx1Z2luTWFuYWdlcjtcbmxldCBwbHVnaW5NYXJrZXRwbGFjZTogUGx1Z2luTWFya2V0cGxhY2VTZXJ2aWNlO1xubGV0IHBsdWdpbkRpc2NvdmVyeTogUGx1Z2luRGlzY292ZXJ5U2VydmljZTtcblxuLy8gUGhhc2UgNSBGZWF0dXJlc1xubGV0IG54QWZmZWN0ZWRNYW5hZ2VyOiBOeEFmZmVjdGVkTWFuYWdlcjtcbmxldCBueENvbW1hbmRQcm92aWRlcjogTnhDb21tYW5kUHJvdmlkZXI7XG5sZXQgbnhTdGF0dXNCYXI6IE54U3RhdHVzQmFyO1xubGV0IGdpdERpZmZNYW5hZ2VyOiBHaXREaWZmTWFuYWdlcjtcbmxldCBnaXRDb21tYW5kUHJvdmlkZXI6IEdpdENvbW1hbmRQcm92aWRlcjtcbmxldCBmbGlwcGVyRGV0ZWN0aW9uTWFuYWdlcjogRmxpcHBlckRldGVjdGlvbk1hbmFnZXI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhY3RpdmF0ZShjb250ZXh0OiB2c2NvZGUuRXh0ZW5zaW9uQ29udGV4dCkge1xuICAgIGNvbnNvbGUubG9nKCdBSSBEZWJ1ZyBVdGlsaXRpZXMgZXh0ZW5zaW9uIGlzIG5vdyBhY3RpdmUnKTtcblxuICAgIHRyeSB7XG4gICAgICAgIC8vIEdldCB3b3Jrc3BhY2UgcGF0aFxuICAgICAgICBjb25zdCB3b3Jrc3BhY2VSb290ID0gdnNjb2RlLndvcmtzcGFjZS53b3Jrc3BhY2VGb2xkZXJzPy5bMF0/LnVyaS5mc1BhdGggfHwgJyc7XG4gICAgICAgIFxuICAgICAgICAvLyBDcmVhdGUgb3V0cHV0IGNoYW5uZWxcbiAgICAgICAgY29uc3Qgb3V0cHV0Q2hhbm5lbCA9IHZzY29kZS53aW5kb3cuY3JlYXRlT3V0cHV0Q2hhbm5lbCgnQUkgRGVidWcgVXRpbGl0aWVzJyk7XG4gICAgICAgIFxuICAgICAgICAvLyBJbml0aWFsaXplIGNvcmUgdXRpbGl0aWVzIHdpdGggcmVxdWlyZWQgcGFyYW1ldGVyc1xuICAgICAgICBjb25zdCBwcm9qZWN0RGV0ZWN0b3IgPSBuZXcgUHJvamVjdERldGVjdG9yKHdvcmtzcGFjZVJvb3QpO1xuICAgICAgICBjb25zdCBjb21tYW5kUnVubmVyID0gbmV3IENvbW1hbmRSdW5uZXIob3V0cHV0Q2hhbm5lbCk7XG4gICAgICAgIGNvbnN0IGZpbGVNYW5hZ2VyID0gbmV3IEZpbGVNYW5hZ2VyKG91dHB1dENoYW5uZWwpO1xuICAgICAgICBcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBzdGF0dXMgdHJhY2tpbmcgYW5kIGNvb3JkaW5hdGlvblxuICAgICAgICBzdGF0dXNUcmFja2VyID0gbmV3IFN0YXR1c1RyYWNrZXIoKTtcbiAgICAgICAgY29tbWFuZENvb3JkaW5hdG9yID0gbmV3IENvbW1hbmRDb29yZGluYXRvcihzdGF0dXNUcmFja2VyLCBjb250ZXh0KTtcblxuICAgICAgICAvLyBJbml0aWFsaXplIHBsdWdpbiBzeXN0ZW1cbiAgICAgICAgcGx1Z2luTWFuYWdlciA9IG5ldyBQbHVnaW5NYW5hZ2VyKGNvbnRleHQsIHdvcmtzcGFjZVJvb3QpO1xuICAgICAgICBwbHVnaW5NYXJrZXRwbGFjZSA9IG5ldyBQbHVnaW5NYXJrZXRwbGFjZVNlcnZpY2UoY29udGV4dCk7XG4gICAgICAgIHBsdWdpbkRpc2NvdmVyeSA9IG5ldyBQbHVnaW5EaXNjb3ZlcnlTZXJ2aWNlKGNvbnRleHQpO1xuXG4gICAgICAgIC8vIEluaXRpYWxpemUgUGhhc2UgNSBGZWF0dXJlc1xuICAgICAgICBueEFmZmVjdGVkTWFuYWdlciA9IG5ldyBOeEFmZmVjdGVkTWFuYWdlcihjb250ZXh0KTtcbiAgICAgICAgbnhDb21tYW5kUHJvdmlkZXIgPSBuZXcgTnhDb21tYW5kUHJvdmlkZXIobnhBZmZlY3RlZE1hbmFnZXIpO1xuICAgICAgICBueFN0YXR1c0JhciA9IG5ldyBOeFN0YXR1c0Jhcihjb250ZXh0LCBueEFmZmVjdGVkTWFuYWdlcik7XG4gICAgICAgIGdpdERpZmZNYW5hZ2VyID0gbmV3IEdpdERpZmZNYW5hZ2VyKGNvbnRleHQpO1xuICAgICAgICBnaXRDb21tYW5kUHJvdmlkZXIgPSBuZXcgR2l0Q29tbWFuZFByb3ZpZGVyKGdpdERpZmZNYW5hZ2VyKTtcbiAgICAgICAgZmxpcHBlckRldGVjdGlvbk1hbmFnZXIgPSBuZXcgRmxpcHBlckRldGVjdGlvbk1hbmFnZXIoY29udGV4dCk7XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBpcyBhbiBOWCB3b3Jrc3BhY2VcbiAgICAgICAgY29uc3QgaXNOeFdvcmtzcGFjZSA9IGF3YWl0IHByb2plY3REZXRlY3Rvci5maW5kTnhXb3Jrc3BhY2UoKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChpc054V29ya3NwYWNlKSB7XG4gICAgICAgICAgICAvLyBTZXQgY29udGV4dCBmb3Igd2hlbiBjbGF1c2VzXG4gICAgICAgICAgICB2c2NvZGUuY29tbWFuZHMuZXhlY3V0ZUNvbW1hbmQoJ3NldENvbnRleHQnLCAnd29ya3NwYWNlSGFzTnhQcm9qZWN0JywgdHJ1ZSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEluaXRpYWxpemUgd2VidmlldyBwcm92aWRlclxuICAgICAgICAgICAgd2Vidmlld1Byb3ZpZGVyID0gbmV3IFdlYnZpZXdQcm92aWRlcihcbiAgICAgICAgICAgICAgICBjb250ZXh0LmV4dGVuc2lvblVyaSwgXG4gICAgICAgICAgICAgICAgcHJvamVjdERldGVjdG9yLCBcbiAgICAgICAgICAgICAgICBjb21tYW5kUnVubmVyLCBcbiAgICAgICAgICAgICAgICBmaWxlTWFuYWdlcixcbiAgICAgICAgICAgICAgICBzdGF0dXNUcmFja2VyXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBSZWdpc3RlciB3ZWJ2aWV3IHByb3ZpZGVyXG4gICAgICAgICAgICBjb250ZXh0LnN1YnNjcmlwdGlvbnMucHVzaChcbiAgICAgICAgICAgICAgICB2c2NvZGUud2luZG93LnJlZ2lzdGVyV2Vidmlld1ZpZXdQcm92aWRlcignYWlEZWJ1Z1V0aWxpdGllcycsIHdlYnZpZXdQcm92aWRlcilcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIC8vIFJlZ2lzdGVyIGNvbW1hbmRzXG4gICAgICAgICAgICByZWdpc3RlckNvbW1hbmRzKGNvbnRleHQsIHdlYnZpZXdQcm92aWRlciwgcHJvamVjdERldGVjdG9yLCBjb21tYW5kUnVubmVyLCBmaWxlTWFuYWdlciwgc3RhdHVzVHJhY2tlciwgY29tbWFuZENvb3JkaW5hdG9yLCBwbHVnaW5NYW5hZ2VyLCBwbHVnaW5NYXJrZXRwbGFjZSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFJlZ2lzdGVyIFBoYXNlIDUgY29tbWFuZHNcbiAgICAgICAgICAgIGNvbnN0IG54Q29tbWFuZHMgPSBueENvbW1hbmRQcm92aWRlci5yZWdpc3RlcigpO1xuICAgICAgICAgICAgY29uc3QgZ2l0Q29tbWFuZHMgPSBnaXRDb21tYW5kUHJvdmlkZXIucmVnaXN0ZXIoKTtcbiAgICAgICAgICAgIGNvbnRleHQuc3Vic2NyaXB0aW9ucy5wdXNoKC4uLm54Q29tbWFuZHMsIC4uLmdpdENvbW1hbmRzKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc29sZS5sb2coJ0FJIERlYnVnIFV0aWxpdGllczogTlggd29ya3NwYWNlIGRldGVjdGVkLCBleHRlbnNpb24gZnVsbHkgYWN0aXZhdGVkJyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFNob3cgd2VsY29tZSBub3RpZmljYXRpb25cbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZyA9IHZzY29kZS53b3Jrc3BhY2UuZ2V0Q29uZmlndXJhdGlvbignYWlEZWJ1Z1V0aWxpdGllcycpO1xuICAgICAgICAgICAgaWYgKGNvbmZpZy5nZXQoJ3Nob3dOb3RpZmljYXRpb25zJykpIHtcbiAgICAgICAgICAgICAgICB2c2NvZGUud2luZG93LnNob3dJbmZvcm1hdGlvbk1lc3NhZ2UoXG4gICAgICAgICAgICAgICAgICAgICdBSSBEZWJ1ZyBVdGlsaXRpZXMgYWN0aXZhdGVkISBPcGVuIHRoZSBwYW5lbCB0byBnZXQgc3RhcnRlZC4nLFxuICAgICAgICAgICAgICAgICAgICAnT3BlbiBQYW5lbCdcbiAgICAgICAgICAgICAgICApLnRoZW4oc2VsZWN0aW9uID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdGlvbiA9PT0gJ09wZW4gUGFuZWwnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2c2NvZGUuY29tbWFuZHMuZXhlY3V0ZUNvbW1hbmQoJ2FpRGVidWdVdGlsaXRpZXMub3BlblBhbmVsJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZzY29kZS5jb21tYW5kcy5leGVjdXRlQ29tbWFuZCgnc2V0Q29udGV4dCcsICd3b3Jrc3BhY2VIYXNOeFByb2plY3QnLCBmYWxzZSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQUkgRGVidWcgVXRpbGl0aWVzOiBObyBOWCB3b3Jrc3BhY2UgZGV0ZWN0ZWQsIGV4dGVuc2lvbiByZW1haW5zIGRvcm1hbnQnKTtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFjdGl2YXRpbmcgQUkgRGVidWcgVXRpbGl0aWVzOicsIGVycm9yKTtcbiAgICAgICAgdnNjb2RlLmNvbW1hbmRzLmV4ZWN1dGVDb21tYW5kKCdzZXRDb250ZXh0JywgJ3dvcmtzcGFjZUhhc054UHJvamVjdCcsIGZhbHNlKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHJlZ2lzdGVyQ29tbWFuZHMoXG4gICAgY29udGV4dDogdnNjb2RlLkV4dGVuc2lvbkNvbnRleHQsXG4gICAgd2Vidmlld1Byb3ZpZGVyOiBXZWJ2aWV3UHJvdmlkZXIsXG4gICAgcHJvamVjdERldGVjdG9yOiBQcm9qZWN0RGV0ZWN0b3IsXG4gICAgY29tbWFuZFJ1bm5lcjogQ29tbWFuZFJ1bm5lcixcbiAgICBmaWxlTWFuYWdlcjogRmlsZU1hbmFnZXIsXG4gICAgc3RhdHVzVHJhY2tlcjogU3RhdHVzVHJhY2tlcixcbiAgICBjb21tYW5kQ29vcmRpbmF0b3I6IENvbW1hbmRDb29yZGluYXRvcixcbiAgICBwbHVnaW5NYW5hZ2VyOiBQbHVnaW5NYW5hZ2VyLFxuICAgIHBsdWdpbk1hcmtldHBsYWNlOiBQbHVnaW5NYXJrZXRwbGFjZVNlcnZpY2Vcbikge1xuICAgIC8vIE9wZW4gcGFuZWwgY29tbWFuZFxuICAgIGNvbnN0IG9wZW5QYW5lbENvbW1hbmQgPSB2c2NvZGUuY29tbWFuZHMucmVnaXN0ZXJDb21tYW5kKCdhaURlYnVnVXRpbGl0aWVzLm9wZW5QYW5lbCcsICgpID0+IHtcbiAgICAgICAgd2Vidmlld1Byb3ZpZGVyLnNob3coKTtcbiAgICB9KTtcblxuICAgIC8vIFJ1biBBSSBEZWJ1ZyBjb21tYW5kXG4gICAgY29uc3QgcnVuQWlEZWJ1Z0NvbW1hbmQgPSB2c2NvZGUuY29tbWFuZHMucmVnaXN0ZXJDb21tYW5kKCdhaURlYnVnVXRpbGl0aWVzLnJ1bkFpRGVidWcnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHByb2plY3QgPSBhd2FpdCBwcm9qZWN0RGV0ZWN0b3IuZ2V0Q3VycmVudFByb2plY3QoKTtcbiAgICAgICAgaWYgKHByb2plY3QpIHtcbiAgICAgICAgICAgIGF3YWl0IHdlYnZpZXdQcm92aWRlci5ydW5Db21tYW5kKCdhaURlYnVnJywgeyBwcm9qZWN0OiBwcm9qZWN0Lm5hbWUgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2c2NvZGUud2luZG93LnNob3dXYXJuaW5nTWVzc2FnZSgnTm8gTlggcHJvamVjdCBkZXRlY3RlZC4gUGxlYXNlIHNlbGVjdCBhIHByb2plY3QgZmlyc3QuJyk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFJ1biBOWCBUZXN0IGNvbW1hbmRcbiAgICBjb25zdCBydW5OeFRlc3RDb21tYW5kID0gdnNjb2RlLmNvbW1hbmRzLnJlZ2lzdGVyQ29tbWFuZCgnYWlEZWJ1Z1V0aWxpdGllcy5ydW5OeFRlc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHByb2plY3QgPSBhd2FpdCBwcm9qZWN0RGV0ZWN0b3IuZ2V0Q3VycmVudFByb2plY3QoKTtcbiAgICAgICAgaWYgKHByb2plY3QpIHtcbiAgICAgICAgICAgIGF3YWl0IHdlYnZpZXdQcm92aWRlci5ydW5Db21tYW5kKCdueFRlc3QnLCB7IHByb2plY3Q6IHByb2plY3QubmFtZSB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZzY29kZS53aW5kb3cuc2hvd1dhcm5pbmdNZXNzYWdlKCdObyBOWCBwcm9qZWN0IGRldGVjdGVkLiBQbGVhc2Ugc2VsZWN0IGEgcHJvamVjdCBmaXJzdC4nKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gUnVuIEdpdCBEaWZmIGNvbW1hbmRcbiAgICBjb25zdCBydW5HaXREaWZmQ29tbWFuZCA9IHZzY29kZS5jb21tYW5kcy5yZWdpc3RlckNvbW1hbmQoJ2FpRGVidWdVdGlsaXRpZXMucnVuR2l0RGlmZicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgYXdhaXQgd2Vidmlld1Byb3ZpZGVyLnJ1bkNvbW1hbmQoJ2dpdERpZmYnLCB7fSk7XG4gICAgfSk7XG5cbiAgICAvLyBSdW4gUHJlcGFyZSB0byBQdXNoIGNvbW1hbmRcbiAgICBjb25zdCBydW5QcmVwYXJlVG9QdXNoQ29tbWFuZCA9IHZzY29kZS5jb21tYW5kcy5yZWdpc3RlckNvbW1hbmQoJ2FpRGVidWdVdGlsaXRpZXMucnVuUHJlcGFyZVRvUHVzaCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcHJvamVjdCA9IGF3YWl0IHByb2plY3REZXRlY3Rvci5nZXRDdXJyZW50UHJvamVjdCgpO1xuICAgICAgICBpZiAocHJvamVjdCkge1xuICAgICAgICAgICAgYXdhaXQgd2Vidmlld1Byb3ZpZGVyLnJ1bkNvbW1hbmQoJ3ByZXBhcmVUb1B1c2gnLCB7IHByb2plY3Q6IHByb2plY3QubmFtZSB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZzY29kZS53aW5kb3cuc2hvd1dhcm5pbmdNZXNzYWdlKCdObyBOWCBwcm9qZWN0IGRldGVjdGVkLiBQbGVhc2Ugc2VsZWN0IGEgcHJvamVjdCBmaXJzdC4nKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gU3RhdHVzIHRyYWNraW5nIGNvbW1hbmRzXG4gICAgY29uc3Qgc2hvd1N0YXR1c0NvbW1hbmQgPSB2c2NvZGUuY29tbWFuZHMucmVnaXN0ZXJDb21tYW5kKCdhaURlYnVnVXRpbGl0aWVzLnNob3dTdGF0dXMnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlcG9ydCA9IHN0YXR1c1RyYWNrZXIuZ2VuZXJhdGVTdGF0dXNSZXBvcnQoKTtcbiAgICAgICAgY29uc3QgcGFuZWwgPSB2c2NvZGUud2luZG93LmNyZWF0ZVdlYnZpZXdQYW5lbChcbiAgICAgICAgICAgICdhaURlYnVnU3RhdHVzJyxcbiAgICAgICAgICAgICdBSSBEZWJ1ZyBTdGF0dXMgUmVwb3J0JyxcbiAgICAgICAgICAgIHZzY29kZS5WaWV3Q29sdW1uLk9uZSxcbiAgICAgICAgICAgIHt9XG4gICAgICAgICk7XG4gICAgICAgIHBhbmVsLndlYnZpZXcuaHRtbCA9IGBcbiAgICAgICAgICAgIDwhRE9DVFlQRSBodG1sPlxuICAgICAgICAgICAgPGh0bWw+XG4gICAgICAgICAgICA8aGVhZD5cbiAgICAgICAgICAgICAgICA8dGl0bGU+U3RhdHVzIFJlcG9ydDwvdGl0bGU+XG4gICAgICAgICAgICAgICAgPHN0eWxlPlxuICAgICAgICAgICAgICAgICAgICBib2R5IHsgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTsgd2hpdGUtc3BhY2U6IHByZS13cmFwOyBwYWRkaW5nOiAyMHB4OyB9XG4gICAgICAgICAgICAgICAgICAgIC5yZXBvcnQgeyBiYWNrZ3JvdW5kOiAjMWUxZTFlOyBjb2xvcjogI2Q0ZDRkNDsgcGFkZGluZzogMjBweDsgYm9yZGVyLXJhZGl1czogNXB4OyB9XG4gICAgICAgICAgICAgICAgPC9zdHlsZT5cbiAgICAgICAgICAgIDwvaGVhZD5cbiAgICAgICAgICAgIDxib2R5PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJyZXBvcnRcIj4ke3JlcG9ydC5yZXBsYWNlKC9cXG4vZywgJzxicj4nKX08L2Rpdj5cbiAgICAgICAgICAgIDwvYm9keT5cbiAgICAgICAgICAgIDwvaHRtbD5cbiAgICAgICAgYDsgIFxuICAgICAgICB9KTtcblxuICAgIC8vIFBsdWdpbiBtYW5hZ2VtZW50IGNvbW1hbmRzXG4gICAgY29uc3QgcGx1Z2luTWFuYWdlckNvbW1hbmQgPSB2c2NvZGUuY29tbWFuZHMucmVnaXN0ZXJDb21tYW5kKCdhaURlYnVnVXRpbGl0aWVzLnBsdWdpbk1hbmFnZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHBsdWdpbnMgPSBwbHVnaW5NYW5hZ2VyLmdldEFsbCgpO1xuICAgICAgICBjb25zdCBpdGVtcyA9IHBsdWdpbnMubWFwKHBsdWdpbiA9PiAoe1xuICAgICAgICAgICAgbGFiZWw6IHBsdWdpbi5tZXRhZGF0YS5uYW1lLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IHBsdWdpbi5tZXRhZGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgIGRldGFpbDogYHYke3BsdWdpbi5tZXRhZGF0YS52ZXJzaW9ufSAtICR7cGx1Z2luLm1ldGFkYXRhLmF1dGhvcn1gLFxuICAgICAgICAgICAgcGx1Z2luXG4gICAgICAgIH0pKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHNlbGVjdGVkID0gYXdhaXQgdnNjb2RlLndpbmRvdy5zaG93UXVpY2tQaWNrKGl0ZW1zLCB7XG4gICAgICAgICAgICBwbGFjZUhvbGRlcjogJ1NlbGVjdCBhIHBsdWdpbiB0byBtYW5hZ2UnLFxuICAgICAgICAgICAgY2FuUGlja01hbnk6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgaWYgKHNlbGVjdGVkKSB7XG4gICAgICAgICAgICBjb25zdCBhY3Rpb25zID0gW1xuICAgICAgICAgICAgICAgIHsgbGFiZWw6ICdFbmFibGUvRGlzYWJsZScsIGFjdGlvbjogJ3RvZ2dsZScgfSxcbiAgICAgICAgICAgICAgICB7IGxhYmVsOiAnVmlldyBEZXRhaWxzJywgYWN0aW9uOiAnZGV0YWlscycgfSxcbiAgICAgICAgICAgICAgICB7IGxhYmVsOiAnVW5pbnN0YWxsJywgYWN0aW9uOiAndW5pbnN0YWxsJyB9XG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBhY3Rpb24gPSBhd2FpdCB2c2NvZGUud2luZG93LnNob3dRdWlja1BpY2soYWN0aW9ucywge1xuICAgICAgICAgICAgICAgIHBsYWNlSG9sZGVyOiBgV2hhdCB3b3VsZCB5b3UgbGlrZSB0byBkbyB3aXRoICR7c2VsZWN0ZWQucGx1Z2luLm1ldGFkYXRhLm5hbWV9P2BcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoYWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChhY3Rpb24uYWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3RvZ2dsZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocGx1Z2luTWFuYWdlci5pc0VuYWJsZWQoc2VsZWN0ZWQucGx1Z2luLm1ldGFkYXRhLmlkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHBsdWdpbk1hbmFnZXIuZGlzYWJsZShzZWxlY3RlZC5wbHVnaW4ubWV0YWRhdGEuaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZzY29kZS53aW5kb3cuc2hvd0luZm9ybWF0aW9uTWVzc2FnZShgJHtzZWxlY3RlZC5wbHVnaW4ubWV0YWRhdGEubmFtZX0gZGlzYWJsZWRgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgcGx1Z2luTWFuYWdlci5lbmFibGUoc2VsZWN0ZWQucGx1Z2luLm1ldGFkYXRhLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2c2NvZGUud2luZG93LnNob3dJbmZvcm1hdGlvbk1lc3NhZ2UoYCR7c2VsZWN0ZWQucGx1Z2luLm1ldGFkYXRhLm5hbWV9IGVuYWJsZWRgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdkZXRhaWxzJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRldGFpbHMgPSBgIyAke3NlbGVjdGVkLnBsdWdpbi5tZXRhZGF0YS5uYW1lfVxcblxcbmAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAqKlZlcnNpb246KiogJHtzZWxlY3RlZC5wbHVnaW4ubWV0YWRhdGEudmVyc2lvbn1cXG5gICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgKipBdXRob3I6KiogJHtzZWxlY3RlZC5wbHVnaW4ubWV0YWRhdGEuYXV0aG9yfVxcbmAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAqKkRlc2NyaXB0aW9uOioqICR7c2VsZWN0ZWQucGx1Z2luLm1ldGFkYXRhLmRlc2NyaXB0aW9ufVxcblxcbmAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAqKkNhcGFiaWxpdGllczoqKlxcbmAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkLnBsdWdpbi5tZXRhZGF0YS5jYXBhYmlsaXRpZXMubWFwKGNhcCA9PiBgLSAke2NhcC5uYW1lfTogJHtjYXAuZGVzY3JpcHRpb259YCkuam9pbignXFxuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRvYyA9IGF3YWl0IHZzY29kZS53b3Jrc3BhY2Uub3BlblRleHREb2N1bWVudCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogZGV0YWlscyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZTogJ21hcmtkb3duJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB2c2NvZGUud2luZG93LnNob3dUZXh0RG9jdW1lbnQoZG9jKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICd1bmluc3RhbGwnOlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29uZmlybSA9IGF3YWl0IHZzY29kZS53aW5kb3cuc2hvd1dhcm5pbmdNZXNzYWdlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gdW5pbnN0YWxsICR7c2VsZWN0ZWQucGx1Z2luLm1ldGFkYXRhLm5hbWV9P2AsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBtb2RhbDogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdZZXMnLCAnTm8nXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm0gPT09ICdZZXMnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgcGx1Z2luTWFuYWdlci51bnJlZ2lzdGVyKHNlbGVjdGVkLnBsdWdpbi5tZXRhZGF0YS5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdnNjb2RlLndpbmRvdy5zaG93SW5mb3JtYXRpb25NZXNzYWdlKGAke3NlbGVjdGVkLnBsdWdpbi5tZXRhZGF0YS5uYW1lfSB1bmluc3RhbGxlZGApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBwbHVnaW5NYXJrZXRwbGFjZUNvbW1hbmQgPSB2c2NvZGUuY29tbWFuZHMucmVnaXN0ZXJDb21tYW5kKCdhaURlYnVnVXRpbGl0aWVzLnBsdWdpbk1hcmtldHBsYWNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBxdWVyeSA9IGF3YWl0IHZzY29kZS53aW5kb3cuc2hvd0lucHV0Qm94KHtcbiAgICAgICAgICAgIHByb21wdDogJ1NlYXJjaCBmb3IgcGx1Z2lucycsXG4gICAgICAgICAgICBwbGFjZUhvbGRlcjogJ0VudGVyIHNlYXJjaCB0ZXJtcyAoZS5nLiwgXCJnaXRcIiwgXCJ0ZXN0XCIsIFwiYWlcIiknLFxuICAgICAgICAgICAgdmFsdWU6ICcnXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgaWYgKHF1ZXJ5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IHBsdWdpbnMgPSBhd2FpdCBwbHVnaW5NYXJrZXRwbGFjZS5zZWFyY2hQbHVnaW5zKHF1ZXJ5IHx8ICcnKTtcbiAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gcGx1Z2lucy5tYXAocGx1Z2luID0+ICh7XG4gICAgICAgICAgICAgICAgbGFiZWw6IHBsdWdpbi5uYW1lLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBwbHVnaW4uZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgZGV0YWlsOiBgdiR7cGx1Z2luLnZlcnNpb259IC0gJHtwbHVnaW4uYXV0aG9yfSAoJHtwbHVnaW4uZG93bmxvYWRzfSBkb3dubG9hZHMsICR7cGx1Z2luLnJhdGluZ30vNSBzdGFycylgLFxuICAgICAgICAgICAgICAgIHBsdWdpblxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZCA9IGF3YWl0IHZzY29kZS53aW5kb3cuc2hvd1F1aWNrUGljayhpdGVtcywge1xuICAgICAgICAgICAgICAgIHBsYWNlSG9sZGVyOiAnU2VsZWN0IGEgcGx1Z2luIHRvIGluc3RhbGwnLFxuICAgICAgICAgICAgICAgIGNhblBpY2tNYW55OiBmYWxzZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChzZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGFjdGlvbnMgPSBbXG4gICAgICAgICAgICAgICAgICAgIHsgbGFiZWw6ICdJbnN0YWxsJywgYWN0aW9uOiAnaW5zdGFsbCcgfSxcbiAgICAgICAgICAgICAgICAgICAgeyBsYWJlbDogJ1ZpZXcgRGV0YWlscycsIGFjdGlvbjogJ2RldGFpbHMnIH1cbiAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGNvbnN0IGFjdGlvbiA9IGF3YWl0IHZzY29kZS53aW5kb3cuc2hvd1F1aWNrUGljayhhY3Rpb25zLCB7XG4gICAgICAgICAgICAgICAgICAgIHBsYWNlSG9sZGVyOiBgV2hhdCB3b3VsZCB5b3UgbGlrZSB0byBkbyB3aXRoICR7c2VsZWN0ZWQucGx1Z2luLm5hbWV9P2BcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAoYWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYWN0aW9uLmFjdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnaW5zdGFsbCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgcGx1Z2luTWFya2V0cGxhY2UuaW5zdGFsbFBsdWdpbihzZWxlY3RlZC5wbHVnaW4uaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2c2NvZGUud2luZG93LnNob3dJbmZvcm1hdGlvbk1lc3NhZ2UoYCR7c2VsZWN0ZWQucGx1Z2luLm5hbWV9IGluc3RhbGxlZCBzdWNjZXNzZnVsbHkhYCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdnNjb2RlLndpbmRvdy5zaG93RXJyb3JNZXNzYWdlKGBGYWlsZWQgdG8gaW5zdGFsbCAke3NlbGVjdGVkLnBsdWdpbi5uYW1lfTogJHsoZXJyb3IgYXMgRXJyb3IpLm1lc3NhZ2V9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGV0YWlscyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGV0YWlscyA9IGAjICR7c2VsZWN0ZWQucGx1Z2luLm5hbWV9XFxuXFxuYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAqKlZlcnNpb246KiogJHtzZWxlY3RlZC5wbHVnaW4udmVyc2lvbn1cXG5gICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYCoqQXV0aG9yOioqICR7c2VsZWN0ZWQucGx1Z2luLmF1dGhvcn1cXG5gICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYCoqRGVzY3JpcHRpb246KiogJHtzZWxlY3RlZC5wbHVnaW4uZGVzY3JpcHRpb259XFxuYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAqKkRvd25sb2FkczoqKiAke3NlbGVjdGVkLnBsdWdpbi5kb3dubG9hZHN9XFxuYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAqKlJhdGluZzoqKiAke3NlbGVjdGVkLnBsdWdpbi5yYXRpbmd9LzVcXG5cXG5gICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYCoqVGFnczoqKiAke3NlbGVjdGVkLnBsdWdpbi50YWdzLmpvaW4oJywgJyl9XFxuXFxuYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAqKlJFQURNRToqKlxcbiR7c2VsZWN0ZWQucGx1Z2luLnJlYWRtZX1gO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRvYyA9IGF3YWl0IHZzY29kZS53b3Jrc3BhY2Uub3BlblRleHREb2N1bWVudCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGRldGFpbHMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlOiAnbWFya2Rvd24nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdnNjb2RlLndpbmRvdy5zaG93VGV4dERvY3VtZW50KGRvYyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGNvbnN0IHJ1blBsdWdpbkNvbW1hbmQgPSB2c2NvZGUuY29tbWFuZHMucmVnaXN0ZXJDb21tYW5kKCdhaURlYnVnVXRpbGl0aWVzLnJ1blBsdWdpbkNvbW1hbmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHBsdWdpbnMgPSBwbHVnaW5NYW5hZ2VyLmdldEFsbCgpLmZpbHRlcihwID0+IHBsdWdpbk1hbmFnZXIuaXNFbmFibGVkKHAubWV0YWRhdGEuaWQpKTtcbiAgICAgICAgY29uc3QgY29tbWFuZHMgPSBwbHVnaW5zLmZsYXRNYXAocGx1Z2luID0+IFxuICAgICAgICAgICAgKHBsdWdpbi5jb21tYW5kcyB8fCBbXSkubWFwKGNtZCA9PiAoe1xuICAgICAgICAgICAgICAgIGxhYmVsOiBjbWQudGl0bGUsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGNtZC5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICBkZXRhaWw6IGBQbHVnaW46ICR7cGx1Z2luLm1ldGFkYXRhLm5hbWV9YCxcbiAgICAgICAgICAgICAgICBwbHVnaW5JZDogcGx1Z2luLm1ldGFkYXRhLmlkLFxuICAgICAgICAgICAgICAgIGNvbW1hbmRJZDogY21kLmlkXG4gICAgICAgICAgICB9KSlcbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHNlbGVjdGVkID0gYXdhaXQgdnNjb2RlLndpbmRvdy5zaG93UXVpY2tQaWNrKGNvbW1hbmRzLCB7XG4gICAgICAgICAgICBwbGFjZUhvbGRlcjogJ1NlbGVjdCBhIHBsdWdpbiBjb21tYW5kIHRvIHJ1bicsXG4gICAgICAgICAgICBjYW5QaWNrTWFueTogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGx1Z2luTWFuYWdlci5leGVjdXRlUGx1Z2luQ29tbWFuZChzZWxlY3RlZC5wbHVnaW5JZCwgc2VsZWN0ZWQuY29tbWFuZElkKTtcbiAgICAgICAgICAgICAgICB2c2NvZGUud2luZG93LnNob3dJbmZvcm1hdGlvbk1lc3NhZ2UoYENvbW1hbmQgZXhlY3V0ZWQgc3VjY2Vzc2Z1bGx5OiAke3NlbGVjdGVkLmxhYmVsfWApO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB2c2NvZGUud2luZG93LnNob3dFcnJvck1lc3NhZ2UoYEZhaWxlZCB0byBleGVjdXRlIGNvbW1hbmQ6ICR7KGVycm9yIGFzIEVycm9yKS5tZXNzYWdlfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBjbGVhckhpc3RvcnlDb21tYW5kID0gdnNjb2RlLmNvbW1hbmRzLnJlZ2lzdGVyQ29tbWFuZCgnYWlEZWJ1Z1V0aWxpdGllcy5jbGVhckhpc3RvcnknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHZzY29kZS53aW5kb3cuc2hvd1dhcm5pbmdNZXNzYWdlKFxuICAgICAgICAgICAgJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBjbGVhciB0aGUgY29tbWFuZCBoaXN0b3J5PycsXG4gICAgICAgICAgICB7IG1vZGFsOiB0cnVlIH0sXG4gICAgICAgICAgICAnWWVzJywgJ05vJ1xuICAgICAgICApO1xuICAgICAgICBcbiAgICAgICAgaWYgKHJlc3VsdCA9PT0gJ1llcycpIHtcbiAgICAgICAgICAgIHN0YXR1c1RyYWNrZXIuY2xlYXJIaXN0b3J5KCk7XG4gICAgICAgICAgICB2c2NvZGUud2luZG93LnNob3dJbmZvcm1hdGlvbk1lc3NhZ2UoJ0NvbW1hbmQgaGlzdG9yeSBjbGVhcmVkLicpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBjYW5jZWxBbGxDb21tYW5kID0gdnNjb2RlLmNvbW1hbmRzLnJlZ2lzdGVyQ29tbWFuZCgnYWlEZWJ1Z1V0aWxpdGllcy5jYW5jZWxBbGwnLCAoKSA9PiB7XG4gICAgICAgIGNvbW1hbmRDb29yZGluYXRvci5jYW5jZWxBbGxDb21tYW5kcygpO1xuICAgICAgICB2c2NvZGUud2luZG93LnNob3dJbmZvcm1hdGlvbk1lc3NhZ2UoJ0FsbCBydW5uaW5nIGNvbW1hbmRzIGNhbmNlbGxlZC4nKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IGhlYWx0aFJlcG9ydENvbW1hbmQgPSB2c2NvZGUuY29tbWFuZHMucmVnaXN0ZXJDb21tYW5kKCdhaURlYnVnVXRpbGl0aWVzLmhlYWx0aFJlcG9ydCcsICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVwb3J0ID0gY29tbWFuZENvb3JkaW5hdG9yLmNyZWF0ZUhlYWx0aFJlcG9ydCgpO1xuICAgICAgICBjb25zdCBwYW5lbCA9IHZzY29kZS53aW5kb3cuY3JlYXRlV2Vidmlld1BhbmVsKFxuICAgICAgICAgICAgJ2FpRGVidWdIZWFsdGgnLFxuICAgICAgICAgICAgJ0NvbW1hbmQgRXhlY3V0aW9uIEhlYWx0aCBSZXBvcnQnLFxuICAgICAgICAgICAgdnNjb2RlLlZpZXdDb2x1bW4uT25lLFxuICAgICAgICAgICAge31cbiAgICAgICAgKTtcbiAgICAgICAgcGFuZWwud2Vidmlldy5odG1sID0gYFxuICAgICAgICAgICAgPCFET0NUWVBFIGh0bWw+XG4gICAgICAgICAgICA8aHRtbD5cbiAgICAgICAgICAgIDxoZWFkPlxuICAgICAgICAgICAgICAgIDx0aXRsZT5IZWFsdGggUmVwb3J0PC90aXRsZT5cbiAgICAgICAgICAgICAgICA8c3R5bGU+XG4gICAgICAgICAgICAgICAgICAgIGJvZHkgeyBmb250LWZhbWlseTogbW9ub3NwYWNlOyB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7IHBhZGRpbmc6IDIwcHg7IH1cbiAgICAgICAgICAgICAgICAgICAgLnJlcG9ydCB7IGJhY2tncm91bmQ6ICMxZTFlMWU7IGNvbG9yOiAjZDRkNGQ0OyBwYWRkaW5nOiAyMHB4OyBib3JkZXItcmFkaXVzOiA1cHg7IH1cbiAgICAgICAgICAgICAgICA8L3N0eWxlPlxuICAgICAgICAgICAgPC9oZWFkPlxuICAgICAgICAgICAgPGJvZHk+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInJlcG9ydFwiPiR7cmVwb3J0LnJlcGxhY2UoL1xcbi9nLCAnPGJyPicpfTwvZGl2PlxuICAgICAgICAgICAgPC9ib2R5PlxuICAgICAgICAgICAgPC9odG1sPlxuICAgICAgICBgO1xuICAgIH0pO1xuXG4gICAgLy8gQWRkIGFsbCBjb21tYW5kcyB0byBzdWJzY3JpcHRpb25zXG4gICAgY29udGV4dC5zdWJzY3JpcHRpb25zLnB1c2goXG4gICAgICAgIG9wZW5QYW5lbENvbW1hbmQsXG4gICAgICAgIHJ1bkFpRGVidWdDb21tYW5kLFxuICAgICAgICBydW5OeFRlc3RDb21tYW5kLFxuICAgICAgICBydW5HaXREaWZmQ29tbWFuZCxcbiAgICAgICAgcnVuUHJlcGFyZVRvUHVzaENvbW1hbmQsXG4gICAgICAgIHNob3dTdGF0dXNDb21tYW5kLFxuICAgICAgICBjbGVhckhpc3RvcnlDb21tYW5kLFxuICAgICAgICBjYW5jZWxBbGxDb21tYW5kLFxuICAgICAgICBoZWFsdGhSZXBvcnRDb21tYW5kLFxuICAgICAgICBwbHVnaW5NYW5hZ2VyQ29tbWFuZCxcbiAgICAgICAgcGx1Z2luTWFya2V0cGxhY2VDb21tYW5kLFxuICAgICAgICBydW5QbHVnaW5Db21tYW5kXG4gICAgKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlYWN0aXZhdGUoKSB7XG4gICAgY29uc29sZS5sb2coJ0FJIERlYnVnIFV0aWxpdGllcyBleHRlbnNpb24gaXMgbm93IGRlYWN0aXZhdGVkJyk7XG4gICAgXG4gICAgLy8gQ2xlYW4gdXAgcmVzb3VyY2VzXG4gICAgaWYgKHN0YXR1c1RyYWNrZXIpIHtcbiAgICAgICAgc3RhdHVzVHJhY2tlci5kaXNwb3NlKCk7XG4gICAgfVxuICAgIFxuICAgIGlmIChjb21tYW5kQ29vcmRpbmF0b3IpIHtcbiAgICAgICAgY29tbWFuZENvb3JkaW5hdG9yLmRpc3Bvc2UoKTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ2xlYW4gdXAgcGx1Z2luIHN5c3RlbVxuICAgIGlmIChwbHVnaW5NYW5hZ2VyKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBhbGxQbHVnaW5zID0gcGx1Z2luTWFuYWdlci5nZXRBbGwoKTtcbiAgICAgICAgICAgIGlmIChhbGxQbHVnaW5zICYmIEFycmF5LmlzQXJyYXkoYWxsUGx1Z2lucykpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHBsdWdpbiBvZiBhbGxQbHVnaW5zKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwbHVnaW4/Lm1ldGFkYXRhPy5pZCAmJiBwbHVnaW5NYW5hZ2VyLmlzRW5hYmxlZChwbHVnaW4ubWV0YWRhdGEuaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwbHVnaW5NYW5hZ2VyLmRpc2FibGUocGx1Z2luLm1ldGFkYXRhLmlkKS5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGRpc2FibGUgcGx1Z2luICR7cGx1Z2luLm1ldGFkYXRhLmlkfTpgLCBlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGR1cmluZyBwbHVnaW4gY2xlYW51cDonLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gQ2xlYW4gdXAgUGhhc2UgNSBGZWF0dXJlc1xuICAgIGlmIChueEFmZmVjdGVkTWFuYWdlcikge1xuICAgICAgICBueEFmZmVjdGVkTWFuYWdlci5kaXNwb3NlKCk7XG4gICAgfVxuICAgIGlmIChueFN0YXR1c0Jhcikge1xuICAgICAgICBueFN0YXR1c0Jhci5kaXNwb3NlKCk7XG4gICAgfVxuICAgIGlmIChnaXREaWZmTWFuYWdlcikge1xuICAgICAgICBnaXREaWZmTWFuYWdlci5kaXNwb3NlKCk7XG4gICAgfVxuICAgIGlmIChmbGlwcGVyRGV0ZWN0aW9uTWFuYWdlcikge1xuICAgICAgICBmbGlwcGVyRGV0ZWN0aW9uTWFuYWdlci5kaXNwb3NlKCk7XG4gICAgfVxufSJdLCJ2ZXJzaW9uIjozfQ==