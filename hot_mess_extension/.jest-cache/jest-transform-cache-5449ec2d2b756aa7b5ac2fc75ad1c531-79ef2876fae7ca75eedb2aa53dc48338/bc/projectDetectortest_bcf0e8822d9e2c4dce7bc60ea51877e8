4b1a9e6c71a7c65d66d725f66c9b8510
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
// Mock fs module
jest.mock('fs');
jest.mock('path');
jest.mock('vscode', () => mockVscode);
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
// Mock vscode module
const mockVscode = {
    workspace: {
        workspaceFolders: [
            { uri: { fsPath: '/test/workspace' } }
        ]
    },
    window: {
        activeTextEditor: null
    }
};
// Import after mocking
const projectDetector_1 = require("../projectDetector");
const mockedFs = jest.mocked(fs);
const mockedPath = jest.mocked(path);
describe('ProjectDetector', () => {
    let projectDetector;
    beforeEach(() => {
        jest.clearAllMocks();
        projectDetector = new projectDetector_1.ProjectDetector('/test/workspace');
        // Setup path mocks
        mockedPath.join.mockImplementation((...segments) => segments.join('/'));
        mockedPath.basename.mockImplementation((p) => p.split('/').pop() || '');
        mockedPath.relative.mockImplementation((from, to) => to.replace(from, '').replace(/^\//, ''));
    });
    describe('findNxWorkspace', () => {
        it('should find nx.json workspace', async () => {
            mockedFs.existsSync.mockImplementation((filePath) => {
                return filePath === '/test/workspace/nx.json';
            });
            const result = await projectDetector.findNxWorkspace();
            expect(result).toBe('/test/workspace/nx.json');
        });
        it('should find angular.json workspace', async () => {
            mockedFs.existsSync.mockImplementation((filePath) => {
                return filePath === '/test/workspace/angular.json';
            });
            const result = await projectDetector.findNxWorkspace();
            expect(result).toBe('/test/workspace/angular.json');
        });
        it('should return null if no workspace config found', async () => {
            mockedFs.existsSync.mockReturnValue(false);
            const result = await projectDetector.findNxWorkspace();
            expect(result).toBeNull();
        });
        it('should handle errors gracefully', async () => {
            mockedFs.existsSync.mockImplementation(() => {
                throw new Error('File system error');
            });
            const result = await projectDetector.findNxWorkspace();
            expect(result).toBeNull();
        });
    });
    describe('getProjects', () => {
        it('should parse NX workspace with project.json files', async () => {
            // Mock file system to simulate empty project detection
            mockedFs.existsSync.mockReturnValue(false);
            mockedFs.readdirSync.mockReturnValue([]);
            mockedFs.statSync.mockReturnValue({});
            const projects = await projectDetector.getProjects();
            // Should return empty array when no projects are found
            expect(projects).toHaveLength(0);
        });
        it('should parse Angular workspace format', async () => {
            const angularConfig = {
                projects: {
                    'my-app': {
                        root: 'projects/my-app',
                        projectType: 'application',
                        architect: {
                            build: {},
                            test: {}
                        }
                    }
                }
            };
            mockedFs.existsSync.mockImplementation((filePath) => {
                return filePath === '/test/workspace/angular.json';
            });
            mockedFs.readFileSync.mockReturnValue(JSON.stringify(angularConfig));
            mockedFs.readdirSync.mockReturnValue([]);
            mockedFs.statSync.mockReturnValue({});
            const projects = await projectDetector.getProjects();
            expect(projects).toHaveLength(1);
            expect(projects[0]).toMatchObject({
                name: 'my-app',
                type: 'angular',
                projectType: 'application',
                targets: { build: {}, test: {} }
            });
        });
        it('should handle inline project configurations', async () => {
            const nxConfig = {
                projects: {
                    'inline-project': 'apps/inline'
                }
            };
            mockedFs.existsSync.mockImplementation((filePath) => {
                return filePath === '/test/workspace/nx.json' || filePath === '/test/workspace/apps/inline/package.json';
            });
            mockedFs.readFileSync.mockReturnValue(JSON.stringify(nxConfig));
            mockedFs.readdirSync.mockReturnValue([]);
            mockedFs.statSync.mockReturnValue({ isDirectory: () => false });
            const projects = await projectDetector.getProjects();
            expect(projects).toHaveLength(1);
            expect(projects[0]).toMatchObject({
                name: 'inline-project',
                type: 'nx',
                projectType: 'application'
            });
        });
        it('should return empty array when no config found', async () => {
            mockedFs.existsSync.mockReturnValue(false);
            mockedFs.readdirSync.mockReturnValue([]);
            mockedFs.statSync.mockReturnValue({});
            const projects = await projectDetector.getProjects();
            expect(projects).toEqual([]);
        });
        it('should handle JSON parsing errors', async () => {
            mockedFs.existsSync.mockImplementation((filePath) => {
                return filePath === '/test/workspace/nx.json';
            });
            mockedFs.readFileSync.mockReturnValue('invalid json');
            mockedFs.readdirSync.mockReturnValue([]);
            mockedFs.statSync.mockReturnValue({ isDirectory: () => false });
            const projects = await projectDetector.getProjects();
            expect(projects).toEqual([]);
        });
    });
    describe('detectCurrentProject', () => {
        it('should detect project from active file path', async () => {
            const mockProjects = [
                { name: 'my-app', root: '/test/workspace/apps/my-app', projectType: 'application', type: 'nx', packageJsonPath: '/test/workspace/apps/my-app/package.json' },
                { name: 'my-lib', root: '/test/workspace/libs/my-lib', projectType: 'library', type: 'nx', packageJsonPath: '/test/workspace/libs/my-lib/package.json' }
            ];
            jest.spyOn(projectDetector, 'detectProjects').mockResolvedValue(mockProjects);
            // Mock vscode window.activeTextEditor
            mockVscode.window.activeTextEditor = {
                document: {
                    uri: {
                        fsPath: '/test/workspace/apps/my-app/src/main.ts'
                    }
                }
            };
            const currentProject = await projectDetector.detectCurrentProject();
            expect(currentProject?.name).toBe('my-app');
        });
        it('should return null when no active editor', async () => {
            mockVscode.window.activeTextEditor = null;
            const currentProject = await projectDetector.detectCurrentProject();
            expect(currentProject).toBeUndefined();
        });
        it('should return null when file is not in any project', async () => {
            const mockProjects = [
                { name: 'my-app', root: '/test/workspace/apps/my-app', projectType: 'application', type: 'nx', packageJsonPath: '/test/workspace/apps/my-app/package.json' }
            ];
            jest.spyOn(projectDetector, 'detectProjects').mockResolvedValue(mockProjects);
            mockVscode.window.activeTextEditor = {
                document: {
                    uri: {
                        fsPath: '/test/workspace/other/file.ts'
                    }
                }
            };
            const currentProject = await projectDetector.detectCurrentProject();
            expect(currentProject).toBeUndefined();
        });
    });
    describe('getProject', () => {
        it('should return project by name', async () => {
            const mockProjects = [
                { name: 'my-app', root: '/test/workspace/apps/my-app', projectType: 'application', type: 'nx', packageJsonPath: '/test/workspace/apps/my-app/package.json' },
                { name: 'my-lib', root: '/test/workspace/libs/my-lib', projectType: 'library', type: 'nx', packageJsonPath: '/test/workspace/libs/my-lib/package.json' }
            ];
            jest.spyOn(projectDetector, 'detectProjects').mockResolvedValue(mockProjects);
            const project = await projectDetector.getProject('my-lib');
            expect(project).toEqual(mockProjects[1]);
        });
        it('should return null for non-existent project', async () => {
            jest.spyOn(projectDetector, 'detectProjects').mockResolvedValue([]);
            const project = await projectDetector.getProject('non-existent');
            expect(project).toBeNull();
        });
    });
    describe('hasTarget', () => {
        it('should return true when project has target', async () => {
            const mockProject = {
                name: 'my-app',
                root: '/test/workspace/apps/my-app',
                projectType: 'application',
                type: 'nx',
                packageJsonPath: '/test/workspace/apps/my-app/package.json',
                targets: { build: {}, test: {} }
            };
            jest.spyOn(projectDetector, 'getProject').mockResolvedValue(mockProject);
            const hasTarget = await projectDetector.hasTarget('my-app', 'build');
            expect(hasTarget).toBe(true);
        });
        it('should return false when project does not have target', async () => {
            const mockProject = {
                name: 'my-app',
                root: '/test/workspace/apps/my-app',
                projectType: 'application',
                type: 'nx',
                packageJsonPath: '/test/workspace/apps/my-app/package.json',
                targets: { build: {} }
            };
            jest.spyOn(projectDetector, 'getProject').mockResolvedValue(mockProject);
            const hasTarget = await projectDetector.hasTarget('my-app', 'test');
            expect(hasTarget).toBe(false);
        });
        it('should return false when project not found', async () => {
            jest.spyOn(projectDetector, 'getProject').mockResolvedValue(null);
            const hasTarget = await projectDetector.hasTarget('non-existent', 'build');
            expect(hasTarget).toBe(false);
        });
        it('should return false when project has no targets', async () => {
            const mockProject = {
                name: 'my-app',
                root: '/test/workspace/apps/my-app',
                projectType: 'application',
                type: 'nx',
                packageJsonPath: '/test/workspace/apps/my-app/package.json'
            };
            jest.spyOn(projectDetector, 'getProject').mockResolvedValue(mockProject);
            const hasTarget = await projectDetector.hasTarget('my-app', 'build');
            expect(hasTarget).toBe(false);
        });
    });
    describe('getWorkspaceRoot', () => {
        it('should return workspace root directory', () => {
            const root = projectDetector.getWorkspaceRoot();
            expect(root).toBe('/test/workspace');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2dyZWdkdW5uL3NyYy90ZXN0L2FpX2RlYnVnX2NvbnRleHQvdnNjb2RlL3NyYy91dGlscy9fX3Rlc3RzX18vcHJvamVjdERldGVjdG9yLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFHQSxpQkFBaUI7QUFDakIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNoQixJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBY2xCLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBbkJ0Qyx1Q0FBeUI7QUFDekIsMkNBQTZCO0FBTTdCLHFCQUFxQjtBQUNyQixNQUFNLFVBQVUsR0FBRztJQUNqQixTQUFTLEVBQUU7UUFDVCxnQkFBZ0IsRUFBRTtZQUNoQixFQUFFLEdBQUcsRUFBRSxFQUFFLE1BQU0sRUFBRSxpQkFBaUIsRUFBRSxFQUFFO1NBQ3ZDO0tBQ0Y7SUFDRCxNQUFNLEVBQUU7UUFDTixnQkFBZ0IsRUFBRSxJQUFJO0tBQ3ZCO0NBQ0YsQ0FBQztBQUlGLHVCQUF1QjtBQUN2Qix3REFBcUQ7QUFFckQsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUNqQyxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBRXJDLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUU7SUFDL0IsSUFBSSxlQUFnQyxDQUFDO0lBRXJDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDckIsZUFBZSxHQUFHLElBQUksaUNBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBRXpELG1CQUFtQjtRQUNuQixVQUFVLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUMsR0FBRyxRQUFRLEVBQUUsRUFBRSxD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QUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFO1FBQ2hDLEVBQUUsQ0FBQyx3Q0FBd0MsRUFBRSxHQUFHLEVBQUU7WUFDaEQsTUFBTSxJQUFJLEdBQUcsZUFBZSxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDaEQsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBQ3ZDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvZ3JlZ2R1bm4vc3JjL3Rlc3QvYWlfZGVidWdfY29udGV4dC92c2NvZGUvc3JjL3V0aWxzL19fdGVzdHNfXy9wcm9qZWN0RGV0ZWN0b3IudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuXG4vLyBNb2NrIGZzIG1vZHVsZVxuamVzdC5tb2NrKCdmcycpO1xuamVzdC5tb2NrKCdwYXRoJyk7XG5cbi8vIE1vY2sgdnNjb2RlIG1vZHVsZVxuY29uc3QgbW9ja1ZzY29kZSA9IHtcbiAgd29ya3NwYWNlOiB7XG4gICAgd29ya3NwYWNlRm9sZGVyczogW1xuICAgICAgeyB1cmk6IHsgZnNQYXRoOiAnL3Rlc3Qvd29ya3NwYWNlJyB9IH1cbiAgICBdXG4gIH0sXG4gIHdpbmRvdzoge1xuICAgIGFjdGl2ZVRleHRFZGl0b3I6IG51bGxcbiAgfVxufTtcblxuamVzdC5tb2NrKCd2c2NvZGUnLCAoKSA9PiBtb2NrVnNjb2RlKTtcblxuLy8gSW1wb3J0IGFmdGVyIG1vY2tpbmdcbmltcG9ydCB7IFByb2plY3REZXRlY3RvciB9IGZyb20gJy4uL3Byb2plY3REZXRlY3Rvcic7XG5cbmNvbnN0IG1vY2tlZEZzID0gamVzdC5tb2NrZWQoZnMpO1xuY29uc3QgbW9ja2VkUGF0aCA9IGplc3QubW9ja2VkKHBhdGgpO1xuXG5kZXNjcmliZSgnUHJvamVjdERldGVjdG9yJywgKCkgPT4ge1xuICBsZXQgcHJvamVjdERldGVjdG9yOiBQcm9qZWN0RGV0ZWN0b3I7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgcHJvamVjdERldGVjdG9yID0gbmV3IFByb2plY3REZXRlY3RvcignL3Rlc3Qvd29ya3NwYWNlJyk7XG4gICAgXG4gICAgLy8gU2V0dXAgcGF0aCBtb2Nrc1xuICAgIG1vY2tlZFBhdGguam9pbi5tb2NrSW1wbGVtZW50YXRpb24oKC4uLnNlZ21lbnRzKSA9PiBzZWdtZW50cy5qb2luKCcvJykpO1xuICAgIG1vY2tlZFBhdGguYmFzZW5hbWUubW9ja0ltcGxlbWVudGF0aW9uKChwKSA9PiBwLnNwbGl0KCcvJykucG9wKCkgfHwgJycpO1xuICAgIG1vY2tlZFBhdGgucmVsYXRpdmUubW9ja0ltcGxlbWVudGF0aW9uKChmcm9tLCB0bykgPT4gdG8ucmVwbGFjZShmcm9tLCAnJykucmVwbGFjZSgvXlxcLy8sICcnKSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdmaW5kTnhXb3Jrc3BhY2UnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBmaW5kIG54Lmpzb24gd29ya3NwYWNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja2VkRnMuZXhpc3RzU3luYy5tb2NrSW1wbGVtZW50YXRpb24oKGZpbGVQYXRoKSA9PiB7XG4gICAgICAgIHJldHVybiBmaWxlUGF0aCA9PT0gJy90ZXN0L3dvcmtzcGFjZS9ueC5qc29uJztcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcm9qZWN0RGV0ZWN0b3IuZmluZE54V29ya3NwYWNlKCk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKCcvdGVzdC93b3Jrc3BhY2UvbnguanNvbicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmaW5kIGFuZ3VsYXIuanNvbiB3b3Jrc3BhY2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrZWRGcy5leGlzdHNTeW5jLm1vY2tJbXBsZW1lbnRhdGlvbigoZmlsZVBhdGgpID0+IHtcbiAgICAgICAgcmV0dXJuIGZpbGVQYXRoID09PSAnL3Rlc3Qvd29ya3NwYWNlL2FuZ3VsYXIuanNvbic7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcHJvamVjdERldGVjdG9yLmZpbmROeFdvcmtzcGFjZSgpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgnL3Rlc3Qvd29ya3NwYWNlL2FuZ3VsYXIuanNvbicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbnVsbCBpZiBubyB3b3Jrc3BhY2UgY29uZmlnIGZvdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja2VkRnMuZXhpc3RzU3luYy5tb2NrUmV0dXJuVmFsdWUoZmFsc2UpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcm9qZWN0RGV0ZWN0b3IuZmluZE54V29ya3NwYWNlKCk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZXJyb3JzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrZWRGcy5leGlzdHNTeW5jLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRmlsZSBzeXN0ZW0gZXJyb3InKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcm9qZWN0RGV0ZWN0b3IuZmluZE54V29ya3NwYWNlKCk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0UHJvamVjdHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBwYXJzZSBOWCB3b3Jrc3BhY2Ugd2l0aCBwcm9qZWN0Lmpzb24gZmlsZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNb2NrIGZpbGUgc3lzdGVtIHRvIHNpbXVsYXRlIGVtcHR5IHByb2plY3QgZGV0ZWN0aW9uXG4gICAgICBtb2NrZWRGcy5leGlzdHNTeW5jLm1vY2tSZXR1cm5WYWx1ZShmYWxzZSk7XG4gICAgICAobW9ja2VkRnMucmVhZGRpclN5bmMgYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUoW10pO1xuICAgICAgKG1vY2tlZEZzLnN0YXRTeW5jIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKHt9KTtcblxuICAgICAgY29uc3QgcHJvamVjdHMgPSBhd2FpdCBwcm9qZWN0RGV0ZWN0b3IuZ2V0UHJvamVjdHMoKTtcblxuICAgICAgLy8gU2hvdWxkIHJldHVybiBlbXB0eSBhcnJheSB3aGVuIG5vIHByb2plY3RzIGFyZSBmb3VuZFxuICAgICAgZXhwZWN0KHByb2plY3RzKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHBhcnNlIEFuZ3VsYXIgd29ya3NwYWNlIGZvcm1hdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGFuZ3VsYXJDb25maWcgPSB7XG4gICAgICAgIHByb2plY3RzOiB7XG4gICAgICAgICAgJ215LWFwcCc6IHtcbiAgICAgICAgICAgIHJvb3Q6ICdwcm9qZWN0cy9teS1hcHAnLFxuICAgICAgICAgICAgcHJvamVjdFR5cGU6ICdhcHBsaWNhdGlvbicsXG4gICAgICAgICAgICBhcmNoaXRlY3Q6IHtcbiAgICAgICAgICAgICAgYnVpbGQ6IHt9LFxuICAgICAgICAgICAgICB0ZXN0OiB7fVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgbW9ja2VkRnMuZXhpc3RzU3luYy5tb2NrSW1wbGVtZW50YXRpb24oKGZpbGVQYXRoKSA9PiB7XG4gICAgICAgIHJldHVybiBmaWxlUGF0aCA9PT0gJy90ZXN0L3dvcmtzcGFjZS9hbmd1bGFyLmpzb24nO1xuICAgICAgfSk7XG4gICAgICBtb2NrZWRGcy5yZWFkRmlsZVN5bmMubW9ja1JldHVyblZhbHVlKEpTT04uc3RyaW5naWZ5KGFuZ3VsYXJDb25maWcpKTtcbiAgICAgIChtb2NrZWRGcy5yZWFkZGlyU3luYyBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZShbXSk7XG4gICAgICAobW9ja2VkRnMuc3RhdFN5bmMgYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUoe30pO1xuXG4gICAgICBjb25zdCBwcm9qZWN0cyA9IGF3YWl0IHByb2plY3REZXRlY3Rvci5nZXRQcm9qZWN0cygpO1xuXG4gICAgICBleHBlY3QocHJvamVjdHMpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChwcm9qZWN0c1swXSkudG9NYXRjaE9iamVjdCh7XG4gICAgICAgIG5hbWU6ICdteS1hcHAnLFxuICAgICAgICB0eXBlOiAnYW5ndWxhcicsXG4gICAgICAgIHByb2plY3RUeXBlOiAnYXBwbGljYXRpb24nLFxuICAgICAgICB0YXJnZXRzOiB7IGJ1aWxkOiB7fSwgdGVzdDoge30gfVxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBpbmxpbmUgcHJvamVjdCBjb25maWd1cmF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG54Q29uZmlnID0ge1xuICAgICAgICBwcm9qZWN0czoge1xuICAgICAgICAgICdpbmxpbmUtcHJvamVjdCc6ICdhcHBzL2lubGluZSdcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgbW9ja2VkRnMuZXhpc3RzU3luYy5tb2NrSW1wbGVtZW50YXRpb24oKGZpbGVQYXRoKSA9PiB7XG4gICAgICAgIHJldHVybiBmaWxlUGF0aCA9PT0gJy90ZXN0L3dvcmtzcGFjZS9ueC5qc29uJyB8fCBmaWxlUGF0aCA9PT0gJy90ZXN0L3dvcmtzcGFjZS9hcHBzL2lubGluZS9wYWNrYWdlLmpzb24nO1xuICAgICAgfSk7XG4gICAgICBtb2NrZWRGcy5yZWFkRmlsZVN5bmMubW9ja1JldHVyblZhbHVlKEpTT04uc3RyaW5naWZ5KG54Q29uZmlnKSk7XG4gICAgICAobW9ja2VkRnMucmVhZGRpclN5bmMgYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUoW10pO1xuICAgICAgKG1vY2tlZEZzLnN0YXRTeW5jIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKHsgaXNEaXJlY3Rvcnk6ICgpID0+IGZhbHNlIH0pO1xuXG4gICAgICBjb25zdCBwcm9qZWN0cyA9IGF3YWl0IHByb2plY3REZXRlY3Rvci5nZXRQcm9qZWN0cygpO1xuXG4gICAgICBleHBlY3QocHJvamVjdHMpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChwcm9qZWN0c1swXSkudG9NYXRjaE9iamVjdCh7XG4gICAgICAgIG5hbWU6ICdpbmxpbmUtcHJvamVjdCcsXG4gICAgICAgIHR5cGU6ICdueCcsXG4gICAgICAgIHByb2plY3RUeXBlOiAnYXBwbGljYXRpb24nXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGVtcHR5IGFycmF5IHdoZW4gbm8gY29uZmlnIGZvdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja2VkRnMuZXhpc3RzU3luYy5tb2NrUmV0dXJuVmFsdWUoZmFsc2UpO1xuICAgICAgKG1vY2tlZEZzLnJlYWRkaXJTeW5jIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKFtdKTtcbiAgICAgIChtb2NrZWRGcy5zdGF0U3luYyBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSh7fSk7XG5cbiAgICAgIGNvbnN0IHByb2plY3RzID0gYXdhaXQgcHJvamVjdERldGVjdG9yLmdldFByb2plY3RzKCk7XG4gICAgICBleHBlY3QocHJvamVjdHMpLnRvRXF1YWwoW10pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgSlNPTiBwYXJzaW5nIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tlZEZzLmV4aXN0c1N5bmMubW9ja0ltcGxlbWVudGF0aW9uKChmaWxlUGF0aCkgPT4ge1xuICAgICAgICByZXR1cm4gZmlsZVBhdGggPT09ICcvdGVzdC93b3Jrc3BhY2UvbnguanNvbic7XG4gICAgICB9KTtcbiAgICAgIG1vY2tlZEZzLnJlYWRGaWxlU3luYy5tb2NrUmV0dXJuVmFsdWUoJ2ludmFsaWQganNvbicpO1xuICAgICAgKG1vY2tlZEZzLnJlYWRkaXJTeW5jIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKFtdKTtcbiAgICAgIChtb2NrZWRGcy5zdGF0U3luYyBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSh7IGlzRGlyZWN0b3J5OiAoKSA9PiBmYWxzZSB9KTtcblxuICAgICAgY29uc3QgcHJvamVjdHMgPSBhd2FpdCBwcm9qZWN0RGV0ZWN0b3IuZ2V0UHJvamVjdHMoKTtcbiAgICAgIGV4cGVjdChwcm9qZWN0cykudG9FcXVhbChbXSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdkZXRlY3RDdXJyZW50UHJvamVjdCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGRldGVjdCBwcm9qZWN0IGZyb20gYWN0aXZlIGZpbGUgcGF0aCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tQcm9qZWN0cyA9IFtcbiAgICAgICAgeyBuYW1lOiAnbXktYXBwJywgcm9vdDogJy90ZXN0L3dvcmtzcGFjZS9hcHBzL215LWFwcCcsIHByb2plY3RUeXBlOiAnYXBwbGljYXRpb24nIGFzIGNvbnN0LCB0eXBlOiAnbngnIGFzIGNvbnN0LCBwYWNrYWdlSnNvblBhdGg6ICcvdGVzdC93b3Jrc3BhY2UvYXBwcy9teS1hcHAvcGFja2FnZS5qc29uJyB9LFxuICAgICAgICB7IG5hbWU6ICdteS1saWInLCByb290OiAnL3Rlc3Qvd29ya3NwYWNlL2xpYnMvbXktbGliJywgcHJvamVjdFR5cGU6ICdsaWJyYXJ5JyBhcyBjb25zdCwgdHlwZTogJ254JyBhcyBjb25zdCwgcGFja2FnZUpzb25QYXRoOiAnL3Rlc3Qvd29ya3NwYWNlL2xpYnMvbXktbGliL3BhY2thZ2UuanNvbicgfVxuICAgICAgXTtcblxuICAgICAgamVzdC5zcHlPbihwcm9qZWN0RGV0ZWN0b3IsICdkZXRlY3RQcm9qZWN0cycpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9qZWN0cyk7XG5cbiAgICAgIC8vIE1vY2sgdnNjb2RlIHdpbmRvdy5hY3RpdmVUZXh0RWRpdG9yXG4gICAgICBtb2NrVnNjb2RlLndpbmRvdy5hY3RpdmVUZXh0RWRpdG9yID0ge1xuICAgICAgICBkb2N1bWVudDoge1xuICAgICAgICAgIHVyaToge1xuICAgICAgICAgICAgZnNQYXRoOiAnL3Rlc3Qvd29ya3NwYWNlL2FwcHMvbXktYXBwL3NyYy9tYWluLnRzJ1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBhcyBhbnk7XG5cbiAgICAgIGNvbnN0IGN1cnJlbnRQcm9qZWN0ID0gYXdhaXQgcHJvamVjdERldGVjdG9yLmRldGVjdEN1cnJlbnRQcm9qZWN0KCk7XG4gICAgICBleHBlY3QoY3VycmVudFByb2plY3Q/Lm5hbWUpLnRvQmUoJ215LWFwcCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbnVsbCB3aGVuIG5vIGFjdGl2ZSBlZGl0b3InLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrVnNjb2RlLndpbmRvdy5hY3RpdmVUZXh0RWRpdG9yID0gbnVsbDtcblxuICAgICAgY29uc3QgY3VycmVudFByb2plY3QgPSBhd2FpdCBwcm9qZWN0RGV0ZWN0b3IuZGV0ZWN0Q3VycmVudFByb2plY3QoKTtcbiAgICAgIGV4cGVjdChjdXJyZW50UHJvamVjdCkudG9CZVVuZGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbnVsbCB3aGVuIGZpbGUgaXMgbm90IGluIGFueSBwcm9qZWN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Byb2plY3RzID0gW1xuICAgICAgICB7IG5hbWU6ICdteS1hcHAnLCByb290OiAnL3Rlc3Qvd29ya3NwYWNlL2FwcHMvbXktYXBwJywgcHJvamVjdFR5cGU6ICdhcHBsaWNhdGlvbicgYXMgY29uc3QsIHR5cGU6ICdueCcgYXMgY29uc3QsIHBhY2thZ2VKc29uUGF0aDogJy90ZXN0L3dvcmtzcGFjZS9hcHBzL215LWFwcC9wYWNrYWdlLmpzb24nIH1cbiAgICAgIF07XG5cbiAgICAgIGplc3Quc3B5T24ocHJvamVjdERldGVjdG9yLCAnZGV0ZWN0UHJvamVjdHMnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUHJvamVjdHMpO1xuXG4gICAgICBtb2NrVnNjb2RlLndpbmRvdy5hY3RpdmVUZXh0RWRpdG9yID0ge1xuICAgICAgICBkb2N1bWVudDoge1xuICAgICAgICAgIHVyaToge1xuICAgICAgICAgICAgZnNQYXRoOiAnL3Rlc3Qvd29ya3NwYWNlL290aGVyL2ZpbGUudHMnXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGFzIGFueTtcblxuICAgICAgY29uc3QgY3VycmVudFByb2plY3QgPSBhd2FpdCBwcm9qZWN0RGV0ZWN0b3IuZGV0ZWN0Q3VycmVudFByb2plY3QoKTtcbiAgICAgIGV4cGVjdChjdXJyZW50UHJvamVjdCkudG9CZVVuZGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0UHJvamVjdCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBwcm9qZWN0IGJ5IG5hbWUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUHJvamVjdHMgPSBbXG4gICAgICAgIHsgbmFtZTogJ215LWFwcCcsIHJvb3Q6ICcvdGVzdC93b3Jrc3BhY2UvYXBwcy9teS1hcHAnLCBwcm9qZWN0VHlwZTogJ2FwcGxpY2F0aW9uJyBhcyBjb25zdCwgdHlwZTogJ254JyBhcyBjb25zdCwgcGFja2FnZUpzb25QYXRoOiAnL3Rlc3Qvd29ya3NwYWNlL2FwcHMvbXktYXBwL3BhY2thZ2UuanNvbicgfSxcbiAgICAgICAgeyBuYW1lOiAnbXktbGliJywgcm9vdDogJy90ZXN0L3dvcmtzcGFjZS9saWJzL215LWxpYicsIHByb2plY3RUeXBlOiAnbGlicmFyeScgYXMgY29uc3QsIHR5cGU6ICdueCcgYXMgY29uc3QsIHBhY2thZ2VKc29uUGF0aDogJy90ZXN0L3dvcmtzcGFjZS9saWJzL215LWxpYi9wYWNrYWdlLmpzb24nIH1cbiAgICAgIF07XG5cbiAgICAgIGplc3Quc3B5T24ocHJvamVjdERldGVjdG9yLCAnZGV0ZWN0UHJvamVjdHMnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUHJvamVjdHMpO1xuXG4gICAgICBjb25zdCBwcm9qZWN0ID0gYXdhaXQgcHJvamVjdERldGVjdG9yLmdldFByb2plY3QoJ215LWxpYicpO1xuICAgICAgZXhwZWN0KHByb2plY3QpLnRvRXF1YWwobW9ja1Byb2plY3RzWzFdKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgZm9yIG5vbi1leGlzdGVudCBwcm9qZWN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdC5zcHlPbihwcm9qZWN0RGV0ZWN0b3IsICdkZXRlY3RQcm9qZWN0cycpLm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcblxuICAgICAgY29uc3QgcHJvamVjdCA9IGF3YWl0IHByb2plY3REZXRlY3Rvci5nZXRQcm9qZWN0KCdub24tZXhpc3RlbnQnKTtcbiAgICAgIGV4cGVjdChwcm9qZWN0KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaGFzVGFyZ2V0JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHRydWUgd2hlbiBwcm9qZWN0IGhhcyB0YXJnZXQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUHJvamVjdCA9IHtcbiAgICAgICAgbmFtZTogJ215LWFwcCcsXG4gICAgICAgIHJvb3Q6ICcvdGVzdC93b3Jrc3BhY2UvYXBwcy9teS1hcHAnLFxuICAgICAgICBwcm9qZWN0VHlwZTogJ2FwcGxpY2F0aW9uJyBhcyBjb25zdCxcbiAgICAgICAgdHlwZTogJ254JyBhcyBjb25zdCxcbiAgICAgICAgcGFja2FnZUpzb25QYXRoOiAnL3Rlc3Qvd29ya3NwYWNlL2FwcHMvbXktYXBwL3BhY2thZ2UuanNvbicsXG4gICAgICAgIHRhcmdldHM6IHsgYnVpbGQ6IHt9LCB0ZXN0OiB7fSB9XG4gICAgICB9O1xuXG4gICAgICBqZXN0LnNweU9uKHByb2plY3REZXRlY3RvciwgJ2dldFByb2plY3QnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUHJvamVjdCk7XG5cbiAgICAgIGNvbnN0IGhhc1RhcmdldCA9IGF3YWl0IHByb2plY3REZXRlY3Rvci5oYXNUYXJnZXQoJ215LWFwcCcsICdidWlsZCcpO1xuICAgICAgZXhwZWN0KGhhc1RhcmdldCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGZhbHNlIHdoZW4gcHJvamVjdCBkb2VzIG5vdCBoYXZlIHRhcmdldCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tQcm9qZWN0ID0ge1xuICAgICAgICBuYW1lOiAnbXktYXBwJyxcbiAgICAgICAgcm9vdDogJy90ZXN0L3dvcmtzcGFjZS9hcHBzL215LWFwcCcsXG4gICAgICAgIHByb2plY3RUeXBlOiAnYXBwbGljYXRpb24nIGFzIGNvbnN0LFxuICAgICAgICB0eXBlOiAnbngnIGFzIGNvbnN0LFxuICAgICAgICBwYWNrYWdlSnNvblBhdGg6ICcvdGVzdC93b3Jrc3BhY2UvYXBwcy9teS1hcHAvcGFja2FnZS5qc29uJyxcbiAgICAgICAgdGFyZ2V0czogeyBidWlsZDoge30gfVxuICAgICAgfTtcblxuICAgICAgamVzdC5zcHlPbihwcm9qZWN0RGV0ZWN0b3IsICdnZXRQcm9qZWN0JykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2plY3QpO1xuXG4gICAgICBjb25zdCBoYXNUYXJnZXQgPSBhd2FpdCBwcm9qZWN0RGV0ZWN0b3IuaGFzVGFyZ2V0KCdteS1hcHAnLCAndGVzdCcpO1xuICAgICAgZXhwZWN0KGhhc1RhcmdldCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSB3aGVuIHByb2plY3Qgbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdC5zcHlPbihwcm9qZWN0RGV0ZWN0b3IsICdnZXRQcm9qZWN0JykubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGNvbnN0IGhhc1RhcmdldCA9IGF3YWl0IHByb2plY3REZXRlY3Rvci5oYXNUYXJnZXQoJ25vbi1leGlzdGVudCcsICdidWlsZCcpO1xuICAgICAgZXhwZWN0KGhhc1RhcmdldCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSB3aGVuIHByb2plY3QgaGFzIG5vIHRhcmdldHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUHJvamVjdCA9IHtcbiAgICAgICAgbmFtZTogJ215LWFwcCcsXG4gICAgICAgIHJvb3Q6ICcvdGVzdC93b3Jrc3BhY2UvYXBwcy9teS1hcHAnLFxuICAgICAgICBwcm9qZWN0VHlwZTogJ2FwcGxpY2F0aW9uJyBhcyBjb25zdCxcbiAgICAgICAgdHlwZTogJ254JyBhcyBjb25zdCxcbiAgICAgICAgcGFja2FnZUpzb25QYXRoOiAnL3Rlc3Qvd29ya3NwYWNlL2FwcHMvbXktYXBwL3BhY2thZ2UuanNvbidcbiAgICAgIH07XG5cbiAgICAgIGplc3Quc3B5T24ocHJvamVjdERldGVjdG9yLCAnZ2V0UHJvamVjdCcpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9qZWN0KTtcblxuICAgICAgY29uc3QgaGFzVGFyZ2V0ID0gYXdhaXQgcHJvamVjdERldGVjdG9yLmhhc1RhcmdldCgnbXktYXBwJywgJ2J1aWxkJyk7XG4gICAgICBleHBlY3QoaGFzVGFyZ2V0KS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFdvcmtzcGFjZVJvb3QnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gd29ya3NwYWNlIHJvb3QgZGlyZWN0b3J5JywgKCkgPT4ge1xuICAgICAgY29uc3Qgcm9vdCA9IHByb2plY3REZXRlY3Rvci5nZXRXb3Jrc3BhY2VSb290KCk7XG4gICAgICBleHBlY3Qocm9vdCkudG9CZSgnL3Rlc3Qvd29ya3NwYWNlJyk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=