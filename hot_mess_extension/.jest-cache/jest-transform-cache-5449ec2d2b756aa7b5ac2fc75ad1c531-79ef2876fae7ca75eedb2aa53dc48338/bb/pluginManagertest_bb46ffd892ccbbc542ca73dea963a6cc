2dc502afb972924582c0491ace04089d
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock VSCode API
jest.mock('vscode', () => ({
    window: {
        showInformationMessage: jest.fn(),
        showWarningMessage: jest.fn(),
        showErrorMessage: jest.fn(),
        withProgress: jest.fn(),
        createTreeView: jest.fn(),
        showTextDocument: jest.fn(),
        showInputBox: jest.fn(),
        showQuickPick: jest.fn(),
        activeTextEditor: {
            document: {
                fileName: 'test.ts',
                getText: jest.fn().mockReturnValue('test content')
            },
            selection: {}
        }
    },
    workspace: {
        openTextDocument: jest.fn(),
        fs: {
            writeFile: jest.fn(),
            readFile: jest.fn()
        }
    },
    commands: {
        registerCommand: jest.fn().mockReturnValue({ dispose: jest.fn() })
    },
    ProgressLocation: {
        Notification: 15
    },
    Uri: {
        file: jest.fn()
    }
}));
const pluginManager_1 = require("../pluginManager");
// Mock plugin for testing
class TestPlugin {
    metadata = {
        id: 'test-plugin',
        name: 'Test Plugin',
        version: '1.0.0',
        description: 'Test plugin for unit tests',
        author: 'Test Author',
        license: 'MIT',
        enabled: true,
        capabilities: [
            {
                type: 'command',
                name: 'test-command',
                description: 'Test command'
            }
        ]
    };
    activated = false;
    deactivated = false;
    async activate(api, context) {
        this.activated = true;
    }
    async deactivate(api, context) {
        this.deactivated = true;
    }
    get commands() {
        return [
            {
                id: 'test-command',
                title: 'Test Command',
                description: 'Test command',
                execute: async (context, args) => {
                    return 'test-result';
                }
            }
        ];
    }
}
describe('PluginManager', () => {
    let pluginManager;
    let mockExtensionContext;
    beforeEach(() => {
        mockExtensionContext = {
            subscriptions: [],
            extensionPath: '/test/path',
            globalState: {
                get: jest.fn().mockReturnValue({}),
                update: jest.fn(),
                keys: jest.fn().mockReturnValue([])
            }
        };
        pluginManager = new pluginManager_1.PluginManager(mockExtensionContext, '/test/workspace');
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('Plugin Registration', () => {
        it('should register a plugin successfully', async () => {
            const testPlugin = new TestPlugin();
            await pluginManager.register(testPlugin);
            const registeredPlugin = pluginManager.get('test-plugin');
            expect(registeredPlugin).toBe(testPlugin);
            expect(testPlugin.activated).toBe(true);
        });
        it('should throw error when registering plugin with duplicate ID', async () => {
            const testPlugin1 = new TestPlugin();
            const testPlugin2 = new TestPlugin();
            await pluginManager.register(testPlugin1);
            await expect(pluginManager.register(testPlugin2)).rejects.toThrow('Plugin with ID \'test-plugin\' is already registered');
        });
        it('should validate plugin before registration', async () => {
            const invalidPlugin = {
                metadata: {
                    id: '',
                    name: '',
                    version: '',
                    description: '',
                    author: '',
                    license: '',
                    enabled: true,
                    capabilities: []
                },
                activate: jest.fn(),
                deactivate: jest.fn()
            };
            await expect(pluginManager.register(invalidPlugin)).rejects.toThrow();
        });
    });
    describe('Plugin Lifecycle', () => {
        it('should enable and disable plugins', async () => {
            const testPlugin = new TestPlugin();
            await pluginManager.register(testPlugin);
            // Plugin should be enabled by default
            expect(pluginManager.isEnabled('test-plugin')).toBe(true);
            // Disable plugin
            await pluginManager.disable('test-plugin');
            expect(pluginManager.isEnabled('test-plugin')).toBe(false);
            expect(testPlugin.deactivated).toBe(true);
            // Re-enable plugin
            testPlugin.activated = false;
            await pluginManager.enable('test-plugin');
            expect(pluginManager.isEnabled('test-plugin')).toBe(true);
            expect(testPlugin.activated).toBe(true);
        });
        it('should unregister plugins', async () => {
            const testPlugin = new TestPlugin();
            await pluginManager.register(testPlugin);
            expect(pluginManager.get('test-plugin')).toBe(testPlugin);
            await pluginManager.unregister('test-plugin');
            expect(pluginManager.get('test-plugin')).toBeUndefined();
            expect(testPlugin.deactivated).toBe(true);
        });
    });
    describe('Plugin Discovery', () => {
        it('should get all registered plugins', async () => {
            const testPlugin1 = new TestPlugin();
            const testPlugin2 = new TestPlugin();
            testPlugin2.metadata.id = 'test-plugin-2';
            await pluginManager.register(testPlugin1);
            await pluginManager.register(testPlugin2);
            const allPlugins = pluginManager.getAll();
            expect(allPlugins).toHaveLength(5); // 2 test plugins + 3 built-in plugins
            expect(allPlugins.find(p => p.metadata.id === 'test-plugin')).toBe(testPlugin1);
            expect(allPlugins.find(p => p.metadata.id === 'test-plugin-2')).toBe(testPlugin2);
        });
        it('should get plugins by capability', async () => {
            const testPlugin = new TestPlugin();
            await pluginManager.register(testPlugin);
            const commandPlugins = pluginManager.getByCapability('command');
            expect(commandPlugins.length).toBeGreaterThan(0);
            expect(commandPlugins.find(p => p.metadata.id === 'test-plugin')).toBe(testPlugin);
        });
    });
    describe('Plugin Commands', () => {
        it('should execute plugin commands', async () => {
            const testPlugin = new TestPlugin();
            await pluginManager.register(testPlugin);
            const result = await pluginManager.executePluginCommand('test-plugin', 'test-command');
            expect(result).toBe('test-result');
        });
        it('should throw error for non-existent plugin', async () => {
            await expect(pluginManager.executePluginCommand('non-existent', 'test-command')).rejects.toThrow('Plugin \'non-existent\' not found or not enabled');
        });
        it('should throw error for non-existent command', async () => {
            const testPlugin = new TestPlugin();
            await pluginManager.register(testPlugin);
            await expect(pluginManager.executePluginCommand('test-plugin', 'non-existent-command')).rejects.toThrow('Command \'non-existent-command\' not found in plugin \'test-plugin\'');
        });
    });
    describe('Plugin Context', () => {
        it('should refresh plugin context', async () => {
            const testPlugin = new TestPlugin();
            await pluginManager.register(testPlugin);
            await pluginManager.refreshPluginContext();
            // Context should be updated
            expect(pluginManager).toBeDefined();
        });
    });
    describe('Development Utilities', () => {
        it('should create development utils', () => {
            const devUtils = pluginManager.createDevUtils('test-plugin');
            expect(devUtils).toBeDefined();
            expect(devUtils.createLogger).toBeDefined();
            expect(devUtils.createStorage).toBeDefined();
            expect(devUtils.createScheduler).toBeDefined();
        });
        it('should create logger', () => {
            const devUtils = pluginManager.createDevUtils('test-plugin');
            const logger = devUtils.createLogger('test-plugin');
            expect(logger).toBeDefined();
            expect(logger.info).toBeDefined();
            expect(logger.warn).toBeDefined();
            expect(logger.error).toBeDefined();
            expect(logger.debug).toBeDefined();
            // Test logging (should not throw)
            logger.info('Test message');
            logger.warn('Test warning');
            logger.error('Test error');
            logger.debug('Test debug');
        });
        it('should create storage', () => {
            const devUtils = pluginManager.createDevUtils('test-plugin');
            const storage = devUtils.createStorage('test-plugin');
            expect(storage).toBeDefined();
            expect(storage.get).toBeDefined();
            expect(storage.set).toBeDefined();
            expect(storage.delete).toBeDefined();
            expect(storage.clear).toBeDefined();
            expect(storage.keys).toBeDefined();
        });
        it('should create scheduler', () => {
            const devUtils = pluginManager.createDevUtils('test-plugin');
            const scheduler = devUtils.createScheduler('test-plugin');
            expect(scheduler).toBeDefined();
            expect(scheduler.schedule).toBeDefined();
            expect(scheduler.cancel).toBeDefined();
            expect(scheduler.cancelAll).toBeDefined();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2dyZWdkdW5uL3NyYy90ZXN0L2FpX2RlYnVnX2NvbnRleHQvdnNjb2RlL3NyYy9zZXJ2aWNlcy9wbHVnaW5zL19fdGVzdHNfXy9wbHVnaW5NYW5hZ2VyLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFJQSxrQkFBa0I7QUFDbEIsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN6QixNQUFNLEVBQUU7UUFDTixzQkFBc0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2pDLGtCQUFrQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDN0IsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUMzQixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUN2QixjQUFjLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUN6QixnQkFBZ0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQzNCLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3ZCLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3hCLGdCQUFnQixFQUFFO1lBQ2hCLFFBQVEsRUFBRTtnQkFDUixRQUFRLEVBQUUsU0FBUztnQkFDbkIsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsY0FBYyxDQUFDO2FBQ25EO1lBQ0QsU0FBUyxFQUFFLEVBQUU7U0FDZDtLQUNGO0lBQ0QsU0FBUyxFQUFFO1FBQ1QsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUMzQixFQUFFLEVBQUU7WUFDRixTQUFTLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNwQixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUNwQjtLQUNGO0lBQ0QsUUFBUSxFQUFFO1FBQ1IsZUFBZSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLEVB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QUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3JDLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDcEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNyQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx5QkFBeUIsRUFBRSxHQUFHLEVBQUU7WUFDakMsTUFBTSxRQUFRLEdBQUcsYUFBYSxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUM3RCxNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsZUFBZSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBRTFELE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUNoQyxNQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3pDLE1BQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDdkMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUM1QyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2dyZWdkdW5uL3NyYy90ZXN0L2FpX2RlYnVnX2NvbnRleHQvdnNjb2RlL3NyYy9zZXJ2aWNlcy9wbHVnaW5zL19fdGVzdHNfXy9wbHVnaW5NYW5hZ2VyLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGx1Z2luTWFuYWdlciB9IGZyb20gJy4uL3BsdWdpbk1hbmFnZXInO1xuaW1wb3J0IHsgUGx1Z2luLCBQbHVnaW5NZXRhZGF0YSwgUGx1Z2luQVBJLCBQbHVnaW5Db250ZXh0IH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMvcGx1Z2luJztcbmltcG9ydCAqIGFzIHZzY29kZSBmcm9tICd2c2NvZGUnO1xuXG4vLyBNb2NrIFZTQ29kZSBBUElcbmplc3QubW9jaygndnNjb2RlJywgKCkgPT4gKHtcbiAgd2luZG93OiB7XG4gICAgc2hvd0luZm9ybWF0aW9uTWVzc2FnZTogamVzdC5mbigpLFxuICAgIHNob3dXYXJuaW5nTWVzc2FnZTogamVzdC5mbigpLFxuICAgIHNob3dFcnJvck1lc3NhZ2U6IGplc3QuZm4oKSxcbiAgICB3aXRoUHJvZ3Jlc3M6IGplc3QuZm4oKSxcbiAgICBjcmVhdGVUcmVlVmlldzogamVzdC5mbigpLFxuICAgIHNob3dUZXh0RG9jdW1lbnQ6IGplc3QuZm4oKSxcbiAgICBzaG93SW5wdXRCb3g6IGplc3QuZm4oKSxcbiAgICBzaG93UXVpY2tQaWNrOiBqZXN0LmZuKCksXG4gICAgYWN0aXZlVGV4dEVkaXRvcjoge1xuICAgICAgZG9jdW1lbnQ6IHtcbiAgICAgICAgZmlsZU5hbWU6ICd0ZXN0LnRzJyxcbiAgICAgICAgZ2V0VGV4dDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgndGVzdCBjb250ZW50JylcbiAgICAgIH0sXG4gICAgICBzZWxlY3Rpb246IHt9XG4gICAgfVxuICB9LFxuICB3b3Jrc3BhY2U6IHtcbiAgICBvcGVuVGV4dERvY3VtZW50OiBqZXN0LmZuKCksXG4gICAgZnM6IHtcbiAgICAgIHdyaXRlRmlsZTogamVzdC5mbigpLFxuICAgICAgcmVhZEZpbGU6IGplc3QuZm4oKVxuICAgIH1cbiAgfSxcbiAgY29tbWFuZHM6IHtcbiAgICByZWdpc3RlckNvbW1hbmQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBkaXNwb3NlOiBqZXN0LmZuKCkgfSlcbiAgfSxcbiAgUHJvZ3Jlc3NMb2NhdGlvbjoge1xuICAgIE5vdGlmaWNhdGlvbjogMTVcbiAgfSxcbiAgVXJpOiB7XG4gICAgZmlsZTogamVzdC5mbigpXG4gIH1cbn0pKTtcblxuLy8gTW9jayBwbHVnaW4gZm9yIHRlc3RpbmdcbmNsYXNzIFRlc3RQbHVnaW4gaW1wbGVtZW50cyBQbHVnaW4ge1xuICBtZXRhZGF0YTogUGx1Z2luTWV0YWRhdGEgPSB7XG4gICAgaWQ6ICd0ZXN0LXBsdWdpbicsXG4gICAgbmFtZTogJ1Rlc3QgUGx1Z2luJyxcbiAgICB2ZXJzaW9uOiAnMS4wLjAnLFxuICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBwbHVnaW4gZm9yIHVuaXQgdGVzdHMnLFxuICAgIGF1dGhvcjogJ1Rlc3QgQXV0aG9yJyxcbiAgICBsaWNlbnNlOiAnTUlUJyxcbiAgICBlbmFibGVkOiB0cnVlLFxuICAgIGNhcGFiaWxpdGllczogW1xuICAgICAge1xuICAgICAgICB0eXBlOiAnY29tbWFuZCcsXG4gICAgICAgIG5hbWU6ICd0ZXN0LWNvbW1hbmQnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1Rlc3QgY29tbWFuZCdcbiAgICAgIH1cbiAgICBdXG4gIH07XG5cbiAgYWN0aXZhdGVkID0gZmFsc2U7XG4gIGRlYWN0aXZhdGVkID0gZmFsc2U7XG5cbiAgYXN5bmMgYWN0aXZhdGUoYXBpOiBQbHVnaW5BUEksIGNvbnRleHQ6IFBsdWdpbkNvbnRleHQpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLmFjdGl2YXRlZCA9IHRydWU7XG4gIH1cblxuICBhc3luYyBkZWFjdGl2YXRlKGFwaTogUGx1Z2luQVBJLCBjb250ZXh0OiBQbHVnaW5Db250ZXh0KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5kZWFjdGl2YXRlZCA9IHRydWU7XG4gIH1cblxuICBnZXQgY29tbWFuZHMoKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgIHtcbiAgICAgICAgaWQ6ICd0ZXN0LWNvbW1hbmQnLFxuICAgICAgICB0aXRsZTogJ1Rlc3QgQ29tbWFuZCcsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBjb21tYW5kJyxcbiAgICAgICAgZXhlY3V0ZTogYXN5bmMgKGNvbnRleHQ6IFBsdWdpbkNvbnRleHQsIGFyZ3M/OiBhbnlbXSkgPT4ge1xuICAgICAgICAgIHJldHVybiAndGVzdC1yZXN1bHQnO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgXTtcbiAgfVxufVxuXG5kZXNjcmliZSgnUGx1Z2luTWFuYWdlcicsICgpID0+IHtcbiAgbGV0IHBsdWdpbk1hbmFnZXI6IFBsdWdpbk1hbmFnZXI7XG4gIGxldCBtb2NrRXh0ZW5zaW9uQ29udGV4dDogdnNjb2RlLkV4dGVuc2lvbkNvbnRleHQ7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgbW9ja0V4dGVuc2lvbkNvbnRleHQgPSB7XG4gICAgICBzdWJzY3JpcHRpb25zOiBbXSxcbiAgICAgIGV4dGVuc2lvblBhdGg6ICcvdGVzdC9wYXRoJyxcbiAgICAgIGdsb2JhbFN0YXRlOiB7XG4gICAgICAgIGdldDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7fSksXG4gICAgICAgIHVwZGF0ZTogamVzdC5mbigpLFxuICAgICAgICBrZXlzOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKFtdKVxuICAgICAgfVxuICAgIH0gYXMgYW55O1xuXG4gICAgcGx1Z2luTWFuYWdlciA9IG5ldyBQbHVnaW5NYW5hZ2VyKG1vY2tFeHRlbnNpb25Db250ZXh0LCAnL3Rlc3Qvd29ya3NwYWNlJyk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQbHVnaW4gUmVnaXN0cmF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVnaXN0ZXIgYSBwbHVnaW4gc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdFBsdWdpbiA9IG5ldyBUZXN0UGx1Z2luKCk7XG4gICAgICBcbiAgICAgIGF3YWl0IHBsdWdpbk1hbmFnZXIucmVnaXN0ZXIodGVzdFBsdWdpbik7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlZ2lzdGVyZWRQbHVnaW4gPSBwbHVnaW5NYW5hZ2VyLmdldCgndGVzdC1wbHVnaW4nKTtcbiAgICAgIGV4cGVjdChyZWdpc3RlcmVkUGx1Z2luKS50b0JlKHRlc3RQbHVnaW4pO1xuICAgICAgZXhwZWN0KHRlc3RQbHVnaW4uYWN0aXZhdGVkKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciB3aGVuIHJlZ2lzdGVyaW5nIHBsdWdpbiB3aXRoIGR1cGxpY2F0ZSBJRCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RQbHVnaW4xID0gbmV3IFRlc3RQbHVnaW4oKTtcbiAgICAgIGNvbnN0IHRlc3RQbHVnaW4yID0gbmV3IFRlc3RQbHVnaW4oKTtcbiAgICAgIFxuICAgICAgYXdhaXQgcGx1Z2luTWFuYWdlci5yZWdpc3Rlcih0ZXN0UGx1Z2luMSk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChwbHVnaW5NYW5hZ2VyLnJlZ2lzdGVyKHRlc3RQbHVnaW4yKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICAnUGx1Z2luIHdpdGggSUQgXFwndGVzdC1wbHVnaW5cXCcgaXMgYWxyZWFkeSByZWdpc3RlcmVkJ1xuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgcGx1Z2luIGJlZm9yZSByZWdpc3RyYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkUGx1Z2luID0ge1xuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIGlkOiAnJyxcbiAgICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgICB2ZXJzaW9uOiAnJyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJycsXG4gICAgICAgICAgYXV0aG9yOiAnJyxcbiAgICAgICAgICBsaWNlbnNlOiAnJyxcbiAgICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICAgIGNhcGFiaWxpdGllczogW11cbiAgICAgICAgfSxcbiAgICAgICAgYWN0aXZhdGU6IGplc3QuZm4oKSxcbiAgICAgICAgZGVhY3RpdmF0ZTogamVzdC5mbigpXG4gICAgICB9IGFzIFBsdWdpbjtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KHBsdWdpbk1hbmFnZXIucmVnaXN0ZXIoaW52YWxpZFBsdWdpbikpLnJlamVjdHMudG9UaHJvdygpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUGx1Z2luIExpZmVjeWNsZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGVuYWJsZSBhbmQgZGlzYWJsZSBwbHVnaW5zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdFBsdWdpbiA9IG5ldyBUZXN0UGx1Z2luKCk7XG4gICAgICBhd2FpdCBwbHVnaW5NYW5hZ2VyLnJlZ2lzdGVyKHRlc3RQbHVnaW4pO1xuICAgICAgXG4gICAgICAvLyBQbHVnaW4gc2hvdWxkIGJlIGVuYWJsZWQgYnkgZGVmYXVsdFxuICAgICAgZXhwZWN0KHBsdWdpbk1hbmFnZXIuaXNFbmFibGVkKCd0ZXN0LXBsdWdpbicpKS50b0JlKHRydWUpO1xuICAgICAgXG4gICAgICAvLyBEaXNhYmxlIHBsdWdpblxuICAgICAgYXdhaXQgcGx1Z2luTWFuYWdlci5kaXNhYmxlKCd0ZXN0LXBsdWdpbicpO1xuICAgICAgZXhwZWN0KHBsdWdpbk1hbmFnZXIuaXNFbmFibGVkKCd0ZXN0LXBsdWdpbicpKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdCh0ZXN0UGx1Z2luLmRlYWN0aXZhdGVkKS50b0JlKHRydWUpO1xuICAgICAgXG4gICAgICAvLyBSZS1lbmFibGUgcGx1Z2luXG4gICAgICB0ZXN0UGx1Z2luLmFjdGl2YXRlZCA9IGZhbHNlO1xuICAgICAgYXdhaXQgcGx1Z2luTWFuYWdlci5lbmFibGUoJ3Rlc3QtcGx1Z2luJyk7XG4gICAgICBleHBlY3QocGx1Z2luTWFuYWdlci5pc0VuYWJsZWQoJ3Rlc3QtcGx1Z2luJykpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QodGVzdFBsdWdpbi5hY3RpdmF0ZWQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVucmVnaXN0ZXIgcGx1Z2lucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RQbHVnaW4gPSBuZXcgVGVzdFBsdWdpbigpO1xuICAgICAgYXdhaXQgcGx1Z2luTWFuYWdlci5yZWdpc3Rlcih0ZXN0UGx1Z2luKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHBsdWdpbk1hbmFnZXIuZ2V0KCd0ZXN0LXBsdWdpbicpKS50b0JlKHRlc3RQbHVnaW4pO1xuICAgICAgXG4gICAgICBhd2FpdCBwbHVnaW5NYW5hZ2VyLnVucmVnaXN0ZXIoJ3Rlc3QtcGx1Z2luJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChwbHVnaW5NYW5hZ2VyLmdldCgndGVzdC1wbHVnaW4nKSkudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHRlc3RQbHVnaW4uZGVhY3RpdmF0ZWQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQbHVnaW4gRGlzY292ZXJ5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2V0IGFsbCByZWdpc3RlcmVkIHBsdWdpbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0UGx1Z2luMSA9IG5ldyBUZXN0UGx1Z2luKCk7XG4gICAgICBjb25zdCB0ZXN0UGx1Z2luMiA9IG5ldyBUZXN0UGx1Z2luKCk7XG4gICAgICB0ZXN0UGx1Z2luMi5tZXRhZGF0YS5pZCA9ICd0ZXN0LXBsdWdpbi0yJztcbiAgICAgIFxuICAgICAgYXdhaXQgcGx1Z2luTWFuYWdlci5yZWdpc3Rlcih0ZXN0UGx1Z2luMSk7XG4gICAgICBhd2FpdCBwbHVnaW5NYW5hZ2VyLnJlZ2lzdGVyKHRlc3RQbHVnaW4yKTtcbiAgICAgIFxuICAgICAgY29uc3QgYWxsUGx1Z2lucyA9IHBsdWdpbk1hbmFnZXIuZ2V0QWxsKCk7XG4gICAgICBleHBlY3QoYWxsUGx1Z2lucykudG9IYXZlTGVuZ3RoKDUpOyAvLyAyIHRlc3QgcGx1Z2lucyArIDMgYnVpbHQtaW4gcGx1Z2luc1xuICAgICAgZXhwZWN0KGFsbFBsdWdpbnMuZmluZChwID0+IHAubWV0YWRhdGEuaWQgPT09ICd0ZXN0LXBsdWdpbicpKS50b0JlKHRlc3RQbHVnaW4xKTtcbiAgICAgIGV4cGVjdChhbGxQbHVnaW5zLmZpbmQocCA9PiBwLm1ldGFkYXRhLmlkID09PSAndGVzdC1wbHVnaW4tMicpKS50b0JlKHRlc3RQbHVnaW4yKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2V0IHBsdWdpbnMgYnkgY2FwYWJpbGl0eScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RQbHVnaW4gPSBuZXcgVGVzdFBsdWdpbigpO1xuICAgICAgYXdhaXQgcGx1Z2luTWFuYWdlci5yZWdpc3Rlcih0ZXN0UGx1Z2luKTtcbiAgICAgIFxuICAgICAgY29uc3QgY29tbWFuZFBsdWdpbnMgPSBwbHVnaW5NYW5hZ2VyLmdldEJ5Q2FwYWJpbGl0eSgnY29tbWFuZCcpO1xuICAgICAgZXhwZWN0KGNvbW1hbmRQbHVnaW5zLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgZXhwZWN0KGNvbW1hbmRQbHVnaW5zLmZpbmQocCA9PiBwLm1ldGFkYXRhLmlkID09PSAndGVzdC1wbHVnaW4nKSkudG9CZSh0ZXN0UGx1Z2luKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BsdWdpbiBDb21tYW5kcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGV4ZWN1dGUgcGx1Z2luIGNvbW1hbmRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdFBsdWdpbiA9IG5ldyBUZXN0UGx1Z2luKCk7XG4gICAgICBhd2FpdCBwbHVnaW5NYW5hZ2VyLnJlZ2lzdGVyKHRlc3RQbHVnaW4pO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwbHVnaW5NYW5hZ2VyLmV4ZWN1dGVQbHVnaW5Db21tYW5kKCd0ZXN0LXBsdWdpbicsICd0ZXN0LWNvbW1hbmQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ3Rlc3QtcmVzdWx0Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGZvciBub24tZXhpc3RlbnQgcGx1Z2luJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBwbHVnaW5NYW5hZ2VyLmV4ZWN1dGVQbHVnaW5Db21tYW5kKCdub24tZXhpc3RlbnQnLCAndGVzdC1jb21tYW5kJylcbiAgICAgICkucmVqZWN0cy50b1Rocm93KCdQbHVnaW4gXFwnbm9uLWV4aXN0ZW50XFwnIG5vdCBmb3VuZCBvciBub3QgZW5hYmxlZCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBmb3Igbm9uLWV4aXN0ZW50IGNvbW1hbmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0UGx1Z2luID0gbmV3IFRlc3RQbHVnaW4oKTtcbiAgICAgIGF3YWl0IHBsdWdpbk1hbmFnZXIucmVnaXN0ZXIodGVzdFBsdWdpbik7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgcGx1Z2luTWFuYWdlci5leGVjdXRlUGx1Z2luQ29tbWFuZCgndGVzdC1wbHVnaW4nLCAnbm9uLWV4aXN0ZW50LWNvbW1hbmQnKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coJ0NvbW1hbmQgXFwnbm9uLWV4aXN0ZW50LWNvbW1hbmRcXCcgbm90IGZvdW5kIGluIHBsdWdpbiBcXCd0ZXN0LXBsdWdpblxcJycpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUGx1Z2luIENvbnRleHQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZWZyZXNoIHBsdWdpbiBjb250ZXh0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdFBsdWdpbiA9IG5ldyBUZXN0UGx1Z2luKCk7XG4gICAgICBhd2FpdCBwbHVnaW5NYW5hZ2VyLnJlZ2lzdGVyKHRlc3RQbHVnaW4pO1xuICAgICAgXG4gICAgICBhd2FpdCBwbHVnaW5NYW5hZ2VyLnJlZnJlc2hQbHVnaW5Db250ZXh0KCk7XG4gICAgICBcbiAgICAgIC8vIENvbnRleHQgc2hvdWxkIGJlIHVwZGF0ZWRcbiAgICAgIGV4cGVjdChwbHVnaW5NYW5hZ2VyKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRGV2ZWxvcG1lbnQgVXRpbGl0aWVzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIGRldmVsb3BtZW50IHV0aWxzJywgKCkgPT4ge1xuICAgICAgY29uc3QgZGV2VXRpbHMgPSBwbHVnaW5NYW5hZ2VyLmNyZWF0ZURldlV0aWxzKCd0ZXN0LXBsdWdpbicpO1xuICAgICAgXG4gICAgICBleHBlY3QoZGV2VXRpbHMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoZGV2VXRpbHMuY3JlYXRlTG9nZ2VyKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGRldlV0aWxzLmNyZWF0ZVN0b3JhZ2UpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoZGV2VXRpbHMuY3JlYXRlU2NoZWR1bGVyKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgbG9nZ2VyJywgKCkgPT4ge1xuICAgICAgY29uc3QgZGV2VXRpbHMgPSBwbHVnaW5NYW5hZ2VyLmNyZWF0ZURldlV0aWxzKCd0ZXN0LXBsdWdpbicpO1xuICAgICAgY29uc3QgbG9nZ2VyID0gZGV2VXRpbHMuY3JlYXRlTG9nZ2VyKCd0ZXN0LXBsdWdpbicpO1xuICAgICAgXG4gICAgICBleHBlY3QobG9nZ2VyKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGxvZ2dlci5pbmZvKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGxvZ2dlci53YXJuKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGxvZ2dlci5lcnJvcikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChsb2dnZXIuZGVidWcpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBcbiAgICAgIC8vIFRlc3QgbG9nZ2luZyAoc2hvdWxkIG5vdCB0aHJvdylcbiAgICAgIGxvZ2dlci5pbmZvKCdUZXN0IG1lc3NhZ2UnKTtcbiAgICAgIGxvZ2dlci53YXJuKCdUZXN0IHdhcm5pbmcnKTtcbiAgICAgIGxvZ2dlci5lcnJvcignVGVzdCBlcnJvcicpO1xuICAgICAgbG9nZ2VyLmRlYnVnKCdUZXN0IGRlYnVnJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBzdG9yYWdlJywgKCkgPT4ge1xuICAgICAgY29uc3QgZGV2VXRpbHMgPSBwbHVnaW5NYW5hZ2VyLmNyZWF0ZURldlV0aWxzKCd0ZXN0LXBsdWdpbicpO1xuICAgICAgY29uc3Qgc3RvcmFnZSA9IGRldlV0aWxzLmNyZWF0ZVN0b3JhZ2UoJ3Rlc3QtcGx1Z2luJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChzdG9yYWdlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHN0b3JhZ2UuZ2V0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHN0b3JhZ2Uuc2V0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHN0b3JhZ2UuZGVsZXRlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHN0b3JhZ2UuY2xlYXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3Qoc3RvcmFnZS5rZXlzKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgc2NoZWR1bGVyJywgKCkgPT4ge1xuICAgICAgY29uc3QgZGV2VXRpbHMgPSBwbHVnaW5NYW5hZ2VyLmNyZWF0ZURldlV0aWxzKCd0ZXN0LXBsdWdpbicpO1xuICAgICAgY29uc3Qgc2NoZWR1bGVyID0gZGV2VXRpbHMuY3JlYXRlU2NoZWR1bGVyKCd0ZXN0LXBsdWdpbicpO1xuICAgICAgXG4gICAgICBleHBlY3Qoc2NoZWR1bGVyKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHNjaGVkdWxlci5zY2hlZHVsZSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChzY2hlZHVsZXIuY2FuY2VsKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHNjaGVkdWxlci5jYW5jZWxBbGwpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=