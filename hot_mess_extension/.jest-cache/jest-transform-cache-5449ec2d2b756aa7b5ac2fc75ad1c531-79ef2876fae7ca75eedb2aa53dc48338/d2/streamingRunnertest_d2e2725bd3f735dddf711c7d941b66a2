7e233b341a5db78d5e4f8e02dc14cabd
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock('child_process', () => ({
    spawn: jest.fn(() => mockProcess)
}));
const streamingRunner_1 = require("../../utils/streamingRunner");
const events_1 = require("events");
// Mock child_process
class MockChildProcess extends events_1.EventEmitter {
    stdout = new events_1.EventEmitter();
    stderr = new events_1.EventEmitter();
    kill = jest.fn().mockReturnValue(true);
    pid = 12345;
}
const mockStdout = new events_1.EventEmitter();
const mockStderr = new events_1.EventEmitter();
const mockProcess = new MockChildProcess();
Object.assign(mockProcess, {
    stdout: mockStdout,
    stderr: mockStderr
});
const { spawn } = require('child_process');
describe('StreamingCommandRunner', () => {
    let streamingRunner;
    let mockSpawn;
    beforeEach(() => {
        jest.clearAllMocks();
        // Create mock output channel
        const mockOutputChannel = {
            appendLine: jest.fn(),
            append: jest.fn(),
            show: jest.fn(),
            hide: jest.fn(),
            dispose: jest.fn(),
            name: 'Test Output Channel'
        };
        streamingRunner = new streamingRunner_1.StreamingCommandRunner(mockOutputChannel);
        mockSpawn = spawn;
        mockSpawn.mockReturnValue(mockProcess);
    });
    afterEach(() => {
        streamingRunner.removeAllListeners();
        // Clean up any remaining listeners on mock process
        mockProcess.removeAllListeners();
        mockStdout.removeAllListeners();
        mockStderr.removeAllListeners();
    });
    describe('executeWithStreaming', () => {
        it('should execute command and emit output events', async () => {
            // Arrange
            const outputSpy = jest.fn();
            const completeSpy = jest.fn();
            streamingRunner.on('output', outputSpy);
            streamingRunner.on('complete', completeSpy);
            // Act
            const promise = streamingRunner.executeWithStreaming('echo', ['hello']);
            // Simulate command execution
            mockStdout.emit('data', Buffer.from('hello\n'));
            mockProcess.emit('close', 0);
            const result = await promise;
            // Assert
            expect(result.success).toBe(true);
            expect(result.exitCode).toBe(0);
            expect(result.output).toBe('hello\n');
            expect(outputSpy).toHaveBeenCalledWith('hello\n');
            expect(completeSpy).toHaveBeenCalledWith(result);
        });
        it('should track progress based on output patterns', async () => {
            // Arrange
            const outputSpy = jest.fn();
            streamingRunner.on('output', outputSpy);
            // Act
            const promise = streamingRunner.executeWithStreaming('test', []);
            // Simulate progress
            mockStdout.emit('data', Buffer.from('Starting the process...\n'));
            mockStdout.emit('data', Buffer.from('Processing files...\n'));
            mockStdout.emit('data', Buffer.from('Finishing up...\n'));
            mockProcess.emit('close', 0);
            await promise;
            // Assert
            expect(outputSpy).toHaveBeenCalledWith('Starting the process...\n');
            expect(outputSpy).toHaveBeenCalledWith('Processing files...\n');
            expect(outputSpy).toHaveBeenCalledWith('Finishing up...\n');
        });
        it('should handle stderr output', async () => {
            // Arrange
            const errorSpy = jest.fn();
            streamingRunner.on('error', errorSpy);
            // Act
            const promise = streamingRunner.executeWithStreaming('test', []);
            // Simulate stderr output
            mockStderr.emit('data', Buffer.from('warning: something happened\n'));
            mockProcess.emit('close', 0);
            const result = await promise;
            // Assert
            expect(result.success).toBe(true);
            expect(result.error).toBe('warning: something happened\n');
            expect(errorSpy).toHaveBeenCalledWith('warning: something happened\n');
        });
        it('should handle command failure', async () => {
            // Arrange
            const completeSpy = jest.fn();
            streamingRunner.on('complete', completeSpy);
            // Act
            const promise = streamingRunner.executeWithStreaming('test', []);
            // Simulate command failure
            mockStdout.emit('data', Buffer.from('some output\n'));
            mockProcess.emit('close', 1);
            const result = await promise;
            // Assert
            expect(result.success).toBe(false);
            expect(result.exitCode).toBe(1);
            expect(result.output).toBe('some output\n');
            expect(completeSpy).toHaveBeenCalledWith(result);
        });
        it('should handle process error', async () => {
            // Arrange
            const completeSpy = jest.fn();
            const errorSpy = jest.fn();
            // FIX: Add error event listener to handle unhandled errors
            streamingRunner.on('error', errorSpy);
            streamingRunner.on('complete', completeSpy);
            // Act
            const promise = streamingRunner.executeWithStreaming('test', []);
            // Simulate process error
            const error = new Error('Command not found');
            mockProcess.emit('error', error);
            const result = await promise;
            // Assert
            expect(result.success).toBe(false);
            expect(result.exitCode).toBe(1);
            expect(result.error).toBe('Command not found');
            expect(errorSpy).toHaveBeenCalledWith('Command not found');
            expect(completeSpy).toHaveBeenCalledWith(result);
        });
        it('should pass correct spawn options', async () => {
            // Arrange
            const options = {
                cwd: '/test/dir'
            };
            // Act
            const promise = streamingRunner.executeWithStreaming('test', ['arg1', 'arg2'], options);
            mockProcess.emit('close', 0);
            await promise;
            // Assert
            expect(mockSpawn).toHaveBeenCalledWith('test', ['arg1', 'arg2'], expect.objectContaining({
                cwd: '/test/dir',
                env: expect.any(Object),
                stdio: ['pipe', 'pipe', 'pipe']
            }));
        });
    });
    describe('cancel', () => {
        it('should cancel running command', () => {
            // Start a command
            streamingRunner.executeWithStreaming('test', []);
            expect(streamingRunner.isRunning).toBe(true);
            // Act
            streamingRunner.cancel();
            // Assert
            expect(mockProcess.kill).toHaveBeenCalledWith('SIGTERM');
            // Note: isRunning might still be true until the process actually terminates
        });
        it('should force kill after timeout', async () => {
            // Arrange
            jest.useFakeTimers();
            // Start a command
            streamingRunner.executeWithStreaming('test', []);
            // Act
            streamingRunner.cancel();
            // Fast-forward time
            jest.advanceTimersByTime(6000);
            // Allow any pending promises to resolve
            await Promise.resolve();
            // Assert
            expect(mockProcess.kill).toHaveBeenCalledWith('SIGTERM');
            expect(mockProcess.kill).toHaveBeenCalledWith('SIGKILL');
            jest.useRealTimers();
        });
        it('should do nothing if no command running', () => {
            // Arrange
            expect(streamingRunner.isRunning).toBe(false);
            // Act
            streamingRunner.cancel();
            // Assert
            expect(mockProcess.kill).not.toHaveBeenCalled();
        });
    });
    describe('isRunning', () => {
        it('should return true when command is running', () => {
            // Act
            streamingRunner.executeWithStreaming('test', []);
            // Assert
            expect(streamingRunner.isRunning).toBe(true);
        });
        it('should return false when no command is running', () => {
            // Assert
            expect(streamingRunner.isRunning).toBe(false);
        });
        it('should return false after command completes', async () => {
            // Arrange
            const promise = streamingRunner.executeWithStreaming('test', []);
            expect(streamingRunner.isRunning).toBe(true);
            // Act
            mockProcess.emit('close', 0);
            await promise;
            // Assert
            expect(streamingRunner.isRunning).toBe(false);
        });
    });
    describe('getCurrentOutput', () => {
        it('should return accumulated output', async () => {
            // Act
            const promise = streamingRunner.executeWithStreaming('test', []);
            mockStdout.emit('data', Buffer.from('line 1\n'));
            mockStdout.emit('data', Buffer.from('line 2\n'));
            // Assert
            expect(streamingRunner.getCurrentOutput()).toBe('line 1\nline 2\n');
            mockProcess.emit('close', 0);
            await promise;
        });
    });
    describe('clearOutput', () => {
        it('should clear output buffers', async () => {
            // Arrange
            const errorSpy = jest.fn();
            streamingRunner.on('error', errorSpy);
            const promise = streamingRunner.executeWithStreaming('test', []);
            mockStdout.emit('data', Buffer.from('some output\n'));
            mockStderr.emit('data', Buffer.from('some error\n'));
            expect(streamingRunner.getCurrentOutput()).toBe('some output\nsome error\n');
            // Act
            streamingRunner.clearOutput();
            // Assert
            expect(streamingRunner.getCurrentOutput()).toBe('');
            // FIX: Verify that the error event was handled
            expect(errorSpy).toHaveBeenCalledWith('some error\n');
            mockProcess.emit('close', 0);
            await promise;
        });
    });
    describe('simulateProgress', () => {
        it('should emit progress events over time', async () => {
            // Arrange
            jest.useFakeTimers();
            const progressSpy = jest.fn();
            streamingRunner.on('progress', progressSpy);
            // Start a command
            streamingRunner.executeWithStreaming('test', []);
            // Act
            streamingRunner.simulateProgress(10000); // 10 seconds
            // Fast-forward time
            jest.advanceTimersByTime(1000); // 1 second = 9% progress
            jest.advanceTimersByTime(5000); // 6 seconds = 54% progress
            jest.advanceTimersByTime(4000); // 10 seconds = 90% progress
            // Allow any pending promises to resolve
            await Promise.resolve();
            // Assert
            expect(progressSpy).toHaveBeenCalledWith(9);
            expect(progressSpy).toHaveBeenCalledWith(54);
            expect(progressSpy).toHaveBeenCalledWith(90);
            jest.useRealTimers();
        });
        it('should stop when command is no longer running', async () => {
            // Arrange
            jest.useFakeTimers();
            const progressSpy = jest.fn();
            streamingRunner.on('progress', progressSpy);
            // Start and immediately complete command
            const promise = streamingRunner.executeWithStreaming('test', []);
            mockProcess.emit('close', 0);
            await promise; // Wait for command to complete
            // Act
            streamingRunner.simulateProgress(10000);
            jest.advanceTimersByTime(5000);
            // Allow any pending promises to resolve
            await Promise.resolve();
            // Assert
            expect(progressSpy).not.toHaveBeenCalled();
            jest.useRealTimers();
        });
    });
    describe('executeTestCommand', () => {
        it('should execute test command with predefined progress steps', async () => {
            // Arrange
            const outputSpy = jest.fn();
            streamingRunner.on('output', outputSpy);
            // Act
            const promise = streamingRunner.executeTestCommand('yarn', ['nx', 'test', 'project'], '/test/cwd');
            // Simulate test output with progress keywords
            mockStdout.emit('data', Buffer.from('Determining test suites to run...\n'));
            mockStdout.emit('data', Buffer.from('Found test suites in project\n'));
            mockStdout.emit('data', Buffer.from('Running tests now...\n'));
            mockProcess.emit('close', 0);
            await promise;
            // Assert
            expect(outputSpy).toHaveBeenCalled();
            expect(mockSpawn).toHaveBeenCalledWith('yarn', ['nx', 'test', 'project'], expect.objectContaining({
                cwd: '/test/cwd'
            }));
        });
    });
    describe('executeGitCommand', () => {
        it('should execute git command with git-specific progress steps', async () => {
            // Arrange
            const outputSpy = jest.fn();
            streamingRunner.on('output', outputSpy);
            // Act
            const promise = streamingRunner.executeGitCommand(['diff', '--name-only'], '/test/cwd');
            mockStdout.emit('data', Buffer.from('Analyzing repository state...\n'));
            mockProcess.emit('close', 0);
            await promise;
            // Assert
            expect(outputSpy).toHaveBeenCalled();
            expect(mockSpawn).toHaveBeenCalledWith('git', ['diff', '--name-only'], expect.objectContaining({
                cwd: '/test/cwd'
            }));
        });
    });
    describe('executeLintCommand', () => {
        it('should execute lint command with lint-specific progress steps', async () => {
            // Arrange
            const outputSpy = jest.fn();
            streamingRunner.on('output', outputSpy);
            // Act
            const promise = streamingRunner.executeLintCommand('yarn', ['nx', 'lint', 'project'], '/test/cwd');
            mockStdout.emit('data', Buffer.from('Loading configuration files...\n'));
            mockProcess.emit('close', 0);
            await promise;
            // Assert
            expect(outputSpy).toHaveBeenCalled();
            expect(mockSpawn).toHaveBeenCalledWith('yarn', ['nx', 'lint', 'project'], expect.objectContaining({
                cwd: '/test/cwd'
            }));
        });
    });
    describe('event handling', () => {
        it('should implement StreamingEventEmitter interface', () => {
            // Assert
            expect(streamingRunner.on).toBeDefined();
            expect(streamingRunner.emit).toBeDefined();
            expect(streamingRunner.removeAllListeners).toBeDefined();
        });
        it('should allow multiple listeners for same event', () => {
            // Arrange
            const listener1 = jest.fn();
            const listener2 = jest.fn();
            streamingRunner.on('output', listener1);
            streamingRunner.on('output', listener2);
            // Act
            streamingRunner.emit('output', 'test data');
            // Assert
            expect(listener1).toHaveBeenCalledWith('test data');
            expect(listener2).toHaveBeenCalledWith('test data');
        });
        it('should clean up listeners', () => {
            // Arrange
            const listener = jest.fn();
            streamingRunner.on('output', listener);
            // Act
            streamingRunner.removeAllListeners();
            streamingRunner.emit('output', 'test data');
            // Assert
            expect(listener).not.toHaveBeenCalled();
        });
    });
    describe('error scenarios', () => {
        it('should handle stdout stream errors gracefully', async () => {
            // Arrange
            const promise = streamingRunner.executeWithStreaming('test', []);
            // Act - simulate stream error (this shouldn't crash)
            mockStdout.emit('error', new Error('Stream error'));
            mockProcess.emit('close', 0);
            const result = await promise;
            // Assert
            expect(result.success).toBe(true); // Should still complete
        });
        it('should handle stderr stream errors gracefully', async () => {
            // Arrange
            const promise = streamingRunner.executeWithStreaming('test', []);
            // Act - simulate stream error
            mockStderr.emit('error', new Error('Stream error'));
            mockProcess.emit('close', 0);
            const result = await promise;
            // Assert
            expect(result.success).toBe(true); // Should still complete
        });
        it('should measure command duration correctly', async () => {
            // Arrange
            const promise = streamingRunner.executeWithStreaming('test', []);
            // Act - immediately complete the process
            mockProcess.emit('close', 0);
            const result = await promise;
            // Assert
            expect(result.duration).toBeGreaterThanOrEqual(0);
            expect(result.duration).toBeLessThan(1000); // Should be very fast
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2dyZWdkdW5uL3NyYy90ZXN0L2FpX2RlYnVnX2NvbnRleHQvdnNjb2RlL3NyYy91dGlscy9fX3Rlc3RzX18vc3RyZWFtaW5nUnVubmVyLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFxQkEsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUM5QixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxXQUFXLENBQUM7Q0FDcEMsQ0FBQyxDQUFDLENBQUM7QUF2QkosaUVBQXFFO0FBRXJFLG1DQUFzQztBQUV0QyxxQkFBcUI7QUFDckIsTUFBTSxnQkFBaUIsU0FBUSxxQkFBWTtJQUN2QyxNQUFNLEdBQUcsSUFBSSxxQkFBWSxFQUFFLENBQUM7SUFDNUIsTUFBTSxHQUFHLElBQUkscUJBQVksRUFBRSxDQUFDO0lBQzVCLElBQUksR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3ZDLEdBQUcsR0FBRyxLQUFLLENBQUM7Q0FDZjtBQUVELE1BQU0sVUFBVSxHQUFHLElBQUkscUJBQVksRUFBRSxDQUFDO0FBQ3RDLE1BQU0sVUFBVSxHQUFHLElBQUkscUJBQVksRUFBRSxDQUFDO0FBQ3RDLE1BQU0sV0FBVyxHQUFHLElBQUksZ0JBQWdCLEVBQUUsQ0FBQztBQUUzQyxNQUFNLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRTtJQUN2QixNQUFNLEVBQUUsVUFBVTtJQUNsQixNQUFNLEVBQUUsVUFBVTtDQUNyQixDQUFDLENBQUM7QUFNSCxNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBRTNDLFFBQVEsQ0FBQyx3QkFBd0IsRUFBRSxHQUFHLEVBQUU7SUFDcEMsSUFBSSxlQUF1QyxDQUFDO0lBQzVDLElBQUksU0FBNEMsQ0FBQztJQUVqRCxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ1osSUFBSSxDQUFDLGFBQWEsRUFB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VUFBVSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQztZQUNwRCxXQUFXLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQztZQUU3QixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQztZQUU3QixTQUFTO1lBQ1QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyx3QkFBd0I7UUFDL0QsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsMkNBQTJDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdkQsVUFBVTtZQUNWLE1BQU0sT0FBTyxHQUFHLGVBQWUsQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFFakUseUNBQXlDO1lBQ3pDLFdBQVcsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzdCLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDO1lBRTdCLFNBQVM7WUFDVCxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xELE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsc0JBQXNCO1FBQ3RFLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvZ3JlZ2R1bm4vc3JjL3Rlc3QvYWlfZGVidWdfY29udGV4dC92c2NvZGUvc3JjL3V0aWxzL19fdGVzdHNfXy9zdHJlYW1pbmdSdW5uZXIudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTdHJlYW1pbmdDb21tYW5kUnVubmVyIH0gZnJvbSAnLi4vLi4vdXRpbHMvc3RyZWFtaW5nUnVubmVyJztcbmltcG9ydCB7IENvbW1hbmRSZXN1bHQgfSBmcm9tICcuLi8uLi90eXBlcyc7XG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdldmVudHMnO1xuXG4vLyBNb2NrIGNoaWxkX3Byb2Nlc3NcbmNsYXNzIE1vY2tDaGlsZFByb2Nlc3MgZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xuICAgIHN0ZG91dCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICBzdGRlcnIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAga2lsbCA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUodHJ1ZSk7XG4gICAgcGlkID0gMTIzNDU7XG59XG5cbmNvbnN0IG1vY2tTdGRvdXQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5jb25zdCBtb2NrU3RkZXJyID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuY29uc3QgbW9ja1Byb2Nlc3MgPSBuZXcgTW9ja0NoaWxkUHJvY2VzcygpO1xuXG5PYmplY3QuYXNzaWduKG1vY2tQcm9jZXNzLCB7XG4gICAgc3Rkb3V0OiBtb2NrU3Rkb3V0LFxuICAgIHN0ZGVycjogbW9ja1N0ZGVyclxufSk7XG5cbmplc3QubW9jaygnY2hpbGRfcHJvY2VzcycsICgpID0+ICh7XG4gICAgc3Bhd246IGplc3QuZm4oKCkgPT4gbW9ja1Byb2Nlc3MpXG59KSk7XG5cbmNvbnN0IHsgc3Bhd24gfSA9IHJlcXVpcmUoJ2NoaWxkX3Byb2Nlc3MnKTtcblxuZGVzY3JpYmUoJ1N0cmVhbWluZ0NvbW1hbmRSdW5uZXInLCAoKSA9PiB7XG4gICAgbGV0IHN0cmVhbWluZ1J1bm5lcjogU3RyZWFtaW5nQ29tbWFuZFJ1bm5lcjtcbiAgICBsZXQgbW9ja1NwYXduOiBqZXN0Lk1vY2tlZEZ1bmN0aW9uPHR5cGVvZiBzcGF3bj47XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgICAgIFxuICAgICAgICAvLyBDcmVhdGUgbW9jayBvdXRwdXQgY2hhbm5lbFxuICAgICAgICBjb25zdCBtb2NrT3V0cHV0Q2hhbm5lbCA9IHtcbiAgICAgICAgICAgIGFwcGVuZExpbmU6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIGFwcGVuZDogamVzdC5mbigpLFxuICAgICAgICAgICAgc2hvdzogamVzdC5mbigpLFxuICAgICAgICAgICAgaGlkZTogamVzdC5mbigpLFxuICAgICAgICAgICAgZGlzcG9zZTogamVzdC5mbigpLFxuICAgICAgICAgICAgbmFtZTogJ1Rlc3QgT3V0cHV0IENoYW5uZWwnXG4gICAgICAgIH0gYXMgYW55O1xuICAgICAgICBcbiAgICAgICAgc3RyZWFtaW5nUnVubmVyID0gbmV3IFN0cmVhbWluZ0NvbW1hbmRSdW5uZXIobW9ja091dHB1dENoYW5uZWwpO1xuICAgICAgICBtb2NrU3Bhd24gPSBzcGF3biBhcyBqZXN0Lk1vY2tlZEZ1bmN0aW9uPHR5cGVvZiBzcGF3bj47XG4gICAgICAgIG1vY2tTcGF3bi5tb2NrUmV0dXJuVmFsdWUobW9ja1Byb2Nlc3MpO1xuICAgIH0pO1xuXG4gICAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICAgICAgc3RyZWFtaW5nUnVubmVyLnJlbW92ZUFsbExpc3RlbmVycygpO1xuICAgICAgICAvLyBDbGVhbiB1cCBhbnkgcmVtYWluaW5nIGxpc3RlbmVycyBvbiBtb2NrIHByb2Nlc3NcbiAgICAgICAgbW9ja1Byb2Nlc3MucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG4gICAgICAgIG1vY2tTdGRvdXQucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG4gICAgICAgIG1vY2tTdGRlcnIucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZXhlY3V0ZVdpdGhTdHJlYW1pbmcnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgZXhlY3V0ZSBjb21tYW5kIGFuZCBlbWl0IG91dHB1dCBldmVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAvLyBBcnJhbmdlXG4gICAgICAgICAgICBjb25zdCBvdXRwdXRTcHkgPSBqZXN0LmZuKCk7XG4gICAgICAgICAgICBjb25zdCBjb21wbGV0ZVNweSA9IGplc3QuZm4oKTtcblxuICAgICAgICAgICAgc3RyZWFtaW5nUnVubmVyLm9uKCdvdXRwdXQnLCBvdXRwdXRTcHkpO1xuICAgICAgICAgICAgc3RyZWFtaW5nUnVubmVyLm9uKCdjb21wbGV0ZScsIGNvbXBsZXRlU3B5KTtcblxuICAgICAgICAgICAgLy8gQWN0XG4gICAgICAgICAgICBjb25zdCBwcm9taXNlID0gc3RyZWFtaW5nUnVubmVyLmV4ZWN1dGVXaXRoU3RyZWFtaW5nKCdlY2hvJywgWydoZWxsbyddKTtcblxuICAgICAgICAgICAgLy8gU2ltdWxhdGUgY29tbWFuZCBleGVjdXRpb25cbiAgICAgICAgICAgIG1vY2tTdGRvdXQuZW1pdCgnZGF0YScsIEJ1ZmZlci5mcm9tKCdoZWxsb1xcbicpKTtcbiAgICAgICAgICAgIG1vY2tQcm9jZXNzLmVtaXQoJ2Nsb3NlJywgMCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHByb21pc2U7XG5cbiAgICAgICAgICAgIC8vIEFzc2VydFxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5leGl0Q29kZSkudG9CZSgwKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQub3V0cHV0KS50b0JlKCdoZWxsb1xcbicpO1xuICAgICAgICAgICAgZXhwZWN0KG91dHB1dFNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2hlbGxvXFxuJyk7XG4gICAgICAgICAgICBleHBlY3QoY29tcGxldGVTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHJlc3VsdCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgdHJhY2sgcHJvZ3Jlc3MgYmFzZWQgb24gb3V0cHV0IHBhdHRlcm5zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgLy8gQXJyYW5nZVxuICAgICAgICAgICAgY29uc3Qgb3V0cHV0U3B5ID0gamVzdC5mbigpO1xuXG4gICAgICAgICAgICBzdHJlYW1pbmdSdW5uZXIub24oJ291dHB1dCcsIG91dHB1dFNweSk7XG5cbiAgICAgICAgICAgIC8vIEFjdFxuICAgICAgICAgICAgY29uc3QgcHJvbWlzZSA9IHN0cmVhbWluZ1J1bm5lci5leGVjdXRlV2l0aFN0cmVhbWluZygndGVzdCcsIFtdKTtcblxuICAgICAgICAgICAgLy8gU2ltdWxhdGUgcHJvZ3Jlc3NcbiAgICAgICAgICAgIG1vY2tTdGRvdXQuZW1pdCgnZGF0YScsIEJ1ZmZlci5mcm9tKCdTdGFydGluZyB0aGUgcHJvY2Vzcy4uLlxcbicpKTtcbiAgICAgICAgICAgIG1vY2tTdGRvdXQuZW1pdCgnZGF0YScsIEJ1ZmZlci5mcm9tKCdQcm9jZXNzaW5nIGZpbGVzLi4uXFxuJykpO1xuICAgICAgICAgICAgbW9ja1N0ZG91dC5lbWl0KCdkYXRhJywgQnVmZmVyLmZyb20oJ0ZpbmlzaGluZyB1cC4uLlxcbicpKTtcbiAgICAgICAgICAgIG1vY2tQcm9jZXNzLmVtaXQoJ2Nsb3NlJywgMCk7XG5cbiAgICAgICAgICAgIGF3YWl0IHByb21pc2U7XG5cbiAgICAgICAgICAgIC8vIEFzc2VydFxuICAgICAgICAgICAgZXhwZWN0KG91dHB1dFNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1N0YXJ0aW5nIHRoZSBwcm9jZXNzLi4uXFxuJyk7XG4gICAgICAgICAgICBleHBlY3Qob3V0cHV0U3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnUHJvY2Vzc2luZyBmaWxlcy4uLlxcbicpO1xuICAgICAgICAgICAgZXhwZWN0KG91dHB1dFNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ0ZpbmlzaGluZyB1cC4uLlxcbicpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBzdGRlcnIgb3V0cHV0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgLy8gQXJyYW5nZVxuICAgICAgICAgICAgY29uc3QgZXJyb3JTcHkgPSBqZXN0LmZuKCk7XG4gICAgICAgICAgICBzdHJlYW1pbmdSdW5uZXIub24oJ2Vycm9yJywgZXJyb3JTcHkpO1xuXG4gICAgICAgICAgICAvLyBBY3RcbiAgICAgICAgICAgIGNvbnN0IHByb21pc2UgPSBzdHJlYW1pbmdSdW5uZXIuZXhlY3V0ZVdpdGhTdHJlYW1pbmcoJ3Rlc3QnLCBbXSk7XG5cbiAgICAgICAgICAgIC8vIFNpbXVsYXRlIHN0ZGVyciBvdXRwdXRcbiAgICAgICAgICAgIG1vY2tTdGRlcnIuZW1pdCgnZGF0YScsIEJ1ZmZlci5mcm9tKCd3YXJuaW5nOiBzb21ldGhpbmcgaGFwcGVuZWRcXG4nKSk7XG4gICAgICAgICAgICBtb2NrUHJvY2Vzcy5lbWl0KCdjbG9zZScsIDApO1xuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcm9taXNlO1xuXG4gICAgICAgICAgICAvLyBBc3NlcnRcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQmUoJ3dhcm5pbmc6IHNvbWV0aGluZyBoYXBwZW5lZFxcbicpO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnd2FybmluZzogc29tZXRoaW5nIGhhcHBlbmVkXFxuJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbW1hbmQgZmFpbHVyZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8vIEFycmFuZ2VcbiAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRlU3B5ID0gamVzdC5mbigpO1xuICAgICAgICAgICAgc3RyZWFtaW5nUnVubmVyLm9uKCdjb21wbGV0ZScsIGNvbXBsZXRlU3B5KTtcblxuICAgICAgICAgICAgLy8gQWN0XG4gICAgICAgICAgICBjb25zdCBwcm9taXNlID0gc3RyZWFtaW5nUnVubmVyLmV4ZWN1dGVXaXRoU3RyZWFtaW5nKCd0ZXN0JywgW10pO1xuXG4gICAgICAgICAgICAvLyBTaW11bGF0ZSBjb21tYW5kIGZhaWx1cmVcbiAgICAgICAgICAgIG1vY2tTdGRvdXQuZW1pdCgnZGF0YScsIEJ1ZmZlci5mcm9tKCdzb21lIG91dHB1dFxcbicpKTtcbiAgICAgICAgICAgIG1vY2tQcm9jZXNzLmVtaXQoJ2Nsb3NlJywgMSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHByb21pc2U7XG5cbiAgICAgICAgICAgIC8vIEFzc2VydFxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuZXhpdENvZGUpLnRvQmUoMSk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0Lm91dHB1dCkudG9CZSgnc29tZSBvdXRwdXRcXG4nKTtcbiAgICAgICAgICAgIGV4cGVjdChjb21wbGV0ZVNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgocmVzdWx0KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgcHJvY2VzcyBlcnJvcicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8vIEFycmFuZ2VcbiAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRlU3B5ID0gamVzdC5mbigpO1xuICAgICAgICAgICAgY29uc3QgZXJyb3JTcHkgPSBqZXN0LmZuKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEZJWDogQWRkIGVycm9yIGV2ZW50IGxpc3RlbmVyIHRvIGhhbmRsZSB1bmhhbmRsZWQgZXJyb3JzXG4gICAgICAgICAgICBzdHJlYW1pbmdSdW5uZXIub24oJ2Vycm9yJywgZXJyb3JTcHkpO1xuICAgICAgICAgICAgc3RyZWFtaW5nUnVubmVyLm9uKCdjb21wbGV0ZScsIGNvbXBsZXRlU3B5KTtcblxuICAgICAgICAgICAgLy8gQWN0XG4gICAgICAgICAgICBjb25zdCBwcm9taXNlID0gc3RyZWFtaW5nUnVubmVyLmV4ZWN1dGVXaXRoU3RyZWFtaW5nKCd0ZXN0JywgW10pO1xuXG4gICAgICAgICAgICAvLyBTaW11bGF0ZSBwcm9jZXNzIGVycm9yXG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignQ29tbWFuZCBub3QgZm91bmQnKTtcbiAgICAgICAgICAgIG1vY2tQcm9jZXNzLmVtaXQoJ2Vycm9yJywgZXJyb3IpO1xuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcm9taXNlO1xuXG4gICAgICAgICAgICAvLyBBc3NlcnRcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmV4aXRDb2RlKS50b0JlKDEpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9CZSgnQ29tbWFuZCBub3QgZm91bmQnKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ0NvbW1hbmQgbm90IGZvdW5kJyk7XG4gICAgICAgICAgICBleHBlY3QoY29tcGxldGVTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHJlc3VsdCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcGFzcyBjb3JyZWN0IHNwYXduIG9wdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAvLyBBcnJhbmdlXG4gICAgICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgICAgICAgIGN3ZDogJy90ZXN0L2RpcidcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIEFjdFxuICAgICAgICAgICAgY29uc3QgcHJvbWlzZSA9IHN0cmVhbWluZ1J1bm5lci5leGVjdXRlV2l0aFN0cmVhbWluZygndGVzdCcsIFsnYXJnMScsICdhcmcyJ10sIG9wdGlvbnMpO1xuICAgICAgICAgICAgbW9ja1Byb2Nlc3MuZW1pdCgnY2xvc2UnLCAwKTtcbiAgICAgICAgICAgIGF3YWl0IHByb21pc2U7XG5cbiAgICAgICAgICAgIC8vIEFzc2VydFxuICAgICAgICAgICAgZXhwZWN0KG1vY2tTcGF3bikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Rlc3QnLCBbJ2FyZzEnLCAnYXJnMiddLCBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICAgICAgY3dkOiAnL3Rlc3QvZGlyJyxcbiAgICAgICAgICAgICAgICBlbnY6IGV4cGVjdC5hbnkoT2JqZWN0KSxcbiAgICAgICAgICAgICAgICBzdGRpbzogWydwaXBlJywgJ3BpcGUnLCAncGlwZSddXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2NhbmNlbCcsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCBjYW5jZWwgcnVubmluZyBjb21tYW5kJywgKCkgPT4ge1xuICAgICAgICAgICAgLy8gU3RhcnQgYSBjb21tYW5kXG4gICAgICAgICAgICBzdHJlYW1pbmdSdW5uZXIuZXhlY3V0ZVdpdGhTdHJlYW1pbmcoJ3Rlc3QnLCBbXSk7XG4gICAgICAgICAgICBleHBlY3Qoc3RyZWFtaW5nUnVubmVyLmlzUnVubmluZykudG9CZSh0cnVlKTtcblxuICAgICAgICAgICAgLy8gQWN0XG4gICAgICAgICAgICBzdHJlYW1pbmdSdW5uZXIuY2FuY2VsKCk7XG5cbiAgICAgICAgICAgIC8vIEFzc2VydFxuICAgICAgICAgICAgZXhwZWN0KG1vY2tQcm9jZXNzLmtpbGwpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdTSUdURVJNJyk7XG4gICAgICAgICAgICAvLyBOb3RlOiBpc1J1bm5pbmcgbWlnaHQgc3RpbGwgYmUgdHJ1ZSB1bnRpbCB0aGUgcHJvY2VzcyBhY3R1YWxseSB0ZXJtaW5hdGVzXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgZm9yY2Uga2lsbCBhZnRlciB0aW1lb3V0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgLy8gQXJyYW5nZVxuICAgICAgICAgICAgamVzdC51c2VGYWtlVGltZXJzKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFN0YXJ0IGEgY29tbWFuZFxuICAgICAgICAgICAgc3RyZWFtaW5nUnVubmVyLmV4ZWN1dGVXaXRoU3RyZWFtaW5nKCd0ZXN0JywgW10pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBBY3RcbiAgICAgICAgICAgIHN0cmVhbWluZ1J1bm5lci5jYW5jZWwoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gRmFzdC1mb3J3YXJkIHRpbWVcbiAgICAgICAgICAgIGplc3QuYWR2YW5jZVRpbWVyc0J5VGltZSg2MDAwKTtcblxuICAgICAgICAgICAgLy8gQWxsb3cgYW55IHBlbmRpbmcgcHJvbWlzZXMgdG8gcmVzb2x2ZVxuICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5yZXNvbHZlKCk7XG5cbiAgICAgICAgICAgIC8vIEFzc2VydFxuICAgICAgICAgICAgZXhwZWN0KG1vY2tQcm9jZXNzLmtpbGwpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdTSUdURVJNJyk7XG4gICAgICAgICAgICBleHBlY3QobW9ja1Byb2Nlc3Mua2lsbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1NJR0tJTEwnKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgamVzdC51c2VSZWFsVGltZXJzKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgZG8gbm90aGluZyBpZiBubyBjb21tYW5kIHJ1bm5pbmcnLCAoKSA9PiB7XG4gICAgICAgICAgICAvLyBBcnJhbmdlXG4gICAgICAgICAgICBleHBlY3Qoc3RyZWFtaW5nUnVubmVyLmlzUnVubmluZykudG9CZShmYWxzZSk7XG5cbiAgICAgICAgICAgIC8vIEFjdFxuICAgICAgICAgICAgc3RyZWFtaW5nUnVubmVyLmNhbmNlbCgpO1xuXG4gICAgICAgICAgICAvLyBBc3NlcnRcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUHJvY2Vzcy5raWxsKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdpc1J1bm5pbmcnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIHRydWUgd2hlbiBjb21tYW5kIGlzIHJ1bm5pbmcnLCAoKSA9PiB7XG4gICAgICAgICAgICAvLyBBY3RcbiAgICAgICAgICAgIHN0cmVhbWluZ1J1bm5lci5leGVjdXRlV2l0aFN0cmVhbWluZygndGVzdCcsIFtdKTtcblxuICAgICAgICAgICAgLy8gQXNzZXJ0XG4gICAgICAgICAgICBleHBlY3Qoc3RyZWFtaW5nUnVubmVyLmlzUnVubmluZykudG9CZSh0cnVlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gZmFsc2Ugd2hlbiBubyBjb21tYW5kIGlzIHJ1bm5pbmcnLCAoKSA9PiB7XG4gICAgICAgICAgICAvLyBBc3NlcnRcbiAgICAgICAgICAgIGV4cGVjdChzdHJlYW1pbmdSdW5uZXIuaXNSdW5uaW5nKS50b0JlKGZhbHNlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gZmFsc2UgYWZ0ZXIgY29tbWFuZCBjb21wbGV0ZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAvLyBBcnJhbmdlXG4gICAgICAgICAgICBjb25zdCBwcm9taXNlID0gc3RyZWFtaW5nUnVubmVyLmV4ZWN1dGVXaXRoU3RyZWFtaW5nKCd0ZXN0JywgW10pO1xuXG4gICAgICAgICAgICBleHBlY3Qoc3RyZWFtaW5nUnVubmVyLmlzUnVubmluZykudG9CZSh0cnVlKTtcblxuICAgICAgICAgICAgLy8gQWN0XG4gICAgICAgICAgICBtb2NrUHJvY2Vzcy5lbWl0KCdjbG9zZScsIDApO1xuICAgICAgICAgICAgYXdhaXQgcHJvbWlzZTtcblxuICAgICAgICAgICAgLy8gQXNzZXJ0XG4gICAgICAgICAgICBleHBlY3Qoc3RyZWFtaW5nUnVubmVyLmlzUnVubmluZykudG9CZShmYWxzZSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2dldEN1cnJlbnRPdXRwdXQnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGFjY3VtdWxhdGVkIG91dHB1dCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8vIEFjdFxuICAgICAgICAgICAgY29uc3QgcHJvbWlzZSA9IHN0cmVhbWluZ1J1bm5lci5leGVjdXRlV2l0aFN0cmVhbWluZygndGVzdCcsIFtdKTtcblxuICAgICAgICAgICAgbW9ja1N0ZG91dC5lbWl0KCdkYXRhJywgQnVmZmVyLmZyb20oJ2xpbmUgMVxcbicpKTtcbiAgICAgICAgICAgIG1vY2tTdGRvdXQuZW1pdCgnZGF0YScsIEJ1ZmZlci5mcm9tKCdsaW5lIDJcXG4nKSk7XG5cbiAgICAgICAgICAgIC8vIEFzc2VydFxuICAgICAgICAgICAgZXhwZWN0KHN0cmVhbWluZ1J1bm5lci5nZXRDdXJyZW50T3V0cHV0KCkpLnRvQmUoJ2xpbmUgMVxcbmxpbmUgMlxcbicpO1xuXG4gICAgICAgICAgICBtb2NrUHJvY2Vzcy5lbWl0KCdjbG9zZScsIDApO1xuICAgICAgICAgICAgYXdhaXQgcHJvbWlzZTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnY2xlYXJPdXRwdXQnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgY2xlYXIgb3V0cHV0IGJ1ZmZlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAvLyBBcnJhbmdlXG4gICAgICAgICAgICBjb25zdCBlcnJvclNweSA9IGplc3QuZm4oKTtcbiAgICAgICAgICAgIHN0cmVhbWluZ1J1bm5lci5vbignZXJyb3InLCBlcnJvclNweSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHByb21pc2UgPSBzdHJlYW1pbmdSdW5uZXIuZXhlY3V0ZVdpdGhTdHJlYW1pbmcoJ3Rlc3QnLCBbXSk7XG4gICAgICAgICAgICBtb2NrU3Rkb3V0LmVtaXQoJ2RhdGEnLCBCdWZmZXIuZnJvbSgnc29tZSBvdXRwdXRcXG4nKSk7XG4gICAgICAgICAgICBtb2NrU3RkZXJyLmVtaXQoJ2RhdGEnLCBCdWZmZXIuZnJvbSgnc29tZSBlcnJvclxcbicpKTtcblxuICAgICAgICAgICAgZXhwZWN0KHN0cmVhbWluZ1J1bm5lci5nZXRDdXJyZW50T3V0cHV0KCkpLnRvQmUoJ3NvbWUgb3V0cHV0XFxuc29tZSBlcnJvclxcbicpO1xuXG4gICAgICAgICAgICAvLyBBY3RcbiAgICAgICAgICAgIHN0cmVhbWluZ1J1bm5lci5jbGVhck91dHB1dCgpO1xuXG4gICAgICAgICAgICAvLyBBc3NlcnRcbiAgICAgICAgICAgIGV4cGVjdChzdHJlYW1pbmdSdW5uZXIuZ2V0Q3VycmVudE91dHB1dCgpKS50b0JlKCcnKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gRklYOiBWZXJpZnkgdGhhdCB0aGUgZXJyb3IgZXZlbnQgd2FzIGhhbmRsZWRcbiAgICAgICAgICAgIGV4cGVjdChlcnJvclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3NvbWUgZXJyb3JcXG4nKTtcblxuICAgICAgICAgICAgbW9ja1Byb2Nlc3MuZW1pdCgnY2xvc2UnLCAwKTtcbiAgICAgICAgICAgIGF3YWl0IHByb21pc2U7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3NpbXVsYXRlUHJvZ3Jlc3MnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgZW1pdCBwcm9ncmVzcyBldmVudHMgb3ZlciB0aW1lJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgLy8gQXJyYW5nZVxuICAgICAgICAgICAgamVzdC51c2VGYWtlVGltZXJzKCk7XG4gICAgICAgICAgICBjb25zdCBwcm9ncmVzc1NweSA9IGplc3QuZm4oKTtcbiAgICAgICAgICAgIHN0cmVhbWluZ1J1bm5lci5vbigncHJvZ3Jlc3MnLCBwcm9ncmVzc1NweSk7XG5cbiAgICAgICAgICAgIC8vIFN0YXJ0IGEgY29tbWFuZFxuICAgICAgICAgICAgc3RyZWFtaW5nUnVubmVyLmV4ZWN1dGVXaXRoU3RyZWFtaW5nKCd0ZXN0JywgW10pO1xuXG4gICAgICAgICAgICAvLyBBY3RcbiAgICAgICAgICAgIHN0cmVhbWluZ1J1bm5lci5zaW11bGF0ZVByb2dyZXNzKDEwMDAwKTsgLy8gMTAgc2Vjb25kc1xuXG4gICAgICAgICAgICAvLyBGYXN0LWZvcndhcmQgdGltZVxuICAgICAgICAgICAgamVzdC5hZHZhbmNlVGltZXJzQnlUaW1lKDEwMDApOyAvLyAxIHNlY29uZCA9IDklIHByb2dyZXNzXG4gICAgICAgICAgICBqZXN0LmFkdmFuY2VUaW1lcnNCeVRpbWUoNTAwMCk7IC8vIDYgc2Vjb25kcyA9IDU0JSBwcm9ncmVzc1xuICAgICAgICAgICAgamVzdC5hZHZhbmNlVGltZXJzQnlUaW1lKDQwMDApOyAvLyAxMCBzZWNvbmRzID0gOTAlIHByb2dyZXNzXG5cbiAgICAgICAgICAgIC8vIEFsbG93IGFueSBwZW5kaW5nIHByb21pc2VzIHRvIHJlc29sdmVcbiAgICAgICAgICAgIGF3YWl0IFByb21pc2UucmVzb2x2ZSgpO1xuXG4gICAgICAgICAgICAvLyBBc3NlcnRcbiAgICAgICAgICAgIGV4cGVjdChwcm9ncmVzc1NweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoOSk7XG4gICAgICAgICAgICBleHBlY3QocHJvZ3Jlc3NTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDU0KTtcbiAgICAgICAgICAgIGV4cGVjdChwcm9ncmVzc1NweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoOTApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBqZXN0LnVzZVJlYWxUaW1lcnMoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBzdG9wIHdoZW4gY29tbWFuZCBpcyBubyBsb25nZXIgcnVubmluZycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8vIEFycmFuZ2VcbiAgICAgICAgICAgIGplc3QudXNlRmFrZVRpbWVycygpO1xuICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3NTcHkgPSBqZXN0LmZuKCk7XG4gICAgICAgICAgICBzdHJlYW1pbmdSdW5uZXIub24oJ3Byb2dyZXNzJywgcHJvZ3Jlc3NTcHkpO1xuXG4gICAgICAgICAgICAvLyBTdGFydCBhbmQgaW1tZWRpYXRlbHkgY29tcGxldGUgY29tbWFuZFxuICAgICAgICAgICAgY29uc3QgcHJvbWlzZSA9IHN0cmVhbWluZ1J1bm5lci5leGVjdXRlV2l0aFN0cmVhbWluZygndGVzdCcsIFtdKTtcbiAgICAgICAgICAgIG1vY2tQcm9jZXNzLmVtaXQoJ2Nsb3NlJywgMCk7XG4gICAgICAgICAgICBhd2FpdCBwcm9taXNlOyAvLyBXYWl0IGZvciBjb21tYW5kIHRvIGNvbXBsZXRlXG5cbiAgICAgICAgICAgIC8vIEFjdFxuICAgICAgICAgICAgc3RyZWFtaW5nUnVubmVyLnNpbXVsYXRlUHJvZ3Jlc3MoMTAwMDApO1xuICAgICAgICAgICAgamVzdC5hZHZhbmNlVGltZXJzQnlUaW1lKDUwMDApO1xuXG4gICAgICAgICAgICAvLyBBbGxvdyBhbnkgcGVuZGluZyBwcm9taXNlcyB0byByZXNvbHZlXG4gICAgICAgICAgICBhd2FpdCBQcm9taXNlLnJlc29sdmUoKTtcblxuICAgICAgICAgICAgLy8gQXNzZXJ0XG4gICAgICAgICAgICBleHBlY3QocHJvZ3Jlc3NTcHkpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGplc3QudXNlUmVhbFRpbWVycygpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdleGVjdXRlVGVzdENvbW1hbmQnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgZXhlY3V0ZSB0ZXN0IGNvbW1hbmQgd2l0aCBwcmVkZWZpbmVkIHByb2dyZXNzIHN0ZXBzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgLy8gQXJyYW5nZVxuICAgICAgICAgICAgY29uc3Qgb3V0cHV0U3B5ID0gamVzdC5mbigpO1xuICAgICAgICAgICAgc3RyZWFtaW5nUnVubmVyLm9uKCdvdXRwdXQnLCBvdXRwdXRTcHkpO1xuXG4gICAgICAgICAgICAvLyBBY3RcbiAgICAgICAgICAgIGNvbnN0IHByb21pc2UgPSBzdHJlYW1pbmdSdW5uZXIuZXhlY3V0ZVRlc3RDb21tYW5kKCd5YXJuJywgWydueCcsICd0ZXN0JywgJ3Byb2plY3QnXSwgJy90ZXN0L2N3ZCcpO1xuXG4gICAgICAgICAgICAvLyBTaW11bGF0ZSB0ZXN0IG91dHB1dCB3aXRoIHByb2dyZXNzIGtleXdvcmRzXG4gICAgICAgICAgICBtb2NrU3Rkb3V0LmVtaXQoJ2RhdGEnLCBCdWZmZXIuZnJvbSgnRGV0ZXJtaW5pbmcgdGVzdCBzdWl0ZXMgdG8gcnVuLi4uXFxuJykpO1xuICAgICAgICAgICAgbW9ja1N0ZG91dC5lbWl0KCdkYXRhJywgQnVmZmVyLmZyb20oJ0ZvdW5kIHRlc3Qgc3VpdGVzIGluIHByb2plY3RcXG4nKSk7XG4gICAgICAgICAgICBtb2NrU3Rkb3V0LmVtaXQoJ2RhdGEnLCBCdWZmZXIuZnJvbSgnUnVubmluZyB0ZXN0cyBub3cuLi5cXG4nKSk7XG4gICAgICAgICAgICBtb2NrUHJvY2Vzcy5lbWl0KCdjbG9zZScsIDApO1xuXG4gICAgICAgICAgICBhd2FpdCBwcm9taXNlO1xuXG4gICAgICAgICAgICAvLyBBc3NlcnRcbiAgICAgICAgICAgIGV4cGVjdChvdXRwdXRTcHkpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgICAgIGV4cGVjdChtb2NrU3Bhd24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd5YXJuJywgWydueCcsICd0ZXN0JywgJ3Byb2plY3QnXSwgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgICAgIGN3ZDogJy90ZXN0L2N3ZCdcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZXhlY3V0ZUdpdENvbW1hbmQnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgZXhlY3V0ZSBnaXQgY29tbWFuZCB3aXRoIGdpdC1zcGVjaWZpYyBwcm9ncmVzcyBzdGVwcycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8vIEFycmFuZ2VcbiAgICAgICAgICAgIGNvbnN0IG91dHB1dFNweSA9IGplc3QuZm4oKTtcbiAgICAgICAgICAgIHN0cmVhbWluZ1J1bm5lci5vbignb3V0cHV0Jywgb3V0cHV0U3B5KTtcblxuICAgICAgICAgICAgLy8gQWN0XG4gICAgICAgICAgICBjb25zdCBwcm9taXNlID0gc3RyZWFtaW5nUnVubmVyLmV4ZWN1dGVHaXRDb21tYW5kKFsnZGlmZicsICctLW5hbWUtb25seSddLCAnL3Rlc3QvY3dkJyk7XG5cbiAgICAgICAgICAgIG1vY2tTdGRvdXQuZW1pdCgnZGF0YScsIEJ1ZmZlci5mcm9tKCdBbmFseXppbmcgcmVwb3NpdG9yeSBzdGF0ZS4uLlxcbicpKTtcbiAgICAgICAgICAgIG1vY2tQcm9jZXNzLmVtaXQoJ2Nsb3NlJywgMCk7XG5cbiAgICAgICAgICAgIGF3YWl0IHByb21pc2U7XG5cbiAgICAgICAgICAgIC8vIEFzc2VydFxuICAgICAgICAgICAgZXhwZWN0KG91dHB1dFNweSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICAgICAgZXhwZWN0KG1vY2tTcGF3bikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2dpdCcsIFsnZGlmZicsICctLW5hbWUtb25seSddLCBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICAgICAgY3dkOiAnL3Rlc3QvY3dkJ1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdleGVjdXRlTGludENvbW1hbmQnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgZXhlY3V0ZSBsaW50IGNvbW1hbmQgd2l0aCBsaW50LXNwZWNpZmljIHByb2dyZXNzIHN0ZXBzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgLy8gQXJyYW5nZVxuICAgICAgICAgICAgY29uc3Qgb3V0cHV0U3B5ID0gamVzdC5mbigpO1xuICAgICAgICAgICAgc3RyZWFtaW5nUnVubmVyLm9uKCdvdXRwdXQnLCBvdXRwdXRTcHkpO1xuXG4gICAgICAgICAgICAvLyBBY3RcbiAgICAgICAgICAgIGNvbnN0IHByb21pc2UgPSBzdHJlYW1pbmdSdW5uZXIuZXhlY3V0ZUxpbnRDb21tYW5kKCd5YXJuJywgWydueCcsICdsaW50JywgJ3Byb2plY3QnXSwgJy90ZXN0L2N3ZCcpO1xuXG4gICAgICAgICAgICBtb2NrU3Rkb3V0LmVtaXQoJ2RhdGEnLCBCdWZmZXIuZnJvbSgnTG9hZGluZyBjb25maWd1cmF0aW9uIGZpbGVzLi4uXFxuJykpO1xuICAgICAgICAgICAgbW9ja1Byb2Nlc3MuZW1pdCgnY2xvc2UnLCAwKTtcblxuICAgICAgICAgICAgYXdhaXQgcHJvbWlzZTtcblxuICAgICAgICAgICAgLy8gQXNzZXJ0XG4gICAgICAgICAgICBleHBlY3Qob3V0cHV0U3B5KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAgICAgICBleHBlY3QobW9ja1NwYXduKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgneWFybicsIFsnbngnLCAnbGludCcsICdwcm9qZWN0J10sIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgICAgICBjd2Q6ICcvdGVzdC9jd2QnXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2V2ZW50IGhhbmRsaW5nJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIGltcGxlbWVudCBTdHJlYW1pbmdFdmVudEVtaXR0ZXIgaW50ZXJmYWNlJywgKCkgPT4ge1xuICAgICAgICAgICAgLy8gQXNzZXJ0XG4gICAgICAgICAgICBleHBlY3Qoc3RyZWFtaW5nUnVubmVyLm9uKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICAgICAgZXhwZWN0KHN0cmVhbWluZ1J1bm5lci5lbWl0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgICAgICAgZXhwZWN0KHN0cmVhbWluZ1J1bm5lci5yZW1vdmVBbGxMaXN0ZW5lcnMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgYWxsb3cgbXVsdGlwbGUgbGlzdGVuZXJzIGZvciBzYW1lIGV2ZW50JywgKCkgPT4ge1xuICAgICAgICAgICAgLy8gQXJyYW5nZVxuICAgICAgICAgICAgY29uc3QgbGlzdGVuZXIxID0gamVzdC5mbigpO1xuICAgICAgICAgICAgY29uc3QgbGlzdGVuZXIyID0gamVzdC5mbigpO1xuXG4gICAgICAgICAgICBzdHJlYW1pbmdSdW5uZXIub24oJ291dHB1dCcsIGxpc3RlbmVyMSk7XG4gICAgICAgICAgICBzdHJlYW1pbmdSdW5uZXIub24oJ291dHB1dCcsIGxpc3RlbmVyMik7XG5cbiAgICAgICAgICAgIC8vIEFjdFxuICAgICAgICAgICAgc3RyZWFtaW5nUnVubmVyLmVtaXQoJ291dHB1dCcsICd0ZXN0IGRhdGEnKTtcblxuICAgICAgICAgICAgLy8gQXNzZXJ0XG4gICAgICAgICAgICBleHBlY3QobGlzdGVuZXIxKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndGVzdCBkYXRhJyk7XG4gICAgICAgICAgICBleHBlY3QobGlzdGVuZXIyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndGVzdCBkYXRhJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgY2xlYW4gdXAgbGlzdGVuZXJzJywgKCkgPT4ge1xuICAgICAgICAgICAgLy8gQXJyYW5nZVxuICAgICAgICAgICAgY29uc3QgbGlzdGVuZXIgPSBqZXN0LmZuKCk7XG4gICAgICAgICAgICBzdHJlYW1pbmdSdW5uZXIub24oJ291dHB1dCcsIGxpc3RlbmVyKTtcblxuICAgICAgICAgICAgLy8gQWN0XG4gICAgICAgICAgICBzdHJlYW1pbmdSdW5uZXIucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG4gICAgICAgICAgICBzdHJlYW1pbmdSdW5uZXIuZW1pdCgnb3V0cHV0JywgJ3Rlc3QgZGF0YScpO1xuXG4gICAgICAgICAgICAvLyBBc3NlcnRcbiAgICAgICAgICAgIGV4cGVjdChsaXN0ZW5lcikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZXJyb3Igc2NlbmFyaW9zJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBzdGRvdXQgc3RyZWFtIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgLy8gQXJyYW5nZVxuICAgICAgICAgICAgY29uc3QgcHJvbWlzZSA9IHN0cmVhbWluZ1J1bm5lci5leGVjdXRlV2l0aFN0cmVhbWluZygndGVzdCcsIFtdKTtcblxuICAgICAgICAgICAgLy8gQWN0IC0gc2ltdWxhdGUgc3RyZWFtIGVycm9yICh0aGlzIHNob3VsZG4ndCBjcmFzaClcbiAgICAgICAgICAgIG1vY2tTdGRvdXQuZW1pdCgnZXJyb3InLCBuZXcgRXJyb3IoJ1N0cmVhbSBlcnJvcicpKTtcbiAgICAgICAgICAgIG1vY2tQcm9jZXNzLmVtaXQoJ2Nsb3NlJywgMCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHByb21pc2U7XG5cbiAgICAgICAgICAgIC8vIEFzc2VydFxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpOyAvLyBTaG91bGQgc3RpbGwgY29tcGxldGVcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgc3RkZXJyIHN0cmVhbSBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8vIEFycmFuZ2VcbiAgICAgICAgICAgIGNvbnN0IHByb21pc2UgPSBzdHJlYW1pbmdSdW5uZXIuZXhlY3V0ZVdpdGhTdHJlYW1pbmcoJ3Rlc3QnLCBbXSk7XG5cbiAgICAgICAgICAgIC8vIEFjdCAtIHNpbXVsYXRlIHN0cmVhbSBlcnJvclxuICAgICAgICAgICAgbW9ja1N0ZGVyci5lbWl0KCdlcnJvcicsIG5ldyBFcnJvcignU3RyZWFtIGVycm9yJykpO1xuICAgICAgICAgICAgbW9ja1Byb2Nlc3MuZW1pdCgnY2xvc2UnLCAwKTtcblxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcHJvbWlzZTtcblxuICAgICAgICAgICAgLy8gQXNzZXJ0XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7IC8vIFNob3VsZCBzdGlsbCBjb21wbGV0ZVxuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIG1lYXN1cmUgY29tbWFuZCBkdXJhdGlvbiBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAvLyBBcnJhbmdlXG4gICAgICAgICAgICBjb25zdCBwcm9taXNlID0gc3RyZWFtaW5nUnVubmVyLmV4ZWN1dGVXaXRoU3RyZWFtaW5nKCd0ZXN0JywgW10pO1xuXG4gICAgICAgICAgICAvLyBBY3QgLSBpbW1lZGlhdGVseSBjb21wbGV0ZSB0aGUgcHJvY2Vzc1xuICAgICAgICAgICAgbW9ja1Byb2Nlc3MuZW1pdCgnY2xvc2UnLCAwKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHByb21pc2U7XG5cbiAgICAgICAgICAgIC8vIEFzc2VydFxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5kdXJhdGlvbikudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuZHVyYXRpb24pLnRvQmVMZXNzVGhhbigxMDAwKTsgLy8gU2hvdWxkIGJlIHZlcnkgZmFzdFxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9