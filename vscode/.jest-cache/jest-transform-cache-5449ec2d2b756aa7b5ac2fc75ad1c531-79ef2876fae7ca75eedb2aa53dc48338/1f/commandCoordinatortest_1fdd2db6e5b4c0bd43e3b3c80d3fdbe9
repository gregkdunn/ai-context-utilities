4c6f9960abd3ae57995ffb3dc03479d7
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock dependencies
jest.mock('../statusTracker');
jest.mock('../streamingRunner');
jest.mock('vscode');
const commandCoordinator_1 = require("../commandCoordinator");
const statusTracker_1 = require("../statusTracker");
const streamingRunner_1 = require("../streamingRunner");
describe('CommandCoordinator', () => {
    let coordinator;
    let mockStatusTracker;
    let mockContext;
    let mockStreamingRunner;
    beforeEach(() => {
        mockContext = {
            subscriptions: [],
            globalState: {
                get: jest.fn(),
                update: jest.fn()
            }
        };
        mockStatusTracker = new statusTracker_1.StatusTracker();
        mockStatusTracker.startCommand = jest.fn().mockReturnValue('test-command-id');
        mockStatusTracker.completeCommand = jest.fn();
        mockStatusTracker.updateStatus = jest.fn();
        mockStatusTracker.appendOutput = jest.fn();
        mockStatusTracker.appendError = jest.fn();
        mockStatusTracker.updateProgress = jest.fn();
        mockStatusTracker.cancelCommand = jest.fn();
        mockStatusTracker.getAllStatuses = jest.fn().mockReturnValue([]);
        mockStatusTracker.getRunningCommands = jest.fn().mockReturnValue([]);
        coordinator = new commandCoordinator_1.CommandCoordinator(mockStatusTracker, mockContext);
        // Mock StreamingCommandRunner
        mockStreamingRunner = {
            executeWithStreaming: jest.fn(),
            executeTestCommand: jest.fn(),
            executeGitCommand: jest.fn(),
            executeLintCommand: jest.fn(),
            isRunning: false,
            cancel: jest.fn(),
            getCurrentOutput: jest.fn().mockReturnValue(''),
            clearOutput: jest.fn(),
            on: jest.fn(),
            removeAllListeners: jest.fn(),
            emit: jest.fn()
        };
        // Mock the StreamingCommandRunner constructor
        streamingRunner_1.StreamingCommandRunner.mockImplementation(() => mockStreamingRunner);
    });
    afterEach(() => {
        coordinator.dispose();
        jest.clearAllMocks();
    });
    describe('Command Execution', () => {
        test('should execute aiDebug command', async () => {
            const mockResult = {
                success: true,
                exitCode: 0,
                output: 'Test output',
                duration: 5000,
                outputFiles: ['output.txt']
            };
            mockStreamingRunner.executeWithStreaming.mockResolvedValue(mockResult);
            const result = await coordinator.executeCommand('aiDebug', ['test-project'], {
                project: 'test-project',
                cwd: '/test/path'
            });
            expect(mockStatusTracker.startCommand).toHaveBeenCalledWith('aiDebug', 'test-project', undefined);
            expect(mockStreamingRunner.executeWithStreaming).toHaveBeenCalled();
            expect(mockStatusTracker.completeCommand).toHaveBeenCalledWith('test-command-id', mockResult);
            expect(result).toEqual(mockResult);
        });
        test('should execute nxTest command with streaming', async () => {
            const mockResult = {
                success: true,
                exitCode: 0,
                output: 'Tests passed',
                duration: 3000,
                outputFiles: []
            };
            mockStreamingRunner.executeTestCommand.mockResolvedValue(mockResult);
            const result = await coordinator.executeCommand('nxTest', ['test-project'], {
                project: 'test-project',
                cwd: '/test/path'
            });
            expect(mockStreamingRunner.executeTestCommand).toHaveBeenCalledWith('npx', ['nx', 'test', 'test-project'], '/test/path');
            expect(result).toEqual(mockResult);
        });
        test('should execute gitDiff command', async () => {
            const mockResult = {
                success: true,
                exitCode: 0,
                output: 'Git diff output',
                duration: 2000,
                outputFiles: ['diff.txt']
            };
            mockStreamingRunner.executeGitCommand.mockResolvedValue(mockResult);
            const result = await coordinator.executeCommand('gitDiff', ['--staged'], {
                cwd: '/test/path'
            });
            expect(mockStreamingRunner.executeGitCommand).toHaveBeenCalledWith(['diff', '--staged'], '/test/path');
            expect(result).toEqual(mockResult);
        });
        test('should execute prepareToPush command', async () => {
            const mockResult = {
                success: true,
                exitCode: 0,
                output: 'Lint passed',
                duration: 4000,
                outputFiles: []
            };
            mockStreamingRunner.executeLintCommand.mockResolvedValue(mockResult);
            const result = await coordinator.executeCommand('prepareToPush', ['test-project'], {
                project: 'test-project',
                cwd: '/test/path'
            });
            expect(mockStreamingRunner.executeLintCommand).toHaveBeenCalledWith('npx', ['nx', 'lint', 'test-project'], '/test/path');
            expect(result).toEqual(mockResult);
        });
    });
    describe('Streaming Event Handling', () => {
        test('should handle streaming output events', async () => {
            const mockResult = { success: true, exitCode: 0, output: 'test', duration: 1000, outputFiles: [] };
            mockStreamingRunner.executeWithStreaming.mockResolvedValue(mockResult);
            // Mock the event handler setup
            const eventHandlers = {};
            mockStreamingRunner.on.mockImplementation((eventName, listener) => {
                eventHandlers[eventName] = listener;
                return mockStreamingRunner;
            });
            // Start command execution (don't await yet)
            const promise = coordinator.executeCommand('aiDebug', ['test-project'], {
                project: 'test-project'
            });
            // Simulate streaming events
            eventHandlers['output']('Test output line\\n');
            eventHandlers['error']('Test error line\\n');
            eventHandlers['progress'](50);
            eventHandlers['status']('Processing...');
            await promise;
            expect(mockStatusTracker.appendOutput).toHaveBeenCalledWith('test-command-id', 'Test output line\\n');
            expect(mockStatusTracker.appendError).toHaveBeenCalledWith('test-command-id', 'Test error line\\n');
            expect(mockStatusTracker.updateProgress).toHaveBeenCalledWith('test-command-id', 50);
            // This line needs to be updated based on actual CommandCoordinator implementation
            // expect(mockStatusTracker.updateStatus).toHaveBeenCalledWith({ message: 'Processing...' });
        });
        test('should emit streaming messages', async () => {
            const mockResult = { success: true, exitCode: 0, output: 'test', duration: 1000, outputFiles: [] };
            mockStreamingRunner.executeWithStreaming.mockResolvedValue(mockResult);
            const streamingMessages = [];
            coordinator.on('streaming_message', (message) => {
                streamingMessages.push(message);
            });
            const eventHandlers = {};
            mockStreamingRunner.on.mockImplementation((eventName, listener) => {
                eventHandlers[eventName] = listener;
                return mockStreamingRunner;
            });
            const promise = coordinator.executeCommand('aiDebug', ['test-project'], {
                project: 'test-project'
            });
            // Simulate events
            eventHandlers['output']('Test output');
            eventHandlers['progress'](25);
            await promise;
            expect(streamingMessages).toHaveLength(3);
            expect(streamingMessages[0].type).toBe('output');
            expect(streamingMessages[0].data.text).toBe('Test output');
            expect(streamingMessages[1].type).toBe('progress');
            expect(streamingMessages[1].data.progress).toBe(25);
            expect(streamingMessages[2].type).toBe('complete');
            expect(streamingMessages[2].data.result).toBeDefined();
        });
    });
    describe('Concurrency Control', () => {
        test('should respect maximum concurrent commands', async () => {
            coordinator.setMaxConcurrentCommands(2);
            const mockResult = { success: true, exitCode: 0, output: 'test', duration: 1000, outputFiles: [] };
            // Make the first two commands hang
            let resolveFirst = () => { };
            let resolveSecond = () => { };
            mockStreamingRunner.executeWithStreaming
                .mockImplementationOnce(() => new Promise(resolve => { resolveFirst = () => resolve(mockResult); }))
                .mockImplementationOnce(() => new Promise(resolve => { resolveSecond = () => resolve(mockResult); }))
                .mockResolvedValue(mockResult);
            // Start first two commands
            const promise1 = coordinator.executeCommand('aiDebug', ['project1'], { project: 'project1' });
            const promise2 = coordinator.executeCommand('nxTest', ['project2'], { project: 'project2' });
            // Third command should be queued
            const promise3 = coordinator.executeCommand('gitDiff', [], {});
            // Wait a bit for commands to start
            await new Promise(resolve => setTimeout(resolve, 100));
            const status = coordinator.getExecutionStatus();
            expect(status.active).toBe(1); // First command should be active
            expect(status.queued).toBe(2); // Second and third should be queued
            // Complete first command
            resolveFirst();
            await promise1;
            // Third command should now be processing
            expect(coordinator.getExecutionStatus().active).toBe(2);
            // Complete remaining commands
            resolveSecond();
            await Promise.all([promise2, promise3]);
        });
        test('should handle high priority commands', async () => {
            coordinator.setMaxConcurrentCommands(1);
            const mockResult = { success: true, exitCode: 0, output: 'test', duration: 1000, outputFiles: [] };
            // Make first command hang
            let resolveFirst = () => { };
            mockStreamingRunner.executeWithStreaming
                .mockImplementationOnce(() => new Promise(resolve => { resolveFirst = () => resolve(mockResult); }))
                .mockResolvedValue(mockResult);
            Object.defineProperty(mockStreamingRunner, 'isRunning', { value: true, writable: true });
            // Start first command
            const promise1 = coordinator.executeCommand('aiDebug', ['project1'], { project: 'project1' });
            // High priority command should cancel the first one
            const promise2 = coordinator.executeCommand('nxTest', ['project2'], {
                project: 'project2',
                priority: 'high'
            });
            expect(mockStreamingRunner.cancel).toHaveBeenCalled();
            expect(mockStatusTracker.cancelCommand).toHaveBeenCalled();
            resolveFirst();
            await Promise.all([promise1, promise2]);
        });
    });
    describe('Command Cancellation', () => {
        test('should cancel running command', () => {
            const commandId = 'test-command-id';
            Object.defineProperty(mockStreamingRunner, 'isRunning', { value: true, writable: true });
            // Simulate active command
            coordinator.activeCommands.set(commandId, mockStreamingRunner);
            const result = coordinator.cancelCommand(commandId);
            expect(result).toBe(true);
            expect(mockStreamingRunner.cancel).toHaveBeenCalled();
            expect(mockStatusTracker.cancelCommand).toHaveBeenCalledWith(commandId);
        });
        test('should not cancel non-running command', () => {
            const commandId = 'test-command-id';
            Object.defineProperty(mockStreamingRunner, 'isRunning', { value: false, writable: true });
            const result = coordinator.cancelCommand(commandId);
            expect(result).toBe(false);
            expect(mockStreamingRunner.cancel).not.toHaveBeenCalled();
        });
        test('should cancel all running commands', () => {
            const commands = ['cmd1', 'cmd2', 'cmd3'];
            commands.forEach(cmdId => {
                const runner = { ...mockStreamingRunner, isRunning: true };
                coordinator.activeCommands.set(cmdId, runner);
            });
            coordinator.cancelAllCommands();
            commands.forEach(cmdId => {
                expect(mockStatusTracker.cancelCommand).toHaveBeenCalledWith(cmdId);
            });
        });
    });
    describe('Output Management', () => {
        test('should get command output', () => {
            const commandId = 'test-command-id';
            const expectedOutput = 'Command output here';
            mockStreamingRunner.getCurrentOutput.mockReturnValue(expectedOutput);
            coordinator.activeCommands.set(commandId, mockStreamingRunner);
            const output = coordinator.getCommandOutput(commandId);
            expect(output).toBe(expectedOutput);
            expect(mockStreamingRunner.getCurrentOutput).toHaveBeenCalled();
        });
        test('should clear command output', () => {
            const commandId = 'test-command-id';
            coordinator.activeCommands.set(commandId, mockStreamingRunner);
            coordinator.clearCommandOutput(commandId);
            expect(mockStreamingRunner.clearOutput).toHaveBeenCalled();
        });
        test('should return empty string for non-existent command output', () => {
            const output = coordinator.getCommandOutput('non-existent');
            expect(output).toBe('');
        });
    });
    describe('Metrics and Reporting', () => {
        test('should get execution metrics', () => {
            const mockStats = {
                total: 10,
                successful: 8,
                failed: 2,
                averageDuration: 5000,
                lastRun: new Date(),
                recentCommands: []
            };
            mockStatusTracker.getCommandStats.mockReturnValue(mockStats);
            const metrics = coordinator.getExecutionMetrics();
            expect(metrics.totalCommands).toBe(10);
            expect(metrics.successRate).toBe(80);
            expect(metrics.averageExecutionTime).toBe(5000);
        });
        test('should create health report', () => {
            const mockStatuses = [
                {
                    id: 'cmd1',
                    command: 'aiDebug',
                    action: 'aiDebug',
                    status: 'running',
                    progress: 75,
                    message: 'Processing...',
                    startTime: new Date(),
                    project: 'test-project',
                    output: '',
                    outputFiles: [],
                    metadata: {}
                }
            ];
            mockStatusTracker.getAllStatuses.mockReturnValue(mockStatuses);
            mockStatusTracker.getCommandStats.mockReturnValue({
                total: 5,
                successful: 4,
                failed: 1,
                averageDuration: 3000,
                recentCommands: []
            });
            const report = coordinator.createHealthReport();
            expect(report).toContain('COMMAND EXECUTION HEALTH REPORT');
            expect(report).toContain('ACTIVE COMMANDS');
            expect(report).toContain('PERFORMANCE METRICS');
            expect(report).toContain('RECOMMENDATIONS');
            expect(report).toContain('Processing...');
            expect(report).toContain('75%');
        });
    });
    describe('Queue Management', () => {
        test('should emit queue update events', async () => {
            coordinator.setMaxConcurrentCommands(1);
            const queueUpdates = [];
            coordinator.on('queue_update', (data) => {
                queueUpdates.push(data);
            });
            const mockResult = { success: true, exitCode: 0, output: 'test', duration: 1000, outputFiles: [] };
            let resolveFirst = () => { };
            mockStreamingRunner.executeWithStreaming
                .mockImplementationOnce(() => new Promise(resolve => { resolveFirst = () => resolve(mockResult); }))
                .mockResolvedValue(mockResult);
            // Start first command (will run immediately)
            const promise1 = coordinator.executeCommand('aiDebug', ['project1'], { project: 'project1' });
            // Start second command (will be queued)
            const promise2 = coordinator.executeCommand('nxTest', ['project2'], { project: 'project2' });
            // Should have emitted a queue update
            expect(queueUpdates.length).toBeGreaterThan(0);
            expect(queueUpdates[0]).toHaveProperty('queued');
            resolveFirst();
            await Promise.all([promise1, promise2]);
        });
    });
    describe('Error Handling', () => {
        test('should handle command execution errors', async () => {
            const error = new Error('Command failed');
            mockStreamingRunner.executeWithStreaming.mockRejectedValue(error);
            await expect(coordinator.executeCommand('aiDebug', ['test-project'], {
                project: 'test-project'
            })).rejects.toThrow('Command failed');
            expect(mockStatusTracker.updateStatus).toHaveBeenCalledWith({
                message: 'Command failed'
            });
        });
        test('should handle cleanup after errors', async () => {
            const error = new Error('Test error');
            mockStreamingRunner.executeWithStreaming.mockRejectedValue(error);
            try {
                await coordinator.executeCommand('aiDebug', ['test-project'], {
                    project: 'test-project'
                });
            }
            catch (e) {
                // Expected error
            }
            // Should clean up the runner
            expect(mockStreamingRunner.removeAllListeners).toHaveBeenCalled();
        });
    });
    describe('Configuration', () => {
        test('should set maximum concurrent commands within bounds', () => {
            coordinator.setMaxConcurrentCommands(0); // Below minimum
            expect(coordinator.getExecutionStatus().maxConcurrent).toBe(1);
            coordinator.setMaxConcurrentCommands(15); // Above maximum
            expect(coordinator.getExecutionStatus().maxConcurrent).toBe(10);
            coordinator.setMaxConcurrentCommands(5); // Valid value
            expect(coordinator.getExecutionStatus().maxConcurrent).toBe(5);
        });
    });
    describe('Disposal', () => {
        test('should dispose properly', () => {
            // Add some mock active commands
            coordinator.activeCommands.set('cmd1', mockStreamingRunner);
            coordinator.activeCommands.set('cmd2', mockStreamingRunner);
            // Mock the cancel method to track calls
            const mockCancel = jest.fn();
            const runner1 = { ...mockStreamingRunner, cancel: mockCancel, isRunning: true };
            const runner2 = { ...mockStreamingRunner, cancel: mockCancel, isRunning: true };
            coordinator.activeCommands.set('cmd1', runner1);
            coordinator.activeCommands.set('cmd2', runner2);
            coordinator.dispose();
            expect(mockCancel).toHaveBeenCalledTimes(2);
            expect(coordinator.activeCommands.size).toBe(0);
            expect(coordinator.commandQueue.length).toBe(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2dyZWdkdW5uL3NyYy90ZXN0L2FpX2RlYnVnX2NvbnRleHQvdnNjb2RlL3NyYy91dGlscy9fX3Rlc3RzX18vY29tbWFuZENvb3JkaW5hdG9yLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFLQSxvQkFBb0I7QUFDcEIsSUFBSSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBQzlCLElBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQztBQUNoQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBUnBCLDhEQUEyRDtBQUMzRCxvREFBaUQ7QUFDakQsd0RBQTREO0FBUTVELFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7SUFDaEMsSUFBSSxXQUErQixDQUFDO0lBQ3BDLElBQUksaUJBQTZDLENBQUM7SUFDbEQsSUFBSSxXQUFvQyxDQUFDO0lBQ3pDLElBQUksbUJBQXdELENBQUM7SUFFN0QsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNaLFdBQVcsR0FBRztZQUNWLGFBQWEsRUFBRSxFQUFFO1lBQ2pCLFdBQVcsRUFBRTtnQkFDVCxHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtnQkFDZCxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTthQUNwQjtTQUNHLENBQUM7UUFFVCxpQkFBaUIsR0FBRyxJQUFJLDZCQUFhLEVBQWdDLENBQUM7UUFDdEUsaUJBQWlCLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUM5RSxpQkFBaUIsQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQzlDLGlCQUFpQixDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDM0MsaUJBQWlCLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUMzQyxpQkFBaUIsQ0FBQyxXQUFXLEdBQUcsSUFB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bUIsQ0FBQyxDQUFDO1lBRXJFLHdDQUF3QztZQUN4QyxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDN0IsTUFBTSxPQUFPLEdBQUcsRUFBRSxHQUFHLG1CQUFtQixFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDO1lBQ2hGLE1BQU0sT0FBTyxHQUFHLEVBQUUsR0FBRyxtQkFBbUIsRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQztZQUUvRSxXQUFtQixDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQ3hELFdBQW1CLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFFekQsV0FBVyxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBRXRCLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM1QyxNQUFNLENBQUUsV0FBbUIsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3pELE1BQU0sQ0FBRSxXQUFtQixDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0QsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9ncmVnZHVubi9zcmMvdGVzdC9haV9kZWJ1Z19jb250ZXh0L3ZzY29kZS9zcmMvdXRpbHMvX190ZXN0c19fL2NvbW1hbmRDb29yZGluYXRvci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbW1hbmRDb29yZGluYXRvciB9IGZyb20gJy4uL2NvbW1hbmRDb29yZGluYXRvcic7XG5pbXBvcnQgeyBTdGF0dXNUcmFja2VyIH0gZnJvbSAnLi4vc3RhdHVzVHJhY2tlcic7XG5pbXBvcnQgeyBTdHJlYW1pbmdDb21tYW5kUnVubmVyIH0gZnJvbSAnLi4vc3RyZWFtaW5nUnVubmVyJztcbmltcG9ydCAqIGFzIHZzY29kZSBmcm9tICd2c2NvZGUnO1xuXG4vLyBNb2NrIGRlcGVuZGVuY2llc1xuamVzdC5tb2NrKCcuLi9zdGF0dXNUcmFja2VyJyk7XG5qZXN0Lm1vY2soJy4uL3N0cmVhbWluZ1J1bm5lcicpO1xuamVzdC5tb2NrKCd2c2NvZGUnKTtcblxuZGVzY3JpYmUoJ0NvbW1hbmRDb29yZGluYXRvcicsICgpID0+IHtcbiAgICBsZXQgY29vcmRpbmF0b3I6IENvbW1hbmRDb29yZGluYXRvcjtcbiAgICBsZXQgbW9ja1N0YXR1c1RyYWNrZXI6IGplc3QuTW9ja2VkPFN0YXR1c1RyYWNrZXI+O1xuICAgIGxldCBtb2NrQ29udGV4dDogdnNjb2RlLkV4dGVuc2lvbkNvbnRleHQ7XG4gICAgbGV0IG1vY2tTdHJlYW1pbmdSdW5uZXI6IGplc3QuTW9ja2VkPFN0cmVhbWluZ0NvbW1hbmRSdW5uZXI+O1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgIG1vY2tDb250ZXh0ID0ge1xuICAgICAgICAgICAgc3Vic2NyaXB0aW9uczogW10sXG4gICAgICAgICAgICBnbG9iYWxTdGF0ZToge1xuICAgICAgICAgICAgICAgIGdldDogamVzdC5mbigpLFxuICAgICAgICAgICAgICAgIHVwZGF0ZTogamVzdC5mbigpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0gYXMgYW55O1xuXG4gICAgICAgIG1vY2tTdGF0dXNUcmFja2VyID0gbmV3IFN0YXR1c1RyYWNrZXIoKSBhcyBqZXN0Lk1vY2tlZDxTdGF0dXNUcmFja2VyPjtcbiAgICAgICAgbW9ja1N0YXR1c1RyYWNrZXIuc3RhcnRDb21tYW5kID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgndGVzdC1jb21tYW5kLWlkJyk7XG4gICAgICAgIG1vY2tTdGF0dXNUcmFja2VyLmNvbXBsZXRlQ29tbWFuZCA9IGplc3QuZm4oKTtcbiAgICAgICAgbW9ja1N0YXR1c1RyYWNrZXIudXBkYXRlU3RhdHVzID0gamVzdC5mbigpO1xuICAgICAgICBtb2NrU3RhdHVzVHJhY2tlci5hcHBlbmRPdXRwdXQgPSBqZXN0LmZuKCk7XG4gICAgICAgIG1vY2tTdGF0dXNUcmFja2VyLmFwcGVuZEVycm9yID0gamVzdC5mbigpO1xuICAgICAgICBtb2NrU3RhdHVzVHJhY2tlci51cGRhdGVQcm9ncmVzcyA9IGplc3QuZm4oKTtcbiAgICAgICAgbW9ja1N0YXR1c1RyYWNrZXIuY2FuY2VsQ29tbWFuZCA9IGplc3QuZm4oKTtcbiAgICAgICAgbW9ja1N0YXR1c1RyYWNrZXIuZ2V0QWxsU3RhdHVzZXMgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKFtdKTtcbiAgICAgICAgbW9ja1N0YXR1c1RyYWNrZXIuZ2V0UnVubmluZ0NvbW1hbmRzID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShbXSk7XG5cbiAgICAgICAgY29vcmRpbmF0b3IgPSBuZXcgQ29tbWFuZENvb3JkaW5hdG9yKG1vY2tTdGF0dXNUcmFja2VyLCBtb2NrQ29udGV4dCk7XG5cbiAgICAgICAgLy8gTW9jayBTdHJlYW1pbmdDb21tYW5kUnVubmVyXG4gICAgICAgIG1vY2tTdHJlYW1pbmdSdW5uZXIgPSB7XG4gICAgICAgICAgICBleGVjdXRlV2l0aFN0cmVhbWluZzogamVzdC5mbigpLFxuICAgICAgICAgICAgZXhlY3V0ZVRlc3RDb21tYW5kOiBqZXN0LmZuKCksXG4gICAgICAgICAgICBleGVjdXRlR2l0Q29tbWFuZDogamVzdC5mbigpLFxuICAgICAgICAgICAgZXhlY3V0ZUxpbnRDb21tYW5kOiBqZXN0LmZuKCksXG4gICAgICAgICAgICBpc1J1bm5pbmc6IGZhbHNlLFxuICAgICAgICAgICAgY2FuY2VsOiBqZXN0LmZuKCksXG4gICAgICAgICAgICBnZXRDdXJyZW50T3V0cHV0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCcnKSxcbiAgICAgICAgICAgIGNsZWFyT3V0cHV0OiBqZXN0LmZuKCksXG4gICAgICAgICAgICBvbjogamVzdC5mbigpLFxuICAgICAgICAgICAgcmVtb3ZlQWxsTGlzdGVuZXJzOiBqZXN0LmZuKCksXG4gICAgICAgICAgICBlbWl0OiBqZXN0LmZuKClcbiAgICAgICAgfSBhcyBhbnk7XG5cbiAgICAgICAgLy8gTW9jayB0aGUgU3RyZWFtaW5nQ29tbWFuZFJ1bm5lciBjb25zdHJ1Y3RvclxuICAgICAgICAoU3RyZWFtaW5nQ29tbWFuZFJ1bm5lciBhcyBqZXN0Lk1vY2tlZENsYXNzPHR5cGVvZiBTdHJlYW1pbmdDb21tYW5kUnVubmVyPikubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IG1vY2tTdHJlYW1pbmdSdW5uZXIpO1xuICAgIH0pO1xuXG4gICAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICAgICAgY29vcmRpbmF0b3IuZGlzcG9zZSgpO1xuICAgICAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdDb21tYW5kIEV4ZWN1dGlvbicsICgpID0+IHtcbiAgICAgICAgdGVzdCgnc2hvdWxkIGV4ZWN1dGUgYWlEZWJ1ZyBjb21tYW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbW9ja1Jlc3VsdCA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGV4aXRDb2RlOiAwLFxuICAgICAgICAgICAgICAgIG91dHB1dDogJ1Rlc3Qgb3V0cHV0JyxcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogNTAwMCxcbiAgICAgICAgICAgICAgICBvdXRwdXRGaWxlczogWydvdXRwdXQudHh0J11cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIG1vY2tTdHJlYW1pbmdSdW5uZXIuZXhlY3V0ZVdpdGhTdHJlYW1pbmcubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc3VsdCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvb3JkaW5hdG9yLmV4ZWN1dGVDb21tYW5kKCdhaURlYnVnJywgWyd0ZXN0LXByb2plY3QnXSwge1xuICAgICAgICAgICAgICAgIHByb2plY3Q6ICd0ZXN0LXByb2plY3QnLFxuICAgICAgICAgICAgICAgIGN3ZDogJy90ZXN0L3BhdGgnXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZXhwZWN0KG1vY2tTdGF0dXNUcmFja2VyLnN0YXJ0Q29tbWFuZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2FpRGVidWcnLCAndGVzdC1wcm9qZWN0JywgdW5kZWZpbmVkKTtcbiAgICAgICAgICAgIGV4cGVjdChtb2NrU3RyZWFtaW5nUnVubmVyLmV4ZWN1dGVXaXRoU3RyZWFtaW5nKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAgICAgICBleHBlY3QobW9ja1N0YXR1c1RyYWNrZXIuY29tcGxldGVDb21tYW5kKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndGVzdC1jb21tYW5kLWlkJywgbW9ja1Jlc3VsdCk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tSZXN1bHQpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0ZXN0KCdzaG91bGQgZXhlY3V0ZSBueFRlc3QgY29tbWFuZCB3aXRoIHN0cmVhbWluZycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1vY2tSZXN1bHQgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBleGl0Q29kZTogMCxcbiAgICAgICAgICAgICAgICBvdXRwdXQ6ICdUZXN0cyBwYXNzZWQnLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAzMDAwLFxuICAgICAgICAgICAgICAgIG91dHB1dEZpbGVzOiBbXVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgbW9ja1N0cmVhbWluZ1J1bm5lci5leGVjdXRlVGVzdENvbW1hbmQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc3VsdCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvb3JkaW5hdG9yLmV4ZWN1dGVDb21tYW5kKCdueFRlc3QnLCBbJ3Rlc3QtcHJvamVjdCddLCB7XG4gICAgICAgICAgICAgICAgcHJvamVjdDogJ3Rlc3QtcHJvamVjdCcsXG4gICAgICAgICAgICAgICAgY3dkOiAnL3Rlc3QvcGF0aCdcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBleHBlY3QobW9ja1N0cmVhbWluZ1J1bm5lci5leGVjdXRlVGVzdENvbW1hbmQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgICAgICAgICducHgnLFxuICAgICAgICAgICAgICAgIFsnbngnLCAndGVzdCcsICd0ZXN0LXByb2plY3QnXSxcbiAgICAgICAgICAgICAgICAnL3Rlc3QvcGF0aCdcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tSZXN1bHQpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0ZXN0KCdzaG91bGQgZXhlY3V0ZSBnaXREaWZmIGNvbW1hbmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBtb2NrUmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICAgICAgZXhpdENvZGU6IDAsXG4gICAgICAgICAgICAgICAgb3V0cHV0OiAnR2l0IGRpZmYgb3V0cHV0JyxcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogMjAwMCxcbiAgICAgICAgICAgICAgICBvdXRwdXRGaWxlczogWydkaWZmLnR4dCddXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBtb2NrU3RyZWFtaW5nUnVubmVyLmV4ZWN1dGVHaXRDb21tYW5kLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXN1bHQpO1xuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb29yZGluYXRvci5leGVjdXRlQ29tbWFuZCgnZ2l0RGlmZicsIFsnLS1zdGFnZWQnXSwge1xuICAgICAgICAgICAgICAgIGN3ZDogJy90ZXN0L3BhdGgnXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZXhwZWN0KG1vY2tTdHJlYW1pbmdSdW5uZXIuZXhlY3V0ZUdpdENvbW1hbmQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgICAgICAgIFsnZGlmZicsICctLXN0YWdlZCddLFxuICAgICAgICAgICAgICAgICcvdGVzdC9wYXRoJ1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1Jlc3VsdCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBleGVjdXRlIHByZXBhcmVUb1B1c2ggY29tbWFuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1vY2tSZXN1bHQgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBleGl0Q29kZTogMCxcbiAgICAgICAgICAgICAgICBvdXRwdXQ6ICdMaW50IHBhc3NlZCcsXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDQwMDAsXG4gICAgICAgICAgICAgICAgb3V0cHV0RmlsZXM6IFtdXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBtb2NrU3RyZWFtaW5nUnVubmVyLmV4ZWN1dGVMaW50Q29tbWFuZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVzdWx0KTtcblxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29vcmRpbmF0b3IuZXhlY3V0ZUNvbW1hbmQoJ3ByZXBhcmVUb1B1c2gnLCBbJ3Rlc3QtcHJvamVjdCddLCB7XG4gICAgICAgICAgICAgICAgcHJvamVjdDogJ3Rlc3QtcHJvamVjdCcsXG4gICAgICAgICAgICAgICAgY3dkOiAnL3Rlc3QvcGF0aCdcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBleHBlY3QobW9ja1N0cmVhbWluZ1J1bm5lci5leGVjdXRlTGludENvbW1hbmQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgICAgICAgICducHgnLFxuICAgICAgICAgICAgICAgIFsnbngnLCAnbGludCcsICd0ZXN0LXByb2plY3QnXSxcbiAgICAgICAgICAgICAgICAnL3Rlc3QvcGF0aCdcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tSZXN1bHQpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdTdHJlYW1pbmcgRXZlbnQgSGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgc3RyZWFtaW5nIG91dHB1dCBldmVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBtb2NrUmVzdWx0ID0geyBzdWNjZXNzOiB0cnVlLCBleGl0Q29kZTogMCwgb3V0cHV0OiAndGVzdCcsIGR1cmF0aW9uOiAxMDAwLCBvdXRwdXRGaWxlczogW10gfTtcbiAgICAgICAgICAgIG1vY2tTdHJlYW1pbmdSdW5uZXIuZXhlY3V0ZVdpdGhTdHJlYW1pbmcubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc3VsdCk7XG5cbiAgICAgICAgICAgIC8vIE1vY2sgdGhlIGV2ZW50IGhhbmRsZXIgc2V0dXBcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50SGFuZGxlcnM6IFJlY29yZDxzdHJpbmcsIEZ1bmN0aW9uPiA9IHt9O1xuICAgICAgICAgICAgbW9ja1N0cmVhbWluZ1J1bm5lci5vbi5tb2NrSW1wbGVtZW50YXRpb24oKGV2ZW50TmFtZTogc3RyaW5nIHwgc3ltYm9sLCBsaXN0ZW5lcjogKC4uLmFyZ3M6IGFueVtdKSA9PiB2b2lkKSA9PiB7XG4gICAgICAgICAgICAgICAgZXZlbnRIYW5kbGVyc1tldmVudE5hbWUgYXMgc3RyaW5nXSA9IGxpc3RlbmVyO1xuICAgICAgICAgICAgICAgIHJldHVybiBtb2NrU3RyZWFtaW5nUnVubmVyO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIFN0YXJ0IGNvbW1hbmQgZXhlY3V0aW9uIChkb24ndCBhd2FpdCB5ZXQpXG4gICAgICAgICAgICBjb25zdCBwcm9taXNlID0gY29vcmRpbmF0b3IuZXhlY3V0ZUNvbW1hbmQoJ2FpRGVidWcnLCBbJ3Rlc3QtcHJvamVjdCddLCB7XG4gICAgICAgICAgICAgICAgcHJvamVjdDogJ3Rlc3QtcHJvamVjdCdcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBTaW11bGF0ZSBzdHJlYW1pbmcgZXZlbnRzXG4gICAgICAgICAgICBldmVudEhhbmRsZXJzWydvdXRwdXQnXSgnVGVzdCBvdXRwdXQgbGluZVxcXFxuJyk7XG4gICAgICAgICAgICBldmVudEhhbmRsZXJzWydlcnJvciddKCdUZXN0IGVycm9yIGxpbmVcXFxcbicpO1xuICAgICAgICAgICAgZXZlbnRIYW5kbGVyc1sncHJvZ3Jlc3MnXSg1MCk7XG4gICAgICAgICAgICBldmVudEhhbmRsZXJzWydzdGF0dXMnXSgnUHJvY2Vzc2luZy4uLicpO1xuXG4gICAgICAgICAgICBhd2FpdCBwcm9taXNlO1xuXG4gICAgICAgICAgICBleHBlY3QobW9ja1N0YXR1c1RyYWNrZXIuYXBwZW5kT3V0cHV0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndGVzdC1jb21tYW5kLWlkJywgJ1Rlc3Qgb3V0cHV0IGxpbmVcXFxcbicpO1xuICAgICAgICAgICAgZXhwZWN0KG1vY2tTdGF0dXNUcmFja2VyLmFwcGVuZEVycm9yKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndGVzdC1jb21tYW5kLWlkJywgJ1Rlc3QgZXJyb3IgbGluZVxcXFxuJyk7XG4gICAgICAgICAgICBleHBlY3QobW9ja1N0YXR1c1RyYWNrZXIudXBkYXRlUHJvZ3Jlc3MpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd0ZXN0LWNvbW1hbmQtaWQnLCA1MCk7XG4gICAgICAgICAgICAvLyBUaGlzIGxpbmUgbmVlZHMgdG8gYmUgdXBkYXRlZCBiYXNlZCBvbiBhY3R1YWwgQ29tbWFuZENvb3JkaW5hdG9yIGltcGxlbWVudGF0aW9uXG4gICAgICAgICAgICAvLyBleHBlY3QobW9ja1N0YXR1c1RyYWNrZXIudXBkYXRlU3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7IG1lc3NhZ2U6ICdQcm9jZXNzaW5nLi4uJyB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGVzdCgnc2hvdWxkIGVtaXQgc3RyZWFtaW5nIG1lc3NhZ2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbW9ja1Jlc3VsdCA9IHsgc3VjY2VzczogdHJ1ZSwgZXhpdENvZGU6IDAsIG91dHB1dDogJ3Rlc3QnLCBkdXJhdGlvbjogMTAwMCwgb3V0cHV0RmlsZXM6IFtdIH07XG4gICAgICAgICAgICBtb2NrU3RyZWFtaW5nUnVubmVyLmV4ZWN1dGVXaXRoU3RyZWFtaW5nLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXN1bHQpO1xuXG4gICAgICAgICAgICBjb25zdCBzdHJlYW1pbmdNZXNzYWdlczogYW55W10gPSBbXTtcbiAgICAgICAgICAgIGNvb3JkaW5hdG9yLm9uKCdzdHJlYW1pbmdfbWVzc2FnZScsIChtZXNzYWdlKSA9PiB7XG4gICAgICAgICAgICAgICAgc3RyZWFtaW5nTWVzc2FnZXMucHVzaChtZXNzYWdlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCBldmVudEhhbmRsZXJzOiBSZWNvcmQ8c3RyaW5nLCBGdW5jdGlvbj4gPSB7fTtcbiAgICAgICAgICAgIG1vY2tTdHJlYW1pbmdSdW5uZXIub24ubW9ja0ltcGxlbWVudGF0aW9uKChldmVudE5hbWU6IHN0cmluZyB8IHN5bWJvbCwgbGlzdGVuZXI6ICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCkgPT4ge1xuICAgICAgICAgICAgICAgIGV2ZW50SGFuZGxlcnNbZXZlbnROYW1lIGFzIHN0cmluZ10gPSBsaXN0ZW5lcjtcbiAgICAgICAgICAgICAgICByZXR1cm4gbW9ja1N0cmVhbWluZ1J1bm5lcjtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCBwcm9taXNlID0gY29vcmRpbmF0b3IuZXhlY3V0ZUNvbW1hbmQoJ2FpRGVidWcnLCBbJ3Rlc3QtcHJvamVjdCddLCB7XG4gICAgICAgICAgICAgICAgcHJvamVjdDogJ3Rlc3QtcHJvamVjdCdcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBTaW11bGF0ZSBldmVudHNcbiAgICAgICAgICAgIGV2ZW50SGFuZGxlcnNbJ291dHB1dCddKCdUZXN0IG91dHB1dCcpO1xuICAgICAgICAgICAgZXZlbnRIYW5kbGVyc1sncHJvZ3Jlc3MnXSgyNSk7XG5cbiAgICAgICAgICAgIGF3YWl0IHByb21pc2U7XG5cbiAgICAgICAgICAgIGV4cGVjdChzdHJlYW1pbmdNZXNzYWdlcykudG9IYXZlTGVuZ3RoKDMpO1xuICAgICAgICAgICAgZXhwZWN0KHN0cmVhbWluZ01lc3NhZ2VzWzBdLnR5cGUpLnRvQmUoJ291dHB1dCcpO1xuICAgICAgICAgICAgZXhwZWN0KHN0cmVhbWluZ01lc3NhZ2VzWzBdLmRhdGEudGV4dCkudG9CZSgnVGVzdCBvdXRwdXQnKTtcbiAgICAgICAgICAgIGV4cGVjdChzdHJlYW1pbmdNZXNzYWdlc1sxXS50eXBlKS50b0JlKCdwcm9ncmVzcycpO1xuICAgICAgICAgICAgZXhwZWN0KHN0cmVhbWluZ01lc3NhZ2VzWzFdLmRhdGEucHJvZ3Jlc3MpLnRvQmUoMjUpO1xuICAgICAgICAgICAgZXhwZWN0KHN0cmVhbWluZ01lc3NhZ2VzWzJdLnR5cGUpLnRvQmUoJ2NvbXBsZXRlJyk7XG4gICAgICAgICAgICBleHBlY3Qoc3RyZWFtaW5nTWVzc2FnZXNbMl0uZGF0YS5yZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ0NvbmN1cnJlbmN5IENvbnRyb2wnLCAoKSA9PiB7XG4gICAgICAgIHRlc3QoJ3Nob3VsZCByZXNwZWN0IG1heGltdW0gY29uY3VycmVudCBjb21tYW5kcycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvb3JkaW5hdG9yLnNldE1heENvbmN1cnJlbnRDb21tYW5kcygyKTtcblxuICAgICAgICAgICAgY29uc3QgbW9ja1Jlc3VsdCA9IHsgc3VjY2VzczogdHJ1ZSwgZXhpdENvZGU6IDAsIG91dHB1dDogJ3Rlc3QnLCBkdXJhdGlvbjogMTAwMCwgb3V0cHV0RmlsZXM6IFtdIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIE1ha2UgdGhlIGZpcnN0IHR3byBjb21tYW5kcyBoYW5nXG4gICAgICAgICAgICBsZXQgcmVzb2x2ZUZpcnN0OiBGdW5jdGlvbiA9ICgpID0+IHt9O1xuICAgICAgICAgICAgbGV0IHJlc29sdmVTZWNvbmQ6IEZ1bmN0aW9uID0gKCkgPT4ge307XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIG1vY2tTdHJlYW1pbmdSdW5uZXIuZXhlY3V0ZVdpdGhTdHJlYW1pbmdcbiAgICAgICAgICAgICAgICAubW9ja0ltcGxlbWVudGF0aW9uT25jZSgoKSA9PiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHsgcmVzb2x2ZUZpcnN0ID0gKCkgPT4gcmVzb2x2ZShtb2NrUmVzdWx0KTsgfSkpXG4gICAgICAgICAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoKCkgPT4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7IHJlc29sdmVTZWNvbmQgPSAoKSA9PiByZXNvbHZlKG1vY2tSZXN1bHQpOyB9KSlcbiAgICAgICAgICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc3VsdCk7XG5cbiAgICAgICAgICAgIC8vIFN0YXJ0IGZpcnN0IHR3byBjb21tYW5kc1xuICAgICAgICAgICAgY29uc3QgcHJvbWlzZTEgPSBjb29yZGluYXRvci5leGVjdXRlQ29tbWFuZCgnYWlEZWJ1ZycsIFsncHJvamVjdDEnXSwgeyBwcm9qZWN0OiAncHJvamVjdDEnIH0pO1xuICAgICAgICAgICAgY29uc3QgcHJvbWlzZTIgPSBjb29yZGluYXRvci5leGVjdXRlQ29tbWFuZCgnbnhUZXN0JywgWydwcm9qZWN0MiddLCB7IHByb2plY3Q6ICdwcm9qZWN0MicgfSk7XG5cbiAgICAgICAgICAgIC8vIFRoaXJkIGNvbW1hbmQgc2hvdWxkIGJlIHF1ZXVlZFxuICAgICAgICAgICAgY29uc3QgcHJvbWlzZTMgPSBjb29yZGluYXRvci5leGVjdXRlQ29tbWFuZCgnZ2l0RGlmZicsIFtdLCB7fSk7XG5cbiAgICAgICAgICAgIC8vIFdhaXQgYSBiaXQgZm9yIGNvbW1hbmRzIHRvIHN0YXJ0XG4gICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwKSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHN0YXR1cyA9IGNvb3JkaW5hdG9yLmdldEV4ZWN1dGlvblN0YXR1cygpO1xuICAgICAgICAgICAgZXhwZWN0KHN0YXR1cy5hY3RpdmUpLnRvQmUoMSk7IC8vIEZpcnN0IGNvbW1hbmQgc2hvdWxkIGJlIGFjdGl2ZVxuICAgICAgICAgICAgZXhwZWN0KHN0YXR1cy5xdWV1ZWQpLnRvQmUoMik7IC8vIFNlY29uZCBhbmQgdGhpcmQgc2hvdWxkIGJlIHF1ZXVlZFxuXG4gICAgICAgICAgICAvLyBDb21wbGV0ZSBmaXJzdCBjb21tYW5kXG4gICAgICAgICAgICByZXNvbHZlRmlyc3QoKTtcbiAgICAgICAgICAgIGF3YWl0IHByb21pc2UxO1xuXG4gICAgICAgICAgICAvLyBUaGlyZCBjb21tYW5kIHNob3VsZCBub3cgYmUgcHJvY2Vzc2luZ1xuICAgICAgICAgICAgZXhwZWN0KGNvb3JkaW5hdG9yLmdldEV4ZWN1dGlvblN0YXR1cygpLmFjdGl2ZSkudG9CZSgyKTtcblxuICAgICAgICAgICAgLy8gQ29tcGxldGUgcmVtYWluaW5nIGNvbW1hbmRzXG4gICAgICAgICAgICByZXNvbHZlU2Vjb25kKCk7XG4gICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbcHJvbWlzZTIsIHByb21pc2UzXSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgaGlnaCBwcmlvcml0eSBjb21tYW5kcycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvb3JkaW5hdG9yLnNldE1heENvbmN1cnJlbnRDb21tYW5kcygxKTtcblxuICAgICAgICAgICAgY29uc3QgbW9ja1Jlc3VsdCA9IHsgc3VjY2VzczogdHJ1ZSwgZXhpdENvZGU6IDAsIG91dHB1dDogJ3Rlc3QnLCBkdXJhdGlvbjogMTAwMCwgb3V0cHV0RmlsZXM6IFtdIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIE1ha2UgZmlyc3QgY29tbWFuZCBoYW5nXG4gICAgICAgICAgICBsZXQgcmVzb2x2ZUZpcnN0OiBGdW5jdGlvbiA9ICgpID0+IHt9O1xuICAgICAgICAgICAgbW9ja1N0cmVhbWluZ1J1bm5lci5leGVjdXRlV2l0aFN0cmVhbWluZ1xuICAgICAgICAgICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+IG5ldyBQcm9taXNlKHJlc29sdmUgPT4geyByZXNvbHZlRmlyc3QgPSAoKSA9PiByZXNvbHZlKG1vY2tSZXN1bHQpOyB9KSlcbiAgICAgICAgICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc3VsdCk7XG5cbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShtb2NrU3RyZWFtaW5nUnVubmVyLCAnaXNSdW5uaW5nJywgeyB2YWx1ZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7XG5cbiAgICAgICAgICAgIC8vIFN0YXJ0IGZpcnN0IGNvbW1hbmRcbiAgICAgICAgICAgIGNvbnN0IHByb21pc2UxID0gY29vcmRpbmF0b3IuZXhlY3V0ZUNvbW1hbmQoJ2FpRGVidWcnLCBbJ3Byb2plY3QxJ10sIHsgcHJvamVjdDogJ3Byb2plY3QxJyB9KTtcblxuICAgICAgICAgICAgLy8gSGlnaCBwcmlvcml0eSBjb21tYW5kIHNob3VsZCBjYW5jZWwgdGhlIGZpcnN0IG9uZVxuICAgICAgICAgICAgY29uc3QgcHJvbWlzZTIgPSBjb29yZGluYXRvci5leGVjdXRlQ29tbWFuZCgnbnhUZXN0JywgWydwcm9qZWN0MiddLCB7IFxuICAgICAgICAgICAgICAgIHByb2plY3Q6ICdwcm9qZWN0MicsXG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6ICdoaWdoJ1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGV4cGVjdChtb2NrU3RyZWFtaW5nUnVubmVyLmNhbmNlbCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICAgICAgZXhwZWN0KG1vY2tTdGF0dXNUcmFja2VyLmNhbmNlbENvbW1hbmQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcblxuICAgICAgICAgICAgcmVzb2x2ZUZpcnN0KCk7XG4gICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbcHJvbWlzZTEsIHByb21pc2UyXSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ0NvbW1hbmQgQ2FuY2VsbGF0aW9uJywgKCkgPT4ge1xuICAgICAgICB0ZXN0KCdzaG91bGQgY2FuY2VsIHJ1bm5pbmcgY29tbWFuZCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbW1hbmRJZCA9ICd0ZXN0LWNvbW1hbmQtaWQnO1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG1vY2tTdHJlYW1pbmdSdW5uZXIsICdpc1J1bm5pbmcnLCB7IHZhbHVlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gU2ltdWxhdGUgYWN0aXZlIGNvbW1hbmRcbiAgICAgICAgICAgIChjb29yZGluYXRvciBhcyBhbnkpLmFjdGl2ZUNvbW1hbmRzLnNldChjb21tYW5kSWQsIG1vY2tTdHJlYW1pbmdSdW5uZXIpO1xuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBjb29yZGluYXRvci5jYW5jZWxDb21tYW5kKGNvbW1hbmRJZCk7XG5cbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICBleHBlY3QobW9ja1N0cmVhbWluZ1J1bm5lci5jYW5jZWwpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgICAgIGV4cGVjdChtb2NrU3RhdHVzVHJhY2tlci5jYW5jZWxDb21tYW5kKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChjb21tYW5kSWQpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0ZXN0KCdzaG91bGQgbm90IGNhbmNlbCBub24tcnVubmluZyBjb21tYW5kJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29tbWFuZElkID0gJ3Rlc3QtY29tbWFuZC1pZCc7XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobW9ja1N0cmVhbWluZ1J1bm5lciwgJ2lzUnVubmluZycsIHsgdmFsdWU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gY29vcmRpbmF0b3IuY2FuY2VsQ29tbWFuZChjb21tYW5kSWQpO1xuXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcbiAgICAgICAgICAgIGV4cGVjdChtb2NrU3RyZWFtaW5nUnVubmVyLmNhbmNlbCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGVzdCgnc2hvdWxkIGNhbmNlbCBhbGwgcnVubmluZyBjb21tYW5kcycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbW1hbmRzID0gWydjbWQxJywgJ2NtZDInLCAnY21kMyddO1xuICAgICAgICAgICAgY29tbWFuZHMuZm9yRWFjaChjbWRJZCA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcnVubmVyID0geyAuLi5tb2NrU3RyZWFtaW5nUnVubmVyLCBpc1J1bm5pbmc6IHRydWUgfTtcbiAgICAgICAgICAgICAgICAoY29vcmRpbmF0b3IgYXMgYW55KS5hY3RpdmVDb21tYW5kcy5zZXQoY21kSWQsIHJ1bm5lcik7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29vcmRpbmF0b3IuY2FuY2VsQWxsQ29tbWFuZHMoKTtcblxuICAgICAgICAgICAgY29tbWFuZHMuZm9yRWFjaChjbWRJZCA9PiB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KG1vY2tTdGF0dXNUcmFja2VyLmNhbmNlbENvbW1hbmQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGNtZElkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdPdXRwdXQgTWFuYWdlbWVudCcsICgpID0+IHtcbiAgICAgICAgdGVzdCgnc2hvdWxkIGdldCBjb21tYW5kIG91dHB1dCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbW1hbmRJZCA9ICd0ZXN0LWNvbW1hbmQtaWQnO1xuICAgICAgICAgICAgY29uc3QgZXhwZWN0ZWRPdXRwdXQgPSAnQ29tbWFuZCBvdXRwdXQgaGVyZSc7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIG1vY2tTdHJlYW1pbmdSdW5uZXIuZ2V0Q3VycmVudE91dHB1dC5tb2NrUmV0dXJuVmFsdWUoZXhwZWN0ZWRPdXRwdXQpO1xuICAgICAgICAgICAgKGNvb3JkaW5hdG9yIGFzIGFueSkuYWN0aXZlQ29tbWFuZHMuc2V0KGNvbW1hbmRJZCwgbW9ja1N0cmVhbWluZ1J1bm5lcik7XG5cbiAgICAgICAgICAgIGNvbnN0IG91dHB1dCA9IGNvb3JkaW5hdG9yLmdldENvbW1hbmRPdXRwdXQoY29tbWFuZElkKTtcblxuICAgICAgICAgICAgZXhwZWN0KG91dHB1dCkudG9CZShleHBlY3RlZE91dHB1dCk7XG4gICAgICAgICAgICBleHBlY3QobW9ja1N0cmVhbWluZ1J1bm5lci5nZXRDdXJyZW50T3V0cHV0KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBjbGVhciBjb21tYW5kIG91dHB1dCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbW1hbmRJZCA9ICd0ZXN0LWNvbW1hbmQtaWQnO1xuICAgICAgICAgICAgKGNvb3JkaW5hdG9yIGFzIGFueSkuYWN0aXZlQ29tbWFuZHMuc2V0KGNvbW1hbmRJZCwgbW9ja1N0cmVhbWluZ1J1bm5lcik7XG5cbiAgICAgICAgICAgIGNvb3JkaW5hdG9yLmNsZWFyQ29tbWFuZE91dHB1dChjb21tYW5kSWQpO1xuXG4gICAgICAgICAgICBleHBlY3QobW9ja1N0cmVhbWluZ1J1bm5lci5jbGVhck91dHB1dCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0ZXN0KCdzaG91bGQgcmV0dXJuIGVtcHR5IHN0cmluZyBmb3Igbm9uLWV4aXN0ZW50IGNvbW1hbmQgb3V0cHV0JywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb3V0cHV0ID0gY29vcmRpbmF0b3IuZ2V0Q29tbWFuZE91dHB1dCgnbm9uLWV4aXN0ZW50Jyk7XG4gICAgICAgICAgICBleHBlY3Qob3V0cHV0KS50b0JlKCcnKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnTWV0cmljcyBhbmQgUmVwb3J0aW5nJywgKCkgPT4ge1xuICAgICAgICB0ZXN0KCdzaG91bGQgZ2V0IGV4ZWN1dGlvbiBtZXRyaWNzJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbW9ja1N0YXRzID0ge1xuICAgICAgICAgICAgICAgIHRvdGFsOiAxMCxcbiAgICAgICAgICAgICAgICBzdWNjZXNzZnVsOiA4LFxuICAgICAgICAgICAgICAgIGZhaWxlZDogMixcbiAgICAgICAgICAgICAgICBhdmVyYWdlRHVyYXRpb246IDUwMDAsXG4gICAgICAgICAgICAgICAgbGFzdFJ1bjogbmV3IERhdGUoKSxcbiAgICAgICAgICAgICAgICByZWNlbnRDb21tYW5kczogW11cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIG1vY2tTdGF0dXNUcmFja2VyLmdldENvbW1hbmRTdGF0cy5tb2NrUmV0dXJuVmFsdWUobW9ja1N0YXRzKTtcblxuICAgICAgICAgICAgY29uc3QgbWV0cmljcyA9IGNvb3JkaW5hdG9yLmdldEV4ZWN1dGlvbk1ldHJpY3MoKTtcblxuICAgICAgICAgICAgZXhwZWN0KG1ldHJpY3MudG90YWxDb21tYW5kcykudG9CZSgxMCk7XG4gICAgICAgICAgICBleHBlY3QobWV0cmljcy5zdWNjZXNzUmF0ZSkudG9CZSg4MCk7XG4gICAgICAgICAgICBleHBlY3QobWV0cmljcy5hdmVyYWdlRXhlY3V0aW9uVGltZSkudG9CZSg1MDAwKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGVzdCgnc2hvdWxkIGNyZWF0ZSBoZWFsdGggcmVwb3J0JywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbW9ja1N0YXR1c2VzID0gW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdjbWQxJyxcbiAgICAgICAgICAgICAgICAgICAgY29tbWFuZDogJ2FpRGVidWcnLFxuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdhaURlYnVnJyxcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAncnVubmluZycgYXMgY29uc3QsXG4gICAgICAgICAgICAgICAgICAgIHByb2dyZXNzOiA3NSxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ1Byb2Nlc3NpbmcuLi4nLFxuICAgICAgICAgICAgICAgICAgICBzdGFydFRpbWU6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICAgICAgICAgIHByb2plY3Q6ICd0ZXN0LXByb2plY3QnLFxuICAgICAgICAgICAgICAgICAgICBvdXRwdXQ6ICcnLFxuICAgICAgICAgICAgICAgICAgICBvdXRwdXRGaWxlczogW10sXG4gICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhOiB7fVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIG1vY2tTdGF0dXNUcmFja2VyLmdldEFsbFN0YXR1c2VzLm1vY2tSZXR1cm5WYWx1ZShtb2NrU3RhdHVzZXMpO1xuICAgICAgICAgICAgbW9ja1N0YXR1c1RyYWNrZXIuZ2V0Q29tbWFuZFN0YXRzLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgICAgICAgdG90YWw6IDUsXG4gICAgICAgICAgICAgICAgc3VjY2Vzc2Z1bDogNCxcbiAgICAgICAgICAgICAgICBmYWlsZWQ6IDEsXG4gICAgICAgICAgICAgICAgYXZlcmFnZUR1cmF0aW9uOiAzMDAwLFxuICAgICAgICAgICAgICAgIHJlY2VudENvbW1hbmRzOiBbXVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlcG9ydCA9IGNvb3JkaW5hdG9yLmNyZWF0ZUhlYWx0aFJlcG9ydCgpO1xuXG4gICAgICAgICAgICBleHBlY3QocmVwb3J0KS50b0NvbnRhaW4oJ0NPTU1BTkQgRVhFQ1VUSU9OIEhFQUxUSCBSRVBPUlQnKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXBvcnQpLnRvQ29udGFpbignQUNUSVZFIENPTU1BTkRTJyk7XG4gICAgICAgICAgICBleHBlY3QocmVwb3J0KS50b0NvbnRhaW4oJ1BFUkZPUk1BTkNFIE1FVFJJQ1MnKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXBvcnQpLnRvQ29udGFpbignUkVDT01NRU5EQVRJT05TJyk7XG4gICAgICAgICAgICBleHBlY3QocmVwb3J0KS50b0NvbnRhaW4oJ1Byb2Nlc3NpbmcuLi4nKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXBvcnQpLnRvQ29udGFpbignNzUlJyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ1F1ZXVlIE1hbmFnZW1lbnQnLCAoKSA9PiB7XG4gICAgICAgIHRlc3QoJ3Nob3VsZCBlbWl0IHF1ZXVlIHVwZGF0ZSBldmVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb29yZGluYXRvci5zZXRNYXhDb25jdXJyZW50Q29tbWFuZHMoMSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHF1ZXVlVXBkYXRlczogYW55W10gPSBbXTtcbiAgICAgICAgICAgIGNvb3JkaW5hdG9yLm9uKCdxdWV1ZV91cGRhdGUnLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgIHF1ZXVlVXBkYXRlcy5wdXNoKGRhdGEpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IG1vY2tSZXN1bHQgPSB7IHN1Y2Nlc3M6IHRydWUsIGV4aXRDb2RlOiAwLCBvdXRwdXQ6ICd0ZXN0JywgZHVyYXRpb246IDEwMDAsIG91dHB1dEZpbGVzOiBbXSB9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBsZXQgcmVzb2x2ZUZpcnN0OiBGdW5jdGlvbiA9ICgpID0+IHt9O1xuICAgICAgICAgICAgbW9ja1N0cmVhbWluZ1J1bm5lci5leGVjdXRlV2l0aFN0cmVhbWluZ1xuICAgICAgICAgICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+IG5ldyBQcm9taXNlKHJlc29sdmUgPT4geyByZXNvbHZlRmlyc3QgPSAoKSA9PiByZXNvbHZlKG1vY2tSZXN1bHQpOyB9KSlcbiAgICAgICAgICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc3VsdCk7XG5cbiAgICAgICAgICAgIC8vIFN0YXJ0IGZpcnN0IGNvbW1hbmQgKHdpbGwgcnVuIGltbWVkaWF0ZWx5KVxuICAgICAgICAgICAgY29uc3QgcHJvbWlzZTEgPSBjb29yZGluYXRvci5leGVjdXRlQ29tbWFuZCgnYWlEZWJ1ZycsIFsncHJvamVjdDEnXSwgeyBwcm9qZWN0OiAncHJvamVjdDEnIH0pO1xuXG4gICAgICAgICAgICAvLyBTdGFydCBzZWNvbmQgY29tbWFuZCAod2lsbCBiZSBxdWV1ZWQpXG4gICAgICAgICAgICBjb25zdCBwcm9taXNlMiA9IGNvb3JkaW5hdG9yLmV4ZWN1dGVDb21tYW5kKCdueFRlc3QnLCBbJ3Byb2plY3QyJ10sIHsgcHJvamVjdDogJ3Byb2plY3QyJyB9KTtcblxuICAgICAgICAgICAgLy8gU2hvdWxkIGhhdmUgZW1pdHRlZCBhIHF1ZXVlIHVwZGF0ZVxuICAgICAgICAgICAgZXhwZWN0KHF1ZXVlVXBkYXRlcy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgICAgICAgIGV4cGVjdChxdWV1ZVVwZGF0ZXNbMF0pLnRvSGF2ZVByb3BlcnR5KCdxdWV1ZWQnKTtcblxuICAgICAgICAgICAgcmVzb2x2ZUZpcnN0KCk7XG4gICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbcHJvbWlzZTEsIHByb21pc2UyXSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ0Vycm9yIEhhbmRsaW5nJywgKCkgPT4ge1xuICAgICAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIGNvbW1hbmQgZXhlY3V0aW9uIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdDb21tYW5kIGZhaWxlZCcpO1xuICAgICAgICAgICAgbW9ja1N0cmVhbWluZ1J1bm5lci5leGVjdXRlV2l0aFN0cmVhbWluZy5tb2NrUmVqZWN0ZWRWYWx1ZShlcnJvcik7XG5cbiAgICAgICAgICAgIGF3YWl0IGV4cGVjdChjb29yZGluYXRvci5leGVjdXRlQ29tbWFuZCgnYWlEZWJ1ZycsIFsndGVzdC1wcm9qZWN0J10sIHtcbiAgICAgICAgICAgICAgICBwcm9qZWN0OiAndGVzdC1wcm9qZWN0J1xuICAgICAgICAgICAgfSkpLnJlamVjdHMudG9UaHJvdygnQ29tbWFuZCBmYWlsZWQnKTtcblxuICAgICAgICAgICAgZXhwZWN0KG1vY2tTdGF0dXNUcmFja2VyLnVwZGF0ZVN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdDb21tYW5kIGZhaWxlZCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIGNsZWFudXAgYWZ0ZXIgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ1Rlc3QgZXJyb3InKTtcbiAgICAgICAgICAgIG1vY2tTdHJlYW1pbmdSdW5uZXIuZXhlY3V0ZVdpdGhTdHJlYW1pbmcubW9ja1JlamVjdGVkVmFsdWUoZXJyb3IpO1xuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IGNvb3JkaW5hdG9yLmV4ZWN1dGVDb21tYW5kKCdhaURlYnVnJywgWyd0ZXN0LXByb2plY3QnXSwge1xuICAgICAgICAgICAgICAgICAgICBwcm9qZWN0OiAndGVzdC1wcm9qZWN0J1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIC8vIEV4cGVjdGVkIGVycm9yXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFNob3VsZCBjbGVhbiB1cCB0aGUgcnVubmVyXG4gICAgICAgICAgICBleHBlY3QobW9ja1N0cmVhbWluZ1J1bm5lci5yZW1vdmVBbGxMaXN0ZW5lcnMpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnQ29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgICAgICAgdGVzdCgnc2hvdWxkIHNldCBtYXhpbXVtIGNvbmN1cnJlbnQgY29tbWFuZHMgd2l0aGluIGJvdW5kcycsICgpID0+IHtcbiAgICAgICAgICAgIGNvb3JkaW5hdG9yLnNldE1heENvbmN1cnJlbnRDb21tYW5kcygwKTsgLy8gQmVsb3cgbWluaW11bVxuICAgICAgICAgICAgZXhwZWN0KGNvb3JkaW5hdG9yLmdldEV4ZWN1dGlvblN0YXR1cygpLm1heENvbmN1cnJlbnQpLnRvQmUoMSk7XG5cbiAgICAgICAgICAgIGNvb3JkaW5hdG9yLnNldE1heENvbmN1cnJlbnRDb21tYW5kcygxNSk7IC8vIEFib3ZlIG1heGltdW1cbiAgICAgICAgICAgIGV4cGVjdChjb29yZGluYXRvci5nZXRFeGVjdXRpb25TdGF0dXMoKS5tYXhDb25jdXJyZW50KS50b0JlKDEwKTtcblxuICAgICAgICAgICAgY29vcmRpbmF0b3Iuc2V0TWF4Q29uY3VycmVudENvbW1hbmRzKDUpOyAvLyBWYWxpZCB2YWx1ZVxuICAgICAgICAgICAgZXhwZWN0KGNvb3JkaW5hdG9yLmdldEV4ZWN1dGlvblN0YXR1cygpLm1heENvbmN1cnJlbnQpLnRvQmUoNSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ0Rpc3Bvc2FsJywgKCkgPT4ge1xuICAgICAgICB0ZXN0KCdzaG91bGQgZGlzcG9zZSBwcm9wZXJseScsICgpID0+IHtcbiAgICAgICAgICAgIC8vIEFkZCBzb21lIG1vY2sgYWN0aXZlIGNvbW1hbmRzXG4gICAgICAgICAgICAoY29vcmRpbmF0b3IgYXMgYW55KS5hY3RpdmVDb21tYW5kcy5zZXQoJ2NtZDEnLCBtb2NrU3RyZWFtaW5nUnVubmVyKTtcbiAgICAgICAgICAgIChjb29yZGluYXRvciBhcyBhbnkpLmFjdGl2ZUNvbW1hbmRzLnNldCgnY21kMicsIG1vY2tTdHJlYW1pbmdSdW5uZXIpO1xuXG4gICAgICAgICAgICAvLyBNb2NrIHRoZSBjYW5jZWwgbWV0aG9kIHRvIHRyYWNrIGNhbGxzXG4gICAgICAgICAgICBjb25zdCBtb2NrQ2FuY2VsID0gamVzdC5mbigpO1xuICAgICAgICAgICAgY29uc3QgcnVubmVyMSA9IHsgLi4ubW9ja1N0cmVhbWluZ1J1bm5lciwgY2FuY2VsOiBtb2NrQ2FuY2VsLCBpc1J1bm5pbmc6IHRydWUgfTtcbiAgICAgICAgICAgIGNvbnN0IHJ1bm5lcjIgPSB7IC4uLm1vY2tTdHJlYW1pbmdSdW5uZXIsIGNhbmNlbDogbW9ja0NhbmNlbCwgaXNSdW5uaW5nOiB0cnVlIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIChjb29yZGluYXRvciBhcyBhbnkpLmFjdGl2ZUNvbW1hbmRzLnNldCgnY21kMScsIHJ1bm5lcjEpO1xuICAgICAgICAgICAgKGNvb3JkaW5hdG9yIGFzIGFueSkuYWN0aXZlQ29tbWFuZHMuc2V0KCdjbWQyJywgcnVubmVyMik7XG5cbiAgICAgICAgICAgIGNvb3JkaW5hdG9yLmRpc3Bvc2UoKTtcblxuICAgICAgICAgICAgZXhwZWN0KG1vY2tDYW5jZWwpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcbiAgICAgICAgICAgIGV4cGVjdCgoY29vcmRpbmF0b3IgYXMgYW55KS5hY3RpdmVDb21tYW5kcy5zaXplKS50b0JlKDApO1xuICAgICAgICAgICAgZXhwZWN0KChjb29yZGluYXRvciBhcyBhbnkpLmNvbW1hbmRRdWV1ZS5sZW5ndGgpLnRvQmUoMCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=