a2638ac34f865f893801be637bc7774e
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.StatusTracker = void 0;
const vscode = __importStar(require("vscode"));
const events_1 = require("events");
class StatusTracker extends events_1.EventEmitter {
    _statusBarItem;
    _projects = [];
    _currentStatus = {
        isRunning: false,
        lastUpdated: new Date()
    };
    _commandStatuses = new Map();
    _commandHistory = [];
    constructor() {
        super();
        this._statusBarItem = vscode.window.createStatusBarItem(vscode.StatusBarAlignment.Left, 100);
        this._statusBarItem.show();
        this._updateStatusBar();
    }
    // Start a new command
    startCommand(action, project, options) {
        const commandId = `${action}-${Date.now()}`;
        const commandStatus = {
            id: commandId,
            action,
            project,
            status: 'running',
            startTime: new Date(),
            progress: 0,
            output: ''
        };
        this._commandStatuses.set(commandId, commandStatus);
        this.updateStatus({
            isRunning: true,
            currentAction: action,
            progress: 0
        });
        this.emit('status_change', { commandId, status: commandStatus });
        return commandId;
    }
    // Complete a command
    completeCommand(commandId, result) {
        const commandStatus = this._commandStatuses.get(commandId);
        if (!commandStatus) {
            return;
        }
        commandStatus.status = result.success ? 'success' : 'error';
        commandStatus.endTime = new Date();
        commandStatus.duration = result.duration;
        commandStatus.output = result.output;
        commandStatus.error = result.error;
        commandStatus.progress = 100;
        this._commandHistory.push(commandStatus);
        this._commandStatuses.delete(commandId);
        // Update status if this was the current command
        if (this._commandStatuses.size === 0) {
            this.updateStatus({
                isRunning: false,
                currentAction: undefined,
                progress: 100,
                message: result.success ? 'Command completed' : 'Command failed'
            });
        }
        this.emit('status_change', { commandId, status: commandStatus });
        this.emit('history_updated', this._commandHistory);
    }
    // Cancel a command
    cancelCommand(commandId) {
        const commandStatus = this._commandStatuses.get(commandId);
        if (!commandStatus) {
            return;
        }
        commandStatus.status = 'cancelled';
        commandStatus.endTime = new Date();
        commandStatus.progress = 0;
        this._commandHistory.push(commandStatus);
        this._commandStatuses.delete(commandId);
        if (this._commandStatuses.size === 0) {
            this.updateStatus({
                isRunning: false,
                currentAction: undefined,
                progress: undefined,
                message: 'Command cancelled'
            });
        }
        this.emit('status_change', { commandId, status: commandStatus });
    }
    // Update command progress
    updateProgress(commandId, progress) {
        const commandStatus = this._commandStatuses.get(commandId);
        if (!commandStatus) {
            return;
        }
        commandStatus.progress = Math.max(0, Math.min(100, progress));
        this.updateStatus({
            progress: commandStatus.progress
        });
        this.emit('status_change', { commandId, status: commandStatus });
    }
    // Append output to command
    appendOutput(commandId, output) {
        const commandStatus = this._commandStatuses.get(commandId);
        if (!commandStatus) {
            return;
        }
        commandStatus.output += output;
        this.emit('status_change', { commandId, status: commandStatus });
    }
    // Append error to command
    appendError(commandId, error) {
        const commandStatus = this._commandStatuses.get(commandId);
        if (!commandStatus) {
            return;
        }
        commandStatus.error = (commandStatus.error || '') + error;
        this.emit('status_change', { commandId, status: commandStatus });
    }
    // Get all current statuses
    getAllStatuses() {
        return Array.from(this._commandStatuses.values());
    }
    // Get running commands
    getRunningCommands() {
        return Array.from(this._commandStatuses.values()).filter(status => status.status === 'running');
    }
    // Get command history
    getHistory() {
        return [...this._commandHistory];
    }
    // Clear command history
    clearHistory() {
        this._commandHistory = [];
        this.emit('history_updated', this._commandHistory);
    }
    // Get command statistics
    getCommandStats(action) {
        let commands = this._commandHistory;
        if (action) {
            commands = commands.filter(cmd => cmd.action === action);
        }
        const successful = commands.filter(cmd => cmd.status === 'success').length;
        const failed = commands.filter(cmd => cmd.status === 'error').length;
        const totalDuration = commands.reduce((sum, cmd) => sum + (cmd.duration || 0), 0);
        return {
            total: commands.length,
            successful,
            failed,
            averageDuration: commands.length > 0 ? totalDuration / commands.length : 0,
            recentCommands: commands.slice(-10)
        };
    }
    // Generate status report
    generateStatusReport() {
        const stats = this.getCommandStats();
        const runningCommands = this.getRunningCommands();
        return `
AI Debug Status Report
=====================

Current Status: ${this._currentStatus.isRunning ? 'Running' : 'Idle'}
Running Commands: ${runningCommands.length}
Total Commands: ${stats.total}
Success Rate: ${stats.total > 0 ? ((stats.successful / stats.total) * 100).toFixed(1) : 0}%
Average Duration: ${stats.averageDuration.toFixed(0)}ms

Recent Commands:
${stats.recentCommands.slice(-5).map(cmd => `- ${cmd.action} (${cmd.project || 'N/A'}): ${cmd.status} - ${cmd.duration || 0}ms`).join('\n')}
        `.trim();
    }
    // Convert to action buttons
    toActionButtons() {
        const buttons = {};
        // Default actions
        const actions = ['aiDebug', 'nxTest', 'gitDiff', 'prepareToPush'];
        for (const action of actions) {
            const runningCommand = this.getRunningCommands().find(cmd => cmd.action === action);
            const recentCommand = this._commandHistory
                .filter(cmd => cmd.action === action)
                .sort((a, b) => b.startTime.getTime() - a.startTime.getTime())[0];
            buttons[action] = {
                id: action,
                label: action.charAt(0).toUpperCase() + action.slice(1),
                icon: this._getActionIcon(action),
                status: runningCommand ? 'running' :
                    recentCommand?.status === 'success' ? 'success' :
                        recentCommand?.status === 'error' ? 'error' : 'idle',
                lastRun: recentCommand?.endTime,
                enabled: !runningCommand,
                progress: runningCommand?.progress
            };
        }
        return buttons;
    }
    _getActionIcon(action) {
        switch (action) {
            case 'aiDebug': return '$(debug-alt)';
            case 'nxTest': return '$(beaker)';
            case 'gitDiff': return '$(git-compare)';
            case 'prepareToPush': return '$(cloud-upload)';
            default: return '$(play)';
        }
    }
    updateStatus(status) {
        this._currentStatus = {
            ...this._currentStatus,
            ...status,
            lastUpdated: new Date()
        };
        this._updateStatusBar();
    }
    setRunning(action, message) {
        this.updateStatus({
            isRunning: true,
            currentAction: action,
            message,
            progress: 0
        });
    }
    setProgress(progress, message) {
        this.updateStatus({
            progress,
            message
        });
    }
    setComplete(message) {
        this.updateStatus({
            isRunning: false,
            currentAction: undefined,
            progress: 100,
            message
        });
        // Clear the message after 3 seconds
        setTimeout(() => {
            if (!this._currentStatus.isRunning) {
                this.updateStatus({
                    message: undefined,
                    progress: undefined
                });
            }
        }, 3000);
    }
    setError(error) {
        this.updateStatus({
            isRunning: false,
            currentAction: undefined,
            message: `Error: ${error}`,
            progress: undefined
        });
        // Clear the error after 5 seconds
        setTimeout(() => {
            if (!this._currentStatus.isRunning) {
                this.updateStatus({
                    message: undefined
                });
            }
        }, 5000);
    }
    setProjects(projects) {
        this._projects = projects;
        this._updateStatusBar();
    }
    getProjects() {
        return this._projects;
    }
    getCurrentStatus() {
        return { ...this._currentStatus };
    }
    _updateStatusBar() {
        let text = '$(debug-alt) AI Debug';
        let tooltip = 'AI Debug Utilities';
        if (this._currentStatus.isRunning) {
            text = `$(loading~spin) ${this._currentStatus.currentAction || 'Running'}`;
            tooltip = this._currentStatus.message || 'Command running...';
            if (this._currentStatus.progress !== undefined) {
                text += ` (${this._currentStatus.progress}%)`;
            }
        }
        else if (this._currentStatus.message) {
            text = `$(info) ${this._currentStatus.message}`;
            tooltip = this._currentStatus.message;
        }
        if (this._projects.length > 0) {
            text += ` (${this._projects.length} projects)`;
        }
        this._statusBarItem.text = text;
        this._statusBarItem.tooltip = tooltip;
        this._statusBarItem.command = 'aiDebugUtilities.openPanel';
    }
    dispose() {
        this._statusBarItem.dispose();
        this.removeAllListeners();
    }
}
exports.StatusTracker = StatusTracker;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2dyZWdkdW5uL3NyYy90ZXN0L2FpX2RlYnVnX2NvbnRleHQvdnNjb2RlL3NyYy91dGlscy9zdGF0dXNUcmFja2VyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLCtDQUFpQztBQUNqQyxtQ0FBc0M7QUFrQ3RDLE1BQWEsYUFBYyxTQUFRLHFCQUFZO0lBQ25DLGNBQWMsQ0FBdUI7SUFDckMsU0FBUyxHQUFnQixFQUFFLENBQUM7SUFDNUIsY0FBYyxHQUFlO1FBQ2pDLFNBQVMsRUFBRSxLQUFLO1FBQ2hCLFdBQVcsRUFBRSxJQUFJLElBQUksRUFBRTtLQUMxQixDQUFDO0lBQ00sZ0JBQWdCLEdBQStCLElBQUksR0FBRyxFQUFFLENBQUM7SUFDekQsZUFBZSxHQUFvQixFQUFFLENBQUM7SUFFOUM7UUFDSSxLQUFLLEVBQUUsQ0FBQztRQUNSLElBQUksQ0FBQyxjQUFjLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxtQkFBbUIsQ0FDbkQsTUFBTSxDQUFDLGtCQUFrQixDQUFDLElBQUksRUFDOUIsR0FBRyxDQUNOLENBQUM7UUFDRixJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQzNCLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0lBQzVCLENBQUM7SUFFRCxzQkFBc0I7SUFDZixZQUFZLENBQUMsTUFBYyxFQUFFLE9BQWdCLEVBQUUsT0FBYTtRQUMvRCxNQUFNLFNBQVMsR0FBRyxHQUFHLE1BQU0sSUFBSSxJQUFJLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQztRQUU1QyxNQUFNLGFBQWEsR0FBa0I7WUFDakMsRUFBRSxFQUFFLFNBQVM7WUFDYixNQUFNO1lBQ04sT0FBTztZQUNQLE1BQU0sRUFBRSxTQUFTO1lBQ2pCLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRTtZQUNyQixRQUFRLEVBQUUsQ0FBQztZQUNYLE1BQU0sRUFBRSxFQUFFO1NBQ2IsQ0FBQztRQUVGLElBQUksQ0FBQyxnQkFBZ0IsQ0FB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QUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ2hELE9BQU8sR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQztRQUMxQyxDQUFDO1FBRUQsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUM1QixJQUFJLElBQUksS0FBSyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sWUFBWSxDQUFDO1FBQ25ELENBQUM7UUFFRCxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDaEMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBQ3RDLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxHQUFHLDRCQUE0QixDQUFDO0lBQy9ELENBQUM7SUFFTSxPQUFPO1FBQ1YsSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUM5QixJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztJQUM5QixDQUFDO0NBQ0o7QUE5VkQsc0NBOFZDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9ncmVnZHVubi9zcmMvdGVzdC9haV9kZWJ1Z19jb250ZXh0L3ZzY29kZS9zcmMvdXRpbHMvc3RhdHVzVHJhY2tlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyB2c2NvZGUgZnJvbSAndnNjb2RlJztcbmltcG9ydCB7IEV2ZW50RW1pdHRlciB9IGZyb20gJ2V2ZW50cyc7XG5pbXBvcnQgeyBOeFByb2plY3QsIENvbW1hbmRSZXN1bHQsIEFjdGlvbkJ1dHRvbiB9IGZyb20gJy4uL3R5cGVzJztcblxuZXhwb3J0IGludGVyZmFjZSBTdGF0dXNJbmZvIHtcbiAgICBpc1J1bm5pbmc6IGJvb2xlYW47XG4gICAgY3VycmVudEFjdGlvbj86IHN0cmluZztcbiAgICBwcm9ncmVzcz86IG51bWJlcjtcbiAgICBtZXNzYWdlPzogc3RyaW5nO1xuICAgIGxhc3RVcGRhdGVkOiBEYXRlO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbW1hbmRTdGF0dXMge1xuICAgIGlkOiBzdHJpbmc7XG4gICAgYWN0aW9uOiBzdHJpbmc7XG4gICAgY29tbWFuZD86IHN0cmluZztcbiAgICBwcm9qZWN0Pzogc3RyaW5nO1xuICAgIHN0YXR1czogJ3J1bm5pbmcnIHwgJ3N1Y2Nlc3MnIHwgJ2Vycm9yJyB8ICdjYW5jZWxsZWQnO1xuICAgIHN0YXJ0VGltZTogRGF0ZTtcbiAgICBlbmRUaW1lPzogRGF0ZTtcbiAgICBwcm9ncmVzczogbnVtYmVyO1xuICAgIG91dHB1dDogc3RyaW5nO1xuICAgIGVycm9yPzogc3RyaW5nO1xuICAgIGR1cmF0aW9uPzogbnVtYmVyO1xuICAgIG1lc3NhZ2U/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tbWFuZFN0YXRzIHtcbiAgICB0b3RhbDogbnVtYmVyO1xuICAgIHN1Y2Nlc3NmdWw6IG51bWJlcjtcbiAgICBmYWlsZWQ6IG51bWJlcjtcbiAgICBhdmVyYWdlRHVyYXRpb246IG51bWJlcjtcbiAgICByZWNlbnRDb21tYW5kczogQ29tbWFuZFN0YXR1c1tdO1xufVxuXG5leHBvcnQgY2xhc3MgU3RhdHVzVHJhY2tlciBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG4gICAgcHJpdmF0ZSBfc3RhdHVzQmFySXRlbTogdnNjb2RlLlN0YXR1c0Jhckl0ZW07XG4gICAgcHJpdmF0ZSBfcHJvamVjdHM6IE54UHJvamVjdFtdID0gW107XG4gICAgcHJpdmF0ZSBfY3VycmVudFN0YXR1czogU3RhdHVzSW5mbyA9IHtcbiAgICAgICAgaXNSdW5uaW5nOiBmYWxzZSxcbiAgICAgICAgbGFzdFVwZGF0ZWQ6IG5ldyBEYXRlKClcbiAgICB9O1xuICAgIHByaXZhdGUgX2NvbW1hbmRTdGF0dXNlczogTWFwPHN0cmluZywgQ29tbWFuZFN0YXR1cz4gPSBuZXcgTWFwKCk7XG4gICAgcHJpdmF0ZSBfY29tbWFuZEhpc3Rvcnk6IENvbW1hbmRTdGF0dXNbXSA9IFtdO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuX3N0YXR1c0Jhckl0ZW0gPSB2c2NvZGUud2luZG93LmNyZWF0ZVN0YXR1c0Jhckl0ZW0oXG4gICAgICAgICAgICB2c2NvZGUuU3RhdHVzQmFyQWxpZ25tZW50LkxlZnQsXG4gICAgICAgICAgICAxMDBcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5fc3RhdHVzQmFySXRlbS5zaG93KCk7XG4gICAgICAgIHRoaXMuX3VwZGF0ZVN0YXR1c0JhcigpO1xuICAgIH1cblxuICAgIC8vIFN0YXJ0IGEgbmV3IGNvbW1hbmRcbiAgICBwdWJsaWMgc3RhcnRDb21tYW5kKGFjdGlvbjogc3RyaW5nLCBwcm9qZWN0Pzogc3RyaW5nLCBvcHRpb25zPzogYW55KTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgY29tbWFuZElkID0gYCR7YWN0aW9ufS0ke0RhdGUubm93KCl9YDtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGNvbW1hbmRTdGF0dXM6IENvbW1hbmRTdGF0dXMgPSB7XG4gICAgICAgICAgICBpZDogY29tbWFuZElkLFxuICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgcHJvamVjdCxcbiAgICAgICAgICAgIHN0YXR1czogJ3J1bm5pbmcnLFxuICAgICAgICAgICAgc3RhcnRUaW1lOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgcHJvZ3Jlc3M6IDAsXG4gICAgICAgICAgICBvdXRwdXQ6ICcnXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5fY29tbWFuZFN0YXR1c2VzLnNldChjb21tYW5kSWQsIGNvbW1hbmRTdGF0dXMpO1xuICAgICAgICB0aGlzLnVwZGF0ZVN0YXR1cyh7XG4gICAgICAgICAgICBpc1J1bm5pbmc6IHRydWUsXG4gICAgICAgICAgICBjdXJyZW50QWN0aW9uOiBhY3Rpb24sXG4gICAgICAgICAgICBwcm9ncmVzczogMFxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmVtaXQoJ3N0YXR1c19jaGFuZ2UnLCB7IGNvbW1hbmRJZCwgc3RhdHVzOiBjb21tYW5kU3RhdHVzIH0pO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGNvbW1hbmRJZDtcbiAgICB9XG5cbiAgICAvLyBDb21wbGV0ZSBhIGNvbW1hbmRcbiAgICBwdWJsaWMgY29tcGxldGVDb21tYW5kKGNvbW1hbmRJZDogc3RyaW5nLCByZXN1bHQ6IENvbW1hbmRSZXN1bHQpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgY29tbWFuZFN0YXR1cyA9IHRoaXMuX2NvbW1hbmRTdGF0dXNlcy5nZXQoY29tbWFuZElkKTtcbiAgICAgICAgaWYgKCFjb21tYW5kU3RhdHVzKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb21tYW5kU3RhdHVzLnN0YXR1cyA9IHJlc3VsdC5zdWNjZXNzID8gJ3N1Y2Nlc3MnIDogJ2Vycm9yJztcbiAgICAgICAgY29tbWFuZFN0YXR1cy5lbmRUaW1lID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29tbWFuZFN0YXR1cy5kdXJhdGlvbiA9IHJlc3VsdC5kdXJhdGlvbjtcbiAgICAgICAgY29tbWFuZFN0YXR1cy5vdXRwdXQgPSByZXN1bHQub3V0cHV0O1xuICAgICAgICBjb21tYW5kU3RhdHVzLmVycm9yID0gcmVzdWx0LmVycm9yO1xuICAgICAgICBjb21tYW5kU3RhdHVzLnByb2dyZXNzID0gMTAwO1xuXG4gICAgICAgIHRoaXMuX2NvbW1hbmRIaXN0b3J5LnB1c2goY29tbWFuZFN0YXR1cyk7XG4gICAgICAgIHRoaXMuX2NvbW1hbmRTdGF0dXNlcy5kZWxldGUoY29tbWFuZElkKTtcblxuICAgICAgICAvLyBVcGRhdGUgc3RhdHVzIGlmIHRoaXMgd2FzIHRoZSBjdXJyZW50IGNvbW1hbmRcbiAgICAgICAgaWYgKHRoaXMuX2NvbW1hbmRTdGF0dXNlcy5zaXplID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXR1cyh7XG4gICAgICAgICAgICAgICAgaXNSdW5uaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjdXJyZW50QWN0aW9uOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgcHJvZ3Jlc3M6IDEwMCxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiByZXN1bHQuc3VjY2VzcyA/ICdDb21tYW5kIGNvbXBsZXRlZCcgOiAnQ29tbWFuZCBmYWlsZWQnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZW1pdCgnc3RhdHVzX2NoYW5nZScsIHsgY29tbWFuZElkLCBzdGF0dXM6IGNvbW1hbmRTdGF0dXMgfSk7XG4gICAgICAgIHRoaXMuZW1pdCgnaGlzdG9yeV91cGRhdGVkJywgdGhpcy5fY29tbWFuZEhpc3RvcnkpO1xuICAgIH1cblxuICAgIC8vIENhbmNlbCBhIGNvbW1hbmRcbiAgICBwdWJsaWMgY2FuY2VsQ29tbWFuZChjb21tYW5kSWQ6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBjb25zdCBjb21tYW5kU3RhdHVzID0gdGhpcy5fY29tbWFuZFN0YXR1c2VzLmdldChjb21tYW5kSWQpO1xuICAgICAgICBpZiAoIWNvbW1hbmRTdGF0dXMpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbW1hbmRTdGF0dXMuc3RhdHVzID0gJ2NhbmNlbGxlZCc7XG4gICAgICAgIGNvbW1hbmRTdGF0dXMuZW5kVGltZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGNvbW1hbmRTdGF0dXMucHJvZ3Jlc3MgPSAwO1xuXG4gICAgICAgIHRoaXMuX2NvbW1hbmRIaXN0b3J5LnB1c2goY29tbWFuZFN0YXR1cyk7XG4gICAgICAgIHRoaXMuX2NvbW1hbmRTdGF0dXNlcy5kZWxldGUoY29tbWFuZElkKTtcblxuICAgICAgICBpZiAodGhpcy5fY29tbWFuZFN0YXR1c2VzLnNpemUgPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdHVzKHtcbiAgICAgICAgICAgICAgICBpc1J1bm5pbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGN1cnJlbnRBY3Rpb246IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBwcm9ncmVzczogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdDb21tYW5kIGNhbmNlbGxlZCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5lbWl0KCdzdGF0dXNfY2hhbmdlJywgeyBjb21tYW5kSWQsIHN0YXR1czogY29tbWFuZFN0YXR1cyB9KTtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgY29tbWFuZCBwcm9ncmVzc1xuICAgIHB1YmxpYyB1cGRhdGVQcm9ncmVzcyhjb21tYW5kSWQ6IHN0cmluZywgcHJvZ3Jlc3M6IG51bWJlcik6IHZvaWQge1xuICAgICAgICBjb25zdCBjb21tYW5kU3RhdHVzID0gdGhpcy5fY29tbWFuZFN0YXR1c2VzLmdldChjb21tYW5kSWQpO1xuICAgICAgICBpZiAoIWNvbW1hbmRTdGF0dXMpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbW1hbmRTdGF0dXMucHJvZ3Jlc3MgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxMDAsIHByb2dyZXNzKSk7XG4gICAgICAgIFxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXR1cyh7XG4gICAgICAgICAgICBwcm9ncmVzczogY29tbWFuZFN0YXR1cy5wcm9ncmVzc1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmVtaXQoJ3N0YXR1c19jaGFuZ2UnLCB7IGNvbW1hbmRJZCwgc3RhdHVzOiBjb21tYW5kU3RhdHVzIH0pO1xuICAgIH1cblxuICAgIC8vIEFwcGVuZCBvdXRwdXQgdG8gY29tbWFuZFxuICAgIHB1YmxpYyBhcHBlbmRPdXRwdXQoY29tbWFuZElkOiBzdHJpbmcsIG91dHB1dDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGNvbW1hbmRTdGF0dXMgPSB0aGlzLl9jb21tYW5kU3RhdHVzZXMuZ2V0KGNvbW1hbmRJZCk7XG4gICAgICAgIGlmICghY29tbWFuZFN0YXR1cykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29tbWFuZFN0YXR1cy5vdXRwdXQgKz0gb3V0cHV0O1xuICAgICAgICB0aGlzLmVtaXQoJ3N0YXR1c19jaGFuZ2UnLCB7IGNvbW1hbmRJZCwgc3RhdHVzOiBjb21tYW5kU3RhdHVzIH0pO1xuICAgIH1cblxuICAgIC8vIEFwcGVuZCBlcnJvciB0byBjb21tYW5kXG4gICAgcHVibGljIGFwcGVuZEVycm9yKGNvbW1hbmRJZDogc3RyaW5nLCBlcnJvcjogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGNvbW1hbmRTdGF0dXMgPSB0aGlzLl9jb21tYW5kU3RhdHVzZXMuZ2V0KGNvbW1hbmRJZCk7XG4gICAgICAgIGlmICghY29tbWFuZFN0YXR1cykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29tbWFuZFN0YXR1cy5lcnJvciA9IChjb21tYW5kU3RhdHVzLmVycm9yIHx8ICcnKSArIGVycm9yO1xuICAgICAgICB0aGlzLmVtaXQoJ3N0YXR1c19jaGFuZ2UnLCB7IGNvbW1hbmRJZCwgc3RhdHVzOiBjb21tYW5kU3RhdHVzIH0pO1xuICAgIH1cblxuICAgIC8vIEdldCBhbGwgY3VycmVudCBzdGF0dXNlc1xuICAgIHB1YmxpYyBnZXRBbGxTdGF0dXNlcygpOiBDb21tYW5kU3RhdHVzW10ge1xuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLl9jb21tYW5kU3RhdHVzZXMudmFsdWVzKCkpO1xuICAgIH1cblxuICAgIC8vIEdldCBydW5uaW5nIGNvbW1hbmRzXG4gICAgcHVibGljIGdldFJ1bm5pbmdDb21tYW5kcygpOiBDb21tYW5kU3RhdHVzW10ge1xuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLl9jb21tYW5kU3RhdHVzZXMudmFsdWVzKCkpLmZpbHRlcihcbiAgICAgICAgICAgIHN0YXR1cyA9PiBzdGF0dXMuc3RhdHVzID09PSAncnVubmluZydcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBHZXQgY29tbWFuZCBoaXN0b3J5XG4gICAgcHVibGljIGdldEhpc3RvcnkoKTogQ29tbWFuZFN0YXR1c1tdIHtcbiAgICAgICAgcmV0dXJuIFsuLi50aGlzLl9jb21tYW5kSGlzdG9yeV07XG4gICAgfVxuXG4gICAgLy8gQ2xlYXIgY29tbWFuZCBoaXN0b3J5XG4gICAgcHVibGljIGNsZWFySGlzdG9yeSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5fY29tbWFuZEhpc3RvcnkgPSBbXTtcbiAgICAgICAgdGhpcy5lbWl0KCdoaXN0b3J5X3VwZGF0ZWQnLCB0aGlzLl9jb21tYW5kSGlzdG9yeSk7XG4gICAgfVxuXG4gICAgLy8gR2V0IGNvbW1hbmQgc3RhdGlzdGljc1xuICAgIHB1YmxpYyBnZXRDb21tYW5kU3RhdHMoYWN0aW9uPzogc3RyaW5nKTogQ29tbWFuZFN0YXRzIHtcbiAgICAgICAgbGV0IGNvbW1hbmRzID0gdGhpcy5fY29tbWFuZEhpc3Rvcnk7XG4gICAgICAgIFxuICAgICAgICBpZiAoYWN0aW9uKSB7XG4gICAgICAgICAgICBjb21tYW5kcyA9IGNvbW1hbmRzLmZpbHRlcihjbWQgPT4gY21kLmFjdGlvbiA9PT0gYWN0aW9uKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHN1Y2Nlc3NmdWwgPSBjb21tYW5kcy5maWx0ZXIoY21kID0+IGNtZC5zdGF0dXMgPT09ICdzdWNjZXNzJykubGVuZ3RoO1xuICAgICAgICBjb25zdCBmYWlsZWQgPSBjb21tYW5kcy5maWx0ZXIoY21kID0+IGNtZC5zdGF0dXMgPT09ICdlcnJvcicpLmxlbmd0aDtcbiAgICAgICAgY29uc3QgdG90YWxEdXJhdGlvbiA9IGNvbW1hbmRzLnJlZHVjZSgoc3VtLCBjbWQpID0+IHN1bSArIChjbWQuZHVyYXRpb24gfHwgMCksIDApO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0b3RhbDogY29tbWFuZHMubGVuZ3RoLFxuICAgICAgICAgICAgc3VjY2Vzc2Z1bCxcbiAgICAgICAgICAgIGZhaWxlZCxcbiAgICAgICAgICAgIGF2ZXJhZ2VEdXJhdGlvbjogY29tbWFuZHMubGVuZ3RoID4gMCA/IHRvdGFsRHVyYXRpb24gLyBjb21tYW5kcy5sZW5ndGggOiAwLFxuICAgICAgICAgICAgcmVjZW50Q29tbWFuZHM6IGNvbW1hbmRzLnNsaWNlKC0xMClcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBHZW5lcmF0ZSBzdGF0dXMgcmVwb3J0XG4gICAgcHVibGljIGdlbmVyYXRlU3RhdHVzUmVwb3J0KCk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IHN0YXRzID0gdGhpcy5nZXRDb21tYW5kU3RhdHMoKTtcbiAgICAgICAgY29uc3QgcnVubmluZ0NvbW1hbmRzID0gdGhpcy5nZXRSdW5uaW5nQ29tbWFuZHMoKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBgXG5BSSBEZWJ1ZyBTdGF0dXMgUmVwb3J0XG49PT09PT09PT09PT09PT09PT09PT1cblxuQ3VycmVudCBTdGF0dXM6ICR7dGhpcy5fY3VycmVudFN0YXR1cy5pc1J1bm5pbmcgPyAnUnVubmluZycgOiAnSWRsZSd9XG5SdW5uaW5nIENvbW1hbmRzOiAke3J1bm5pbmdDb21tYW5kcy5sZW5ndGh9XG5Ub3RhbCBDb21tYW5kczogJHtzdGF0cy50b3RhbH1cblN1Y2Nlc3MgUmF0ZTogJHtzdGF0cy50b3RhbCA+IDAgPyAoKHN0YXRzLnN1Y2Nlc3NmdWwgLyBzdGF0cy50b3RhbCkgKiAxMDApLnRvRml4ZWQoMSkgOiAwfSVcbkF2ZXJhZ2UgRHVyYXRpb246ICR7c3RhdHMuYXZlcmFnZUR1cmF0aW9uLnRvRml4ZWQoMCl9bXNcblxuUmVjZW50IENvbW1hbmRzOlxuJHtzdGF0cy5yZWNlbnRDb21tYW5kcy5zbGljZSgtNSkubWFwKGNtZCA9PiBcbiAgICBgLSAke2NtZC5hY3Rpb259ICgke2NtZC5wcm9qZWN0IHx8ICdOL0EnfSk6ICR7Y21kLnN0YXR1c30gLSAke2NtZC5kdXJhdGlvbiB8fCAwfW1zYFxuKS5qb2luKCdcXG4nKX1cbiAgICAgICAgYC50cmltKCk7XG4gICAgfVxuXG4gICAgLy8gQ29udmVydCB0byBhY3Rpb24gYnV0dG9uc1xuICAgIHB1YmxpYyB0b0FjdGlvbkJ1dHRvbnMoKTogUmVjb3JkPHN0cmluZywgQWN0aW9uQnV0dG9uPiB7XG4gICAgICAgIGNvbnN0IGJ1dHRvbnM6IFJlY29yZDxzdHJpbmcsIEFjdGlvbkJ1dHRvbj4gPSB7fTtcbiAgICAgICAgXG4gICAgICAgIC8vIERlZmF1bHQgYWN0aW9uc1xuICAgICAgICBjb25zdCBhY3Rpb25zID0gWydhaURlYnVnJywgJ254VGVzdCcsICdnaXREaWZmJywgJ3ByZXBhcmVUb1B1c2gnXSBhcyBjb25zdDtcbiAgICAgICAgXG4gICAgICAgIGZvciAoY29uc3QgYWN0aW9uIG9mIGFjdGlvbnMpIHtcbiAgICAgICAgICAgIGNvbnN0IHJ1bm5pbmdDb21tYW5kID0gdGhpcy5nZXRSdW5uaW5nQ29tbWFuZHMoKS5maW5kKGNtZCA9PiBjbWQuYWN0aW9uID09PSBhY3Rpb24pO1xuICAgICAgICAgICAgY29uc3QgcmVjZW50Q29tbWFuZCA9IHRoaXMuX2NvbW1hbmRIaXN0b3J5XG4gICAgICAgICAgICAgICAgLmZpbHRlcihjbWQgPT4gY21kLmFjdGlvbiA9PT0gYWN0aW9uKVxuICAgICAgICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiBiLnN0YXJ0VGltZS5nZXRUaW1lKCkgLSBhLnN0YXJ0VGltZS5nZXRUaW1lKCkpWzBdO1xuXG4gICAgICAgICAgICBidXR0b25zW2FjdGlvbl0gPSB7XG4gICAgICAgICAgICAgICAgaWQ6IGFjdGlvbixcbiAgICAgICAgICAgICAgICBsYWJlbDogYWN0aW9uLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgYWN0aW9uLnNsaWNlKDEpLFxuICAgICAgICAgICAgICAgIGljb246IHRoaXMuX2dldEFjdGlvbkljb24oYWN0aW9uKSxcbiAgICAgICAgICAgICAgICBzdGF0dXM6IHJ1bm5pbmdDb21tYW5kID8gJ3J1bm5pbmcnIDogXG4gICAgICAgICAgICAgICAgICAgICAgIHJlY2VudENvbW1hbmQ/LnN0YXR1cyA9PT0gJ3N1Y2Nlc3MnID8gJ3N1Y2Nlc3MnIDpcbiAgICAgICAgICAgICAgICAgICAgICAgcmVjZW50Q29tbWFuZD8uc3RhdHVzID09PSAnZXJyb3InID8gJ2Vycm9yJyA6ICdpZGxlJyxcbiAgICAgICAgICAgICAgICBsYXN0UnVuOiByZWNlbnRDb21tYW5kPy5lbmRUaW1lLFxuICAgICAgICAgICAgICAgIGVuYWJsZWQ6ICFydW5uaW5nQ29tbWFuZCxcbiAgICAgICAgICAgICAgICBwcm9ncmVzczogcnVubmluZ0NvbW1hbmQ/LnByb2dyZXNzXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGJ1dHRvbnM7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfZ2V0QWN0aW9uSWNvbihhY3Rpb246IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIHN3aXRjaCAoYWN0aW9uKSB7XG4gICAgICAgICAgICBjYXNlICdhaURlYnVnJzogcmV0dXJuICckKGRlYnVnLWFsdCknO1xuICAgICAgICAgICAgY2FzZSAnbnhUZXN0JzogcmV0dXJuICckKGJlYWtlciknO1xuICAgICAgICAgICAgY2FzZSAnZ2l0RGlmZic6IHJldHVybiAnJChnaXQtY29tcGFyZSknO1xuICAgICAgICAgICAgY2FzZSAncHJlcGFyZVRvUHVzaCc6IHJldHVybiAnJChjbG91ZC11cGxvYWQpJztcbiAgICAgICAgICAgIGRlZmF1bHQ6IHJldHVybiAnJChwbGF5KSc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgdXBkYXRlU3RhdHVzKHN0YXR1czogUGFydGlhbDxTdGF0dXNJbmZvPik6IHZvaWQge1xuICAgICAgICB0aGlzLl9jdXJyZW50U3RhdHVzID0ge1xuICAgICAgICAgICAgLi4udGhpcy5fY3VycmVudFN0YXR1cyxcbiAgICAgICAgICAgIC4uLnN0YXR1cyxcbiAgICAgICAgICAgIGxhc3RVcGRhdGVkOiBuZXcgRGF0ZSgpXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX3VwZGF0ZVN0YXR1c0JhcigpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRSdW5uaW5nKGFjdGlvbjogc3RyaW5nLCBtZXNzYWdlPzogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMudXBkYXRlU3RhdHVzKHtcbiAgICAgICAgICAgIGlzUnVubmluZzogdHJ1ZSxcbiAgICAgICAgICAgIGN1cnJlbnRBY3Rpb246IGFjdGlvbixcbiAgICAgICAgICAgIG1lc3NhZ2UsXG4gICAgICAgICAgICBwcm9ncmVzczogMFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0UHJvZ3Jlc3MocHJvZ3Jlc3M6IG51bWJlciwgbWVzc2FnZT86IHN0cmluZyk6IHZvaWQge1xuICAgICAgICB0aGlzLnVwZGF0ZVN0YXR1cyh7XG4gICAgICAgICAgICBwcm9ncmVzcyxcbiAgICAgICAgICAgIG1lc3NhZ2VcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIHNldENvbXBsZXRlKG1lc3NhZ2U/OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0dXMoe1xuICAgICAgICAgICAgaXNSdW5uaW5nOiBmYWxzZSxcbiAgICAgICAgICAgIGN1cnJlbnRBY3Rpb246IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHByb2dyZXNzOiAxMDAsXG4gICAgICAgICAgICBtZXNzYWdlXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENsZWFyIHRoZSBtZXNzYWdlIGFmdGVyIDMgc2Vjb25kc1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIGlmICghdGhpcy5fY3VycmVudFN0YXR1cy5pc1J1bm5pbmcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXR1cyh7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3M6IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCAzMDAwKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0RXJyb3IoZXJyb3I6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICB0aGlzLnVwZGF0ZVN0YXR1cyh7XG4gICAgICAgICAgICBpc1J1bm5pbmc6IGZhbHNlLFxuICAgICAgICAgICAgY3VycmVudEFjdGlvbjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgbWVzc2FnZTogYEVycm9yOiAke2Vycm9yfWAsXG4gICAgICAgICAgICBwcm9ncmVzczogdW5kZWZpbmVkXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENsZWFyIHRoZSBlcnJvciBhZnRlciA1IHNlY29uZHNcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX2N1cnJlbnRTdGF0dXMuaXNSdW5uaW5nKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0dXMoe1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgNTAwMCk7XG4gICAgfVxuXG4gICAgcHVibGljIHNldFByb2plY3RzKHByb2plY3RzOiBOeFByb2plY3RbXSk6IHZvaWQge1xuICAgICAgICB0aGlzLl9wcm9qZWN0cyA9IHByb2plY3RzO1xuICAgICAgICB0aGlzLl91cGRhdGVTdGF0dXNCYXIoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0UHJvamVjdHMoKTogTnhQcm9qZWN0W10ge1xuICAgICAgICByZXR1cm4gdGhpcy5fcHJvamVjdHM7XG4gICAgfVxuXG4gICAgcHVibGljIGdldEN1cnJlbnRTdGF0dXMoKTogU3RhdHVzSW5mbyB7XG4gICAgICAgIHJldHVybiB7IC4uLnRoaXMuX2N1cnJlbnRTdGF0dXMgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF91cGRhdGVTdGF0dXNCYXIoKTogdm9pZCB7XG4gICAgICAgIGxldCB0ZXh0ID0gJyQoZGVidWctYWx0KSBBSSBEZWJ1Zyc7XG4gICAgICAgIGxldCB0b29sdGlwID0gJ0FJIERlYnVnIFV0aWxpdGllcyc7XG5cbiAgICAgICAgaWYgKHRoaXMuX2N1cnJlbnRTdGF0dXMuaXNSdW5uaW5nKSB7XG4gICAgICAgICAgICB0ZXh0ID0gYCQobG9hZGluZ35zcGluKSAke3RoaXMuX2N1cnJlbnRTdGF0dXMuY3VycmVudEFjdGlvbiB8fCAnUnVubmluZyd9YDtcbiAgICAgICAgICAgIHRvb2x0aXAgPSB0aGlzLl9jdXJyZW50U3RhdHVzLm1lc3NhZ2UgfHwgJ0NvbW1hbmQgcnVubmluZy4uLic7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICh0aGlzLl9jdXJyZW50U3RhdHVzLnByb2dyZXNzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0ZXh0ICs9IGAgKCR7dGhpcy5fY3VycmVudFN0YXR1cy5wcm9ncmVzc30lKWA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5fY3VycmVudFN0YXR1cy5tZXNzYWdlKSB7XG4gICAgICAgICAgICB0ZXh0ID0gYCQoaW5mbykgJHt0aGlzLl9jdXJyZW50U3RhdHVzLm1lc3NhZ2V9YDtcbiAgICAgICAgICAgIHRvb2x0aXAgPSB0aGlzLl9jdXJyZW50U3RhdHVzLm1lc3NhZ2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5fcHJvamVjdHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGV4dCArPSBgICgke3RoaXMuX3Byb2plY3RzLmxlbmd0aH0gcHJvamVjdHMpYDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX3N0YXR1c0Jhckl0ZW0udGV4dCA9IHRleHQ7XG4gICAgICAgIHRoaXMuX3N0YXR1c0Jhckl0ZW0udG9vbHRpcCA9IHRvb2x0aXA7XG4gICAgICAgIHRoaXMuX3N0YXR1c0Jhckl0ZW0uY29tbWFuZCA9ICdhaURlYnVnVXRpbGl0aWVzLm9wZW5QYW5lbCc7XG4gICAgfVxuXG4gICAgcHVibGljIGRpc3Bvc2UoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuX3N0YXR1c0Jhckl0ZW0uZGlzcG9zZSgpO1xuICAgICAgICB0aGlzLnJlbW92ZUFsbExpc3RlbmVycygpO1xuICAgIH1cbn0iXSwidmVyc2lvbiI6M30=