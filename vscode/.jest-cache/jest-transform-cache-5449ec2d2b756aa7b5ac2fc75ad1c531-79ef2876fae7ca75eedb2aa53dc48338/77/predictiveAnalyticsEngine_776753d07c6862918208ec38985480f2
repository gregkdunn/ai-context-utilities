5e85b99e865a40904194a2c209c2ac70
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PredictiveAnalyticsEngine = void 0;
const events_1 = require("events");
class PredictiveAnalyticsEngine extends events_1.EventEmitter {
    config;
    models = new Map();
    trainingData = [];
    constructor(config) {
        super();
        this.config = {
            enableAnomalyDetection: true,
            enableTrendForecasting: true,
            enableRiskAssessment: true,
            modelUpdateInterval: 3600000, // 1 hour
            anomalyThreshold: 2.0,
            predictionHorizon: 24, // 24 hours
            minTrainingDataSize: 100,
            confidenceThreshold: 0.7,
            ...config
        };
        this.initializeModels();
    }
    initializeModels() {
        // Initialize default models
        const defaultModels = [
            {
                id: 'command_failure',
                name: 'Command Failure Prediction',
                type: 'classification',
                isActive: true,
                accuracy: 0.85,
                precision: 0.82,
                recall: 0.78,
                f1Score: 0.80,
                lastTrained: new Date(),
                trainingDataSize: 0
            },
            {
                id: 'performance_degradation',
                name: 'Performance Degradation Prediction',
                type: 'regression',
                isActive: true,
                accuracy: 0.75,
                precision: 0.73,
                recall: 0.77,
                f1Score: 0.75,
                lastTrained: new Date(),
                trainingDataSize: 0
            },
            {
                id: 'resource_utilization',
                name: 'Resource Utilization Prediction',
                type: 'regression',
                isActive: true,
                accuracy: 0.80,
                precision: 0.78,
                recall: 0.82,
                f1Score: 0.80,
                lastTrained: new Date(),
                trainingDataSize: 0
            }
        ];
        defaultModels.forEach(model => this.models.set(model.id, model));
    }
    getAvailableModels() {
        return Array.from(this.models.values());
    }
    async trainModels(events) {
        if (events.length < this.config.minTrainingDataSize) {
            throw new Error(`Insufficient training data. Required: ${this.config.minTrainingDataSize}, provided: ${events.length}`);
        }
        this.trainingData = events;
        // Update model training metrics
        this.models.forEach(model => {
            model.lastTrained = new Date();
            model.trainingDataSize = events.length;
            // In a real implementation, this would update actual model accuracy
            model.accuracy = Math.min(model.accuracy + 0.01, 0.95); // Simulate improvement
        });
        this.emit('modelsTrained', { modelCount: this.models.size, dataSize: events.length });
    }
    async generatePredictions(events) {
        const predictions = [];
        // Command failure prediction
        const commandFailurePrediction = this.predictCommandFailure(events);
        if (commandFailurePrediction && (commandFailurePrediction.confidence ?? 0) >= this.config.confidenceThreshold) {
            predictions.push(commandFailurePrediction);
        }
        // Performance degradation prediction
        const performancePrediction = this.predictPerformanceDegradation(events);
        if (performancePrediction && (performancePrediction.confidence ?? 0) >= this.config.confidenceThreshold) {
            predictions.push(performancePrediction);
        }
        // Resource utilization prediction
        const resourcePrediction = this.predictResourceUtilization(events);
        if (resourcePrediction && (resourcePrediction.confidence ?? 0) >= this.config.confidenceThreshold) {
            predictions.push(resourcePrediction);
        }
        return predictions;
    }
    async detectAnomalies(events) {
        if (!this.config.enableAnomalyDetection) {
            return [];
        }
        const anomalies = [];
        // Performance anomaly detection
        const performanceEvents = events.filter(e => e.type === 'performance_metric');
        if (performanceEvents.length > 0) {
            const avgValue = performanceEvents.reduce((sum, e) => sum + (e.metadata.value || 0), 0) / performanceEvents.length;
            performanceEvents.forEach(event => {
                const value = event.metadata.value || 0;
                const deviation = Math.abs(value - avgValue) / avgValue;
                if (deviation > 1.0) { // 100% deviation threshold - more sensitive
                    anomalies.push({
                        id: `anomaly_${event.id}`,
                        type: 'performance',
                        severity: deviation > 3.0 ? 'high' : 'medium',
                        detectedAt: new Date(),
                        event: event,
                        description: `Performance value ${value} deviates significantly from average ${avgValue.toFixed(2)}`,
                        confidence: Math.min(deviation / 2, 1),
                        affectedMetrics: ['performance'],
                        recommendation: 'Investigate system performance and resource usage'
                    });
                }
            });
        }
        return anomalies;
    }
    async generateForecasts(events, metrics, horizonHours) {
        if (!this.config.enableTrendForecasting) {
            return [];
        }
        const forecasts = [];
        metrics.forEach(metric => {
            const relevantEvents = events.filter(e => e.metadata[metric] !== undefined);
            if (relevantEvents.length > 0) {
                const values = relevantEvents.map(e => e.metadata[metric]);
                const currentValue = values[values.length - 1];
                // Simple trend analysis
                const trend = this.calculateTrend(values);
                const forecastValue = currentValue + (trend * horizonHours);
                forecasts.push({
                    id: `forecast_${metric}_${Date.now()}`,
                    metric,
                    currentValue,
                    forecastValue,
                    confidence: Math.max(0.5, 1 - (Math.abs(trend) / currentValue)),
                    horizon: horizonHours,
                    timeHorizon: horizonHours,
                    trend: trend > 0 ? 'increasing' : trend < 0 ? 'decreasing' : 'stable',
                    generatedAt: new Date(),
                    dataPoints: relevantEvents.length
                });
            }
        });
        return forecasts;
    }
    async assessRisk(events) {
        if (!this.config.enableRiskAssessment) {
            return {
                overallRiskScore: 0,
                riskLevel: 'low',
                criticalFactors: [],
                recommendations: [],
                predictions: [],
                anomalies: [],
                assessedAt: new Date()
            };
        }
        const predictions = await this.generatePredictions(events);
        const anomalies = await this.detectAnomalies(events);
        // Calculate risk factors
        const errorRate = events.filter(e => e.type === 'error').length / events.length;
        const failureRate = events.filter(e => e.type === 'command_executed' && !e.metadata.success).length / events.length;
        const highAnomaly = anomalies.filter(a => a.severity === 'high').length;
        const riskFactors = [
            { factor: 'Error Rate', weight: 0.3, value: errorRate },
            { factor: 'Failure Rate', weight: 0.4, value: failureRate },
            { factor: 'High Anomalies', weight: 0.3, value: highAnomaly / 10 } // Normalize
        ];
        const overallRiskScore = riskFactors.reduce((sum, factor) => sum + (factor.weight * factor.value), 0);
        const riskLevel = overallRiskScore > 0.7 ? 'high' :
            overallRiskScore > 0.4 ? 'medium' : 'low';
        const criticalFactors = riskFactors
            .filter(factor => factor.value > 0.5)
            .map(factor => factor.factor);
        const recommendations = this.generateRiskRecommendations(riskLevel, criticalFactors);
        return {
            overallRiskScore,
            riskLevel,
            criticalFactors,
            recommendations,
            predictions,
            anomalies,
            assessedAt: new Date()
        };
    }
    getModelMetrics(modelId) {
        const model = this.models.get(modelId);
        if (!model) {
            throw new Error(`Model not found: ${modelId}`);
        }
        return {
            accuracy: model.accuracy,
            precision: model.precision,
            recall: model.recall,
            f1Score: model.f1Score,
            lastTrained: model.lastTrained,
            trainingDataSize: model.trainingDataSize
        };
    }
    toggleModel(modelId, isActive) {
        const model = this.models.get(modelId);
        if (model) {
            model.isActive = isActive;
            this.emit('modelToggled', { modelId, isActive });
        }
    }
    predictCommandFailure(events) {
        const commandEvents = events.filter(e => e.type === 'command_executed');
        if (commandEvents.length === 0) {
            return null;
        }
        const failureRate = commandEvents.filter(e => !e.metadata.success).length / commandEvents.length;
        if (failureRate > 0.25) { // 25% failure rate threshold
            return {
                type: 'test-failure',
                probability: Math.min(failureRate * 2, 1),
                confidence: Math.min(failureRate * 2, 1),
                description: `High command failure rate detected: ${(failureRate * 100).toFixed(1)}%`,
                affectedFiles: this.extractAffectedFiles(commandEvents),
                prevention: [
                    {
                        id: 'review-code-changes',
                        title: 'Review recent code changes',
                        description: 'Check recent commits for potential issues',
                        action: { type: 'command', data: { command: 'git log --oneline -10' } },
                        estimatedImpact: 'medium',
                        estimatedEffort: 'minutes'
                    },
                    {
                        id: 'check-test-config',
                        title: 'Check test configurations',
                        description: 'Verify test setup and configuration files',
                        action: { type: 'file-edit', data: { file: 'jest.config.js' } },
                        estimatedImpact: 'medium',
                        estimatedEffort: 'minutes'
                    },
                    {
                        id: 'verify-dependencies',
                        title: 'Verify dependencies are up to date',
                        description: 'Check package.json and update dependencies',
                        action: { type: 'command', data: { command: 'npm audit' } },
                        estimatedImpact: 'high',
                        estimatedEffort: 'minutes'
                    }
                ],
                timeline: '1-2 hours',
                prediction: 'Command failures likely to continue',
                impact: 'high'
            };
        }
        return null;
    }
    predictPerformanceDegradation(events) {
        const performanceEvents = events.filter(e => e.type === 'performance_metric');
        if (performanceEvents.length === 0) {
            return null;
        }
        const avgResponseTime = performanceEvents.reduce((sum, e) => sum + (e.metadata.responseTime || 0), 0) / performanceEvents.length;
        if (avgResponseTime > 2000) { // 2 second threshold
            return {
                type: 'performance-degradation',
                probability: Math.min(avgResponseTime / 3000, 1),
                confidence: Math.min(avgResponseTime / 3000, 1),
                description: `Performance degradation detected: ${avgResponseTime.toFixed(0)}ms average response time`,
                affectedFiles: [],
                prevention: [
                    {
                        id: 'optimize-queries',
                        title: 'Optimize database queries',
                        description: 'Review and optimize slow database queries',
                        action: { type: 'command', data: { command: 'npm run analyze-queries' } },
                        estimatedImpact: 'high',
                        estimatedEffort: 'hours'
                    },
                    {
                        id: 'review-resources',
                        title: 'Review resource allocation',
                        description: 'Check system resource usage and allocation',
                        action: { type: 'command', data: { command: 'top' } },
                        estimatedImpact: 'medium',
                        estimatedEffort: 'minutes'
                    },
                    {
                        id: 'check-memory-leaks',
                        title: 'Check for memory leaks',
                        description: 'Run memory profiler to detect leaks',
                        action: { type: 'command', data: { command: 'npm run profile' } },
                        estimatedImpact: 'high',
                        estimatedEffort: 'hours'
                    }
                ],
                timeline: '30-60 minutes',
                prediction: 'Performance will continue to degrade',
                impact: 'medium'
            };
        }
        return null;
    }
    predictResourceUtilization(events) {
        const resourceEvents = events.filter(e => e.type === 'resource_usage');
        if (resourceEvents.length === 0) {
            return null;
        }
        const avgMemory = resourceEvents.reduce((sum, e) => sum + (e.metadata.memoryUsage || 0), 0) / resourceEvents.length;
        if (avgMemory > 85) { // 85% memory usage threshold
            return {
                type: 'security-issue',
                probability: Math.min(avgMemory / 100, 1),
                confidence: Math.min(avgMemory / 100, 1),
                description: `High memory usage detected: ${avgMemory.toFixed(1)}%`,
                affectedFiles: [],
                prevention: [
                    {
                        id: 'review-memory-patterns',
                        title: 'Review memory usage patterns',
                        description: 'Analyze memory usage patterns and optimize',
                        action: { type: 'command', data: { command: 'npm run memory-analysis' } },
                        estimatedImpact: 'high',
                        estimatedEffort: 'hours'
                    },
                    {
                        id: 'optimize-data-structures',
                        title: 'Optimize data structures',
                        description: 'Review and optimize data structures for memory efficiency',
                        action: { type: 'file-edit', data: { pattern: '**/*.ts' } },
                        estimatedImpact: 'medium',
                        estimatedEffort: 'hours'
                    },
                    {
                        id: 'check-resource-leaks',
                        title: 'Check for resource leaks',
                        description: 'Scan for resource leaks and memory retention issues',
                        action: { type: 'command', data: { command: 'npm run leak-detection' } },
                        estimatedImpact: 'high',
                        estimatedEffort: 'hours'
                    }
                ],
                timeline: '15-30 minutes',
                prediction: 'Memory usage will continue to increase',
                impact: 'high'
            };
        }
        return null;
    }
    calculateTrend(values) {
        if (values.length < 2) {
            return 0;
        }
        const n = values.length;
        const sumX = (n * (n - 1)) / 2;
        const sumY = values.reduce((sum, val) => sum + val, 0);
        const sumXY = values.reduce((sum, val, i) => sum + (i * val), 0);
        const sumXX = (n * (n - 1) * (2 * n - 1)) / 6;
        return (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
    }
    extractAffectedFiles(events) {
        const files = new Set();
        events.forEach(event => {
            if (event.metadata.filePath) {
                files.add(event.metadata.filePath);
            }
        });
        return Array.from(files);
    }
    generateRiskRecommendations(riskLevel, criticalFactors) {
        const recommendations = [];
        if (riskLevel === 'high') {
            recommendations.push('Immediate attention required');
            recommendations.push('Review system stability');
            recommendations.push('Consider rollback if recent changes');
        }
        if (criticalFactors.includes('Error Rate')) {
            recommendations.push('Investigate error patterns');
            recommendations.push('Review error logs');
        }
        if (criticalFactors.includes('Failure Rate')) {
            recommendations.push('Review test configurations');
            recommendations.push('Check dependency versions');
        }
        if (criticalFactors.includes('High Anomalies')) {
            recommendations.push('Investigate performance anomalies');
            recommendations.push('Monitor system resources');
        }
        return recommendations;
    }
    dispose() {
        this.models.clear();
        this.trainingData = [];
        this.removeAllListeners();
    }
}
exports.PredictiveAnalyticsEngine = PredictiveAnalyticsEngine;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2dyZWdkdW5uL3NyYy90ZXN0L2FpX2RlYnVnX2NvbnRleHQvdnNjb2RlL3NyYy9zZXJ2aWNlcy9hbmFseXRpY3MvZW5naW5lcy9wcmVkaWN0aXZlQW5hbHl0aWNzRW5naW5lLnRzIiwibWFwcGluZ3MiOiI7OztBQUFBLG1DQUFzQztBQVl0QyxNQUFhLHlCQUEwQixTQUFRLHFCQUFZO0lBQy9DLE1BQU0sQ0FBNkI7SUFDbkMsTUFBTSxHQUFpQyxJQUFJLEdBQUcsRUFBRSxDQUFDO0lBQ2pELFlBQVksR0FBcUIsRUFBRSxDQUFDO0lBRTVDLFlBQVksTUFBd0I7UUFDaEMsS0FBSyxFQUFFLENBQUM7UUFDUixJQUFJLENBQUMsTUFBTSxHQUFHO1lBQ1Ysc0JBQXNCLEVBQUUsSUFBSTtZQUM1QixzQkFBc0IsRUFBRSxJQUFJO1lBQzVCLG9CQUFvQixFQUFFLElBQUk7WUFDMUIsbUJBQW1CLEVBQUUsT0FBTyxFQUFFLFNBQVM7WUFDdkMsZ0JBQWdCLEVBQUUsR0FBRztZQUNyQixpQkFBaUIsRUFBRSxFQUFFLEVBQUUsV0FBVztZQUNsQyxtQkFBbUIsRUFBRSxHQUFHO1lBQ3hCLG1CQUFtQixFQUFFLEdBQUc7WUFDeEIsR0FBRyxNQUFNO1NBQ1osQ0FBQztRQUNGLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0lBQzVCLENBQUM7SUFFTyxnQkFBZ0I7UUFDcEIsNEJBQTRCO1FBQzVCLE1BQU0sYUFBYSxHQUFzQjtZQUNyQztnQkFDSSxFQUFFLEVBQUUsaUJBQWlCO2dCQUNyQixJQUFJLEVBQUUsNEJBQTRCO2dCQUNsQyxJQUFJLEVBQUUsZ0JBQWdCO2dCQUN0QixRQUFRLEVBQUUsSUFBSTtnQkFDZCxRQUFRLEVBQUUsSUFBSTtnQkFDZCxTQUFTLEVBQUUsSUFBSTtnQkFDZixNQUFNLEVBQUUsSUFBSTtnQkFDWixPQUFPLEVBQUUsSUFBSTtnQkFDYixXQUFXLEVBQUUsSUFBSSxJQUFJLEVBQUU7Z0JBQ3ZCLGdCQUFnQixFQUFFLENBQUM7YUFDdEI7WUFDRDtnQkFDSSxFQUFFLEVB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QixDQUFDLENBQUM7WUFDbkQsZUFBZSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1FBQzlDLENBQUM7UUFFRCxJQUFJLGVBQWUsQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLEVBQUUsQ0FBQztZQUMzQyxlQUFlLENBQUMsSUFBSSxDQUFDLDRCQUE0QixDQUFDLENBQUM7WUFDbkQsZUFBZSxDQUFDLElBQUksQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1FBQ3RELENBQUM7UUFFRCxJQUFJLGVBQWUsQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxDQUFDO1lBQzdDLGVBQWUsQ0FBQyxJQUFJLENBQUMsbUNBQW1DLENBQUMsQ0FBQztZQUMxRCxlQUFlLENBQUMsSUFBSSxDQUFDLDBCQUEwQixDQUFDLENBQUM7UUFDckQsQ0FBQztRQUVELE9BQU8sZUFBZSxDQUFDO0lBQzNCLENBQUM7SUFFTSxPQUFPO1FBQ1YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNwQixJQUFJLENBQUMsWUFBWSxHQUFHLEVBQUUsQ0FBQztRQUN2QixJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztJQUM5QixDQUFDO0NBQ0o7QUFuZEQsOERBbWRDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9ncmVnZHVubi9zcmMvdGVzdC9haV9kZWJ1Z19jb250ZXh0L3ZzY29kZS9zcmMvc2VydmljZXMvYW5hbHl0aWNzL2VuZ2luZXMvcHJlZGljdGl2ZUFuYWx5dGljc0VuZ2luZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdldmVudHMnO1xuaW1wb3J0IHsgXG4gICAgQW5hbHl0aWNzRXZlbnQsIFxuICAgIFByZWRpY3RpdmVDb25maWcsIFxuICAgIFByZWRpY3Rpb25SZXN1bHQsIFxuICAgIE1vZGVsTWV0cmljcywgXG4gICAgUmlza0Fzc2Vzc21lbnQsXG4gICAgQW5vbWFseURldGVjdGlvbixcbiAgICBGb3JlY2FzdFJlc3VsdCxcbiAgICBQcmVkaWN0aXZlTW9kZWxcbn0gZnJvbSAnLi4vLi4vLi4vdHlwZXMnO1xuXG5leHBvcnQgY2xhc3MgUHJlZGljdGl2ZUFuYWx5dGljc0VuZ2luZSBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG4gICAgcHJpdmF0ZSBjb25maWc6IFJlcXVpcmVkPFByZWRpY3RpdmVDb25maWc+O1xuICAgIHByaXZhdGUgbW9kZWxzOiBNYXA8c3RyaW5nLCBQcmVkaWN0aXZlTW9kZWw+ID0gbmV3IE1hcCgpO1xuICAgIHByaXZhdGUgdHJhaW5pbmdEYXRhOiBBbmFseXRpY3NFdmVudFtdID0gW107XG5cbiAgICBjb25zdHJ1Y3Rvcihjb25maWc6IFByZWRpY3RpdmVDb25maWcpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5jb25maWcgPSB7XG4gICAgICAgICAgICBlbmFibGVBbm9tYWx5RGV0ZWN0aW9uOiB0cnVlLFxuICAgICAgICAgICAgZW5hYmxlVHJlbmRGb3JlY2FzdGluZzogdHJ1ZSxcbiAgICAgICAgICAgIGVuYWJsZVJpc2tBc3Nlc3NtZW50OiB0cnVlLFxuICAgICAgICAgICAgbW9kZWxVcGRhdGVJbnRlcnZhbDogMzYwMDAwMCwgLy8gMSBob3VyXG4gICAgICAgICAgICBhbm9tYWx5VGhyZXNob2xkOiAyLjAsXG4gICAgICAgICAgICBwcmVkaWN0aW9uSG9yaXpvbjogMjQsIC8vIDI0IGhvdXJzXG4gICAgICAgICAgICBtaW5UcmFpbmluZ0RhdGFTaXplOiAxMDAsXG4gICAgICAgICAgICBjb25maWRlbmNlVGhyZXNob2xkOiAwLjcsXG4gICAgICAgICAgICAuLi5jb25maWdcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5pbml0aWFsaXplTW9kZWxzKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpbml0aWFsaXplTW9kZWxzKCk6IHZvaWQge1xuICAgICAgICAvLyBJbml0aWFsaXplIGRlZmF1bHQgbW9kZWxzXG4gICAgICAgIGNvbnN0IGRlZmF1bHRNb2RlbHM6IFByZWRpY3RpdmVNb2RlbFtdID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlkOiAnY29tbWFuZF9mYWlsdXJlJyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnQ29tbWFuZCBGYWlsdXJlIFByZWRpY3Rpb24nLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdjbGFzc2lmaWNhdGlvbicsXG4gICAgICAgICAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgICAgICAgICAgYWNjdXJhY3k6IDAuODUsXG4gICAgICAgICAgICAgICAgcHJlY2lzaW9uOiAwLjgyLFxuICAgICAgICAgICAgICAgIHJlY2FsbDogMC43OCxcbiAgICAgICAgICAgICAgICBmMVNjb3JlOiAwLjgwLFxuICAgICAgICAgICAgICAgIGxhc3RUcmFpbmVkOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgICAgIHRyYWluaW5nRGF0YVNpemU6IDBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWQ6ICdwZXJmb3JtYW5jZV9kZWdyYWRhdGlvbicsXG4gICAgICAgICAgICAgICAgbmFtZTogJ1BlcmZvcm1hbmNlIERlZ3JhZGF0aW9uIFByZWRpY3Rpb24nLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdyZWdyZXNzaW9uJyxcbiAgICAgICAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBhY2N1cmFjeTogMC43NSxcbiAgICAgICAgICAgICAgICBwcmVjaXNpb246IDAuNzMsXG4gICAgICAgICAgICAgICAgcmVjYWxsOiAwLjc3LFxuICAgICAgICAgICAgICAgIGYxU2NvcmU6IDAuNzUsXG4gICAgICAgICAgICAgICAgbGFzdFRyYWluZWQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICAgICAgdHJhaW5pbmdEYXRhU2l6ZTogMFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZDogJ3Jlc291cmNlX3V0aWxpemF0aW9uJyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnUmVzb3VyY2UgVXRpbGl6YXRpb24gUHJlZGljdGlvbicsXG4gICAgICAgICAgICAgICAgdHlwZTogJ3JlZ3Jlc3Npb24nLFxuICAgICAgICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICAgICAgICAgIGFjY3VyYWN5OiAwLjgwLFxuICAgICAgICAgICAgICAgIHByZWNpc2lvbjogMC43OCxcbiAgICAgICAgICAgICAgICByZWNhbGw6IDAuODIsXG4gICAgICAgICAgICAgICAgZjFTY29yZTogMC44MCxcbiAgICAgICAgICAgICAgICBsYXN0VHJhaW5lZDogbmV3IERhdGUoKSxcbiAgICAgICAgICAgICAgICB0cmFpbmluZ0RhdGFTaXplOiAwXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG5cbiAgICAgICAgZGVmYXVsdE1vZGVscy5mb3JFYWNoKG1vZGVsID0+IHRoaXMubW9kZWxzLnNldChtb2RlbC5pZCwgbW9kZWwpKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0QXZhaWxhYmxlTW9kZWxzKCk6IFByZWRpY3RpdmVNb2RlbFtdIHtcbiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5tb2RlbHMudmFsdWVzKCkpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyB0cmFpbk1vZGVscyhldmVudHM6IEFuYWx5dGljc0V2ZW50W10pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKGV2ZW50cy5sZW5ndGggPCB0aGlzLmNvbmZpZy5taW5UcmFpbmluZ0RhdGFTaXplKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEluc3VmZmljaWVudCB0cmFpbmluZyBkYXRhLiBSZXF1aXJlZDogJHt0aGlzLmNvbmZpZy5taW5UcmFpbmluZ0RhdGFTaXplfSwgcHJvdmlkZWQ6ICR7ZXZlbnRzLmxlbmd0aH1gKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudHJhaW5pbmdEYXRhID0gZXZlbnRzO1xuICAgICAgICBcbiAgICAgICAgLy8gVXBkYXRlIG1vZGVsIHRyYWluaW5nIG1ldHJpY3NcbiAgICAgICAgdGhpcy5tb2RlbHMuZm9yRWFjaChtb2RlbCA9PiB7XG4gICAgICAgICAgICBtb2RlbC5sYXN0VHJhaW5lZCA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICBtb2RlbC50cmFpbmluZ0RhdGFTaXplID0gZXZlbnRzLmxlbmd0aDtcbiAgICAgICAgICAgIC8vIEluIGEgcmVhbCBpbXBsZW1lbnRhdGlvbiwgdGhpcyB3b3VsZCB1cGRhdGUgYWN0dWFsIG1vZGVsIGFjY3VyYWN5XG4gICAgICAgICAgICBtb2RlbC5hY2N1cmFjeSA9IE1hdGgubWluKG1vZGVsLmFjY3VyYWN5ICsgMC4wMSwgMC45NSk7IC8vIFNpbXVsYXRlIGltcHJvdmVtZW50XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuZW1pdCgnbW9kZWxzVHJhaW5lZCcsIHsgbW9kZWxDb3VudDogdGhpcy5tb2RlbHMuc2l6ZSwgZGF0YVNpemU6IGV2ZW50cy5sZW5ndGggfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGdlbmVyYXRlUHJlZGljdGlvbnMoZXZlbnRzOiBBbmFseXRpY3NFdmVudFtdKTogUHJvbWlzZTxQcmVkaWN0aW9uUmVzdWx0W10+IHtcbiAgICAgICAgY29uc3QgcHJlZGljdGlvbnM6IFByZWRpY3Rpb25SZXN1bHRbXSA9IFtdO1xuXG4gICAgICAgIC8vIENvbW1hbmQgZmFpbHVyZSBwcmVkaWN0aW9uXG4gICAgICAgIGNvbnN0IGNvbW1hbmRGYWlsdXJlUHJlZGljdGlvbiA9IHRoaXMucHJlZGljdENvbW1hbmRGYWlsdXJlKGV2ZW50cyk7XG4gICAgICAgIGlmIChjb21tYW5kRmFpbHVyZVByZWRpY3Rpb24gJiYgKGNvbW1hbmRGYWlsdXJlUHJlZGljdGlvbi5jb25maWRlbmNlID8/IDApID49IHRoaXMuY29uZmlnLmNvbmZpZGVuY2VUaHJlc2hvbGQpIHtcbiAgICAgICAgICAgIHByZWRpY3Rpb25zLnB1c2goY29tbWFuZEZhaWx1cmVQcmVkaWN0aW9uKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFBlcmZvcm1hbmNlIGRlZ3JhZGF0aW9uIHByZWRpY3Rpb25cbiAgICAgICAgY29uc3QgcGVyZm9ybWFuY2VQcmVkaWN0aW9uID0gdGhpcy5wcmVkaWN0UGVyZm9ybWFuY2VEZWdyYWRhdGlvbihldmVudHMpO1xuICAgICAgICBpZiAocGVyZm9ybWFuY2VQcmVkaWN0aW9uICYmIChwZXJmb3JtYW5jZVByZWRpY3Rpb24uY29uZmlkZW5jZSA/PyAwKSA+PSB0aGlzLmNvbmZpZy5jb25maWRlbmNlVGhyZXNob2xkKSB7XG4gICAgICAgICAgICBwcmVkaWN0aW9ucy5wdXNoKHBlcmZvcm1hbmNlUHJlZGljdGlvbik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZXNvdXJjZSB1dGlsaXphdGlvbiBwcmVkaWN0aW9uXG4gICAgICAgIGNvbnN0IHJlc291cmNlUHJlZGljdGlvbiA9IHRoaXMucHJlZGljdFJlc291cmNlVXRpbGl6YXRpb24oZXZlbnRzKTtcbiAgICAgICAgaWYgKHJlc291cmNlUHJlZGljdGlvbiAmJiAocmVzb3VyY2VQcmVkaWN0aW9uLmNvbmZpZGVuY2UgPz8gMCkgPj0gdGhpcy5jb25maWcuY29uZmlkZW5jZVRocmVzaG9sZCkge1xuICAgICAgICAgICAgcHJlZGljdGlvbnMucHVzaChyZXNvdXJjZVByZWRpY3Rpb24pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHByZWRpY3Rpb25zO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBkZXRlY3RBbm9tYWxpZXMoZXZlbnRzOiBBbmFseXRpY3NFdmVudFtdKTogUHJvbWlzZTxBbm9tYWx5RGV0ZWN0aW9uW10+IHtcbiAgICAgICAgaWYgKCF0aGlzLmNvbmZpZy5lbmFibGVBbm9tYWx5RGV0ZWN0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBhbm9tYWxpZXM6IEFub21hbHlEZXRlY3Rpb25bXSA9IFtdO1xuICAgICAgICBcbiAgICAgICAgLy8gUGVyZm9ybWFuY2UgYW5vbWFseSBkZXRlY3Rpb25cbiAgICAgICAgY29uc3QgcGVyZm9ybWFuY2VFdmVudHMgPSBldmVudHMuZmlsdGVyKGUgPT4gZS50eXBlID09PSAncGVyZm9ybWFuY2VfbWV0cmljJyk7XG4gICAgICAgIGlmIChwZXJmb3JtYW5jZUV2ZW50cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBhdmdWYWx1ZSA9IHBlcmZvcm1hbmNlRXZlbnRzLnJlZHVjZSgoc3VtLCBlKSA9PiBzdW0gKyAoZS5tZXRhZGF0YS52YWx1ZSB8fCAwKSwgMCkgLyBwZXJmb3JtYW5jZUV2ZW50cy5sZW5ndGg7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHBlcmZvcm1hbmNlRXZlbnRzLmZvckVhY2goZXZlbnQgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZXZlbnQubWV0YWRhdGEudmFsdWUgfHwgMDtcbiAgICAgICAgICAgICAgICBjb25zdCBkZXZpYXRpb24gPSBNYXRoLmFicyh2YWx1ZSAtIGF2Z1ZhbHVlKSAvIGF2Z1ZhbHVlO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmIChkZXZpYXRpb24gPiAxLjApIHsgLy8gMTAwJSBkZXZpYXRpb24gdGhyZXNob2xkIC0gbW9yZSBzZW5zaXRpdmVcbiAgICAgICAgICAgICAgICAgICAgYW5vbWFsaWVzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGBhbm9tYWx5XyR7ZXZlbnQuaWR9YCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdwZXJmb3JtYW5jZScsXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXZlcml0eTogZGV2aWF0aW9uID4gMy4wID8gJ2hpZ2gnIDogJ21lZGl1bScsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXRlY3RlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQ6IGV2ZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGBQZXJmb3JtYW5jZSB2YWx1ZSAke3ZhbHVlfSBkZXZpYXRlcyBzaWduaWZpY2FudGx5IGZyb20gYXZlcmFnZSAke2F2Z1ZhbHVlLnRvRml4ZWQoMil9YCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZGVuY2U6IE1hdGgubWluKGRldmlhdGlvbiAvIDIsIDEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWZmZWN0ZWRNZXRyaWNzOiBbJ3BlcmZvcm1hbmNlJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICByZWNvbW1lbmRhdGlvbjogJ0ludmVzdGlnYXRlIHN5c3RlbSBwZXJmb3JtYW5jZSBhbmQgcmVzb3VyY2UgdXNhZ2UnXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGFub21hbGllcztcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgZ2VuZXJhdGVGb3JlY2FzdHMoXG4gICAgICAgIGV2ZW50czogQW5hbHl0aWNzRXZlbnRbXSwgXG4gICAgICAgIG1ldHJpY3M6IHN0cmluZ1tdLCBcbiAgICAgICAgaG9yaXpvbkhvdXJzOiBudW1iZXJcbiAgICApOiBQcm9taXNlPEZvcmVjYXN0UmVzdWx0W10+IHtcbiAgICAgICAgaWYgKCF0aGlzLmNvbmZpZy5lbmFibGVUcmVuZEZvcmVjYXN0aW5nKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBmb3JlY2FzdHM6IEZvcmVjYXN0UmVzdWx0W10gPSBbXTtcblxuICAgICAgICBtZXRyaWNzLmZvckVhY2gobWV0cmljID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlbGV2YW50RXZlbnRzID0gZXZlbnRzLmZpbHRlcihlID0+IGUubWV0YWRhdGFbbWV0cmljXSAhPT0gdW5kZWZpbmVkKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHJlbGV2YW50RXZlbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZXMgPSByZWxldmFudEV2ZW50cy5tYXAoZSA9PiBlLm1ldGFkYXRhW21ldHJpY10pO1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IHZhbHVlc1t2YWx1ZXMubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gU2ltcGxlIHRyZW5kIGFuYWx5c2lzXG4gICAgICAgICAgICAgICAgY29uc3QgdHJlbmQgPSB0aGlzLmNhbGN1bGF0ZVRyZW5kKHZhbHVlcyk7XG4gICAgICAgICAgICAgICAgY29uc3QgZm9yZWNhc3RWYWx1ZSA9IGN1cnJlbnRWYWx1ZSArICh0cmVuZCAqIGhvcml6b25Ib3Vycyk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgZm9yZWNhc3RzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBpZDogYGZvcmVjYXN0XyR7bWV0cmljfV8ke0RhdGUubm93KCl9YCxcbiAgICAgICAgICAgICAgICAgICAgbWV0cmljLFxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50VmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIGZvcmVjYXN0VmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZGVuY2U6IE1hdGgubWF4KDAuNSwgMSAtIChNYXRoLmFicyh0cmVuZCkgLyBjdXJyZW50VmFsdWUpKSxcbiAgICAgICAgICAgICAgICAgICAgaG9yaXpvbjogaG9yaXpvbkhvdXJzLFxuICAgICAgICAgICAgICAgICAgICB0aW1lSG9yaXpvbjogaG9yaXpvbkhvdXJzLFxuICAgICAgICAgICAgICAgICAgICB0cmVuZDogdHJlbmQgPiAwID8gJ2luY3JlYXNpbmcnIDogdHJlbmQgPCAwID8gJ2RlY3JlYXNpbmcnIDogJ3N0YWJsZScsXG4gICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgICAgICAgICBkYXRhUG9pbnRzOiByZWxldmFudEV2ZW50cy5sZW5ndGhcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGZvcmVjYXN0cztcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgYXNzZXNzUmlzayhldmVudHM6IEFuYWx5dGljc0V2ZW50W10pOiBQcm9taXNlPFJpc2tBc3Nlc3NtZW50PiB7XG4gICAgICAgIGlmICghdGhpcy5jb25maWcuZW5hYmxlUmlza0Fzc2Vzc21lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgb3ZlcmFsbFJpc2tTY29yZTogMCxcbiAgICAgICAgICAgICAgICByaXNrTGV2ZWw6ICdsb3cnLFxuICAgICAgICAgICAgICAgIGNyaXRpY2FsRmFjdG9yczogW10sXG4gICAgICAgICAgICAgICAgcmVjb21tZW5kYXRpb25zOiBbXSxcbiAgICAgICAgICAgICAgICBwcmVkaWN0aW9uczogW10sXG4gICAgICAgICAgICAgICAgYW5vbWFsaWVzOiBbXSxcbiAgICAgICAgICAgICAgICBhc3Nlc3NlZEF0OiBuZXcgRGF0ZSgpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcHJlZGljdGlvbnMgPSBhd2FpdCB0aGlzLmdlbmVyYXRlUHJlZGljdGlvbnMoZXZlbnRzKTtcbiAgICAgICAgY29uc3QgYW5vbWFsaWVzID0gYXdhaXQgdGhpcy5kZXRlY3RBbm9tYWxpZXMoZXZlbnRzKTtcblxuICAgICAgICAvLyBDYWxjdWxhdGUgcmlzayBmYWN0b3JzXG4gICAgICAgIGNvbnN0IGVycm9yUmF0ZSA9IGV2ZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT09ICdlcnJvcicpLmxlbmd0aCAvIGV2ZW50cy5sZW5ndGg7XG4gICAgICAgIGNvbnN0IGZhaWx1cmVSYXRlID0gZXZlbnRzLmZpbHRlcihlID0+IGUudHlwZSA9PT0gJ2NvbW1hbmRfZXhlY3V0ZWQnICYmICFlLm1ldGFkYXRhLnN1Y2Nlc3MpLmxlbmd0aCAvIGV2ZW50cy5sZW5ndGg7XG4gICAgICAgIGNvbnN0IGhpZ2hBbm9tYWx5ID0gYW5vbWFsaWVzLmZpbHRlcihhID0+IGEuc2V2ZXJpdHkgPT09ICdoaWdoJykubGVuZ3RoO1xuICAgICAgICBcbiAgICAgICAgY29uc3Qgcmlza0ZhY3RvcnMgPSBbXG4gICAgICAgICAgICB7IGZhY3RvcjogJ0Vycm9yIFJhdGUnLCB3ZWlnaHQ6IDAuMywgdmFsdWU6IGVycm9yUmF0ZSB9LFxuICAgICAgICAgICAgeyBmYWN0b3I6ICdGYWlsdXJlIFJhdGUnLCB3ZWlnaHQ6IDAuNCwgdmFsdWU6IGZhaWx1cmVSYXRlIH0sXG4gICAgICAgICAgICB7IGZhY3RvcjogJ0hpZ2ggQW5vbWFsaWVzJywgd2VpZ2h0OiAwLjMsIHZhbHVlOiBoaWdoQW5vbWFseSAvIDEwIH0gLy8gTm9ybWFsaXplXG4gICAgICAgIF07XG5cbiAgICAgICAgY29uc3Qgb3ZlcmFsbFJpc2tTY29yZSA9IHJpc2tGYWN0b3JzLnJlZHVjZSgoc3VtLCBmYWN0b3IpID0+IFxuICAgICAgICAgICAgc3VtICsgKGZhY3Rvci53ZWlnaHQgKiBmYWN0b3IudmFsdWUpLCAwXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3Qgcmlza0xldmVsID0gb3ZlcmFsbFJpc2tTY29yZSA+IDAuNyA/ICdoaWdoJyA6IFxuICAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJhbGxSaXNrU2NvcmUgPiAwLjQgPyAnbWVkaXVtJyA6ICdsb3cnO1xuXG4gICAgICAgIGNvbnN0IGNyaXRpY2FsRmFjdG9ycyA9IHJpc2tGYWN0b3JzXG4gICAgICAgICAgICAuZmlsdGVyKGZhY3RvciA9PiBmYWN0b3IudmFsdWUgPiAwLjUpXG4gICAgICAgICAgICAubWFwKGZhY3RvciA9PiBmYWN0b3IuZmFjdG9yKTtcblxuICAgICAgICBjb25zdCByZWNvbW1lbmRhdGlvbnMgPSB0aGlzLmdlbmVyYXRlUmlza1JlY29tbWVuZGF0aW9ucyhyaXNrTGV2ZWwsIGNyaXRpY2FsRmFjdG9ycyk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG92ZXJhbGxSaXNrU2NvcmUsXG4gICAgICAgICAgICByaXNrTGV2ZWwsXG4gICAgICAgICAgICBjcml0aWNhbEZhY3RvcnMsXG4gICAgICAgICAgICByZWNvbW1lbmRhdGlvbnMsXG4gICAgICAgICAgICBwcmVkaWN0aW9ucyxcbiAgICAgICAgICAgIGFub21hbGllcyxcbiAgICAgICAgICAgIGFzc2Vzc2VkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0TW9kZWxNZXRyaWNzKG1vZGVsSWQ6IHN0cmluZyk6IE1vZGVsTWV0cmljcyB7XG4gICAgICAgIGNvbnN0IG1vZGVsID0gdGhpcy5tb2RlbHMuZ2V0KG1vZGVsSWQpO1xuICAgICAgICBpZiAoIW1vZGVsKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE1vZGVsIG5vdCBmb3VuZDogJHttb2RlbElkfWApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGFjY3VyYWN5OiBtb2RlbC5hY2N1cmFjeSxcbiAgICAgICAgICAgIHByZWNpc2lvbjogbW9kZWwucHJlY2lzaW9uLFxuICAgICAgICAgICAgcmVjYWxsOiBtb2RlbC5yZWNhbGwsXG4gICAgICAgICAgICBmMVNjb3JlOiBtb2RlbC5mMVNjb3JlLFxuICAgICAgICAgICAgbGFzdFRyYWluZWQ6IG1vZGVsLmxhc3RUcmFpbmVkLFxuICAgICAgICAgICAgdHJhaW5pbmdEYXRhU2l6ZTogbW9kZWwudHJhaW5pbmdEYXRhU2l6ZVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHB1YmxpYyB0b2dnbGVNb2RlbChtb2RlbElkOiBzdHJpbmcsIGlzQWN0aXZlOiBib29sZWFuKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IG1vZGVsID0gdGhpcy5tb2RlbHMuZ2V0KG1vZGVsSWQpO1xuICAgICAgICBpZiAobW9kZWwpIHtcbiAgICAgICAgICAgIG1vZGVsLmlzQWN0aXZlID0gaXNBY3RpdmU7XG4gICAgICAgICAgICB0aGlzLmVtaXQoJ21vZGVsVG9nZ2xlZCcsIHsgbW9kZWxJZCwgaXNBY3RpdmUgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHByZWRpY3RDb21tYW5kRmFpbHVyZShldmVudHM6IEFuYWx5dGljc0V2ZW50W10pOiBQcmVkaWN0aW9uUmVzdWx0IHwgbnVsbCB7XG4gICAgICAgIGNvbnN0IGNvbW1hbmRFdmVudHMgPSBldmVudHMuZmlsdGVyKGUgPT4gZS50eXBlID09PSAnY29tbWFuZF9leGVjdXRlZCcpO1xuICAgICAgICBpZiAoY29tbWFuZEV2ZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZmFpbHVyZVJhdGUgPSBjb21tYW5kRXZlbnRzLmZpbHRlcihlID0+ICFlLm1ldGFkYXRhLnN1Y2Nlc3MpLmxlbmd0aCAvIGNvbW1hbmRFdmVudHMubGVuZ3RoO1xuICAgICAgICBcbiAgICAgICAgaWYgKGZhaWx1cmVSYXRlID4gMC4yNSkgeyAvLyAyNSUgZmFpbHVyZSByYXRlIHRocmVzaG9sZFxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAndGVzdC1mYWlsdXJlJyxcbiAgICAgICAgICAgICAgICBwcm9iYWJpbGl0eTogTWF0aC5taW4oZmFpbHVyZVJhdGUgKiAyLCAxKSxcbiAgICAgICAgICAgICAgICBjb25maWRlbmNlOiBNYXRoLm1pbihmYWlsdXJlUmF0ZSAqIDIsIDEpLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBgSGlnaCBjb21tYW5kIGZhaWx1cmUgcmF0ZSBkZXRlY3RlZDogJHsoZmFpbHVyZVJhdGUgKiAxMDApLnRvRml4ZWQoMSl9JWAsXG4gICAgICAgICAgICAgICAgYWZmZWN0ZWRGaWxlczogdGhpcy5leHRyYWN0QWZmZWN0ZWRGaWxlcyhjb21tYW5kRXZlbnRzKSxcbiAgICAgICAgICAgICAgICBwcmV2ZW50aW9uOiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAncmV2aWV3LWNvZGUtY2hhbmdlcycsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1JldmlldyByZWNlbnQgY29kZSBjaGFuZ2VzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnQ2hlY2sgcmVjZW50IGNvbW1pdHMgZm9yIHBvdGVudGlhbCBpc3N1ZXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiB7IHR5cGU6ICdjb21tYW5kJywgZGF0YTogeyBjb21tYW5kOiAnZ2l0IGxvZyAtLW9uZWxpbmUgLTEwJyB9IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBlc3RpbWF0ZWRJbXBhY3Q6ICdtZWRpdW0nLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXN0aW1hdGVkRWZmb3J0OiAnbWludXRlcydcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICdjaGVjay10ZXN0LWNvbmZpZycsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0NoZWNrIHRlc3QgY29uZmlndXJhdGlvbnMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdWZXJpZnkgdGVzdCBzZXR1cCBhbmQgY29uZmlndXJhdGlvbiBmaWxlcycsXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246IHsgdHlwZTogJ2ZpbGUtZWRpdCcsIGRhdGE6IHsgZmlsZTogJ2plc3QuY29uZmlnLmpzJyB9IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBlc3RpbWF0ZWRJbXBhY3Q6ICdtZWRpdW0nLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXN0aW1hdGVkRWZmb3J0OiAnbWludXRlcydcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICd2ZXJpZnktZGVwZW5kZW5jaWVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnVmVyaWZ5IGRlcGVuZGVuY2llcyBhcmUgdXAgdG8gZGF0ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0NoZWNrIHBhY2thZ2UuanNvbiBhbmQgdXBkYXRlIGRlcGVuZGVuY2llcycsXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246IHsgdHlwZTogJ2NvbW1hbmQnLCBkYXRhOiB7IGNvbW1hbmQ6ICducG0gYXVkaXQnIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVzdGltYXRlZEltcGFjdDogJ2hpZ2gnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXN0aW1hdGVkRWZmb3J0OiAnbWludXRlcydcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgdGltZWxpbmU6ICcxLTIgaG91cnMnLFxuICAgICAgICAgICAgICAgIHByZWRpY3Rpb246ICdDb21tYW5kIGZhaWx1cmVzIGxpa2VseSB0byBjb250aW51ZScsXG4gICAgICAgICAgICAgICAgaW1wYWN0OiAnaGlnaCdcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBwcml2YXRlIHByZWRpY3RQZXJmb3JtYW5jZURlZ3JhZGF0aW9uKGV2ZW50czogQW5hbHl0aWNzRXZlbnRbXSk6IFByZWRpY3Rpb25SZXN1bHQgfCBudWxsIHtcbiAgICAgICAgY29uc3QgcGVyZm9ybWFuY2VFdmVudHMgPSBldmVudHMuZmlsdGVyKGUgPT4gZS50eXBlID09PSAncGVyZm9ybWFuY2VfbWV0cmljJyk7XG4gICAgICAgIGlmIChwZXJmb3JtYW5jZUV2ZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXZnUmVzcG9uc2VUaW1lID0gcGVyZm9ybWFuY2VFdmVudHMucmVkdWNlKChzdW0sIGUpID0+IHN1bSArIChlLm1ldGFkYXRhLnJlc3BvbnNlVGltZSB8fCAwKSwgMCkgLyBwZXJmb3JtYW5jZUV2ZW50cy5sZW5ndGg7XG4gICAgICAgIFxuICAgICAgICBpZiAoYXZnUmVzcG9uc2VUaW1lID4gMjAwMCkgeyAvLyAyIHNlY29uZCB0aHJlc2hvbGRcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3BlcmZvcm1hbmNlLWRlZ3JhZGF0aW9uJyxcbiAgICAgICAgICAgICAgICBwcm9iYWJpbGl0eTogTWF0aC5taW4oYXZnUmVzcG9uc2VUaW1lIC8gMzAwMCwgMSksXG4gICAgICAgICAgICAgICAgY29uZmlkZW5jZTogTWF0aC5taW4oYXZnUmVzcG9uc2VUaW1lIC8gMzAwMCwgMSksXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGBQZXJmb3JtYW5jZSBkZWdyYWRhdGlvbiBkZXRlY3RlZDogJHthdmdSZXNwb25zZVRpbWUudG9GaXhlZCgwKX1tcyBhdmVyYWdlIHJlc3BvbnNlIHRpbWVgLFxuICAgICAgICAgICAgICAgIGFmZmVjdGVkRmlsZXM6IFtdLFxuICAgICAgICAgICAgICAgIHByZXZlbnRpb246IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICdvcHRpbWl6ZS1xdWVyaWVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnT3B0aW1pemUgZGF0YWJhc2UgcXVlcmllcycsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1JldmlldyBhbmQgb3B0aW1pemUgc2xvdyBkYXRhYmFzZSBxdWVyaWVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogeyB0eXBlOiAnY29tbWFuZCcsIGRhdGE6IHsgY29tbWFuZDogJ25wbSBydW4gYW5hbHl6ZS1xdWVyaWVzJyB9IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBlc3RpbWF0ZWRJbXBhY3Q6ICdoaWdoJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVzdGltYXRlZEVmZm9ydDogJ2hvdXJzJ1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogJ3Jldmlldy1yZXNvdXJjZXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdSZXZpZXcgcmVzb3VyY2UgYWxsb2NhdGlvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0NoZWNrIHN5c3RlbSByZXNvdXJjZSB1c2FnZSBhbmQgYWxsb2NhdGlvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246IHsgdHlwZTogJ2NvbW1hbmQnLCBkYXRhOiB7IGNvbW1hbmQ6ICd0b3AnIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVzdGltYXRlZEltcGFjdDogJ21lZGl1bScsXG4gICAgICAgICAgICAgICAgICAgICAgICBlc3RpbWF0ZWRFZmZvcnQ6ICdtaW51dGVzJ1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogJ2NoZWNrLW1lbW9yeS1sZWFrcycsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0NoZWNrIGZvciBtZW1vcnkgbGVha3MnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdSdW4gbWVtb3J5IHByb2ZpbGVyIHRvIGRldGVjdCBsZWFrcycsXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246IHsgdHlwZTogJ2NvbW1hbmQnLCBkYXRhOiB7IGNvbW1hbmQ6ICducG0gcnVuIHByb2ZpbGUnIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVzdGltYXRlZEltcGFjdDogJ2hpZ2gnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXN0aW1hdGVkRWZmb3J0OiAnaG91cnMnXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIHRpbWVsaW5lOiAnMzAtNjAgbWludXRlcycsXG4gICAgICAgICAgICAgICAgcHJlZGljdGlvbjogJ1BlcmZvcm1hbmNlIHdpbGwgY29udGludWUgdG8gZGVncmFkZScsXG4gICAgICAgICAgICAgICAgaW1wYWN0OiAnbWVkaXVtJ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHByaXZhdGUgcHJlZGljdFJlc291cmNlVXRpbGl6YXRpb24oZXZlbnRzOiBBbmFseXRpY3NFdmVudFtdKTogUHJlZGljdGlvblJlc3VsdCB8IG51bGwge1xuICAgICAgICBjb25zdCByZXNvdXJjZUV2ZW50cyA9IGV2ZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT09ICdyZXNvdXJjZV91c2FnZScpO1xuICAgICAgICBpZiAocmVzb3VyY2VFdmVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGF2Z01lbW9yeSA9IHJlc291cmNlRXZlbnRzLnJlZHVjZSgoc3VtLCBlKSA9PiBzdW0gKyAoZS5tZXRhZGF0YS5tZW1vcnlVc2FnZSB8fCAwKSwgMCkgLyByZXNvdXJjZUV2ZW50cy5sZW5ndGg7XG4gICAgICAgIFxuICAgICAgICBpZiAoYXZnTWVtb3J5ID4gODUpIHsgLy8gODUlIG1lbW9yeSB1c2FnZSB0aHJlc2hvbGRcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3NlY3VyaXR5LWlzc3VlJyxcbiAgICAgICAgICAgICAgICBwcm9iYWJpbGl0eTogTWF0aC5taW4oYXZnTWVtb3J5IC8gMTAwLCAxKSxcbiAgICAgICAgICAgICAgICBjb25maWRlbmNlOiBNYXRoLm1pbihhdmdNZW1vcnkgLyAxMDAsIDEpLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBgSGlnaCBtZW1vcnkgdXNhZ2UgZGV0ZWN0ZWQ6ICR7YXZnTWVtb3J5LnRvRml4ZWQoMSl9JWAsXG4gICAgICAgICAgICAgICAgYWZmZWN0ZWRGaWxlczogW10sXG4gICAgICAgICAgICAgICAgcHJldmVudGlvbjogW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogJ3Jldmlldy1tZW1vcnktcGF0dGVybnMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdSZXZpZXcgbWVtb3J5IHVzYWdlIHBhdHRlcm5zJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnQW5hbHl6ZSBtZW1vcnkgdXNhZ2UgcGF0dGVybnMgYW5kIG9wdGltaXplJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogeyB0eXBlOiAnY29tbWFuZCcsIGRhdGE6IHsgY29tbWFuZDogJ25wbSBydW4gbWVtb3J5LWFuYWx5c2lzJyB9IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBlc3RpbWF0ZWRJbXBhY3Q6ICdoaWdoJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVzdGltYXRlZEVmZm9ydDogJ2hvdXJzJ1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogJ29wdGltaXplLWRhdGEtc3RydWN0dXJlcycsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ09wdGltaXplIGRhdGEgc3RydWN0dXJlcycsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1JldmlldyBhbmQgb3B0aW1pemUgZGF0YSBzdHJ1Y3R1cmVzIGZvciBtZW1vcnkgZWZmaWNpZW5jeScsXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246IHsgdHlwZTogJ2ZpbGUtZWRpdCcsIGRhdGE6IHsgcGF0dGVybjogJyoqLyoudHMnIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVzdGltYXRlZEltcGFjdDogJ21lZGl1bScsXG4gICAgICAgICAgICAgICAgICAgICAgICBlc3RpbWF0ZWRFZmZvcnQ6ICdob3VycydcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICdjaGVjay1yZXNvdXJjZS1sZWFrcycsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0NoZWNrIGZvciByZXNvdXJjZSBsZWFrcycsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1NjYW4gZm9yIHJlc291cmNlIGxlYWtzIGFuZCBtZW1vcnkgcmV0ZW50aW9uIGlzc3VlcycsXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246IHsgdHlwZTogJ2NvbW1hbmQnLCBkYXRhOiB7IGNvbW1hbmQ6ICducG0gcnVuIGxlYWstZGV0ZWN0aW9uJyB9IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBlc3RpbWF0ZWRJbXBhY3Q6ICdoaWdoJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVzdGltYXRlZEVmZm9ydDogJ2hvdXJzJ1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICB0aW1lbGluZTogJzE1LTMwIG1pbnV0ZXMnLFxuICAgICAgICAgICAgICAgIHByZWRpY3Rpb246ICdNZW1vcnkgdXNhZ2Ugd2lsbCBjb250aW51ZSB0byBpbmNyZWFzZScsXG4gICAgICAgICAgICAgICAgaW1wYWN0OiAnaGlnaCdcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNhbGN1bGF0ZVRyZW5kKHZhbHVlczogbnVtYmVyW10pOiBudW1iZXIge1xuICAgICAgICBpZiAodmFsdWVzLmxlbmd0aCA8IDIpIHtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCBuID0gdmFsdWVzLmxlbmd0aDtcbiAgICAgICAgY29uc3Qgc3VtWCA9IChuICogKG4gLSAxKSkgLyAyO1xuICAgICAgICBjb25zdCBzdW1ZID0gdmFsdWVzLnJlZHVjZSgoc3VtLCB2YWwpID0+IHN1bSArIHZhbCwgMCk7XG4gICAgICAgIGNvbnN0IHN1bVhZID0gdmFsdWVzLnJlZHVjZSgoc3VtLCB2YWwsIGkpID0+IHN1bSArIChpICogdmFsKSwgMCk7XG4gICAgICAgIGNvbnN0IHN1bVhYID0gKG4gKiAobiAtIDEpICogKDIgKiBuIC0gMSkpIC8gNjtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiAobiAqIHN1bVhZIC0gc3VtWCAqIHN1bVkpIC8gKG4gKiBzdW1YWCAtIHN1bVggKiBzdW1YKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGV4dHJhY3RBZmZlY3RlZEZpbGVzKGV2ZW50czogQW5hbHl0aWNzRXZlbnRbXSk6IHN0cmluZ1tdIHtcbiAgICAgICAgY29uc3QgZmlsZXMgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgICAgICAgZXZlbnRzLmZvckVhY2goZXZlbnQgPT4ge1xuICAgICAgICAgICAgaWYgKGV2ZW50Lm1ldGFkYXRhLmZpbGVQYXRoKSB7XG4gICAgICAgICAgICAgICAgZmlsZXMuYWRkKGV2ZW50Lm1ldGFkYXRhLmZpbGVQYXRoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKGZpbGVzKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdlbmVyYXRlUmlza1JlY29tbWVuZGF0aW9ucyhyaXNrTGV2ZWw6IHN0cmluZywgY3JpdGljYWxGYWN0b3JzOiBzdHJpbmdbXSk6IHN0cmluZ1tdIHtcbiAgICAgICAgY29uc3QgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgICAgIGlmIChyaXNrTGV2ZWwgPT09ICdoaWdoJykge1xuICAgICAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0ltbWVkaWF0ZSBhdHRlbnRpb24gcmVxdWlyZWQnKTtcbiAgICAgICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdSZXZpZXcgc3lzdGVtIHN0YWJpbGl0eScpO1xuICAgICAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0NvbnNpZGVyIHJvbGxiYWNrIGlmIHJlY2VudCBjaGFuZ2VzJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY3JpdGljYWxGYWN0b3JzLmluY2x1ZGVzKCdFcnJvciBSYXRlJykpIHtcbiAgICAgICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdJbnZlc3RpZ2F0ZSBlcnJvciBwYXR0ZXJucycpO1xuICAgICAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ1JldmlldyBlcnJvciBsb2dzJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY3JpdGljYWxGYWN0b3JzLmluY2x1ZGVzKCdGYWlsdXJlIFJhdGUnKSkge1xuICAgICAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ1JldmlldyB0ZXN0IGNvbmZpZ3VyYXRpb25zJyk7XG4gICAgICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnQ2hlY2sgZGVwZW5kZW5jeSB2ZXJzaW9ucycpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNyaXRpY2FsRmFjdG9ycy5pbmNsdWRlcygnSGlnaCBBbm9tYWxpZXMnKSkge1xuICAgICAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0ludmVzdGlnYXRlIHBlcmZvcm1hbmNlIGFub21hbGllcycpO1xuICAgICAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ01vbml0b3Igc3lzdGVtIHJlc291cmNlcycpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlY29tbWVuZGF0aW9ucztcbiAgICB9XG5cbiAgICBwdWJsaWMgZGlzcG9zZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5tb2RlbHMuY2xlYXIoKTtcbiAgICAgICAgdGhpcy50cmFpbmluZ0RhdGEgPSBbXTtcbiAgICAgICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoKTtcbiAgICB9XG59XG4iXSwidmVyc2lvbiI6M30=