e81288f7cef98bda3a002c4f43367ee7
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
// Mock fs module
jest.mock('fs');
jest.mock('path');
jest.mock('vscode', () => mockVscode);
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
// Mock vscode module
const mockVscode = {
    workspace: {
        workspaceFolders: [
            { uri: { fsPath: '/test/workspace' } }
        ]
    },
    window: {
        activeTextEditor: null
    }
};
// Import after mocking
const projectDetector_1 = require("../projectDetector");
const mockedFs = jest.mocked(fs);
const mockedPath = jest.mocked(path);
describe('ProjectDetector', () => {
    let projectDetector;
    beforeEach(() => {
        jest.clearAllMocks();
        projectDetector = new projectDetector_1.ProjectDetector('/test/workspace');
        // Setup path mocks
        mockedPath.join.mockImplementation((...segments) => segments.join('/'));
        mockedPath.basename.mockImplementation((p) => p.split('/').pop() || '');
        mockedPath.relative.mockImplementation((from, to) => to.replace(from, '').replace(/^\//, ''));
    });
    describe('findNxWorkspace', () => {
        it('should find nx.json workspace', async () => {
            mockedFs.existsSync.mockImplementation((filePath) => {
                return filePath === '/test/workspace/nx.json';
            });
            const result = await projectDetector.findNxWorkspace();
            expect(result).toBe('/test/workspace/nx.json');
        });
        it('should find angular.json workspace', async () => {
            mockedFs.existsSync.mockImplementation((filePath) => {
                return filePath === '/test/workspace/angular.json';
            });
            const result = await projectDetector.findNxWorkspace();
            expect(result).toBe('/test/workspace/angular.json');
        });
        it('should return null if no workspace config found', async () => {
            mockedFs.existsSync.mockReturnValue(false);
            const result = await projectDetector.findNxWorkspace();
            expect(result).toBeNull();
        });
        it('should handle errors gracefully', async () => {
            mockedFs.existsSync.mockImplementation(() => {
                throw new Error('File system error');
            });
            const result = await projectDetector.findNxWorkspace();
            expect(result).toBeNull();
        });
    });
    describe('getProjects', () => {
        it('should parse NX workspace with project.json files', async () => {
            // Mock file system to simulate empty project detection
            mockedFs.existsSync.mockReturnValue(false);
            mockedFs.readdirSync.mockReturnValue([]);
            mockedFs.statSync.mockReturnValue({});
            const projects = await projectDetector.getProjects();
            // Should return empty array when no projects are found
            expect(projects).toHaveLength(0);
        });
        it('should parse Angular workspace format', async () => {
            const angularConfig = {
                projects: {
                    'my-app': {
                        root: 'projects/my-app',
                        projectType: 'application',
                        architect: {
                            build: {},
                            test: {}
                        }
                    }
                }
            };
            mockedFs.existsSync.mockImplementation((filePath) => {
                return filePath === '/test/workspace/angular.json';
            });
            mockedFs.readFileSync.mockReturnValue(JSON.stringify(angularConfig));
            mockedFs.readdirSync.mockReturnValue([]);
            mockedFs.statSync.mockReturnValue({});
            const projects = await projectDetector.getProjects();
            expect(projects).toHaveLength(1);
            expect(projects[0]).toMatchObject({
                name: 'my-app',
                type: 'angular',
                projectType: 'application',
                targets: { build: {}, test: {} }
            });
        });
        it('should handle inline project configurations', async () => {
            const nxConfig = {
                projects: {
                    'inline-project': {
                        root: 'apps/inline',
                        projectType: 'application',
                        targets: { build: {} }
                    }
                }
            };
            mockedFs.existsSync.mockImplementation((filePath) => {
                return filePath === '/test/workspace/nx.json';
            });
            mockedFs.readFileSync.mockReturnValue(JSON.stringify(nxConfig));
            mockedFs.readdirSync.mockReturnValue([]);
            mockedFs.statSync.mockReturnValue({});
            const projects = await projectDetector.getProjects();
            expect(projects).toHaveLength(1);
            expect(projects[0]).toMatchObject({
                name: 'inline-project',
                type: 'nx',
                projectType: 'application'
            });
        });
        it('should return empty array when no config found', async () => {
            mockedFs.existsSync.mockReturnValue(false);
            mockedFs.readdirSync.mockReturnValue([]);
            mockedFs.statSync.mockReturnValue({});
            const projects = await projectDetector.getProjects();
            expect(projects).toEqual([]);
        });
        it('should handle JSON parsing errors', async () => {
            mockedFs.existsSync.mockReturnValue(true);
            mockedFs.readFileSync.mockReturnValue('invalid json');
            mockedFs.readdirSync.mockReturnValue([]);
            mockedFs.statSync.mockReturnValue({});
            const projects = await projectDetector.getProjects();
            expect(projects).toEqual([]);
        });
    });
    describe('detectCurrentProject', () => {
        it('should detect project from active file path', async () => {
            const mockProjects = [
                { name: 'my-app', root: 'apps/my-app', projectType: 'application', type: 'nx', packageJsonPath: 'apps/my-app/package.json' },
                { name: 'my-lib', root: 'libs/my-lib', projectType: 'library', type: 'nx', packageJsonPath: 'libs/my-lib/package.json' }
            ];
            jest.spyOn(projectDetector, 'getProjects').mockResolvedValue(mockProjects);
            // Mock vscode window.activeTextEditor
            mockVscode.window.activeTextEditor = {
                document: {
                    uri: {
                        fsPath: '/test/workspace/apps/my-app/src/main.ts'
                    }
                }
            };
            mockedPath.relative.mockReturnValue('apps/my-app/src/main.ts');
            const currentProject = await projectDetector.detectCurrentProject();
            expect(currentProject).toBe('my-app');
        });
        it('should return null when no active editor', async () => {
            mockVscode.window.activeTextEditor = null;
            const currentProject = await projectDetector.detectCurrentProject();
            expect(currentProject).toBeNull();
        });
        it('should return null when file is not in any project', async () => {
            const mockProjects = [
                { name: 'my-app', root: 'apps/my-app', projectType: 'application', type: 'nx', packageJsonPath: 'apps/my-app/package.json' }
            ];
            jest.spyOn(projectDetector, 'getProjects').mockResolvedValue(mockProjects);
            mockVscode.window.activeTextEditor = {
                document: {
                    uri: {
                        fsPath: '/test/workspace/other/file.ts'
                    }
                }
            };
            mockedPath.relative.mockReturnValue('other/file.ts');
            const currentProject = await projectDetector.detectCurrentProject();
            expect(currentProject).toBeNull();
        });
    });
    describe('getProject', () => {
        it('should return project by name', async () => {
            const mockProjects = [
                { name: 'my-app', root: 'apps/my-app', projectType: 'application', type: 'nx', packageJsonPath: 'apps/my-app/package.json' },
                { name: 'my-lib', root: 'libs/my-lib', projectType: 'library', type: 'nx', packageJsonPath: 'libs/my-lib/package.json' }
            ];
            jest.spyOn(projectDetector, 'getProjects').mockResolvedValue(mockProjects);
            const project = await projectDetector.getProject('my-lib');
            expect(project).toEqual(mockProjects[1]);
        });
        it('should return null for non-existent project', async () => {
            jest.spyOn(projectDetector, 'getProjects').mockResolvedValue([]);
            const project = await projectDetector.getProject('non-existent');
            expect(project).toBeNull();
        });
    });
    describe('hasTarget', () => {
        it('should return true when project has target', async () => {
            const mockProject = {
                name: 'my-app',
                root: 'apps/my-app',
                projectType: 'application',
                type: 'nx',
                packageJsonPath: 'apps/my-app/package.json',
                targets: { build: {}, test: {} }
            };
            jest.spyOn(projectDetector, 'getProject').mockResolvedValue(mockProject);
            const hasTarget = await projectDetector.hasTarget('my-app', 'build');
            expect(hasTarget).toBe(true);
        });
        it('should return false when project does not have target', async () => {
            const mockProject = {
                name: 'my-app',
                root: 'apps/my-app',
                projectType: 'application',
                type: 'nx',
                packageJsonPath: 'apps/my-app/package.json',
                targets: { build: {} }
            };
            jest.spyOn(projectDetector, 'getProject').mockResolvedValue(mockProject);
            const hasTarget = await projectDetector.hasTarget('my-app', 'test');
            expect(hasTarget).toBe(false);
        });
        it('should return false when project not found', async () => {
            jest.spyOn(projectDetector, 'getProject').mockResolvedValue(null);
            const hasTarget = await projectDetector.hasTarget('non-existent', 'build');
            expect(hasTarget).toBe(false);
        });
        it('should return false when project has no targets', async () => {
            const mockProject = {
                name: 'my-app',
                root: 'apps/my-app',
                projectType: 'application',
                type: 'nx',
                packageJsonPath: 'apps/my-app/package.json'
            };
            jest.spyOn(projectDetector, 'getProject').mockResolvedValue(mockProject);
            const hasTarget = await projectDetector.hasTarget('my-app', 'build');
            expect(hasTarget).toBe(false);
        });
    });
    describe('getWorkspaceRoot', () => {
        it('should return workspace root directory', () => {
            const root = projectDetector.getWorkspaceRoot();
            expect(root).toBe('/test/workspace');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2dyZWdkdW5uL3NyYy90ZXN0L2FpX2RlYnVnX2NvbnRleHQvdnNjb2RlL3NyYy91dGlscy9fX3Rlc3RzX18vcHJvamVjdERldGVjdG9yLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFHQSxpQkFBaUI7QUFDakIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNoQixJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBY2xCLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBbkJ0Qyx1Q0FBeUI7QUFDekIsMkNBQTZCO0FBTTdCLHFCQUFxQjtBQUNyQixNQUFNLFVBQVUsR0FBRztJQUNqQixTQUFTLEVBQUU7UUFDVCxnQkFBZ0IsRUFBRTtZQUNoQixFQUFFLEdBQUcsRUFBRSxFQUFFLE1BQU0sRUFBRSxpQkFBaUIsRUFBRSxFQUFFO1NBQ3ZDO0tBQ0Y7SUFDRCxNQUFNLEVBQUU7UUFDTixnQkFBZ0IsRUFBRSxJQUFJO0tBQ3ZCO0NBQ0YsQ0FBQztBQUlGLHVCQUF1QjtBQUN2Qix3REFBcUQ7QUFFckQsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUNqQyxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBRXJDLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUU7SUFDL0IsSUFBSSxlQUFnQyxDQUFDO0lBRXJDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDckIsZUFBZSxHQUFHLElBQUksaUNBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBRXpELG1CQUFtQjtRQUNuQixVQUFVLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUMsR0FBRyxRQUFRLEVBQUUsRUFBRSxD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TSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNoQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtRQUNoQyxFQUFFLENBQUMsd0NBQXdDLEVBQUUsR0FBRyxFQUFFO1lBQ2hELE1BQU0sSUFBSSxHQUFHLGVBQWUsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1lBQ2hELE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUN2QyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2dyZWdkdW5uL3NyYy90ZXN0L2FpX2RlYnVnX2NvbnRleHQvdnNjb2RlL3NyYy91dGlscy9fX3Rlc3RzX18vcHJvamVjdERldGVjdG9yLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcblxuLy8gTW9jayBmcyBtb2R1bGVcbmplc3QubW9jaygnZnMnKTtcbmplc3QubW9jaygncGF0aCcpO1xuXG4vLyBNb2NrIHZzY29kZSBtb2R1bGVcbmNvbnN0IG1vY2tWc2NvZGUgPSB7XG4gIHdvcmtzcGFjZToge1xuICAgIHdvcmtzcGFjZUZvbGRlcnM6IFtcbiAgICAgIHsgdXJpOiB7IGZzUGF0aDogJy90ZXN0L3dvcmtzcGFjZScgfSB9XG4gICAgXVxuICB9LFxuICB3aW5kb3c6IHtcbiAgICBhY3RpdmVUZXh0RWRpdG9yOiBudWxsXG4gIH1cbn07XG5cbmplc3QubW9jaygndnNjb2RlJywgKCkgPT4gbW9ja1ZzY29kZSk7XG5cbi8vIEltcG9ydCBhZnRlciBtb2NraW5nXG5pbXBvcnQgeyBQcm9qZWN0RGV0ZWN0b3IgfSBmcm9tICcuLi9wcm9qZWN0RGV0ZWN0b3InO1xuXG5jb25zdCBtb2NrZWRGcyA9IGplc3QubW9ja2VkKGZzKTtcbmNvbnN0IG1vY2tlZFBhdGggPSBqZXN0Lm1vY2tlZChwYXRoKTtcblxuZGVzY3JpYmUoJ1Byb2plY3REZXRlY3RvcicsICgpID0+IHtcbiAgbGV0IHByb2plY3REZXRlY3RvcjogUHJvamVjdERldGVjdG9yO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIHByb2plY3REZXRlY3RvciA9IG5ldyBQcm9qZWN0RGV0ZWN0b3IoJy90ZXN0L3dvcmtzcGFjZScpO1xuICAgIFxuICAgIC8vIFNldHVwIHBhdGggbW9ja3NcbiAgICBtb2NrZWRQYXRoLmpvaW4ubW9ja0ltcGxlbWVudGF0aW9uKCguLi5zZWdtZW50cykgPT4gc2VnbWVudHMuam9pbignLycpKTtcbiAgICBtb2NrZWRQYXRoLmJhc2VuYW1lLm1vY2tJbXBsZW1lbnRhdGlvbigocCkgPT4gcC5zcGxpdCgnLycpLnBvcCgpIHx8ICcnKTtcbiAgICBtb2NrZWRQYXRoLnJlbGF0aXZlLm1vY2tJbXBsZW1lbnRhdGlvbigoZnJvbSwgdG8pID0+IHRvLnJlcGxhY2UoZnJvbSwgJycpLnJlcGxhY2UoL15cXC8vLCAnJykpO1xuICB9KTtcblxuICBkZXNjcmliZSgnZmluZE54V29ya3NwYWNlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZmluZCBueC5qc29uIHdvcmtzcGFjZScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tlZEZzLmV4aXN0c1N5bmMubW9ja0ltcGxlbWVudGF0aW9uKChmaWxlUGF0aCkgPT4ge1xuICAgICAgICByZXR1cm4gZmlsZVBhdGggPT09ICcvdGVzdC93b3Jrc3BhY2UvbnguanNvbic7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcHJvamVjdERldGVjdG9yLmZpbmROeFdvcmtzcGFjZSgpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgnL3Rlc3Qvd29ya3NwYWNlL254Lmpzb24nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmluZCBhbmd1bGFyLmpzb24gd29ya3NwYWNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja2VkRnMuZXhpc3RzU3luYy5tb2NrSW1wbGVtZW50YXRpb24oKGZpbGVQYXRoKSA9PiB7XG4gICAgICAgIHJldHVybiBmaWxlUGF0aCA9PT0gJy90ZXN0L3dvcmtzcGFjZS9hbmd1bGFyLmpzb24nO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHByb2plY3REZXRlY3Rvci5maW5kTnhXb3Jrc3BhY2UoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJy90ZXN0L3dvcmtzcGFjZS9hbmd1bGFyLmpzb24nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgaWYgbm8gd29ya3NwYWNlIGNvbmZpZyBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tlZEZzLmV4aXN0c1N5bmMubW9ja1JldHVyblZhbHVlKGZhbHNlKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcHJvamVjdERldGVjdG9yLmZpbmROeFdvcmtzcGFjZSgpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja2VkRnMuZXhpc3RzU3luYy5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZpbGUgc3lzdGVtIGVycm9yJyk7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcHJvamVjdERldGVjdG9yLmZpbmROeFdvcmtzcGFjZSgpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFByb2plY3RzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcGFyc2UgTlggd29ya3NwYWNlIHdpdGggcHJvamVjdC5qc29uIGZpbGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gTW9jayBmaWxlIHN5c3RlbSB0byBzaW11bGF0ZSBlbXB0eSBwcm9qZWN0IGRldGVjdGlvblxuICAgICAgbW9ja2VkRnMuZXhpc3RzU3luYy5tb2NrUmV0dXJuVmFsdWUoZmFsc2UpO1xuICAgICAgKG1vY2tlZEZzLnJlYWRkaXJTeW5jIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKFtdKTtcbiAgICAgIChtb2NrZWRGcy5zdGF0U3luYyBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSh7fSk7XG5cbiAgICAgIGNvbnN0IHByb2plY3RzID0gYXdhaXQgcHJvamVjdERldGVjdG9yLmdldFByb2plY3RzKCk7XG5cbiAgICAgIC8vIFNob3VsZCByZXR1cm4gZW1wdHkgYXJyYXkgd2hlbiBubyBwcm9qZWN0cyBhcmUgZm91bmRcbiAgICAgIGV4cGVjdChwcm9qZWN0cykudG9IYXZlTGVuZ3RoKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwYXJzZSBBbmd1bGFyIHdvcmtzcGFjZSBmb3JtYXQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhbmd1bGFyQ29uZmlnID0ge1xuICAgICAgICBwcm9qZWN0czoge1xuICAgICAgICAgICdteS1hcHAnOiB7XG4gICAgICAgICAgICByb290OiAncHJvamVjdHMvbXktYXBwJyxcbiAgICAgICAgICAgIHByb2plY3RUeXBlOiAnYXBwbGljYXRpb24nLFxuICAgICAgICAgICAgYXJjaGl0ZWN0OiB7XG4gICAgICAgICAgICAgIGJ1aWxkOiB7fSxcbiAgICAgICAgICAgICAgdGVzdDoge31cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIG1vY2tlZEZzLmV4aXN0c1N5bmMubW9ja0ltcGxlbWVudGF0aW9uKChmaWxlUGF0aCkgPT4ge1xuICAgICAgICByZXR1cm4gZmlsZVBhdGggPT09ICcvdGVzdC93b3Jrc3BhY2UvYW5ndWxhci5qc29uJztcbiAgICAgIH0pO1xuICAgICAgbW9ja2VkRnMucmVhZEZpbGVTeW5jLm1vY2tSZXR1cm5WYWx1ZShKU09OLnN0cmluZ2lmeShhbmd1bGFyQ29uZmlnKSk7XG4gICAgICAobW9ja2VkRnMucmVhZGRpclN5bmMgYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUoW10pO1xuICAgICAgKG1vY2tlZEZzLnN0YXRTeW5jIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKHt9KTtcblxuICAgICAgY29uc3QgcHJvamVjdHMgPSBhd2FpdCBwcm9qZWN0RGV0ZWN0b3IuZ2V0UHJvamVjdHMoKTtcblxuICAgICAgZXhwZWN0KHByb2plY3RzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QocHJvamVjdHNbMF0pLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICBuYW1lOiAnbXktYXBwJyxcbiAgICAgICAgdHlwZTogJ2FuZ3VsYXInLFxuICAgICAgICBwcm9qZWN0VHlwZTogJ2FwcGxpY2F0aW9uJyxcbiAgICAgICAgdGFyZ2V0czogeyBidWlsZDoge30sIHRlc3Q6IHt9IH1cbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgaW5saW5lIHByb2plY3QgY29uZmlndXJhdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBueENvbmZpZyA9IHtcbiAgICAgICAgcHJvamVjdHM6IHtcbiAgICAgICAgICAnaW5saW5lLXByb2plY3QnOiB7XG4gICAgICAgICAgICByb290OiAnYXBwcy9pbmxpbmUnLFxuICAgICAgICAgICAgcHJvamVjdFR5cGU6ICdhcHBsaWNhdGlvbicsXG4gICAgICAgICAgICB0YXJnZXRzOiB7IGJ1aWxkOiB7fSB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBtb2NrZWRGcy5leGlzdHNTeW5jLm1vY2tJbXBsZW1lbnRhdGlvbigoZmlsZVBhdGgpID0+IHtcbiAgICAgICAgcmV0dXJuIGZpbGVQYXRoID09PSAnL3Rlc3Qvd29ya3NwYWNlL254Lmpzb24nO1xuICAgICAgfSk7XG4gICAgICBtb2NrZWRGcy5yZWFkRmlsZVN5bmMubW9ja1JldHVyblZhbHVlKEpTT04uc3RyaW5naWZ5KG54Q29uZmlnKSk7XG4gICAgICAobW9ja2VkRnMucmVhZGRpclN5bmMgYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUoW10pO1xuICAgICAgKG1vY2tlZEZzLnN0YXRTeW5jIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKHt9KTtcblxuICAgICAgY29uc3QgcHJvamVjdHMgPSBhd2FpdCBwcm9qZWN0RGV0ZWN0b3IuZ2V0UHJvamVjdHMoKTtcblxuICAgICAgZXhwZWN0KHByb2plY3RzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QocHJvamVjdHNbMF0pLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICBuYW1lOiAnaW5saW5lLXByb2plY3QnLFxuICAgICAgICB0eXBlOiAnbngnLFxuICAgICAgICBwcm9qZWN0VHlwZTogJ2FwcGxpY2F0aW9uJ1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBlbXB0eSBhcnJheSB3aGVuIG5vIGNvbmZpZyBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tlZEZzLmV4aXN0c1N5bmMubW9ja1JldHVyblZhbHVlKGZhbHNlKTtcbiAgICAgIChtb2NrZWRGcy5yZWFkZGlyU3luYyBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZShbXSk7XG4gICAgICAobW9ja2VkRnMuc3RhdFN5bmMgYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUoe30pO1xuXG4gICAgICBjb25zdCBwcm9qZWN0cyA9IGF3YWl0IHByb2plY3REZXRlY3Rvci5nZXRQcm9qZWN0cygpO1xuICAgICAgZXhwZWN0KHByb2plY3RzKS50b0VxdWFsKFtdKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIEpTT04gcGFyc2luZyBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrZWRGcy5leGlzdHNTeW5jLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKTtcbiAgICAgIG1vY2tlZEZzLnJlYWRGaWxlU3luYy5tb2NrUmV0dXJuVmFsdWUoJ2ludmFsaWQganNvbicpO1xuICAgICAgKG1vY2tlZEZzLnJlYWRkaXJTeW5jIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKFtdKTtcbiAgICAgIChtb2NrZWRGcy5zdGF0U3luYyBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSh7fSk7XG5cbiAgICAgIGNvbnN0IHByb2plY3RzID0gYXdhaXQgcHJvamVjdERldGVjdG9yLmdldFByb2plY3RzKCk7XG4gICAgICBleHBlY3QocHJvamVjdHMpLnRvRXF1YWwoW10pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZGV0ZWN0Q3VycmVudFByb2plY3QnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBkZXRlY3QgcHJvamVjdCBmcm9tIGFjdGl2ZSBmaWxlIHBhdGgnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUHJvamVjdHMgPSBbXG4gICAgICB7IG5hbWU6ICdteS1hcHAnLCByb290OiAnYXBwcy9teS1hcHAnLCBwcm9qZWN0VHlwZTogJ2FwcGxpY2F0aW9uJyBhcyBjb25zdCwgdHlwZTogJ254JyBhcyBjb25zdCwgcGFja2FnZUpzb25QYXRoOiAnYXBwcy9teS1hcHAvcGFja2FnZS5qc29uJyB9LFxuICAgICAgeyBuYW1lOiAnbXktbGliJywgcm9vdDogJ2xpYnMvbXktbGliJywgcHJvamVjdFR5cGU6ICdsaWJyYXJ5JyBhcyBjb25zdCwgdHlwZTogJ254JyBhcyBjb25zdCwgcGFja2FnZUpzb25QYXRoOiAnbGlicy9teS1saWIvcGFja2FnZS5qc29uJyB9XG4gICAgICBdO1xuXG4gICAgICBqZXN0LnNweU9uKHByb2plY3REZXRlY3RvciwgJ2dldFByb2plY3RzJykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2plY3RzKTtcblxuICAgICAgLy8gTW9jayB2c2NvZGUgd2luZG93LmFjdGl2ZVRleHRFZGl0b3JcbiAgICAgIG1vY2tWc2NvZGUud2luZG93LmFjdGl2ZVRleHRFZGl0b3IgPSB7XG4gICAgICAgIGRvY3VtZW50OiB7XG4gICAgICAgICAgdXJpOiB7XG4gICAgICAgICAgICBmc1BhdGg6ICcvdGVzdC93b3Jrc3BhY2UvYXBwcy9teS1hcHAvc3JjL21haW4udHMnXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGFzIGFueTtcblxuICAgICAgbW9ja2VkUGF0aC5yZWxhdGl2ZS5tb2NrUmV0dXJuVmFsdWUoJ2FwcHMvbXktYXBwL3NyYy9tYWluLnRzJyk7XG5cbiAgICAgIGNvbnN0IGN1cnJlbnRQcm9qZWN0ID0gYXdhaXQgcHJvamVjdERldGVjdG9yLmRldGVjdEN1cnJlbnRQcm9qZWN0KCk7XG4gICAgICBleHBlY3QoY3VycmVudFByb2plY3QpLnRvQmUoJ215LWFwcCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbnVsbCB3aGVuIG5vIGFjdGl2ZSBlZGl0b3InLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrVnNjb2RlLndpbmRvdy5hY3RpdmVUZXh0RWRpdG9yID0gbnVsbDtcblxuICAgICAgY29uc3QgY3VycmVudFByb2plY3QgPSBhd2FpdCBwcm9qZWN0RGV0ZWN0b3IuZGV0ZWN0Q3VycmVudFByb2plY3QoKTtcbiAgICAgIGV4cGVjdChjdXJyZW50UHJvamVjdCkudG9CZU51bGwoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgd2hlbiBmaWxlIGlzIG5vdCBpbiBhbnkgcHJvamVjdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tQcm9qZWN0cyA9IFtcbiAgICAgICAgeyBuYW1lOiAnbXktYXBwJywgcm9vdDogJ2FwcHMvbXktYXBwJywgcHJvamVjdFR5cGU6ICdhcHBsaWNhdGlvbicgYXMgY29uc3QsIHR5cGU6ICdueCcgYXMgY29uc3QsIHBhY2thZ2VKc29uUGF0aDogJ2FwcHMvbXktYXBwL3BhY2thZ2UuanNvbicgfVxuICAgICAgXTtcblxuICAgICAgamVzdC5zcHlPbihwcm9qZWN0RGV0ZWN0b3IsICdnZXRQcm9qZWN0cycpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9qZWN0cyk7XG5cbiAgICAgIG1vY2tWc2NvZGUud2luZG93LmFjdGl2ZVRleHRFZGl0b3IgPSB7XG4gICAgICAgIGRvY3VtZW50OiB7XG4gICAgICAgICAgdXJpOiB7XG4gICAgICAgICAgICBmc1BhdGg6ICcvdGVzdC93b3Jrc3BhY2Uvb3RoZXIvZmlsZS50cydcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gYXMgYW55O1xuXG4gICAgICBtb2NrZWRQYXRoLnJlbGF0aXZlLm1vY2tSZXR1cm5WYWx1ZSgnb3RoZXIvZmlsZS50cycpO1xuXG4gICAgICBjb25zdCBjdXJyZW50UHJvamVjdCA9IGF3YWl0IHByb2plY3REZXRlY3Rvci5kZXRlY3RDdXJyZW50UHJvamVjdCgpO1xuICAgICAgZXhwZWN0KGN1cnJlbnRQcm9qZWN0KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0UHJvamVjdCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBwcm9qZWN0IGJ5IG5hbWUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUHJvamVjdHMgPSBbXG4gICAgICAgIHsgbmFtZTogJ215LWFwcCcsIHJvb3Q6ICdhcHBzL215LWFwcCcsIHByb2plY3RUeXBlOiAnYXBwbGljYXRpb24nIGFzIGNvbnN0LCB0eXBlOiAnbngnIGFzIGNvbnN0LCBwYWNrYWdlSnNvblBhdGg6ICdhcHBzL215LWFwcC9wYWNrYWdlLmpzb24nIH0sXG4gICAgICAgIHsgbmFtZTogJ215LWxpYicsIHJvb3Q6ICdsaWJzL215LWxpYicsIHByb2plY3RUeXBlOiAnbGlicmFyeScgYXMgY29uc3QsIHR5cGU6ICdueCcgYXMgY29uc3QsIHBhY2thZ2VKc29uUGF0aDogJ2xpYnMvbXktbGliL3BhY2thZ2UuanNvbicgfVxuICAgICAgXTtcblxuICAgICAgamVzdC5zcHlPbihwcm9qZWN0RGV0ZWN0b3IsICdnZXRQcm9qZWN0cycpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9qZWN0cyk7XG5cbiAgICAgIGNvbnN0IHByb2plY3QgPSBhd2FpdCBwcm9qZWN0RGV0ZWN0b3IuZ2V0UHJvamVjdCgnbXktbGliJyk7XG4gICAgICBleHBlY3QocHJvamVjdCkudG9FcXVhbChtb2NrUHJvamVjdHNbMV0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbnVsbCBmb3Igbm9uLWV4aXN0ZW50IHByb2plY3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBqZXN0LnNweU9uKHByb2plY3REZXRlY3RvciwgJ2dldFByb2plY3RzJykubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuXG4gICAgICBjb25zdCBwcm9qZWN0ID0gYXdhaXQgcHJvamVjdERldGVjdG9yLmdldFByb2plY3QoJ25vbi1leGlzdGVudCcpO1xuICAgICAgZXhwZWN0KHByb2plY3QpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdoYXNUYXJnZXQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdHJ1ZSB3aGVuIHByb2plY3QgaGFzIHRhcmdldCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tQcm9qZWN0ID0ge1xuICAgICAgICBuYW1lOiAnbXktYXBwJyxcbiAgICAgICAgcm9vdDogJ2FwcHMvbXktYXBwJyxcbiAgICAgICAgcHJvamVjdFR5cGU6ICdhcHBsaWNhdGlvbicgYXMgY29uc3QsXG4gICAgICAgIHR5cGU6ICdueCcgYXMgY29uc3QsXG4gICAgICAgIHBhY2thZ2VKc29uUGF0aDogJ2FwcHMvbXktYXBwL3BhY2thZ2UuanNvbicsXG4gICAgICAgIHRhcmdldHM6IHsgYnVpbGQ6IHt9LCB0ZXN0OiB7fSB9XG4gICAgICB9O1xuXG4gICAgICBqZXN0LnNweU9uKHByb2plY3REZXRlY3RvciwgJ2dldFByb2plY3QnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUHJvamVjdCk7XG5cbiAgICAgIGNvbnN0IGhhc1RhcmdldCA9IGF3YWl0IHByb2plY3REZXRlY3Rvci5oYXNUYXJnZXQoJ215LWFwcCcsICdidWlsZCcpO1xuICAgICAgZXhwZWN0KGhhc1RhcmdldCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGZhbHNlIHdoZW4gcHJvamVjdCBkb2VzIG5vdCBoYXZlIHRhcmdldCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tQcm9qZWN0ID0ge1xuICAgICAgICBuYW1lOiAnbXktYXBwJyxcbiAgICAgICAgcm9vdDogJ2FwcHMvbXktYXBwJyxcbiAgICAgICAgcHJvamVjdFR5cGU6ICdhcHBsaWNhdGlvbicgYXMgY29uc3QsXG4gICAgICAgIHR5cGU6ICdueCcgYXMgY29uc3QsXG4gICAgICAgIHBhY2thZ2VKc29uUGF0aDogJ2FwcHMvbXktYXBwL3BhY2thZ2UuanNvbicsXG4gICAgICAgIHRhcmdldHM6IHsgYnVpbGQ6IHt9IH1cbiAgICAgIH07XG5cbiAgICAgIGplc3Quc3B5T24ocHJvamVjdERldGVjdG9yLCAnZ2V0UHJvamVjdCcpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9qZWN0KTtcblxuICAgICAgY29uc3QgaGFzVGFyZ2V0ID0gYXdhaXQgcHJvamVjdERldGVjdG9yLmhhc1RhcmdldCgnbXktYXBwJywgJ3Rlc3QnKTtcbiAgICAgIGV4cGVjdChoYXNUYXJnZXQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZmFsc2Ugd2hlbiBwcm9qZWN0IG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3Quc3B5T24ocHJvamVjdERldGVjdG9yLCAnZ2V0UHJvamVjdCcpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBjb25zdCBoYXNUYXJnZXQgPSBhd2FpdCBwcm9qZWN0RGV0ZWN0b3IuaGFzVGFyZ2V0KCdub24tZXhpc3RlbnQnLCAnYnVpbGQnKTtcbiAgICAgIGV4cGVjdChoYXNUYXJnZXQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZmFsc2Ugd2hlbiBwcm9qZWN0IGhhcyBubyB0YXJnZXRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Byb2plY3QgPSB7XG4gICAgICAgIG5hbWU6ICdteS1hcHAnLFxuICAgICAgICByb290OiAnYXBwcy9teS1hcHAnLFxuICAgICAgICBwcm9qZWN0VHlwZTogJ2FwcGxpY2F0aW9uJyBhcyBjb25zdCxcbiAgICAgICAgdHlwZTogJ254JyBhcyBjb25zdCxcbiAgICAgICAgcGFja2FnZUpzb25QYXRoOiAnYXBwcy9teS1hcHAvcGFja2FnZS5qc29uJ1xuICAgICAgfTtcblxuICAgICAgamVzdC5zcHlPbihwcm9qZWN0RGV0ZWN0b3IsICdnZXRQcm9qZWN0JykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2plY3QpO1xuXG4gICAgICBjb25zdCBoYXNUYXJnZXQgPSBhd2FpdCBwcm9qZWN0RGV0ZWN0b3IuaGFzVGFyZ2V0KCdteS1hcHAnLCAnYnVpbGQnKTtcbiAgICAgIGV4cGVjdChoYXNUYXJnZXQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0V29ya3NwYWNlUm9vdCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiB3b3Jrc3BhY2Ugcm9vdCBkaXJlY3RvcnknLCAoKSA9PiB7XG4gICAgICBjb25zdCByb290ID0gcHJvamVjdERldGVjdG9yLmdldFdvcmtzcGFjZVJvb3QoKTtcbiAgICAgIGV4cGVjdChyb290KS50b0JlKCcvdGVzdC93b3Jrc3BhY2UnKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==