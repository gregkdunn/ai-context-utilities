70b3f67ac8e644d899c33f23bb6f1d27
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock all dependencies
jest.mock('../webview/provider');
jest.mock('../utils/projectDetector');
jest.mock('../utils/shellRunner');
jest.mock('../utils/fileManager');
// Mock additional dependencies
jest.mock('../utils/statusTracker');
jest.mock('../utils/commandCoordinator');
jest.mock('../services/plugins/pluginManager');
jest.mock('../services/plugins/pluginMarketplace');
jest.mock('../services/plugins/pluginDiscovery');
jest.mock('../services/nx/NxAffectedManager');
jest.mock('../services/nx/NxCommandProvider');
jest.mock('../services/nx/NxStatusBar');
jest.mock('../services/git/GitDiffManager');
jest.mock('../services/git/GitCommandProvider');
jest.mock('../services/flipper/FlipperDetectionManager');
// Mock vscode module
jest.mock('vscode', () => ({
    window: {
        registerWebviewViewProvider: jest.fn(),
        showInformationMessage: jest.fn(() => Promise.resolve(undefined)),
        showWarningMessage: jest.fn(),
        createOutputChannel: jest.fn(() => ({
            appendLine: jest.fn(),
            show: jest.fn()
        }))
    },
    commands: {
        registerCommand: jest.fn(() => ({ dispose: jest.fn() })),
        executeCommand: jest.fn()
    },
    workspace: {
        workspaceFolders: [{ uri: { fsPath: '/test/workspace' } }],
        getConfiguration: jest.fn(() => ({
            get: jest.fn((key) => {
                if (key === 'showNotifications') {
                    return true;
                }
                return undefined;
            })
        }))
    }
}));
const extension_1 = require("../extension");
const provider_1 = require("../webview/provider");
const projectDetector_1 = require("../utils/projectDetector");
const shellRunner_1 = require("../utils/shellRunner");
const fileManager_1 = require("../utils/fileManager");
const MockedWebviewProvider = provider_1.WebviewProvider;
const MockedProjectDetector = projectDetector_1.ProjectDetector;
const MockedCommandRunner = shellRunner_1.CommandRunner;
const MockedFileManager = fileManager_1.FileManager;
describe('Extension', () => {
    let mockContext;
    let mockProjectDetector;
    let mockCommandRunner;
    let mockFileManager;
    let mockWebviewProvider;
    beforeEach(() => {
        jest.clearAllMocks();
        // Setup mock context
        mockContext = {
            subscriptions: [],
            extensionUri: { fsPath: '/extension/path' }
        };
        // Setup mock instances
        mockProjectDetector = new MockedProjectDetector('test-workspace');
        mockCommandRunner = new MockedCommandRunner({});
        mockFileManager = new MockedFileManager({});
        // Mock methods that are called in the tests
        mockProjectDetector.findNxWorkspace = jest.fn();
        mockProjectDetector.getCurrentProject = jest.fn();
        // Setup mock return values for constructors
        MockedProjectDetector.mockImplementation(() => mockProjectDetector);
        MockedCommandRunner.mockImplementation(() => mockCommandRunner);
        MockedFileManager.mockImplementation(() => mockFileManager);
        // Create a mock webview provider that will be returned by the constructor
        mockWebviewProvider = {
            show: jest.fn(),
            runCommand: jest.fn(),
            resolveWebviewView: jest.fn()
        };
        MockedWebviewProvider.mockImplementation(() => mockWebviewProvider);
    });
    describe('activate', () => {
        it('should activate extension when NX workspace is detected', async () => {
            const vscode = require('vscode');
            // Mock NX workspace detection
            mockProjectDetector.findNxWorkspace.mockResolvedValue('/workspace/nx.json');
            await (0, extension_1.activate)(mockContext);
            expect(vscode.commands.executeCommand).toHaveBeenCalledWith('setContext', 'workspaceHasNxProject', true);
            expect(vscode.window.registerWebviewViewProvider).toHaveBeenCalledWith('aiDebugUtilities', mockWebviewProvider);
            expect(vscode.commands.registerCommand).toHaveBeenCalled();
            expect(mockContext.subscriptions.length).toBeGreaterThan(0);
        });
        it('should remain dormant when no NX workspace is detected', async () => {
            const vscode = require('vscode');
            // Mock no NX workspace
            mockProjectDetector.findNxWorkspace.mockResolvedValue(null);
            await (0, extension_1.activate)(mockContext);
            expect(vscode.commands.executeCommand).toHaveBeenCalledWith('setContext', 'workspaceHasNxProject', false);
            expect(vscode.window.registerWebviewViewProvider).not.toHaveBeenCalled();
        });
        it('should show welcome notification when notifications are enabled', async () => {
            const vscode = require('vscode');
            mockProjectDetector.findNxWorkspace.mockResolvedValue('/workspace/nx.json');
            vscode.window.showInformationMessage.mockResolvedValue('Open Panel');
            await (0, extension_1.activate)(mockContext);
            // The test should wait for the notification to appear
            await new Promise(resolve => setTimeout(resolve, 100));
            expect(vscode.window.showInformationMessage).toHaveBeenCalledWith('AI Debug Utilities activated! Open the panel to get started.', 'Open Panel');
            expect(vscode.commands.executeCommand).toHaveBeenCalledWith('aiDebugUtilities.openPanel');
        });
        it('should register all required commands', async () => {
            const vscode = require('vscode');
            mockProjectDetector.findNxWorkspace.mockResolvedValue('/workspace/nx.json');
            await (0, extension_1.activate)(mockContext);
            const registeredCommands = vscode.commands.registerCommand.mock.calls.map((call) => call[0]);
            expect(registeredCommands).toContain('aiDebugUtilities.openPanel');
            expect(registeredCommands).toContain('aiDebugUtilities.runAiDebug');
            expect(registeredCommands).toContain('aiDebugUtilities.runNxTest');
            expect(registeredCommands).toContain('aiDebugUtilities.runGitDiff');
            expect(registeredCommands).toContain('aiDebugUtilities.runPrepareToPush');
        });
    });
    describe('registered commands', () => {
        beforeEach(async () => {
            const vscode = require('vscode');
            mockProjectDetector.findNxWorkspace.mockResolvedValue('/workspace/nx.json');
            await (0, extension_1.activate)(mockContext);
        });
        it('should register openPanel command', async () => {
            const vscode = require('vscode');
            const openPanelCall = vscode.commands.registerCommand.mock.calls
                .find((call) => call[0] === 'aiDebugUtilities.openPanel');
            if (openPanelCall && openPanelCall[1]) {
                openPanelCall[1]();
                expect(mockWebviewProvider.show).toHaveBeenCalled();
            }
        });
        it('should register runAiDebug command with project detection', async () => {
            const vscode = require('vscode');
            const runAiDebugCall = vscode.commands.registerCommand.mock.calls
                .find((call) => call[0] === 'aiDebugUtilities.runAiDebug');
            mockProjectDetector.getCurrentProject.mockResolvedValue({
                name: 'my-app',
                root: 'apps/my-app',
                projectType: 'application',
                type: 'nx',
                packageJsonPath: 'apps/my-app/package.json'
            });
            if (runAiDebugCall && runAiDebugCall[1]) {
                await runAiDebugCall[1]();
                expect(mockProjectDetector.getCurrentProject).toHaveBeenCalled();
                expect(mockWebviewProvider.runCommand).toHaveBeenCalledWith('aiDebug', { project: 'my-app' });
            }
        });
        it('should register runAiDebug command and show warning when no project detected', async () => {
            const vscode = require('vscode');
            const runAiDebugCall = vscode.commands.registerCommand.mock.calls
                .find((call) => call[0] === 'aiDebugUtilities.runAiDebug');
            mockProjectDetector.getCurrentProject.mockResolvedValue(undefined);
            if (runAiDebugCall && runAiDebugCall[1]) {
                await runAiDebugCall[1]();
                expect(vscode.window.showWarningMessage).toHaveBeenCalledWith('No NX project detected. Please select a project first.');
                expect(mockWebviewProvider.runCommand).not.toHaveBeenCalled();
            }
        });
        it('should register runNxTest command with project detection', async () => {
            const vscode = require('vscode');
            const runNxTestCall = vscode.commands.registerCommand.mock.calls
                .find((call) => call[0] === 'aiDebugUtilities.runNxTest');
            mockProjectDetector.getCurrentProject.mockResolvedValue({
                name: 'my-lib',
                root: 'libs/my-lib',
                projectType: 'library',
                type: 'nx',
                packageJsonPath: 'libs/my-lib/package.json'
            });
            if (runNxTestCall && runNxTestCall[1]) {
                await runNxTestCall[1]();
                expect(mockProjectDetector.getCurrentProject).toHaveBeenCalled();
                expect(mockWebviewProvider.runCommand).toHaveBeenCalledWith('nxTest', { project: 'my-lib' });
            }
        });
        it('should register runNxTest command and show warning when no project detected', async () => {
            const vscode = require('vscode');
            const runNxTestCall = vscode.commands.registerCommand.mock.calls
                .find((call) => call[0] === 'aiDebugUtilities.runNxTest');
            mockProjectDetector.getCurrentProject.mockResolvedValue(undefined);
            if (runNxTestCall && runNxTestCall[1]) {
                await runNxTestCall[1]();
                expect(vscode.window.showWarningMessage).toHaveBeenCalledWith('No NX project detected. Please select a project first.');
                expect(mockWebviewProvider.runCommand).not.toHaveBeenCalled();
            }
        });
        it('should register runGitDiff command', async () => {
            const vscode = require('vscode');
            const runGitDiffCall = vscode.commands.registerCommand.mock.calls
                .find((call) => call[0] === 'aiDebugUtilities.runGitDiff');
            if (runGitDiffCall && runGitDiffCall[1]) {
                await runGitDiffCall[1]();
                expect(mockWebviewProvider.runCommand).toHaveBeenCalledWith('gitDiff', {});
            }
        });
        it('should register runPrepareToPush command with project detection', async () => {
            const vscode = require('vscode');
            const runPrepareToPushCall = vscode.commands.registerCommand.mock.calls
                .find((call) => call[0] === 'aiDebugUtilities.runPrepareToPush');
            mockProjectDetector.getCurrentProject.mockResolvedValue({
                name: 'my-app',
                root: 'apps/my-app',
                projectType: 'application',
                type: 'nx',
                packageJsonPath: 'apps/my-app/package.json'
            });
            if (runPrepareToPushCall && runPrepareToPushCall[1]) {
                await runPrepareToPushCall[1]();
                expect(mockProjectDetector.getCurrentProject).toHaveBeenCalled();
                expect(mockWebviewProvider.runCommand).toHaveBeenCalledWith('prepareToPush', { project: 'my-app' });
            }
        });
        it('should register runPrepareToPush command and show warning when no project detected', async () => {
            const vscode = require('vscode');
            const runPrepareToPushCall = vscode.commands.registerCommand.mock.calls
                .find((call) => call[0] === 'aiDebugUtilities.runPrepareToPush');
            mockProjectDetector.getCurrentProject.mockResolvedValue(undefined);
            if (runPrepareToPushCall && runPrepareToPushCall[1]) {
                await runPrepareToPushCall[1]();
                expect(vscode.window.showWarningMessage).toHaveBeenCalledWith('No NX project detected. Please select a project first.');
                expect(mockWebviewProvider.runCommand).not.toHaveBeenCalled();
            }
        });
    });
    describe('error handling', () => {
        it('should handle workspace detection errors gracefully', async () => {
            const vscode = require('vscode');
            mockProjectDetector.findNxWorkspace.mockRejectedValue(new Error('Workspace detection failed'));
            await (0, extension_1.activate)(mockContext);
            // The extension should set context to false when workspace detection fails
            expect(vscode.commands.executeCommand).toHaveBeenCalledWith('setContext', 'workspaceHasNxProject', false);
        });
        it('should handle command registration errors gracefully', async () => {
            const vscode = require('vscode');
            mockProjectDetector.findNxWorkspace.mockResolvedValue('/workspace/nx.json');
            vscode.commands.registerCommand.mockImplementation(() => {
                throw new Error('Command registration failed');
            });
            await (0, extension_1.activate)(mockContext);
            // The extension should set context to false when command registration fails
            expect(vscode.commands.executeCommand).toHaveBeenCalledWith('setContext', 'workspaceHasNxProject', false);
        });
    });
    describe('deactivate', () => {
        it('should deactivate extension cleanly', () => {
            // Should not throw
            expect(() => (0, extension_1.deactivate)()).not.toThrow();
        });
    });
    describe('integration', () => {
        it('should create all necessary instances with correct dependencies', async () => {
            // Clear previous mock calls
            MockedProjectDetector.mockClear();
            MockedCommandRunner.mockClear();
            MockedFileManager.mockClear();
            MockedWebviewProvider.mockClear();
            mockProjectDetector.findNxWorkspace.mockResolvedValue('/workspace/nx.json');
            await (0, extension_1.activate)(mockContext);
            expect(MockedProjectDetector).toHaveBeenCalledTimes(1);
            expect(MockedCommandRunner).toHaveBeenCalledTimes(1);
            expect(MockedFileManager).toHaveBeenCalledTimes(1);
            expect(MockedWebviewProvider).toHaveBeenCalledWith(mockContext.extensionUri, mockProjectDetector, mockCommandRunner, mockFileManager, expect.anything() // statusTracker
            );
        });
        it('should properly dispose of resources through context subscriptions', async () => {
            mockProjectDetector.findNxWorkspace.mockResolvedValue('/workspace/nx.json');
            await (0, extension_1.activate)(mockContext);
            expect(mockContext.subscriptions.length).toBeGreaterThan(0);
            // All subscriptions should be disposable objects
            mockContext.subscriptions.forEach(subscription => {
                if (subscription) {
                    expect(subscription).toHaveProperty('dispose');
                }
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2dyZWdkdW5uL3NyYy90ZXN0L2FpX2RlYnVnX2NvbnRleHQvdnNjb2RlL3NyYy9fX3Rlc3RzX18vZXh0ZW5zaW9uLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFPQSx3QkFBd0I7QUFDeEIsSUFBSSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQ2pDLElBQUksQ0FBQyxJQUFJLENBQUMsMEJBQTBCLENBQUMsQ0FBQztBQUN0QyxJQUFJLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUM7QUFDbEMsSUFBSSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0FBRWxDLCtCQUErQjtBQUMvQixJQUFJLENBQUMsSUFBSSxDQUFDLHdCQUF3QixDQUFDLENBQUM7QUFDcEMsSUFBSSxDQUFDLElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO0FBQ3pDLElBQUksQ0FBQyxJQUFJLENBQUMsbUNBQW1DLENBQUMsQ0FBQztBQUMvQyxJQUFJLENBQUMsSUFBSSxDQUFDLHVDQUF1QyxDQUFDLENBQUM7QUFDbkQsSUFBSSxDQUFDLElBQUksQ0FBQyxxQ0FBcUMsQ0FBQyxDQUFDO0FBQ2pELElBQUksQ0FBQyxJQUFJLENBQUMsa0NBQWtDLENBQUMsQ0FBQztBQUM5QyxJQUFJLENBQUMsSUFBSSxDQUFDLGtDQUFrQyxDQUFDLENBQUM7QUFDOUMsSUFBSSxDQUFDLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO0FBQ3hDLElBQUksQ0FBQyxJQUFJLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztBQUM1QyxJQUFJLENBQUMsSUFBSSxDQUFDLG9DQUFvQyxDQUFDLENBQUM7QUFDaEQsSUFBSSxDQUFDLElBQUksQ0FBQyw2Q0FBNkMsQ0FBQyxDQUFDO0FBRXpELHFCQUFxQjtBQUNyQixJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3pCLE1BQU0sRUFBRTtRQUNOLDJCQUEyQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFD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LGVBQWUsRUFDZixNQUFNLENBQUMsUUFBUSxFQUFFLENBQUMsZ0JBQWdCO2FBQ25DLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxvRUFBb0UsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNwRixtQkFBbUIsQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUMsb0JBQW9CLENBQUMsQ0FBQztZQUU1RSxNQUFNLElBQUEsb0JBQVEsRUFBQyxXQUFXLENBQUMsQ0FBQztZQUU1QixNQUFNLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFNUQsaURBQWlEO1lBQ2pELFdBQVcsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxFQUFFO2dCQUNqRCxJQUFJLFlBQVksRUFBRSxDQUFDO29CQUNYLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLENBQUM7Z0JBQy9DLENBQUM7WUFDRCxDQUFDLENBQUMsQ0FBQztRQUNQLENBQUMsQ0FBQyxDQUFDO0lBQ1QsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvZ3JlZ2R1bm4vc3JjL3Rlc3QvYWlfZGVidWdfY29udGV4dC92c2NvZGUvc3JjL19fdGVzdHNfXy9leHRlbnNpb24udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyB2c2NvZGUgZnJvbSAndnNjb2RlJztcbmltcG9ydCB7IGFjdGl2YXRlLCBkZWFjdGl2YXRlIH0gZnJvbSAnLi4vZXh0ZW5zaW9uJztcbmltcG9ydCB7IFdlYnZpZXdQcm92aWRlciB9IGZyb20gJy4uL3dlYnZpZXcvcHJvdmlkZXInO1xuaW1wb3J0IHsgUHJvamVjdERldGVjdG9yIH0gZnJvbSAnLi4vdXRpbHMvcHJvamVjdERldGVjdG9yJztcbmltcG9ydCB7IENvbW1hbmRSdW5uZXIgfSBmcm9tICcuLi91dGlscy9zaGVsbFJ1bm5lcic7XG5pbXBvcnQgeyBGaWxlTWFuYWdlciB9IGZyb20gJy4uL3V0aWxzL2ZpbGVNYW5hZ2VyJztcblxuLy8gTW9jayBhbGwgZGVwZW5kZW5jaWVzXG5qZXN0Lm1vY2soJy4uL3dlYnZpZXcvcHJvdmlkZXInKTtcbmplc3QubW9jaygnLi4vdXRpbHMvcHJvamVjdERldGVjdG9yJyk7XG5qZXN0Lm1vY2soJy4uL3V0aWxzL3NoZWxsUnVubmVyJyk7XG5qZXN0Lm1vY2soJy4uL3V0aWxzL2ZpbGVNYW5hZ2VyJyk7XG5cbi8vIE1vY2sgYWRkaXRpb25hbCBkZXBlbmRlbmNpZXNcbmplc3QubW9jaygnLi4vdXRpbHMvc3RhdHVzVHJhY2tlcicpO1xuamVzdC5tb2NrKCcuLi91dGlscy9jb21tYW5kQ29vcmRpbmF0b3InKTtcbmplc3QubW9jaygnLi4vc2VydmljZXMvcGx1Z2lucy9wbHVnaW5NYW5hZ2VyJyk7XG5qZXN0Lm1vY2soJy4uL3NlcnZpY2VzL3BsdWdpbnMvcGx1Z2luTWFya2V0cGxhY2UnKTtcbmplc3QubW9jaygnLi4vc2VydmljZXMvcGx1Z2lucy9wbHVnaW5EaXNjb3ZlcnknKTtcbmplc3QubW9jaygnLi4vc2VydmljZXMvbngvTnhBZmZlY3RlZE1hbmFnZXInKTtcbmplc3QubW9jaygnLi4vc2VydmljZXMvbngvTnhDb21tYW5kUHJvdmlkZXInKTtcbmplc3QubW9jaygnLi4vc2VydmljZXMvbngvTnhTdGF0dXNCYXInKTtcbmplc3QubW9jaygnLi4vc2VydmljZXMvZ2l0L0dpdERpZmZNYW5hZ2VyJyk7XG5qZXN0Lm1vY2soJy4uL3NlcnZpY2VzL2dpdC9HaXRDb21tYW5kUHJvdmlkZXInKTtcbmplc3QubW9jaygnLi4vc2VydmljZXMvZmxpcHBlci9GbGlwcGVyRGV0ZWN0aW9uTWFuYWdlcicpO1xuXG4vLyBNb2NrIHZzY29kZSBtb2R1bGVcbmplc3QubW9jaygndnNjb2RlJywgKCkgPT4gKHtcbiAgd2luZG93OiB7XG4gICAgcmVnaXN0ZXJXZWJ2aWV3Vmlld1Byb3ZpZGVyOiBqZXN0LmZuKCksXG4gICAgc2hvd0luZm9ybWF0aW9uTWVzc2FnZTogamVzdC5mbigoKSA9PiBQcm9taXNlLnJlc29sdmUodW5kZWZpbmVkKSksXG4gICAgc2hvd1dhcm5pbmdNZXNzYWdlOiBqZXN0LmZuKCksXG4gICAgY3JlYXRlT3V0cHV0Q2hhbm5lbDogamVzdC5mbigoKSA9PiAoe1xuICAgICAgYXBwZW5kTGluZTogamVzdC5mbigpLFxuICAgICAgc2hvdzogamVzdC5mbigpXG4gICAgfSkpXG4gIH0sXG4gIGNvbW1hbmRzOiB7XG4gICAgcmVnaXN0ZXJDb21tYW5kOiBqZXN0LmZuKCgpID0+ICh7IGRpc3Bvc2U6IGplc3QuZm4oKSB9KSksXG4gICAgZXhlY3V0ZUNvbW1hbmQ6IGplc3QuZm4oKVxuICB9LFxuICB3b3Jrc3BhY2U6IHtcbiAgICB3b3Jrc3BhY2VGb2xkZXJzOiBbeyB1cmk6IHsgZnNQYXRoOiAnL3Rlc3Qvd29ya3NwYWNlJyB9IH1dLFxuICAgIGdldENvbmZpZ3VyYXRpb246IGplc3QuZm4oKCkgPT4gKHtcbiAgICAgIGdldDogamVzdC5mbigoa2V5OiBzdHJpbmcpID0+IHtcbiAgICAgICAgaWYgKGtleSA9PT0gJ3Nob3dOb3RpZmljYXRpb25zJykge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICB9KVxuICAgIH0pKVxuICB9XG59KSk7XG5cbmNvbnN0IE1vY2tlZFdlYnZpZXdQcm92aWRlciA9IFdlYnZpZXdQcm92aWRlciBhcyBqZXN0Lk1vY2tlZENsYXNzPHR5cGVvZiBXZWJ2aWV3UHJvdmlkZXI+O1xuY29uc3QgTW9ja2VkUHJvamVjdERldGVjdG9yID0gUHJvamVjdERldGVjdG9yIGFzIGplc3QuTW9ja2VkQ2xhc3M8dHlwZW9mIFByb2plY3REZXRlY3Rvcj47XG5jb25zdCBNb2NrZWRDb21tYW5kUnVubmVyID0gQ29tbWFuZFJ1bm5lciBhcyBqZXN0Lk1vY2tlZENsYXNzPHR5cGVvZiBDb21tYW5kUnVubmVyPjtcbmNvbnN0IE1vY2tlZEZpbGVNYW5hZ2VyID0gRmlsZU1hbmFnZXIgYXMgamVzdC5Nb2NrZWRDbGFzczx0eXBlb2YgRmlsZU1hbmFnZXI+O1xuXG5kZXNjcmliZSgnRXh0ZW5zaW9uJywgKCkgPT4ge1xuICBsZXQgbW9ja0NvbnRleHQ6IHZzY29kZS5FeHRlbnNpb25Db250ZXh0O1xuICBsZXQgbW9ja1Byb2plY3REZXRlY3RvcjogamVzdC5Nb2NrZWQ8UHJvamVjdERldGVjdG9yPjtcbiAgbGV0IG1vY2tDb21tYW5kUnVubmVyOiBqZXN0Lk1vY2tlZDxDb21tYW5kUnVubmVyPjtcbiAgbGV0IG1vY2tGaWxlTWFuYWdlcjogamVzdC5Nb2NrZWQ8RmlsZU1hbmFnZXI+O1xuICBsZXQgbW9ja1dlYnZpZXdQcm92aWRlcjogYW55O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuXG4gICAgLy8gU2V0dXAgbW9jayBjb250ZXh0XG4gICAgbW9ja0NvbnRleHQgPSB7XG4gICAgICBzdWJzY3JpcHRpb25zOiBbXSxcbiAgICAgIGV4dGVuc2lvblVyaTogeyBmc1BhdGg6ICcvZXh0ZW5zaW9uL3BhdGgnIH1cbiAgICB9IGFzIGFueTtcblxuICAgIC8vIFNldHVwIG1vY2sgaW5zdGFuY2VzXG4gICAgbW9ja1Byb2plY3REZXRlY3RvciA9IG5ldyBNb2NrZWRQcm9qZWN0RGV0ZWN0b3IoJ3Rlc3Qtd29ya3NwYWNlJykgYXMgamVzdC5Nb2NrZWQ8UHJvamVjdERldGVjdG9yPjtcbiAgICBtb2NrQ29tbWFuZFJ1bm5lciA9IG5ldyBNb2NrZWRDb21tYW5kUnVubmVyKHt9IGFzIGFueSkgYXMgamVzdC5Nb2NrZWQ8Q29tbWFuZFJ1bm5lcj47XG4gICAgbW9ja0ZpbGVNYW5hZ2VyID0gbmV3IE1vY2tlZEZpbGVNYW5hZ2VyKHt9IGFzIGFueSkgYXMgamVzdC5Nb2NrZWQ8RmlsZU1hbmFnZXI+O1xuICAgIFxuICAgIC8vIE1vY2sgbWV0aG9kcyB0aGF0IGFyZSBjYWxsZWQgaW4gdGhlIHRlc3RzXG4gICAgbW9ja1Byb2plY3REZXRlY3Rvci5maW5kTnhXb3Jrc3BhY2UgPSBqZXN0LmZuKCk7XG4gICAgbW9ja1Byb2plY3REZXRlY3Rvci5nZXRDdXJyZW50UHJvamVjdCA9IGplc3QuZm4oKTtcbiAgICBcbiAgICAvLyBTZXR1cCBtb2NrIHJldHVybiB2YWx1ZXMgZm9yIGNvbnN0cnVjdG9yc1xuICAgIE1vY2tlZFByb2plY3REZXRlY3Rvci5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gbW9ja1Byb2plY3REZXRlY3Rvcik7XG4gICAgTW9ja2VkQ29tbWFuZFJ1bm5lci5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gbW9ja0NvbW1hbmRSdW5uZXIpO1xuICAgIE1vY2tlZEZpbGVNYW5hZ2VyLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBtb2NrRmlsZU1hbmFnZXIpO1xuICAgIFxuICAgIC8vIENyZWF0ZSBhIG1vY2sgd2VidmlldyBwcm92aWRlciB0aGF0IHdpbGwgYmUgcmV0dXJuZWQgYnkgdGhlIGNvbnN0cnVjdG9yXG4gICAgbW9ja1dlYnZpZXdQcm92aWRlciA9IHtcbiAgICAgIHNob3c6IGplc3QuZm4oKSxcbiAgICAgIHJ1bkNvbW1hbmQ6IGplc3QuZm4oKSxcbiAgICAgIHJlc29sdmVXZWJ2aWV3VmlldzogamVzdC5mbigpXG4gICAgfSBhcyBhbnk7XG4gICAgXG4gICAgTW9ja2VkV2Vidmlld1Byb3ZpZGVyLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBtb2NrV2Vidmlld1Byb3ZpZGVyKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2FjdGl2YXRlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYWN0aXZhdGUgZXh0ZW5zaW9uIHdoZW4gTlggd29ya3NwYWNlIGlzIGRldGVjdGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdnNjb2RlID0gcmVxdWlyZSgndnNjb2RlJyk7XG4gICAgICBcbiAgICAgIC8vIE1vY2sgTlggd29ya3NwYWNlIGRldGVjdGlvblxuICAgICAgbW9ja1Byb2plY3REZXRlY3Rvci5maW5kTnhXb3Jrc3BhY2UubW9ja1Jlc29sdmVkVmFsdWUoJy93b3Jrc3BhY2UvbnguanNvbicpO1xuXG4gICAgICBhd2FpdCBhY3RpdmF0ZShtb2NrQ29udGV4dCk7XG5cbiAgICAgIGV4cGVjdCh2c2NvZGUuY29tbWFuZHMuZXhlY3V0ZUNvbW1hbmQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdzZXRDb250ZXh0JywgJ3dvcmtzcGFjZUhhc054UHJvamVjdCcsIHRydWUpO1xuICAgICAgZXhwZWN0KHZzY29kZS53aW5kb3cucmVnaXN0ZXJXZWJ2aWV3Vmlld1Byb3ZpZGVyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnYWlEZWJ1Z1V0aWxpdGllcycsIG1vY2tXZWJ2aWV3UHJvdmlkZXIpO1xuICAgICAgZXhwZWN0KHZzY29kZS5jb21tYW5kcy5yZWdpc3RlckNvbW1hbmQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrQ29udGV4dC5zdWJzY3JpcHRpb25zLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZW1haW4gZG9ybWFudCB3aGVuIG5vIE5YIHdvcmtzcGFjZSBpcyBkZXRlY3RlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZzY29kZSA9IHJlcXVpcmUoJ3ZzY29kZScpO1xuICAgICAgXG4gICAgICAvLyBNb2NrIG5vIE5YIHdvcmtzcGFjZVxuICAgICAgbW9ja1Byb2plY3REZXRlY3Rvci5maW5kTnhXb3Jrc3BhY2UubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGF3YWl0IGFjdGl2YXRlKG1vY2tDb250ZXh0KTtcblxuICAgICAgZXhwZWN0KHZzY29kZS5jb21tYW5kcy5leGVjdXRlQ29tbWFuZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3NldENvbnRleHQnLCAnd29ya3NwYWNlSGFzTnhQcm9qZWN0JywgZmFsc2UpO1xuICAgICAgZXhwZWN0KHZzY29kZS53aW5kb3cucmVnaXN0ZXJXZWJ2aWV3Vmlld1Byb3ZpZGVyKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzaG93IHdlbGNvbWUgbm90aWZpY2F0aW9uIHdoZW4gbm90aWZpY2F0aW9ucyBhcmUgZW5hYmxlZCcsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB2c2NvZGUgPSByZXF1aXJlKCd2c2NvZGUnKTtcbiAgICBcbiAgICBtb2NrUHJvamVjdERldGVjdG9yLmZpbmROeFdvcmtzcGFjZS5tb2NrUmVzb2x2ZWRWYWx1ZSgnL3dvcmtzcGFjZS9ueC5qc29uJyk7XG4gICAgdnNjb2RlLndpbmRvdy5zaG93SW5mb3JtYXRpb25NZXNzYWdlLm1vY2tSZXNvbHZlZFZhbHVlKCdPcGVuIFBhbmVsJyk7XG5cbiAgICBhd2FpdCBhY3RpdmF0ZShtb2NrQ29udGV4dCk7XG5cbiAgICAvLyBUaGUgdGVzdCBzaG91bGQgd2FpdCBmb3IgdGhlIG5vdGlmaWNhdGlvbiB0byBhcHBlYXJcbiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwKSk7XG5cbiAgICBleHBlY3QodnNjb2RlLndpbmRvdy5zaG93SW5mb3JtYXRpb25NZXNzYWdlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ0FJIERlYnVnIFV0aWxpdGllcyBhY3RpdmF0ZWQhIE9wZW4gdGhlIHBhbmVsIHRvIGdldCBzdGFydGVkLicsXG4gICAgICAgICAgICAnT3BlbiBQYW5lbCdcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBleHBlY3QodnNjb2RlLmNvbW1hbmRzLmV4ZWN1dGVDb21tYW5kKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnYWlEZWJ1Z1V0aWxpdGllcy5vcGVuUGFuZWwnKTtcbiAgICAgICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlZ2lzdGVyIGFsbCByZXF1aXJlZCBjb21tYW5kcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZzY29kZSA9IHJlcXVpcmUoJ3ZzY29kZScpO1xuICAgICAgXG4gICAgICBtb2NrUHJvamVjdERldGVjdG9yLmZpbmROeFdvcmtzcGFjZS5tb2NrUmVzb2x2ZWRWYWx1ZSgnL3dvcmtzcGFjZS9ueC5qc29uJyk7XG5cbiAgICAgIGF3YWl0IGFjdGl2YXRlKG1vY2tDb250ZXh0KTtcblxuICAgICAgY29uc3QgcmVnaXN0ZXJlZENvbW1hbmRzID0gdnNjb2RlLmNvbW1hbmRzLnJlZ2lzdGVyQ29tbWFuZC5tb2NrLmNhbGxzLm1hcCgoY2FsbDogYW55KSA9PiBjYWxsWzBdKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlZ2lzdGVyZWRDb21tYW5kcykudG9Db250YWluKCdhaURlYnVnVXRpbGl0aWVzLm9wZW5QYW5lbCcpO1xuICAgICAgZXhwZWN0KHJlZ2lzdGVyZWRDb21tYW5kcykudG9Db250YWluKCdhaURlYnVnVXRpbGl0aWVzLnJ1bkFpRGVidWcnKTtcbiAgICAgIGV4cGVjdChyZWdpc3RlcmVkQ29tbWFuZHMpLnRvQ29udGFpbignYWlEZWJ1Z1V0aWxpdGllcy5ydW5OeFRlc3QnKTtcbiAgICAgIGV4cGVjdChyZWdpc3RlcmVkQ29tbWFuZHMpLnRvQ29udGFpbignYWlEZWJ1Z1V0aWxpdGllcy5ydW5HaXREaWZmJyk7XG4gICAgICBleHBlY3QocmVnaXN0ZXJlZENvbW1hbmRzKS50b0NvbnRhaW4oJ2FpRGVidWdVdGlsaXRpZXMucnVuUHJlcGFyZVRvUHVzaCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncmVnaXN0ZXJlZCBjb21tYW5kcycsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZzY29kZSA9IHJlcXVpcmUoJ3ZzY29kZScpO1xuICAgICAgbW9ja1Byb2plY3REZXRlY3Rvci5maW5kTnhXb3Jrc3BhY2UubW9ja1Jlc29sdmVkVmFsdWUoJy93b3Jrc3BhY2UvbnguanNvbicpO1xuICAgICAgYXdhaXQgYWN0aXZhdGUobW9ja0NvbnRleHQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWdpc3RlciBvcGVuUGFuZWwgY29tbWFuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZzY29kZSA9IHJlcXVpcmUoJ3ZzY29kZScpO1xuICAgICAgY29uc3Qgb3BlblBhbmVsQ2FsbCA9IHZzY29kZS5jb21tYW5kcy5yZWdpc3RlckNvbW1hbmQubW9jay5jYWxsc1xuICAgICAgICAuZmluZCgoY2FsbDogYW55KSA9PiBjYWxsWzBdID09PSAnYWlEZWJ1Z1V0aWxpdGllcy5vcGVuUGFuZWwnKTtcbiAgICAgIFxuICAgICAgaWYgKG9wZW5QYW5lbENhbGwgJiYgb3BlblBhbmVsQ2FsbFsxXSkge1xuICAgICAgICBvcGVuUGFuZWxDYWxsWzFdKCk7XG4gICAgICAgIGV4cGVjdChtb2NrV2Vidmlld1Byb3ZpZGVyLnNob3cpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVnaXN0ZXIgcnVuQWlEZWJ1ZyBjb21tYW5kIHdpdGggcHJvamVjdCBkZXRlY3Rpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB2c2NvZGUgPSByZXF1aXJlKCd2c2NvZGUnKTtcbiAgICAgIGNvbnN0IHJ1bkFpRGVidWdDYWxsID0gdnNjb2RlLmNvbW1hbmRzLnJlZ2lzdGVyQ29tbWFuZC5tb2NrLmNhbGxzXG4gICAgICAgIC5maW5kKChjYWxsOiBhbnkpID0+IGNhbGxbMF0gPT09ICdhaURlYnVnVXRpbGl0aWVzLnJ1bkFpRGVidWcnKTtcblxuICAgICAgbW9ja1Byb2plY3REZXRlY3Rvci5nZXRDdXJyZW50UHJvamVjdC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IFxuICAgICAgICBuYW1lOiAnbXktYXBwJywgXG4gICAgICAgIHJvb3Q6ICdhcHBzL215LWFwcCcsIFxuICAgICAgICBwcm9qZWN0VHlwZTogJ2FwcGxpY2F0aW9uJyxcbiAgICAgICAgdHlwZTogJ254JyxcbiAgICAgICAgcGFja2FnZUpzb25QYXRoOiAnYXBwcy9teS1hcHAvcGFja2FnZS5qc29uJ1xuICAgICAgfSk7XG5cbiAgICAgIGlmIChydW5BaURlYnVnQ2FsbCAmJiBydW5BaURlYnVnQ2FsbFsxXSkge1xuICAgICAgICBhd2FpdCBydW5BaURlYnVnQ2FsbFsxXSgpO1xuXG4gICAgICAgIGV4cGVjdChtb2NrUHJvamVjdERldGVjdG9yLmdldEN1cnJlbnRQcm9qZWN0KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAgIGV4cGVjdChtb2NrV2Vidmlld1Byb3ZpZGVyLnJ1bkNvbW1hbmQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdhaURlYnVnJywgeyBwcm9qZWN0OiAnbXktYXBwJyB9KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVnaXN0ZXIgcnVuQWlEZWJ1ZyBjb21tYW5kIGFuZCBzaG93IHdhcm5pbmcgd2hlbiBubyBwcm9qZWN0IGRldGVjdGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdnNjb2RlID0gcmVxdWlyZSgndnNjb2RlJyk7XG4gICAgICBjb25zdCBydW5BaURlYnVnQ2FsbCA9IHZzY29kZS5jb21tYW5kcy5yZWdpc3RlckNvbW1hbmQubW9jay5jYWxsc1xuICAgICAgICAuZmluZCgoY2FsbDogYW55KSA9PiBjYWxsWzBdID09PSAnYWlEZWJ1Z1V0aWxpdGllcy5ydW5BaURlYnVnJyk7XG5cbiAgICAgIG1vY2tQcm9qZWN0RGV0ZWN0b3IuZ2V0Q3VycmVudFByb2plY3QubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgaWYgKHJ1bkFpRGVidWdDYWxsICYmIHJ1bkFpRGVidWdDYWxsWzFdKSB7XG4gICAgICAgIGF3YWl0IHJ1bkFpRGVidWdDYWxsWzFdKCk7XG5cbiAgICAgICAgZXhwZWN0KHZzY29kZS53aW5kb3cuc2hvd1dhcm5pbmdNZXNzYWdlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICAnTm8gTlggcHJvamVjdCBkZXRlY3RlZC4gUGxlYXNlIHNlbGVjdCBhIHByb2plY3QgZmlyc3QuJ1xuICAgICAgICApO1xuICAgICAgICBleHBlY3QobW9ja1dlYnZpZXdQcm92aWRlci5ydW5Db21tYW5kKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWdpc3RlciBydW5OeFRlc3QgY29tbWFuZCB3aXRoIHByb2plY3QgZGV0ZWN0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdnNjb2RlID0gcmVxdWlyZSgndnNjb2RlJyk7XG4gICAgICBjb25zdCBydW5OeFRlc3RDYWxsID0gdnNjb2RlLmNvbW1hbmRzLnJlZ2lzdGVyQ29tbWFuZC5tb2NrLmNhbGxzXG4gICAgICAgIC5maW5kKChjYWxsOiBhbnkpID0+IGNhbGxbMF0gPT09ICdhaURlYnVnVXRpbGl0aWVzLnJ1bk54VGVzdCcpO1xuXG4gICAgICBtb2NrUHJvamVjdERldGVjdG9yLmdldEN1cnJlbnRQcm9qZWN0Lm1vY2tSZXNvbHZlZFZhbHVlKHsgXG4gICAgICAgIG5hbWU6ICdteS1saWInLCBcbiAgICAgICAgcm9vdDogJ2xpYnMvbXktbGliJywgXG4gICAgICAgIHByb2plY3RUeXBlOiAnbGlicmFyeScsXG4gICAgICAgIHR5cGU6ICdueCcsXG4gICAgICAgIHBhY2thZ2VKc29uUGF0aDogJ2xpYnMvbXktbGliL3BhY2thZ2UuanNvbidcbiAgICAgIH0pO1xuXG4gICAgICBpZiAocnVuTnhUZXN0Q2FsbCAmJiBydW5OeFRlc3RDYWxsWzFdKSB7XG4gICAgICAgIGF3YWl0IHJ1bk54VGVzdENhbGxbMV0oKTtcblxuICAgICAgICBleHBlY3QobW9ja1Byb2plY3REZXRlY3Rvci5nZXRDdXJyZW50UHJvamVjdCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICBleHBlY3QobW9ja1dlYnZpZXdQcm92aWRlci5ydW5Db21tYW5kKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnbnhUZXN0JywgeyBwcm9qZWN0OiAnbXktbGliJyB9KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVnaXN0ZXIgcnVuTnhUZXN0IGNvbW1hbmQgYW5kIHNob3cgd2FybmluZyB3aGVuIG5vIHByb2plY3QgZGV0ZWN0ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB2c2NvZGUgPSByZXF1aXJlKCd2c2NvZGUnKTtcbiAgICAgIGNvbnN0IHJ1bk54VGVzdENhbGwgPSB2c2NvZGUuY29tbWFuZHMucmVnaXN0ZXJDb21tYW5kLm1vY2suY2FsbHNcbiAgICAgICAgLmZpbmQoKGNhbGw6IGFueSkgPT4gY2FsbFswXSA9PT0gJ2FpRGVidWdVdGlsaXRpZXMucnVuTnhUZXN0Jyk7XG5cbiAgICAgIG1vY2tQcm9qZWN0RGV0ZWN0b3IuZ2V0Q3VycmVudFByb2plY3QubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgaWYgKHJ1bk54VGVzdENhbGwgJiYgcnVuTnhUZXN0Q2FsbFsxXSkge1xuICAgICAgICBhd2FpdCBydW5OeFRlc3RDYWxsWzFdKCk7XG5cbiAgICAgICAgZXhwZWN0KHZzY29kZS53aW5kb3cuc2hvd1dhcm5pbmdNZXNzYWdlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICAnTm8gTlggcHJvamVjdCBkZXRlY3RlZC4gUGxlYXNlIHNlbGVjdCBhIHByb2plY3QgZmlyc3QuJ1xuICAgICAgICApO1xuICAgICAgICBleHBlY3QobW9ja1dlYnZpZXdQcm92aWRlci5ydW5Db21tYW5kKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWdpc3RlciBydW5HaXREaWZmIGNvbW1hbmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB2c2NvZGUgPSByZXF1aXJlKCd2c2NvZGUnKTtcbiAgICAgIGNvbnN0IHJ1bkdpdERpZmZDYWxsID0gdnNjb2RlLmNvbW1hbmRzLnJlZ2lzdGVyQ29tbWFuZC5tb2NrLmNhbGxzXG4gICAgICAgIC5maW5kKChjYWxsOiBhbnkpID0+IGNhbGxbMF0gPT09ICdhaURlYnVnVXRpbGl0aWVzLnJ1bkdpdERpZmYnKTtcblxuICAgICAgaWYgKHJ1bkdpdERpZmZDYWxsICYmIHJ1bkdpdERpZmZDYWxsWzFdKSB7XG4gICAgICAgIGF3YWl0IHJ1bkdpdERpZmZDYWxsWzFdKCk7XG4gICAgICAgIGV4cGVjdChtb2NrV2Vidmlld1Byb3ZpZGVyLnJ1bkNvbW1hbmQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdnaXREaWZmJywge30pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWdpc3RlciBydW5QcmVwYXJlVG9QdXNoIGNvbW1hbmQgd2l0aCBwcm9qZWN0IGRldGVjdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZzY29kZSA9IHJlcXVpcmUoJ3ZzY29kZScpO1xuICAgICAgY29uc3QgcnVuUHJlcGFyZVRvUHVzaENhbGwgPSB2c2NvZGUuY29tbWFuZHMucmVnaXN0ZXJDb21tYW5kLm1vY2suY2FsbHNcbiAgICAgICAgLmZpbmQoKGNhbGw6IGFueSkgPT4gY2FsbFswXSA9PT0gJ2FpRGVidWdVdGlsaXRpZXMucnVuUHJlcGFyZVRvUHVzaCcpO1xuXG4gICAgICBtb2NrUHJvamVjdERldGVjdG9yLmdldEN1cnJlbnRQcm9qZWN0Lm1vY2tSZXNvbHZlZFZhbHVlKHsgXG4gICAgICAgIG5hbWU6ICdteS1hcHAnLCBcbiAgICAgICAgcm9vdDogJ2FwcHMvbXktYXBwJywgXG4gICAgICAgIHByb2plY3RUeXBlOiAnYXBwbGljYXRpb24nLFxuICAgICAgICB0eXBlOiAnbngnLFxuICAgICAgICBwYWNrYWdlSnNvblBhdGg6ICdhcHBzL215LWFwcC9wYWNrYWdlLmpzb24nXG4gICAgICB9KTtcblxuICAgICAgaWYgKHJ1blByZXBhcmVUb1B1c2hDYWxsICYmIHJ1blByZXBhcmVUb1B1c2hDYWxsWzFdKSB7XG4gICAgICAgIGF3YWl0IHJ1blByZXBhcmVUb1B1c2hDYWxsWzFdKCk7XG5cbiAgICAgICAgZXhwZWN0KG1vY2tQcm9qZWN0RGV0ZWN0b3IuZ2V0Q3VycmVudFByb2plY3QpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgZXhwZWN0KG1vY2tXZWJ2aWV3UHJvdmlkZXIucnVuQ29tbWFuZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3ByZXBhcmVUb1B1c2gnLCB7IHByb2plY3Q6ICdteS1hcHAnIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWdpc3RlciBydW5QcmVwYXJlVG9QdXNoIGNvbW1hbmQgYW5kIHNob3cgd2FybmluZyB3aGVuIG5vIHByb2plY3QgZGV0ZWN0ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB2c2NvZGUgPSByZXF1aXJlKCd2c2NvZGUnKTtcbiAgICAgIGNvbnN0IHJ1blByZXBhcmVUb1B1c2hDYWxsID0gdnNjb2RlLmNvbW1hbmRzLnJlZ2lzdGVyQ29tbWFuZC5tb2NrLmNhbGxzXG4gICAgICAgIC5maW5kKChjYWxsOiBhbnkpID0+IGNhbGxbMF0gPT09ICdhaURlYnVnVXRpbGl0aWVzLnJ1blByZXBhcmVUb1B1c2gnKTtcblxuICAgICAgbW9ja1Byb2plY3REZXRlY3Rvci5nZXRDdXJyZW50UHJvamVjdC5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuXG4gICAgICBpZiAocnVuUHJlcGFyZVRvUHVzaENhbGwgJiYgcnVuUHJlcGFyZVRvUHVzaENhbGxbMV0pIHtcbiAgICAgICAgYXdhaXQgcnVuUHJlcGFyZVRvUHVzaENhbGxbMV0oKTtcblxuICAgICAgICBleHBlY3QodnNjb2RlLndpbmRvdy5zaG93V2FybmluZ01lc3NhZ2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgICdObyBOWCBwcm9qZWN0IGRldGVjdGVkLiBQbGVhc2Ugc2VsZWN0IGEgcHJvamVjdCBmaXJzdC4nXG4gICAgICAgICk7XG4gICAgICAgIGV4cGVjdChtb2NrV2Vidmlld1Byb3ZpZGVyLnJ1bkNvbW1hbmQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdlcnJvciBoYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB3b3Jrc3BhY2UgZGV0ZWN0aW9uIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdnNjb2RlID0gcmVxdWlyZSgndnNjb2RlJyk7XG4gICAgICBcbiAgICAgIG1vY2tQcm9qZWN0RGV0ZWN0b3IuZmluZE54V29ya3NwYWNlLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignV29ya3NwYWNlIGRldGVjdGlvbiBmYWlsZWQnKSk7XG5cbiAgICAgIGF3YWl0IGFjdGl2YXRlKG1vY2tDb250ZXh0KTtcbiAgICAgIFxuICAgICAgLy8gVGhlIGV4dGVuc2lvbiBzaG91bGQgc2V0IGNvbnRleHQgdG8gZmFsc2Ugd2hlbiB3b3Jrc3BhY2UgZGV0ZWN0aW9uIGZhaWxzXG4gICAgICBleHBlY3QodnNjb2RlLmNvbW1hbmRzLmV4ZWN1dGVDb21tYW5kKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnc2V0Q29udGV4dCcsICd3b3Jrc3BhY2VIYXNOeFByb2plY3QnLCBmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb21tYW5kIHJlZ2lzdHJhdGlvbiBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZzY29kZSA9IHJlcXVpcmUoJ3ZzY29kZScpO1xuICAgICAgXG4gICAgICBtb2NrUHJvamVjdERldGVjdG9yLmZpbmROeFdvcmtzcGFjZS5tb2NrUmVzb2x2ZWRWYWx1ZSgnL3dvcmtzcGFjZS9ueC5qc29uJyk7XG4gICAgICB2c2NvZGUuY29tbWFuZHMucmVnaXN0ZXJDb21tYW5kLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ29tbWFuZCByZWdpc3RyYXRpb24gZmFpbGVkJyk7XG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgYWN0aXZhdGUobW9ja0NvbnRleHQpO1xuICAgICAgXG4gICAgICAvLyBUaGUgZXh0ZW5zaW9uIHNob3VsZCBzZXQgY29udGV4dCB0byBmYWxzZSB3aGVuIGNvbW1hbmQgcmVnaXN0cmF0aW9uIGZhaWxzXG4gICAgICBleHBlY3QodnNjb2RlLmNvbW1hbmRzLmV4ZWN1dGVDb21tYW5kKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnc2V0Q29udGV4dCcsICd3b3Jrc3BhY2VIYXNOeFByb2plY3QnLCBmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdkZWFjdGl2YXRlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZGVhY3RpdmF0ZSBleHRlbnNpb24gY2xlYW5seScsICgpID0+IHtcbiAgICAgIC8vIFNob3VsZCBub3QgdGhyb3dcbiAgICAgIGV4cGVjdCgoKSA9PiBkZWFjdGl2YXRlKCkpLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdpbnRlZ3JhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhbGwgbmVjZXNzYXJ5IGluc3RhbmNlcyB3aXRoIGNvcnJlY3QgZGVwZW5kZW5jaWVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ2xlYXIgcHJldmlvdXMgbW9jayBjYWxsc1xuICAgICAgTW9ja2VkUHJvamVjdERldGVjdG9yLm1vY2tDbGVhcigpO1xuICAgICAgTW9ja2VkQ29tbWFuZFJ1bm5lci5tb2NrQ2xlYXIoKTtcbiAgICAgIE1vY2tlZEZpbGVNYW5hZ2VyLm1vY2tDbGVhcigpO1xuICAgICAgTW9ja2VkV2Vidmlld1Byb3ZpZGVyLm1vY2tDbGVhcigpO1xuICAgICAgXG4gICAgICBtb2NrUHJvamVjdERldGVjdG9yLmZpbmROeFdvcmtzcGFjZS5tb2NrUmVzb2x2ZWRWYWx1ZSgnL3dvcmtzcGFjZS9ueC5qc29uJyk7XG4gICAgICBcbiAgICAgIGF3YWl0IGFjdGl2YXRlKG1vY2tDb250ZXh0KTtcblxuICAgICAgZXhwZWN0KE1vY2tlZFByb2plY3REZXRlY3RvcikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgZXhwZWN0KE1vY2tlZENvbW1hbmRSdW5uZXIpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICAgIGV4cGVjdChNb2NrZWRGaWxlTWFuYWdlcikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgZXhwZWN0KE1vY2tlZFdlYnZpZXdQcm92aWRlcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIG1vY2tDb250ZXh0LmV4dGVuc2lvblVyaSxcbiAgICAgICAgbW9ja1Byb2plY3REZXRlY3RvcixcbiAgICAgICAgbW9ja0NvbW1hbmRSdW5uZXIsXG4gICAgICAgIG1vY2tGaWxlTWFuYWdlcixcbiAgICAgICAgZXhwZWN0LmFueXRoaW5nKCkgLy8gc3RhdHVzVHJhY2tlclxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJvcGVybHkgZGlzcG9zZSBvZiByZXNvdXJjZXMgdGhyb3VnaCBjb250ZXh0IHN1YnNjcmlwdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja1Byb2plY3REZXRlY3Rvci5maW5kTnhXb3Jrc3BhY2UubW9ja1Jlc29sdmVkVmFsdWUoJy93b3Jrc3BhY2UvbnguanNvbicpO1xuICAgIFxuICAgIGF3YWl0IGFjdGl2YXRlKG1vY2tDb250ZXh0KTtcblxuICAgIGV4cGVjdChtb2NrQ29udGV4dC5zdWJzY3JpcHRpb25zLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIFxuICAgIC8vIEFsbCBzdWJzY3JpcHRpb25zIHNob3VsZCBiZSBkaXNwb3NhYmxlIG9iamVjdHNcbiAgICBtb2NrQ29udGV4dC5zdWJzY3JpcHRpb25zLmZvckVhY2goc3Vic2NyaXB0aW9uID0+IHtcbiAgICBpZiAoc3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICBleHBlY3Qoc3Vic2NyaXB0aW9uKS50b0hhdmVQcm9wZXJ0eSgnZGlzcG9zZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9