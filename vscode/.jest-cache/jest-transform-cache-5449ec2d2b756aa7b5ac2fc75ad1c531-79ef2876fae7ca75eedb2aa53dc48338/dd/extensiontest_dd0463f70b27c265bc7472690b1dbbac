2e8d961c0a51240c9e5f464dae4aead0
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock all dependencies
jest.mock('../webview/provider');
jest.mock('../utils/projectDetector');
jest.mock('../utils/shellRunner');
jest.mock('../utils/fileManager');
// Mock additional dependencies
jest.mock('../utils/statusTracker');
jest.mock('../utils/commandCoordinator');
jest.mock('../services/plugins/pluginManager');
jest.mock('../services/plugins/pluginMarketplace');
jest.mock('../services/plugins/pluginDiscovery');
jest.mock('../services/nx/NxAffectedManager');
jest.mock('../services/nx/NxCommandProvider');
jest.mock('../services/nx/NxStatusBar');
jest.mock('../services/git/GitDiffManager');
jest.mock('../services/git/GitCommandProvider');
jest.mock('../services/flipper/FlipperDetectionManager');
// Mock vscode module
jest.mock('vscode', () => ({
    window: {
        registerWebviewViewProvider: jest.fn(),
        showInformationMessage: jest.fn(() => Promise.resolve(undefined)),
        showWarningMessage: jest.fn(),
        createOutputChannel: jest.fn(() => ({
            appendLine: jest.fn(),
            show: jest.fn()
        }))
    },
    commands: {
        registerCommand: jest.fn(() => ({ dispose: jest.fn() })),
        executeCommand: jest.fn()
    },
    workspace: {
        workspaceFolders: [{ uri: { fsPath: '/test/workspace' } }],
        getConfiguration: jest.fn((section) => ({
            get: jest.fn((key) => {
                if (key === 'showNotifications') {
                    return true;
                }
                return undefined;
            })
        }))
    }
}));
const extension_1 = require("../extension");
const provider_1 = require("../webview/provider");
const projectDetector_1 = require("../utils/projectDetector");
const shellRunner_1 = require("../utils/shellRunner");
const fileManager_1 = require("../utils/fileManager");
const MockedWebviewProvider = provider_1.WebviewProvider;
const MockedProjectDetector = projectDetector_1.ProjectDetector;
const MockedCommandRunner = shellRunner_1.CommandRunner;
const MockedFileManager = fileManager_1.FileManager;
describe('Extension', () => {
    let mockContext;
    let mockProjectDetector;
    let mockCommandRunner;
    let mockFileManager;
    let mockWebviewProvider;
    beforeEach(() => {
        jest.clearAllMocks();
        // Setup mock context
        mockContext = {
            subscriptions: [],
            extensionUri: { fsPath: '/extension/path' }
        };
        // Setup mock instances
        mockProjectDetector = new MockedProjectDetector('test-workspace');
        mockCommandRunner = new MockedCommandRunner({});
        mockFileManager = new MockedFileManager({});
        // Mock methods that are called in the tests
        mockProjectDetector.findNxWorkspace = jest.fn();
        mockProjectDetector.getCurrentProject = jest.fn();
        // Setup mock return values for constructors
        MockedProjectDetector.mockImplementation(() => mockProjectDetector);
        MockedCommandRunner.mockImplementation(() => mockCommandRunner);
        MockedFileManager.mockImplementation(() => mockFileManager);
        // Create a mock webview provider that will be returned by the constructor
        mockWebviewProvider = {
            show: jest.fn(),
            runCommand: jest.fn(),
            resolveWebviewView: jest.fn()
        };
        MockedWebviewProvider.mockImplementation(() => mockWebviewProvider);
    });
    describe('activate', () => {
        it('should activate extension when NX workspace is detected', async () => {
            const vscode = require('vscode');
            // Mock NX workspace detection
            mockProjectDetector.findNxWorkspace.mockResolvedValue('/workspace/nx.json');
            await (0, extension_1.activate)(mockContext);
            expect(vscode.commands.executeCommand).toHaveBeenCalledWith('setContext', 'workspaceHasNxProject', true);
            expect(vscode.window.registerWebviewViewProvider).toHaveBeenCalledWith('aiDebugUtilities', mockWebviewProvider);
            expect(vscode.commands.registerCommand).toHaveBeenCalled();
            expect(mockContext.subscriptions.length).toBeGreaterThan(0);
        });
        it('should remain dormant when no NX workspace is detected', async () => {
            const vscode = require('vscode');
            // Mock no NX workspace
            mockProjectDetector.findNxWorkspace.mockResolvedValue(null);
            await (0, extension_1.activate)(mockContext);
            expect(vscode.commands.executeCommand).toHaveBeenCalledWith('setContext', 'workspaceHasNxProject', false);
            expect(vscode.window.registerWebviewViewProvider).not.toHaveBeenCalled();
        });
        it('should show welcome notification when notifications are enabled', async () => {
            const vscode = require('vscode');
            mockProjectDetector.findNxWorkspace.mockResolvedValue('/workspace/nx.json');
            vscode.window.showInformationMessage.mockResolvedValue('Open Panel');
            await (0, extension_1.activate)(mockContext);
            // The test should wait for the notification to appear
            await new Promise(resolve => setTimeout(resolve, 100));
            expect(vscode.window.showInformationMessage).toHaveBeenCalledWith('AI Debug Utilities activated! Open the panel to get started.', 'Open Panel');
            // Wait for the .then() handler to execute
            await new Promise(resolve => setTimeout(resolve, 10));
            expect(vscode.commands.executeCommand).toHaveBeenCalledWith('aiDebugUtilities.openPanel');
        });
        it('should register all required commands', async () => {
            const vscode = require('vscode');
            mockProjectDetector.findNxWorkspace.mockResolvedValue('/workspace/nx.json');
            await (0, extension_1.activate)(mockContext);
            const registeredCommands = vscode.commands.registerCommand.mock.calls.map((call) => call[0]);
            expect(registeredCommands).toContain('aiDebugUtilities.openPanel');
            expect(registeredCommands).toContain('aiDebugUtilities.runAiDebug');
            expect(registeredCommands).toContain('aiDebugUtilities.runNxTest');
            expect(registeredCommands).toContain('aiDebugUtilities.runGitDiff');
            expect(registeredCommands).toContain('aiDebugUtilities.runPrepareToPush');
        });
    });
    describe('registered commands', () => {
        beforeEach(async () => {
            const vscode = require('vscode');
            mockProjectDetector.findNxWorkspace.mockResolvedValue('/workspace/nx.json');
            await (0, extension_1.activate)(mockContext);
        });
        it('should register openPanel command', async () => {
            const vscode = require('vscode');
            const openPanelCall = vscode.commands.registerCommand.mock.calls
                .find((call) => call[0] === 'aiDebugUtilities.openPanel');
            if (openPanelCall && openPanelCall[1]) {
                openPanelCall[1]();
                expect(mockWebviewProvider.show).toHaveBeenCalled();
            }
        });
        it('should register runAiDebug command with project detection', async () => {
            const vscode = require('vscode');
            const runAiDebugCall = vscode.commands.registerCommand.mock.calls
                .find((call) => call[0] === 'aiDebugUtilities.runAiDebug');
            mockProjectDetector.getCurrentProject.mockResolvedValue({
                name: 'my-app',
                root: 'apps/my-app',
                projectType: 'application',
                type: 'nx',
                packageJsonPath: 'apps/my-app/package.json'
            });
            if (runAiDebugCall && runAiDebugCall[1]) {
                await runAiDebugCall[1]();
                expect(mockProjectDetector.getCurrentProject).toHaveBeenCalled();
                expect(mockWebviewProvider.runCommand).toHaveBeenCalledWith('aiDebug', { project: 'my-app' });
            }
        });
        it('should register runAiDebug command and show warning when no project detected', async () => {
            const vscode = require('vscode');
            const runAiDebugCall = vscode.commands.registerCommand.mock.calls
                .find((call) => call[0] === 'aiDebugUtilities.runAiDebug');
            mockProjectDetector.getCurrentProject.mockResolvedValue(undefined);
            if (runAiDebugCall && runAiDebugCall[1]) {
                await runAiDebugCall[1]();
                expect(vscode.window.showWarningMessage).toHaveBeenCalledWith('No NX project detected. Please select a project first.');
                expect(mockWebviewProvider.runCommand).not.toHaveBeenCalled();
            }
        });
        it('should register runNxTest command with project detection', async () => {
            const vscode = require('vscode');
            const runNxTestCall = vscode.commands.registerCommand.mock.calls
                .find((call) => call[0] === 'aiDebugUtilities.runNxTest');
            mockProjectDetector.getCurrentProject.mockResolvedValue({
                name: 'my-lib',
                root: 'libs/my-lib',
                projectType: 'library',
                type: 'nx',
                packageJsonPath: 'libs/my-lib/package.json'
            });
            if (runNxTestCall && runNxTestCall[1]) {
                await runNxTestCall[1]();
                expect(mockProjectDetector.getCurrentProject).toHaveBeenCalled();
                expect(mockWebviewProvider.runCommand).toHaveBeenCalledWith('nxTest', { project: 'my-lib' });
            }
        });
        it('should register runNxTest command and show warning when no project detected', async () => {
            const vscode = require('vscode');
            const runNxTestCall = vscode.commands.registerCommand.mock.calls
                .find((call) => call[0] === 'aiDebugUtilities.runNxTest');
            mockProjectDetector.getCurrentProject.mockResolvedValue(undefined);
            if (runNxTestCall && runNxTestCall[1]) {
                await runNxTestCall[1]();
                expect(vscode.window.showWarningMessage).toHaveBeenCalledWith('No NX project detected. Please select a project first.');
                expect(mockWebviewProvider.runCommand).not.toHaveBeenCalled();
            }
        });
        it('should register runGitDiff command', async () => {
            const vscode = require('vscode');
            const runGitDiffCall = vscode.commands.registerCommand.mock.calls
                .find((call) => call[0] === 'aiDebugUtilities.runGitDiff');
            if (runGitDiffCall && runGitDiffCall[1]) {
                await runGitDiffCall[1]();
                expect(mockWebviewProvider.runCommand).toHaveBeenCalledWith('gitDiff', {});
            }
        });
        it('should register runPrepareToPush command with project detection', async () => {
            const vscode = require('vscode');
            const runPrepareToPushCall = vscode.commands.registerCommand.mock.calls
                .find((call) => call[0] === 'aiDebugUtilities.runPrepareToPush');
            mockProjectDetector.getCurrentProject.mockResolvedValue({
                name: 'my-app',
                root: 'apps/my-app',
                projectType: 'application',
                type: 'nx',
                packageJsonPath: 'apps/my-app/package.json'
            });
            if (runPrepareToPushCall && runPrepareToPushCall[1]) {
                await runPrepareToPushCall[1]();
                expect(mockProjectDetector.getCurrentProject).toHaveBeenCalled();
                expect(mockWebviewProvider.runCommand).toHaveBeenCalledWith('prepareToPush', { project: 'my-app' });
            }
        });
        it('should register runPrepareToPush command and show warning when no project detected', async () => {
            const vscode = require('vscode');
            const runPrepareToPushCall = vscode.commands.registerCommand.mock.calls
                .find((call) => call[0] === 'aiDebugUtilities.runPrepareToPush');
            mockProjectDetector.getCurrentProject.mockResolvedValue(undefined);
            if (runPrepareToPushCall && runPrepareToPushCall[1]) {
                await runPrepareToPushCall[1]();
                expect(vscode.window.showWarningMessage).toHaveBeenCalledWith('No NX project detected. Please select a project first.');
                expect(mockWebviewProvider.runCommand).not.toHaveBeenCalled();
            }
        });
    });
    describe('error handling', () => {
        it('should handle workspace detection errors gracefully', async () => {
            const vscode = require('vscode');
            mockProjectDetector.findNxWorkspace.mockRejectedValue(new Error('Workspace detection failed'));
            await (0, extension_1.activate)(mockContext);
            // The extension should set context to false when workspace detection fails
            expect(vscode.commands.executeCommand).toHaveBeenCalledWith('setContext', 'workspaceHasNxProject', false);
        });
        it('should handle command registration errors gracefully', async () => {
            const vscode = require('vscode');
            mockProjectDetector.findNxWorkspace.mockResolvedValue('/workspace/nx.json');
            vscode.commands.registerCommand.mockImplementation(() => {
                throw new Error('Command registration failed');
            });
            await (0, extension_1.activate)(mockContext);
            // The extension should set context to false when command registration fails
            expect(vscode.commands.executeCommand).toHaveBeenCalledWith('setContext', 'workspaceHasNxProject', false);
        });
    });
    describe('deactivate', () => {
        it('should deactivate extension cleanly', () => {
            // Should not throw
            expect(() => (0, extension_1.deactivate)()).not.toThrow();
        });
    });
    describe('integration', () => {
        it('should create all necessary instances with correct dependencies', async () => {
            // Clear previous mock calls
            MockedProjectDetector.mockClear();
            MockedCommandRunner.mockClear();
            MockedFileManager.mockClear();
            MockedWebviewProvider.mockClear();
            mockProjectDetector.findNxWorkspace.mockResolvedValue('/workspace/nx.json');
            await (0, extension_1.activate)(mockContext);
            expect(MockedProjectDetector).toHaveBeenCalledTimes(1);
            expect(MockedCommandRunner).toHaveBeenCalledTimes(1);
            expect(MockedFileManager).toHaveBeenCalledTimes(1);
            expect(MockedWebviewProvider).toHaveBeenCalledWith(mockContext.extensionUri, mockProjectDetector, mockCommandRunner, mockFileManager, expect.anything() // statusTracker
            );
        });
        it('should properly dispose of resources through context subscriptions', async () => {
            mockProjectDetector.findNxWorkspace.mockResolvedValue('/workspace/nx.json');
            await (0, extension_1.activate)(mockContext);
            expect(mockContext.subscriptions.length).toBeGreaterThan(0);
            // All subscriptions should be disposable objects
            mockContext.subscriptions.forEach(subscription => {
                if (subscription) {
                    expect(subscription).toHaveProperty('dispose');
                }
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2dyZWdkdW5uL3NyYy90ZXN0L2FpX2RlYnVnX2NvbnRleHQvdnNjb2RlL3NyYy9fX3Rlc3RzX18vZXh0ZW5zaW9uLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFPQSx3QkFBd0I7QUFDeEIsSUFBSSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQ2pDLElBQUksQ0FBQyxJQUFJLENBQUMsMEJBQTBCLENBQUMsQ0FBQztBQUN0QyxJQUFJLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUM7QUFDbEMsSUFBSSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0FBRWxDLCtCQUErQjtBQUMvQixJQUFJLENBQUMsSUFBSSxDQUFDLHdCQUF3QixDQUFDLENBQUM7QUFDcEMsSUFBSSxDQUFDLElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO0FBQ3pDLElBQUksQ0FBQyxJQUFJLENBQUMsbUNBQW1DLENBQUMsQ0FBQztBQUMvQyxJQUFJLENBQUMsSUFBSSxDQUFDLHVDQUF1QyxDQUFDLENBQUM7QUFDbkQsSUFBSSxDQUFDLElBQUksQ0FBQyxxQ0FBcUMsQ0FBQyxDQUFDO0FBQ2pELElBQUksQ0FBQyxJQUFJLENBQUMsa0NBQWtDLENBQUMsQ0FBQztBQUM5QyxJQUFJLENBQUMsSUFBSSxDQUFDLGtDQUFrQyxDQUFDLENBQUM7QUFDOUMsSUFBSSxDQUFDLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO0FBQ3hDLElBQUksQ0FBQyxJQUFJLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztBQUM1QyxJQUFJLENBQUMsSUFBSSxDQUFDLG9DQUFvQyxDQUFDLENBQUM7QUFDaEQsSUFBSSxDQUFDLElBQUksQ0FBQyw2Q0FBNkMsQ0FBQyxDQUFDO0FBRXpELHFCQUFxQjtBQUNyQixJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3pCLE1BQU0sRUFBRTtRQUNOLDJCQUEyQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFD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QUMsQ0FBQyxDQUFDLENBQUM7WUFDbkQsTUFBTSxDQUFDLHFCQUFxQixDQUFDLENBQUMsb0JBQW9CLENBQ2hELFdBQVcsQ0FBQyxZQUFZLEVBQ3hCLG1CQUFtQixFQUNuQixpQkFBaUIsRUFDakIsZUFBZSxFQUNmLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxnQkFBZ0I7YUFDbkMsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLG9FQUFvRSxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3BGLG1CQUFtQixDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1lBRTVFLE1BQU0sSUFBQSxvQkFBUSxFQUFDLFdBQVcsQ0FBQyxDQUFDO1lBRTVCLE1BQU0sQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUU1RCxpREFBaUQ7WUFDakQsV0FBVyxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLEVBQUU7Z0JBQ2pELElBQUksWUFBWSxFQUFFLENBQUM7b0JBQ1gsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFDL0MsQ0FBQztZQUNELENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDLENBQUM7SUFDVCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9ncmVnZHVubi9zcmMvdGVzdC9haV9kZWJ1Z19jb250ZXh0L3ZzY29kZS9zcmMvX190ZXN0c19fL2V4dGVuc2lvbi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHZzY29kZSBmcm9tICd2c2NvZGUnO1xuaW1wb3J0IHsgYWN0aXZhdGUsIGRlYWN0aXZhdGUgfSBmcm9tICcuLi9leHRlbnNpb24nO1xuaW1wb3J0IHsgV2Vidmlld1Byb3ZpZGVyIH0gZnJvbSAnLi4vd2Vidmlldy9wcm92aWRlcic7XG5pbXBvcnQgeyBQcm9qZWN0RGV0ZWN0b3IgfSBmcm9tICcuLi91dGlscy9wcm9qZWN0RGV0ZWN0b3InO1xuaW1wb3J0IHsgQ29tbWFuZFJ1bm5lciB9IGZyb20gJy4uL3V0aWxzL3NoZWxsUnVubmVyJztcbmltcG9ydCB7IEZpbGVNYW5hZ2VyIH0gZnJvbSAnLi4vdXRpbHMvZmlsZU1hbmFnZXInO1xuXG4vLyBNb2NrIGFsbCBkZXBlbmRlbmNpZXNcbmplc3QubW9jaygnLi4vd2Vidmlldy9wcm92aWRlcicpO1xuamVzdC5tb2NrKCcuLi91dGlscy9wcm9qZWN0RGV0ZWN0b3InKTtcbmplc3QubW9jaygnLi4vdXRpbHMvc2hlbGxSdW5uZXInKTtcbmplc3QubW9jaygnLi4vdXRpbHMvZmlsZU1hbmFnZXInKTtcblxuLy8gTW9jayBhZGRpdGlvbmFsIGRlcGVuZGVuY2llc1xuamVzdC5tb2NrKCcuLi91dGlscy9zdGF0dXNUcmFja2VyJyk7XG5qZXN0Lm1vY2soJy4uL3V0aWxzL2NvbW1hbmRDb29yZGluYXRvcicpO1xuamVzdC5tb2NrKCcuLi9zZXJ2aWNlcy9wbHVnaW5zL3BsdWdpbk1hbmFnZXInKTtcbmplc3QubW9jaygnLi4vc2VydmljZXMvcGx1Z2lucy9wbHVnaW5NYXJrZXRwbGFjZScpO1xuamVzdC5tb2NrKCcuLi9zZXJ2aWNlcy9wbHVnaW5zL3BsdWdpbkRpc2NvdmVyeScpO1xuamVzdC5tb2NrKCcuLi9zZXJ2aWNlcy9ueC9OeEFmZmVjdGVkTWFuYWdlcicpO1xuamVzdC5tb2NrKCcuLi9zZXJ2aWNlcy9ueC9OeENvbW1hbmRQcm92aWRlcicpO1xuamVzdC5tb2NrKCcuLi9zZXJ2aWNlcy9ueC9OeFN0YXR1c0JhcicpO1xuamVzdC5tb2NrKCcuLi9zZXJ2aWNlcy9naXQvR2l0RGlmZk1hbmFnZXInKTtcbmplc3QubW9jaygnLi4vc2VydmljZXMvZ2l0L0dpdENvbW1hbmRQcm92aWRlcicpO1xuamVzdC5tb2NrKCcuLi9zZXJ2aWNlcy9mbGlwcGVyL0ZsaXBwZXJEZXRlY3Rpb25NYW5hZ2VyJyk7XG5cbi8vIE1vY2sgdnNjb2RlIG1vZHVsZVxuamVzdC5tb2NrKCd2c2NvZGUnLCAoKSA9PiAoe1xuICB3aW5kb3c6IHtcbiAgICByZWdpc3RlcldlYnZpZXdWaWV3UHJvdmlkZXI6IGplc3QuZm4oKSxcbiAgICBzaG93SW5mb3JtYXRpb25NZXNzYWdlOiBqZXN0LmZuKCgpID0+IFByb21pc2UucmVzb2x2ZSh1bmRlZmluZWQpKSxcbiAgICBzaG93V2FybmluZ01lc3NhZ2U6IGplc3QuZm4oKSxcbiAgICBjcmVhdGVPdXRwdXRDaGFubmVsOiBqZXN0LmZuKCgpID0+ICh7XG4gICAgICBhcHBlbmRMaW5lOiBqZXN0LmZuKCksXG4gICAgICBzaG93OiBqZXN0LmZuKClcbiAgICB9KSlcbiAgfSxcbiAgY29tbWFuZHM6IHtcbiAgICByZWdpc3RlckNvbW1hbmQ6IGplc3QuZm4oKCkgPT4gKHsgZGlzcG9zZTogamVzdC5mbigpIH0pKSxcbiAgICBleGVjdXRlQ29tbWFuZDogamVzdC5mbigpXG4gIH0sXG4gIHdvcmtzcGFjZToge1xuICAgIHdvcmtzcGFjZUZvbGRlcnM6IFt7IHVyaTogeyBmc1BhdGg6ICcvdGVzdC93b3Jrc3BhY2UnIH0gfV0sXG4gICAgZ2V0Q29uZmlndXJhdGlvbjogamVzdC5mbigoc2VjdGlvbj86IHN0cmluZykgPT4gKHtcbiAgICAgIGdldDogamVzdC5mbigoa2V5OiBzdHJpbmcpID0+IHtcbiAgICAgICAgaWYgKGtleSA9PT0gJ3Nob3dOb3RpZmljYXRpb25zJykge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICB9KVxuICAgIH0pKVxuICB9XG59KSk7XG5cbmNvbnN0IE1vY2tlZFdlYnZpZXdQcm92aWRlciA9IFdlYnZpZXdQcm92aWRlciBhcyBqZXN0Lk1vY2tlZENsYXNzPHR5cGVvZiBXZWJ2aWV3UHJvdmlkZXI+O1xuY29uc3QgTW9ja2VkUHJvamVjdERldGVjdG9yID0gUHJvamVjdERldGVjdG9yIGFzIGplc3QuTW9ja2VkQ2xhc3M8dHlwZW9mIFByb2plY3REZXRlY3Rvcj47XG5jb25zdCBNb2NrZWRDb21tYW5kUnVubmVyID0gQ29tbWFuZFJ1bm5lciBhcyBqZXN0Lk1vY2tlZENsYXNzPHR5cGVvZiBDb21tYW5kUnVubmVyPjtcbmNvbnN0IE1vY2tlZEZpbGVNYW5hZ2VyID0gRmlsZU1hbmFnZXIgYXMgamVzdC5Nb2NrZWRDbGFzczx0eXBlb2YgRmlsZU1hbmFnZXI+O1xuXG5kZXNjcmliZSgnRXh0ZW5zaW9uJywgKCkgPT4ge1xuICBsZXQgbW9ja0NvbnRleHQ6IHZzY29kZS5FeHRlbnNpb25Db250ZXh0O1xuICBsZXQgbW9ja1Byb2plY3REZXRlY3RvcjogamVzdC5Nb2NrZWQ8UHJvamVjdERldGVjdG9yPjtcbiAgbGV0IG1vY2tDb21tYW5kUnVubmVyOiBqZXN0Lk1vY2tlZDxDb21tYW5kUnVubmVyPjtcbiAgbGV0IG1vY2tGaWxlTWFuYWdlcjogamVzdC5Nb2NrZWQ8RmlsZU1hbmFnZXI+O1xuICBsZXQgbW9ja1dlYnZpZXdQcm92aWRlcjogYW55O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuXG4gICAgLy8gU2V0dXAgbW9jayBjb250ZXh0XG4gICAgbW9ja0NvbnRleHQgPSB7XG4gICAgICBzdWJzY3JpcHRpb25zOiBbXSxcbiAgICAgIGV4dGVuc2lvblVyaTogeyBmc1BhdGg6ICcvZXh0ZW5zaW9uL3BhdGgnIH1cbiAgICB9IGFzIGFueTtcblxuICAgIC8vIFNldHVwIG1vY2sgaW5zdGFuY2VzXG4gICAgbW9ja1Byb2plY3REZXRlY3RvciA9IG5ldyBNb2NrZWRQcm9qZWN0RGV0ZWN0b3IoJ3Rlc3Qtd29ya3NwYWNlJykgYXMgamVzdC5Nb2NrZWQ8UHJvamVjdERldGVjdG9yPjtcbiAgICBtb2NrQ29tbWFuZFJ1bm5lciA9IG5ldyBNb2NrZWRDb21tYW5kUnVubmVyKHt9IGFzIGFueSkgYXMgamVzdC5Nb2NrZWQ8Q29tbWFuZFJ1bm5lcj47XG4gICAgbW9ja0ZpbGVNYW5hZ2VyID0gbmV3IE1vY2tlZEZpbGVNYW5hZ2VyKHt9IGFzIGFueSkgYXMgamVzdC5Nb2NrZWQ8RmlsZU1hbmFnZXI+O1xuICAgIFxuICAgIC8vIE1vY2sgbWV0aG9kcyB0aGF0IGFyZSBjYWxsZWQgaW4gdGhlIHRlc3RzXG4gICAgbW9ja1Byb2plY3REZXRlY3Rvci5maW5kTnhXb3Jrc3BhY2UgPSBqZXN0LmZuKCk7XG4gICAgbW9ja1Byb2plY3REZXRlY3Rvci5nZXRDdXJyZW50UHJvamVjdCA9IGplc3QuZm4oKTtcbiAgICBcbiAgICAvLyBTZXR1cCBtb2NrIHJldHVybiB2YWx1ZXMgZm9yIGNvbnN0cnVjdG9yc1xuICAgIE1vY2tlZFByb2plY3REZXRlY3Rvci5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gbW9ja1Byb2plY3REZXRlY3Rvcik7XG4gICAgTW9ja2VkQ29tbWFuZFJ1bm5lci5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gbW9ja0NvbW1hbmRSdW5uZXIpO1xuICAgIE1vY2tlZEZpbGVNYW5hZ2VyLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBtb2NrRmlsZU1hbmFnZXIpO1xuICAgIFxuICAgIC8vIENyZWF0ZSBhIG1vY2sgd2VidmlldyBwcm92aWRlciB0aGF0IHdpbGwgYmUgcmV0dXJuZWQgYnkgdGhlIGNvbnN0cnVjdG9yXG4gICAgbW9ja1dlYnZpZXdQcm92aWRlciA9IHtcbiAgICAgIHNob3c6IGplc3QuZm4oKSxcbiAgICAgIHJ1bkNvbW1hbmQ6IGplc3QuZm4oKSxcbiAgICAgIHJlc29sdmVXZWJ2aWV3VmlldzogamVzdC5mbigpXG4gICAgfSBhcyBhbnk7XG4gICAgXG4gICAgTW9ja2VkV2Vidmlld1Byb3ZpZGVyLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBtb2NrV2Vidmlld1Byb3ZpZGVyKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2FjdGl2YXRlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYWN0aXZhdGUgZXh0ZW5zaW9uIHdoZW4gTlggd29ya3NwYWNlIGlzIGRldGVjdGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdnNjb2RlID0gcmVxdWlyZSgndnNjb2RlJyk7XG4gICAgICBcbiAgICAgIC8vIE1vY2sgTlggd29ya3NwYWNlIGRldGVjdGlvblxuICAgICAgbW9ja1Byb2plY3REZXRlY3Rvci5maW5kTnhXb3Jrc3BhY2UubW9ja1Jlc29sdmVkVmFsdWUoJy93b3Jrc3BhY2UvbnguanNvbicpO1xuXG4gICAgICBhd2FpdCBhY3RpdmF0ZShtb2NrQ29udGV4dCk7XG5cbiAgICAgIGV4cGVjdCh2c2NvZGUuY29tbWFuZHMuZXhlY3V0ZUNvbW1hbmQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdzZXRDb250ZXh0JywgJ3dvcmtzcGFjZUhhc054UHJvamVjdCcsIHRydWUpO1xuICAgICAgZXhwZWN0KHZzY29kZS53aW5kb3cucmVnaXN0ZXJXZWJ2aWV3Vmlld1Byb3ZpZGVyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnYWlEZWJ1Z1V0aWxpdGllcycsIG1vY2tXZWJ2aWV3UHJvdmlkZXIpO1xuICAgICAgZXhwZWN0KHZzY29kZS5jb21tYW5kcy5yZWdpc3RlckNvbW1hbmQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrQ29udGV4dC5zdWJzY3JpcHRpb25zLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZW1haW4gZG9ybWFudCB3aGVuIG5vIE5YIHdvcmtzcGFjZSBpcyBkZXRlY3RlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZzY29kZSA9IHJlcXVpcmUoJ3ZzY29kZScpO1xuICAgICAgXG4gICAgICAvLyBNb2NrIG5vIE5YIHdvcmtzcGFjZVxuICAgICAgbW9ja1Byb2plY3REZXRlY3Rvci5maW5kTnhXb3Jrc3BhY2UubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGF3YWl0IGFjdGl2YXRlKG1vY2tDb250ZXh0KTtcblxuICAgICAgZXhwZWN0KHZzY29kZS5jb21tYW5kcy5leGVjdXRlQ29tbWFuZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3NldENvbnRleHQnLCAnd29ya3NwYWNlSGFzTnhQcm9qZWN0JywgZmFsc2UpO1xuICAgICAgZXhwZWN0KHZzY29kZS53aW5kb3cucmVnaXN0ZXJXZWJ2aWV3Vmlld1Byb3ZpZGVyKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzaG93IHdlbGNvbWUgbm90aWZpY2F0aW9uIHdoZW4gbm90aWZpY2F0aW9ucyBhcmUgZW5hYmxlZCcsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB2c2NvZGUgPSByZXF1aXJlKCd2c2NvZGUnKTtcbiAgICBcbiAgICBtb2NrUHJvamVjdERldGVjdG9yLmZpbmROeFdvcmtzcGFjZS5tb2NrUmVzb2x2ZWRWYWx1ZSgnL3dvcmtzcGFjZS9ueC5qc29uJyk7XG4gICAgdnNjb2RlLndpbmRvdy5zaG93SW5mb3JtYXRpb25NZXNzYWdlLm1vY2tSZXNvbHZlZFZhbHVlKCdPcGVuIFBhbmVsJyk7XG5cbiAgICBhd2FpdCBhY3RpdmF0ZShtb2NrQ29udGV4dCk7XG5cbiAgICAvLyBUaGUgdGVzdCBzaG91bGQgd2FpdCBmb3IgdGhlIG5vdGlmaWNhdGlvbiB0byBhcHBlYXJcbiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwKSk7XG5cbiAgICBleHBlY3QodnNjb2RlLndpbmRvdy5zaG93SW5mb3JtYXRpb25NZXNzYWdlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ0FJIERlYnVnIFV0aWxpdGllcyBhY3RpdmF0ZWQhIE9wZW4gdGhlIHBhbmVsIHRvIGdldCBzdGFydGVkLicsXG4gICAgICAgICAgICAnT3BlbiBQYW5lbCdcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBcbiAgICAvLyBXYWl0IGZvciB0aGUgLnRoZW4oKSBoYW5kbGVyIHRvIGV4ZWN1dGVcbiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTApKTtcbiAgICBcbiAgICBleHBlY3QodnNjb2RlLmNvbW1hbmRzLmV4ZWN1dGVDb21tYW5kKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnYWlEZWJ1Z1V0aWxpdGllcy5vcGVuUGFuZWwnKTtcbiAgICAgICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlZ2lzdGVyIGFsbCByZXF1aXJlZCBjb21tYW5kcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZzY29kZSA9IHJlcXVpcmUoJ3ZzY29kZScpO1xuICAgICAgXG4gICAgICBtb2NrUHJvamVjdERldGVjdG9yLmZpbmROeFdvcmtzcGFjZS5tb2NrUmVzb2x2ZWRWYWx1ZSgnL3dvcmtzcGFjZS9ueC5qc29uJyk7XG5cbiAgICAgIGF3YWl0IGFjdGl2YXRlKG1vY2tDb250ZXh0KTtcblxuICAgICAgY29uc3QgcmVnaXN0ZXJlZENvbW1hbmRzID0gdnNjb2RlLmNvbW1hbmRzLnJlZ2lzdGVyQ29tbWFuZC5tb2NrLmNhbGxzLm1hcCgoY2FsbDogYW55KSA9PiBjYWxsWzBdKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlZ2lzdGVyZWRDb21tYW5kcykudG9Db250YWluKCdhaURlYnVnVXRpbGl0aWVzLm9wZW5QYW5lbCcpO1xuICAgICAgZXhwZWN0KHJlZ2lzdGVyZWRDb21tYW5kcykudG9Db250YWluKCdhaURlYnVnVXRpbGl0aWVzLnJ1bkFpRGVidWcnKTtcbiAgICAgIGV4cGVjdChyZWdpc3RlcmVkQ29tbWFuZHMpLnRvQ29udGFpbignYWlEZWJ1Z1V0aWxpdGllcy5ydW5OeFRlc3QnKTtcbiAgICAgIGV4cGVjdChyZWdpc3RlcmVkQ29tbWFuZHMpLnRvQ29udGFpbignYWlEZWJ1Z1V0aWxpdGllcy5ydW5HaXREaWZmJyk7XG4gICAgICBleHBlY3QocmVnaXN0ZXJlZENvbW1hbmRzKS50b0NvbnRhaW4oJ2FpRGVidWdVdGlsaXRpZXMucnVuUHJlcGFyZVRvUHVzaCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncmVnaXN0ZXJlZCBjb21tYW5kcycsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZzY29kZSA9IHJlcXVpcmUoJ3ZzY29kZScpO1xuICAgICAgbW9ja1Byb2plY3REZXRlY3Rvci5maW5kTnhXb3Jrc3BhY2UubW9ja1Jlc29sdmVkVmFsdWUoJy93b3Jrc3BhY2UvbnguanNvbicpO1xuICAgICAgYXdhaXQgYWN0aXZhdGUobW9ja0NvbnRleHQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWdpc3RlciBvcGVuUGFuZWwgY29tbWFuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZzY29kZSA9IHJlcXVpcmUoJ3ZzY29kZScpO1xuICAgICAgY29uc3Qgb3BlblBhbmVsQ2FsbCA9IHZzY29kZS5jb21tYW5kcy5yZWdpc3RlckNvbW1hbmQubW9jay5jYWxsc1xuICAgICAgICAuZmluZCgoY2FsbDogYW55KSA9PiBjYWxsWzBdID09PSAnYWlEZWJ1Z1V0aWxpdGllcy5vcGVuUGFuZWwnKTtcbiAgICAgIFxuICAgICAgaWYgKG9wZW5QYW5lbENhbGwgJiYgb3BlblBhbmVsQ2FsbFsxXSkge1xuICAgICAgICBvcGVuUGFuZWxDYWxsWzFdKCk7XG4gICAgICAgIGV4cGVjdChtb2NrV2Vidmlld1Byb3ZpZGVyLnNob3cpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVnaXN0ZXIgcnVuQWlEZWJ1ZyBjb21tYW5kIHdpdGggcHJvamVjdCBkZXRlY3Rpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB2c2NvZGUgPSByZXF1aXJlKCd2c2NvZGUnKTtcbiAgICAgIGNvbnN0IHJ1bkFpRGVidWdDYWxsID0gdnNjb2RlLmNvbW1hbmRzLnJlZ2lzdGVyQ29tbWFuZC5tb2NrLmNhbGxzXG4gICAgICAgIC5maW5kKChjYWxsOiBhbnkpID0+IGNhbGxbMF0gPT09ICdhaURlYnVnVXRpbGl0aWVzLnJ1bkFpRGVidWcnKTtcblxuICAgICAgbW9ja1Byb2plY3REZXRlY3Rvci5nZXRDdXJyZW50UHJvamVjdC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IFxuICAgICAgICBuYW1lOiAnbXktYXBwJywgXG4gICAgICAgIHJvb3Q6ICdhcHBzL215LWFwcCcsIFxuICAgICAgICBwcm9qZWN0VHlwZTogJ2FwcGxpY2F0aW9uJyxcbiAgICAgICAgdHlwZTogJ254JyxcbiAgICAgICAgcGFja2FnZUpzb25QYXRoOiAnYXBwcy9teS1hcHAvcGFja2FnZS5qc29uJ1xuICAgICAgfSk7XG5cbiAgICAgIGlmIChydW5BaURlYnVnQ2FsbCAmJiBydW5BaURlYnVnQ2FsbFsxXSkge1xuICAgICAgICBhd2FpdCBydW5BaURlYnVnQ2FsbFsxXSgpO1xuXG4gICAgICAgIGV4cGVjdChtb2NrUHJvamVjdERldGVjdG9yLmdldEN1cnJlbnRQcm9qZWN0KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAgIGV4cGVjdChtb2NrV2Vidmlld1Byb3ZpZGVyLnJ1bkNvbW1hbmQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdhaURlYnVnJywgeyBwcm9qZWN0OiAnbXktYXBwJyB9KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVnaXN0ZXIgcnVuQWlEZWJ1ZyBjb21tYW5kIGFuZCBzaG93IHdhcm5pbmcgd2hlbiBubyBwcm9qZWN0IGRldGVjdGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdnNjb2RlID0gcmVxdWlyZSgndnNjb2RlJyk7XG4gICAgICBjb25zdCBydW5BaURlYnVnQ2FsbCA9IHZzY29kZS5jb21tYW5kcy5yZWdpc3RlckNvbW1hbmQubW9jay5jYWxsc1xuICAgICAgICAuZmluZCgoY2FsbDogYW55KSA9PiBjYWxsWzBdID09PSAnYWlEZWJ1Z1V0aWxpdGllcy5ydW5BaURlYnVnJyk7XG5cbiAgICAgIG1vY2tQcm9qZWN0RGV0ZWN0b3IuZ2V0Q3VycmVudFByb2plY3QubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgaWYgKHJ1bkFpRGVidWdDYWxsICYmIHJ1bkFpRGVidWdDYWxsWzFdKSB7XG4gICAgICAgIGF3YWl0IHJ1bkFpRGVidWdDYWxsWzFdKCk7XG5cbiAgICAgICAgZXhwZWN0KHZzY29kZS53aW5kb3cuc2hvd1dhcm5pbmdNZXNzYWdlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICAnTm8gTlggcHJvamVjdCBkZXRlY3RlZC4gUGxlYXNlIHNlbGVjdCBhIHByb2plY3QgZmlyc3QuJ1xuICAgICAgICApO1xuICAgICAgICBleHBlY3QobW9ja1dlYnZpZXdQcm92aWRlci5ydW5Db21tYW5kKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWdpc3RlciBydW5OeFRlc3QgY29tbWFuZCB3aXRoIHByb2plY3QgZGV0ZWN0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdnNjb2RlID0gcmVxdWlyZSgndnNjb2RlJyk7XG4gICAgICBjb25zdCBydW5OeFRlc3RDYWxsID0gdnNjb2RlLmNvbW1hbmRzLnJlZ2lzdGVyQ29tbWFuZC5tb2NrLmNhbGxzXG4gICAgICAgIC5maW5kKChjYWxsOiBhbnkpID0+IGNhbGxbMF0gPT09ICdhaURlYnVnVXRpbGl0aWVzLnJ1bk54VGVzdCcpO1xuXG4gICAgICBtb2NrUHJvamVjdERldGVjdG9yLmdldEN1cnJlbnRQcm9qZWN0Lm1vY2tSZXNvbHZlZFZhbHVlKHsgXG4gICAgICAgIG5hbWU6ICdteS1saWInLCBcbiAgICAgICAgcm9vdDogJ2xpYnMvbXktbGliJywgXG4gICAgICAgIHByb2plY3RUeXBlOiAnbGlicmFyeScsXG4gICAgICAgIHR5cGU6ICdueCcsXG4gICAgICAgIHBhY2thZ2VKc29uUGF0aDogJ2xpYnMvbXktbGliL3BhY2thZ2UuanNvbidcbiAgICAgIH0pO1xuXG4gICAgICBpZiAocnVuTnhUZXN0Q2FsbCAmJiBydW5OeFRlc3RDYWxsWzFdKSB7XG4gICAgICAgIGF3YWl0IHJ1bk54VGVzdENhbGxbMV0oKTtcblxuICAgICAgICBleHBlY3QobW9ja1Byb2plY3REZXRlY3Rvci5nZXRDdXJyZW50UHJvamVjdCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICBleHBlY3QobW9ja1dlYnZpZXdQcm92aWRlci5ydW5Db21tYW5kKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnbnhUZXN0JywgeyBwcm9qZWN0OiAnbXktbGliJyB9KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVnaXN0ZXIgcnVuTnhUZXN0IGNvbW1hbmQgYW5kIHNob3cgd2FybmluZyB3aGVuIG5vIHByb2plY3QgZGV0ZWN0ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB2c2NvZGUgPSByZXF1aXJlKCd2c2NvZGUnKTtcbiAgICAgIGNvbnN0IHJ1bk54VGVzdENhbGwgPSB2c2NvZGUuY29tbWFuZHMucmVnaXN0ZXJDb21tYW5kLm1vY2suY2FsbHNcbiAgICAgICAgLmZpbmQoKGNhbGw6IGFueSkgPT4gY2FsbFswXSA9PT0gJ2FpRGVidWdVdGlsaXRpZXMucnVuTnhUZXN0Jyk7XG5cbiAgICAgIG1vY2tQcm9qZWN0RGV0ZWN0b3IuZ2V0Q3VycmVudFByb2plY3QubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgaWYgKHJ1bk54VGVzdENhbGwgJiYgcnVuTnhUZXN0Q2FsbFsxXSkge1xuICAgICAgICBhd2FpdCBydW5OeFRlc3RDYWxsWzFdKCk7XG5cbiAgICAgICAgZXhwZWN0KHZzY29kZS53aW5kb3cuc2hvd1dhcm5pbmdNZXNzYWdlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICAnTm8gTlggcHJvamVjdCBkZXRlY3RlZC4gUGxlYXNlIHNlbGVjdCBhIHByb2plY3QgZmlyc3QuJ1xuICAgICAgICApO1xuICAgICAgICBleHBlY3QobW9ja1dlYnZpZXdQcm92aWRlci5ydW5Db21tYW5kKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWdpc3RlciBydW5HaXREaWZmIGNvbW1hbmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB2c2NvZGUgPSByZXF1aXJlKCd2c2NvZGUnKTtcbiAgICAgIGNvbnN0IHJ1bkdpdERpZmZDYWxsID0gdnNjb2RlLmNvbW1hbmRzLnJlZ2lzdGVyQ29tbWFuZC5tb2NrLmNhbGxzXG4gICAgICAgIC5maW5kKChjYWxsOiBhbnkpID0+IGNhbGxbMF0gPT09ICdhaURlYnVnVXRpbGl0aWVzLnJ1bkdpdERpZmYnKTtcblxuICAgICAgaWYgKHJ1bkdpdERpZmZDYWxsICYmIHJ1bkdpdERpZmZDYWxsWzFdKSB7XG4gICAgICAgIGF3YWl0IHJ1bkdpdERpZmZDYWxsWzFdKCk7XG4gICAgICAgIGV4cGVjdChtb2NrV2Vidmlld1Byb3ZpZGVyLnJ1bkNvbW1hbmQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdnaXREaWZmJywge30pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWdpc3RlciBydW5QcmVwYXJlVG9QdXNoIGNvbW1hbmQgd2l0aCBwcm9qZWN0IGRldGVjdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZzY29kZSA9IHJlcXVpcmUoJ3ZzY29kZScpO1xuICAgICAgY29uc3QgcnVuUHJlcGFyZVRvUHVzaENhbGwgPSB2c2NvZGUuY29tbWFuZHMucmVnaXN0ZXJDb21tYW5kLm1vY2suY2FsbHNcbiAgICAgICAgLmZpbmQoKGNhbGw6IGFueSkgPT4gY2FsbFswXSA9PT0gJ2FpRGVidWdVdGlsaXRpZXMucnVuUHJlcGFyZVRvUHVzaCcpO1xuXG4gICAgICBtb2NrUHJvamVjdERldGVjdG9yLmdldEN1cnJlbnRQcm9qZWN0Lm1vY2tSZXNvbHZlZFZhbHVlKHsgXG4gICAgICAgIG5hbWU6ICdteS1hcHAnLCBcbiAgICAgICAgcm9vdDogJ2FwcHMvbXktYXBwJywgXG4gICAgICAgIHByb2plY3RUeXBlOiAnYXBwbGljYXRpb24nLFxuICAgICAgICB0eXBlOiAnbngnLFxuICAgICAgICBwYWNrYWdlSnNvblBhdGg6ICdhcHBzL215LWFwcC9wYWNrYWdlLmpzb24nXG4gICAgICB9KTtcblxuICAgICAgaWYgKHJ1blByZXBhcmVUb1B1c2hDYWxsICYmIHJ1blByZXBhcmVUb1B1c2hDYWxsWzFdKSB7XG4gICAgICAgIGF3YWl0IHJ1blByZXBhcmVUb1B1c2hDYWxsWzFdKCk7XG5cbiAgICAgICAgZXhwZWN0KG1vY2tQcm9qZWN0RGV0ZWN0b3IuZ2V0Q3VycmVudFByb2plY3QpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgZXhwZWN0KG1vY2tXZWJ2aWV3UHJvdmlkZXIucnVuQ29tbWFuZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3ByZXBhcmVUb1B1c2gnLCB7IHByb2plY3Q6ICdteS1hcHAnIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWdpc3RlciBydW5QcmVwYXJlVG9QdXNoIGNvbW1hbmQgYW5kIHNob3cgd2FybmluZyB3aGVuIG5vIHByb2plY3QgZGV0ZWN0ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB2c2NvZGUgPSByZXF1aXJlKCd2c2NvZGUnKTtcbiAgICAgIGNvbnN0IHJ1blByZXBhcmVUb1B1c2hDYWxsID0gdnNjb2RlLmNvbW1hbmRzLnJlZ2lzdGVyQ29tbWFuZC5tb2NrLmNhbGxzXG4gICAgICAgIC5maW5kKChjYWxsOiBhbnkpID0+IGNhbGxbMF0gPT09ICdhaURlYnVnVXRpbGl0aWVzLnJ1blByZXBhcmVUb1B1c2gnKTtcblxuICAgICAgbW9ja1Byb2plY3REZXRlY3Rvci5nZXRDdXJyZW50UHJvamVjdC5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuXG4gICAgICBpZiAocnVuUHJlcGFyZVRvUHVzaENhbGwgJiYgcnVuUHJlcGFyZVRvUHVzaENhbGxbMV0pIHtcbiAgICAgICAgYXdhaXQgcnVuUHJlcGFyZVRvUHVzaENhbGxbMV0oKTtcblxuICAgICAgICBleHBlY3QodnNjb2RlLndpbmRvdy5zaG93V2FybmluZ01lc3NhZ2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgICdObyBOWCBwcm9qZWN0IGRldGVjdGVkLiBQbGVhc2Ugc2VsZWN0IGEgcHJvamVjdCBmaXJzdC4nXG4gICAgICAgICk7XG4gICAgICAgIGV4cGVjdChtb2NrV2Vidmlld1Byb3ZpZGVyLnJ1bkNvbW1hbmQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdlcnJvciBoYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB3b3Jrc3BhY2UgZGV0ZWN0aW9uIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdnNjb2RlID0gcmVxdWlyZSgndnNjb2RlJyk7XG4gICAgICBcbiAgICAgIG1vY2tQcm9qZWN0RGV0ZWN0b3IuZmluZE54V29ya3NwYWNlLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignV29ya3NwYWNlIGRldGVjdGlvbiBmYWlsZWQnKSk7XG5cbiAgICAgIGF3YWl0IGFjdGl2YXRlKG1vY2tDb250ZXh0KTtcbiAgICAgIFxuICAgICAgLy8gVGhlIGV4dGVuc2lvbiBzaG91bGQgc2V0IGNvbnRleHQgdG8gZmFsc2Ugd2hlbiB3b3Jrc3BhY2UgZGV0ZWN0aW9uIGZhaWxzXG4gICAgICBleHBlY3QodnNjb2RlLmNvbW1hbmRzLmV4ZWN1dGVDb21tYW5kKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnc2V0Q29udGV4dCcsICd3b3Jrc3BhY2VIYXNOeFByb2plY3QnLCBmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb21tYW5kIHJlZ2lzdHJhdGlvbiBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZzY29kZSA9IHJlcXVpcmUoJ3ZzY29kZScpO1xuICAgICAgXG4gICAgICBtb2NrUHJvamVjdERldGVjdG9yLmZpbmROeFdvcmtzcGFjZS5tb2NrUmVzb2x2ZWRWYWx1ZSgnL3dvcmtzcGFjZS9ueC5qc29uJyk7XG4gICAgICB2c2NvZGUuY29tbWFuZHMucmVnaXN0ZXJDb21tYW5kLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ29tbWFuZCByZWdpc3RyYXRpb24gZmFpbGVkJyk7XG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgYWN0aXZhdGUobW9ja0NvbnRleHQpO1xuICAgICAgXG4gICAgICAvLyBUaGUgZXh0ZW5zaW9uIHNob3VsZCBzZXQgY29udGV4dCB0byBmYWxzZSB3aGVuIGNvbW1hbmQgcmVnaXN0cmF0aW9uIGZhaWxzXG4gICAgICBleHBlY3QodnNjb2RlLmNvbW1hbmRzLmV4ZWN1dGVDb21tYW5kKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnc2V0Q29udGV4dCcsICd3b3Jrc3BhY2VIYXNOeFByb2plY3QnLCBmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdkZWFjdGl2YXRlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZGVhY3RpdmF0ZSBleHRlbnNpb24gY2xlYW5seScsICgpID0+IHtcbiAgICAgIC8vIFNob3VsZCBub3QgdGhyb3dcbiAgICAgIGV4cGVjdCgoKSA9PiBkZWFjdGl2YXRlKCkpLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdpbnRlZ3JhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhbGwgbmVjZXNzYXJ5IGluc3RhbmNlcyB3aXRoIGNvcnJlY3QgZGVwZW5kZW5jaWVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ2xlYXIgcHJldmlvdXMgbW9jayBjYWxsc1xuICAgICAgTW9ja2VkUHJvamVjdERldGVjdG9yLm1vY2tDbGVhcigpO1xuICAgICAgTW9ja2VkQ29tbWFuZFJ1bm5lci5tb2NrQ2xlYXIoKTtcbiAgICAgIE1vY2tlZEZpbGVNYW5hZ2VyLm1vY2tDbGVhcigpO1xuICAgICAgTW9ja2VkV2Vidmlld1Byb3ZpZGVyLm1vY2tDbGVhcigpO1xuICAgICAgXG4gICAgICBtb2NrUHJvamVjdERldGVjdG9yLmZpbmROeFdvcmtzcGFjZS5tb2NrUmVzb2x2ZWRWYWx1ZSgnL3dvcmtzcGFjZS9ueC5qc29uJyk7XG4gICAgICBcbiAgICAgIGF3YWl0IGFjdGl2YXRlKG1vY2tDb250ZXh0KTtcblxuICAgICAgZXhwZWN0KE1vY2tlZFByb2plY3REZXRlY3RvcikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgZXhwZWN0KE1vY2tlZENvbW1hbmRSdW5uZXIpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICAgIGV4cGVjdChNb2NrZWRGaWxlTWFuYWdlcikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgZXhwZWN0KE1vY2tlZFdlYnZpZXdQcm92aWRlcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIG1vY2tDb250ZXh0LmV4dGVuc2lvblVyaSxcbiAgICAgICAgbW9ja1Byb2plY3REZXRlY3RvcixcbiAgICAgICAgbW9ja0NvbW1hbmRSdW5uZXIsXG4gICAgICAgIG1vY2tGaWxlTWFuYWdlcixcbiAgICAgICAgZXhwZWN0LmFueXRoaW5nKCkgLy8gc3RhdHVzVHJhY2tlclxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJvcGVybHkgZGlzcG9zZSBvZiByZXNvdXJjZXMgdGhyb3VnaCBjb250ZXh0IHN1YnNjcmlwdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja1Byb2plY3REZXRlY3Rvci5maW5kTnhXb3Jrc3BhY2UubW9ja1Jlc29sdmVkVmFsdWUoJy93b3Jrc3BhY2UvbnguanNvbicpO1xuICAgIFxuICAgIGF3YWl0IGFjdGl2YXRlKG1vY2tDb250ZXh0KTtcblxuICAgIGV4cGVjdChtb2NrQ29udGV4dC5zdWJzY3JpcHRpb25zLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIFxuICAgIC8vIEFsbCBzdWJzY3JpcHRpb25zIHNob3VsZCBiZSBkaXNwb3NhYmxlIG9iamVjdHNcbiAgICBtb2NrQ29udGV4dC5zdWJzY3JpcHRpb25zLmZvckVhY2goc3Vic2NyaXB0aW9uID0+IHtcbiAgICBpZiAoc3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICBleHBlY3Qoc3Vic2NyaXB0aW9uKS50b0hhdmVQcm9wZXJ0eSgnZGlzcG9zZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9