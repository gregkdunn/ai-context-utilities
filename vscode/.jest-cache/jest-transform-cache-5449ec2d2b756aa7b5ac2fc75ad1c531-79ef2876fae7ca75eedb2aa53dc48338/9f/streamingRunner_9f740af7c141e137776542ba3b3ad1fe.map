{"file":"/Users/gregdunn/src/test/ai_debug_context/vscode/src/utils/streamingRunner.ts","mappings":"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","names":[],"sources":["/Users/gregdunn/src/test/ai_debug_context/vscode/src/utils/streamingRunner.ts"],"sourcesContent":["import { EventEmitter } from 'events';\nimport { spawn, ChildProcess } from 'child_process';\nimport * as vscode from 'vscode';\nimport { StreamingMessage, CommandResult } from '../types';\n\nexport interface StreamingOptions {\n    cwd?: string;\n    env?: Record<string, string>;\n    timeout?: number;\n    killSignal?: string;\n    progressSteps?: string[];\n}\n\nexport class StreamingCommandRunner extends EventEmitter {\n    private _activeProcess?: ChildProcess;\n    private _isRunning = false;\n    private _startTime?: number;\n    private _currentOutput = '';\n\n    constructor(private readonly _outputChannel: vscode.OutputChannel) {\n        super();\n    }\n\n    // Main execution method\n    public async executeWithStreaming(command: string, args: string[], options: StreamingOptions = {}): Promise<CommandResult> {\n        if (this._isRunning) {\n            throw new Error('Command is already running');\n        }\n\n        this._isRunning = true;\n        this._startTime = Date.now();\n        this._currentOutput = '';\n\n        try {\n            return await this._executeCommand(command, args, options);\n        } finally {\n            this._isRunning = false;\n            this._activeProcess = undefined;\n        }\n    }\n\n    // Test command execution\n    public async executeTestCommand(command: string, args: string[], cwd?: string): Promise<CommandResult> {\n        return this.executeWithStreaming(command, args, { cwd });\n    }\n\n    // Git command execution\n    public async executeGitCommand(args: string[], cwd?: string): Promise<CommandResult> {\n        return this.executeWithStreaming('git', args, { cwd });\n    }\n\n    // Lint command execution\n    public async executeLintCommand(command: string, args: string[], cwd?: string): Promise<CommandResult> {\n        return this.executeWithStreaming(command, args, { cwd });\n    }\n\n    private async _executeCommand(command: string, args: string[], options: StreamingOptions): Promise<CommandResult> {\n        return new Promise<CommandResult>((resolve, reject) => {\n            this._activeProcess = spawn(command, args, {\n                cwd: options.cwd || vscode.workspace.workspaceFolders?.[0]?.uri.fsPath,\n                env: { ...process.env, ...options.env },\n                stdio: ['pipe', 'pipe', 'pipe']\n            });\n\n            let output = '';\n            let error = '';\n\n            this._activeProcess.stdout?.on('data', (data: Buffer) => {\n                const text = data.toString();\n                output += text;\n                this._currentOutput += text;\n                \n                this.emit('output', text);\n                this._outputChannel.append(text);\n            });\n\n            this._activeProcess.stderr?.on('data', (data: Buffer) => {\n                const text = data.toString();\n                error += text;\n                this._currentOutput += text;\n                \n                this.emit('error', text);\n                this._outputChannel.append(text);\n            });\n\n            this._activeProcess.on('close', (code: number) => {\n                const duration = Date.now() - (this._startTime || 0);\n                \n                const result: CommandResult = {\n                    success: code === 0,\n                    exitCode: code,\n                    output,\n                    error,\n                    duration\n                };\n\n                this.emit('complete', result);\n                resolve(result);\n            });\n\n            this._activeProcess.on('error', (err: Error) => {\n                const duration = Date.now() - (this._startTime || 0);\n                \n                const result: CommandResult = {\n                    success: false,\n                    exitCode: 1,\n                    output,\n                    error: err.message,\n                    duration\n                };\n\n                this.emit('error', err.message);\n                this.emit('complete', result);\n                resolve(result);\n            });\n\n            // Handle timeout\n            if (options.timeout) {\n                setTimeout(() => {\n                    if (this._activeProcess && this._isRunning) {\n                        this.cancel();\n                        reject(new Error('Command timed out'));\n                    }\n                }, options.timeout);\n            }\n        });\n    }\n\n    public cancel(): void {\n        if (this._activeProcess) {\n            this._activeProcess.kill('SIGTERM');\n            \n            // Force kill after 5 seconds\n            setTimeout(() => {\n                if (this._activeProcess) {\n                    this._activeProcess.kill('SIGKILL');\n                }\n            }, 5000);\n        }\n    }\n\n    public get isRunning(): boolean {\n        return this._isRunning;\n    }\n\n    public getCurrentOutput(): string {\n        return this._currentOutput;\n    }\n\n    public clearOutput(): void {\n        this._currentOutput = '';\n    }\n\n    public simulateProgress(duration: number): void {\n        const interval = 100; // Update every 100ms\n        const steps = duration / interval;\n        let currentStep = 0;\n\n        const progressInterval = setInterval(() => {\n            currentStep++;\n            const progress = Math.min(100, (currentStep / steps) * 100);\n            \n            this.emit('progress', progress);\n            \n            if (currentStep >= steps) {\n                clearInterval(progressInterval);\n            }\n        }, interval);\n    }\n\n    public dispose(): void {\n        this.cancel();\n        this.removeAllListeners();\n    }\n}"],"version":3}