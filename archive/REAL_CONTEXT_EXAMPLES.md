# Context File Output Examples

## Overview

Examples of the actual context files generated by the extension. These show what gets written to `.github/instructions/ai-utilities-context/` files.

---

## 1. Failing Tests Context

**Scenario:** Tests fail after refactoring  
**File:** `ai-debug-context.txt`

```
=================================================================
ü§ñ AI DEBUG CONTEXT - OPTIMIZED FOR ANALYSIS
=================================================================

PROJECT: Angular NX Monorepo
TARGET: user-service
STATUS: ‚ùå TESTS FAILING
FOCUS: General debugging
TIMESTAMP: 7/30/2025, 3:15:42 PM

=================================================================
üîß WORKSPACE TECHNOLOGY STACK - USE THESE FRAMEWORKS ONLY
=================================================================
IMPORTANT: All code suggestions must use the frameworks detected in this workspace.
Do not recommend alternatives. Use only the technologies listed below:

‚Ä¢ TypeScript: 5.0 (configured)
‚Ä¢ Frontend: Angular 17.0
‚Ä¢ Testing: Jest 29.0, Cypress 13.0
‚Ä¢ Build: Nx 17.0
‚Ä¢ Package manager: yarn

‚ö†Ô∏è  DO NOT suggest different frameworks (e.g., if Jest is detected, do not suggest Jasmine)
‚ö†Ô∏è  DO NOT recommend changing the existing tech stack
‚ö†Ô∏è  USE the detected versions when providing code examples

=================================================================
üéØ ANALYSIS REQUEST
=================================================================

Please analyze this context and provide:

FAILING TESTS - SPECIFIC FIXES NEEDED:

Based on the test failures shown below, provide these specific fixes:

1. Fix TypeError in src/user/user.service.spec.ts:28
   ‚Üí Update test to call validateUserEmail() instead of validateUser()
   ‚Üí Add null check before accessing email property
   ‚Üí Provide exact code replacement for line 28

2. Fix AuthController compilation error in src/auth/auth.controller.ts:25
   ‚Üí Change this.userService.validateUser() to this.userService.validateUserEmail()
   ‚Üí Update parameter from credentials object to credentials.email string
   ‚Üí Show exact method call replacement

3. Fix missing EmailValidator import in src/validation/email.validator.spec.ts:8
   ‚Üí Add proper import statement for EmailValidator class
   ‚Üí Update test setup to use new class-based validator
   ‚Üí Provide exact import line and test instantiation code

4. Recommend new tests for the refactored validation:
   ‚Üí Test validateUserEmail() with null/undefined email
   ‚Üí Test validateUserEmail() with various email formats
   ‚Üí Test EmailValidator.getDomain() method functionality

**RESPONSE FORMAT:**
For each fix, provide your response in this exact format (render as proper markdown):

## Fix #1: [Brief description]
**File:** src/path/to/file.ts
**Line:** 42
**Issue:** [What's wrong]
**Solution:**
```typescript
// Replace this:
old code here

// With this:
new code here
```
**Explanation:** [Why this fixes the issue]

IMPORTANT: Do not wrap the entire response in code blocks. Use proper markdown formatting so headers (##) and bold text (**text**) render correctly.

Use this format for all 4 fixes above.

**FRAMEWORK REQUIREMENTS:**
- Use ONLY the frameworks detected in the workspace technology stack above
- Do not suggest switching test frameworks (e.g., if Jest is detected, fix Jest issues, don't suggest Jasmine)
- Follow existing test patterns and imports in the codebase
- Use the exact versions detected in the workspace


==================================================================
üß™ TEST EXECUTION DETAILS
==================================================================

Test Suites: 3 failed, 2 passed, 5 total
Tests: 8 failed, 47 passed, 55 total
Time: 12.456s

FAIL src/user/user.service.spec.ts
  ‚óè UserService ‚Ä∫ should validate user email
    TypeError: Cannot read property 'email' of undefined
      at UserService.validateUserEmail (src/user/user.service.ts:42:18)
      at Object.<anonymous> (src/user/user.service.spec.ts:28:23)
        
  ‚óè UserService ‚Ä∫ should create user with valid data
    AssertionError: Expected 201 but received 400
      at Object.<anonymous> (src/user/user.service.spec.ts:45:12)
      Expected: 201
      Received: 400

FAIL src/auth/auth.controller.spec.ts
  ‚óè AuthController ‚Ä∫ should authenticate user
    error TS2339: Property 'validateUser' does not exist on type 'UserService'
      at AuthController.login (src/auth/auth.controller.ts:25:35)
      at Object.<anonymous> (src/auth/auth.controller.spec.ts:33:18)

  ‚óè AuthController ‚Ä∫ should handle invalid credentials
    TypeError: this.userService.validateUser is not a function
      at AuthController.login (src/auth/auth.controller.ts:25:35)
      at Object.<anonymous> (src/auth/auth.controller.spec.ts:48:23)

FAIL src/validation/email.validator.spec.ts
  ‚óè EmailValidator ‚Ä∫ should reject invalid email formats
    ReferenceError: EmailValidator is not defined
      at Object.<anonymous> (src/validation/email.validator.spec.ts:8:16)

  ‚óè EmailValidator ‚Ä∫ should accept valid email formats
    ReferenceError: EmailValidator is not defined
      at Object.<anonymous> (src/validation/email.validator.spec.ts:15:22)

Performance Issues:
  ‚óè Slow test detected: UserService integration tests (4.2s)
  ‚óè Memory leak warning: AuthController test suite

==================================================================
üìã SPECIFIC CHANGES MADE
==================================================================

Files changed: 4
Lines added: 45
Lines removed: 23

Modified files:
‚Ä¢ src/user/user.service.ts
‚Ä¢ src/auth/auth.controller.ts
‚Ä¢ src/validation/email.validator.ts
‚Ä¢ src/user/user.service.spec.ts

=== src/user/user.service.ts ===
@@ -38,8 +38,8 @@ export class UserService {
   }
 
-  validateUser(userData: any): boolean {
-    return userData && userData.email && this.isValidEmail(userData.email);
+  validateUserEmail(email: string): boolean {
+    return email && this.emailValidator.isValid(email);
   }
 
   private isValidEmail(email: string): boolean {

=== src/auth/auth.controller.ts ===
@@ -22,7 +22,7 @@ export class AuthController {
   async login(@Body() credentials: LoginDto): Promise<AuthResponse> {
     try {
-      if (!this.userService.validateUser(credentials)) {
+      if (!this.userService.validateUserEmail(credentials.email)) {
         throw new UnauthorizedException('Invalid credentials');
       }
       
@@ -35,6 +35,10 @@ export class AuthController {
       return this.authService.generateToken(user);
     } catch (error) {
+      if (error instanceof ValidationError) {
+        throw new BadRequestException(error.message);
+      }
       throw new UnauthorizedException('Authentication failed');
     }
   }

=== src/validation/email.validator.ts ===
@@ -1,10 +1,15 @@
+import { Injectable } from '@nestjs/common';
+
+@Injectable()
+export class EmailValidator {
-export function validateEmail(email: string): boolean {
+  isValid(email: string): boolean {
     const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
-    return emailRegex.test(email);
+    return email && typeof email === 'string' && emailRegex.test(email);
   }
-}

+  getDomain(email: string): string | null {
+    const match = email.match(/@(.+)$/);
+    return match ? match[1] : null;
+  }
+}

==================================================================
üéØ FILES TO ANALYZE
==================================================================
Focus your analysis on these specific files and issues:

‚Ä¢ src/user/user.service.spec.ts - Fix method name calls and null checks
‚Ä¢ src/auth/auth.controller.ts - Update method calls to match service changes  
‚Ä¢ src/validation/email.validator.spec.ts - Add missing imports and class usage
‚Ä¢ src/user/user.service.ts - Review the validateUserEmail() implementation
‚Ä¢ src/validation/email.validator.ts - Check the new class structure and methods

Provide exact code fixes with line numbers for each issue identified above.
```

---

## 2. Passing Tests Context

**Scenario:** Tests pass after adding new service  
**File:** `ai-debug-context.txt`

```
=================================================================
ü§ñ AI DEBUG CONTEXT - OPTIMIZED FOR ANALYSIS
=================================================================

PROJECT: Angular NX Monorepo
TARGET: payment-service
STATUS: ‚úÖ TESTS PASSING
FOCUS: General debugging
TIMESTAMP: 7/30/2025, 3:22:18 PM

=================================================================
üîß WORKSPACE TECHNOLOGY STACK - USE THESE FRAMEWORKS ONLY
=================================================================
IMPORTANT: All code suggestions must use the frameworks detected in this workspace.
Do not recommend alternatives. Use only the technologies listed below:

‚Ä¢ TypeScript: 4.9 (configured)
‚Ä¢ Frontend: React 18.2, Next.js 14.0
‚Ä¢ Testing: Jest 29.0, Testing Library 14.0
‚Ä¢ Build: Nx 17.0, Webpack 5.0
‚Ä¢ Package manager: npm

‚ö†Ô∏è  DO NOT suggest different frameworks (e.g., if Jest is detected, do not suggest Jasmine)
‚ö†Ô∏è  DO NOT recommend changing the existing tech stack
‚ö†Ô∏è  USE the detected versions when providing code examples

=================================================================
üéØ ANALYSIS REQUEST
=================================================================

Please analyze this context and provide:

PASSING TESTS - SPECIFIC REVIEW RECOMMENDATIONS:

Based on the new PaymentValidator service and code changes shown below, provide:

1. Code Quality Issues in src/payment/payment.service.ts:
   ‚Üí Review the new dependency injection in constructor (lines 11-14)
   ‚Üí Check if async encryption call needs error handling (line 21)
   ‚Üí Verify chargeCard() method handles encrypted data properly

2. Missing Test Coverage for src/validation/payment.validator.ts:
   ‚Üí Add tests for international card formats (Maestro, Discover, JCB)
   ‚Üí Test Luhn algorithm edge cases (all zeros, all nines, single digit)
   ‚Üí Test getDomain() method that was added but not tested
   ‚Üí Add boundary tests for amount validation (exactly 0, exactly 100000)

3. Security Concerns in src/security/encryption.service.ts:
   ‚Üí Review if encryption key storage is secure (line 89 FIXME comment)
   ‚Üí Check if decryption handles malformed input safely
   ‚Üí Verify encrypted data is properly cleared from memory

4. New Integration Tests Needed:
   ‚Üí Test full payment flow with encryption enabled/disabled
   ‚Üí Test payment processing when validation fails at different steps
   ‚Üí Test performance with large transaction amounts (encryption overhead)

**RESPONSE FORMAT:**
Organize your response using these sections (render as proper markdown):

## Code Quality Review

### üîç Issues Found:
**File:** src/path/to/file.ts (lines X-Y)
- Issue description with specific concern
- Recommended fix with code example

### üß™ Missing Test Coverage:
**File:** src/path/to/test.spec.ts
```typescript
describe('New test suite', () => {
  it('should test specific behavior', () => {
    // Test implementation
  });
});
```

### üîí Security Concerns:
**File:** src/path/to/file.ts (line X)
- Security issue description  
- Mitigation code example

### üîó Integration Tests:
- Test scenario 1: Expected behavior
- Test scenario 2: Expected behavior

IMPORTANT: Do not wrap the entire response in code blocks. Use proper markdown formatting so headers (##, ###) and bold text (**text**) render correctly.

Use this exact structure for consistency.

**FRAMEWORK REQUIREMENTS:**
- Use ONLY the frameworks detected in the workspace technology stack above
- Follow the existing patterns and conventions in the codebase
- Match the detected versions when suggesting code examples


==================================================================
üß™ TEST EXECUTION DETAILS
==================================================================

Test Suites: 0 failed, 6 passed, 6 total
Tests: 0 failed, 128 passed, 128 total
Time: 8.234s

PASS src/payment/payment.service.spec.ts (2.1s)
  ‚úì PaymentService ‚Ä∫ should process valid payment (45ms)
  ‚úì PaymentService ‚Ä∫ should validate credit card numbers (23ms)
  ‚úì PaymentService ‚Ä∫ should handle insufficient funds (67ms)
  ‚úì PaymentService ‚Ä∫ should encrypt payment data (34ms)

PASS src/validation/payment.validator.spec.ts (1.8s)
  ‚úì PaymentValidator ‚Ä∫ should validate Visa cards (12ms)
  ‚úì PaymentValidator ‚Ä∫ should validate Mastercard cards (15ms)
  ‚úì PaymentValidator ‚Ä∫ should reject invalid card numbers (8ms)
  ‚úì PaymentValidator ‚Ä∫ should validate expiration dates (19ms)

PASS src/security/encryption.service.spec.ts (1.2s)
  ‚úì EncryptionService ‚Ä∫ should encrypt sensitive data (89ms)
  ‚úì EncryptionService ‚Ä∫ should decrypt data correctly (76ms)

PASS src/integration/payment-flow.spec.ts (2.9s)
  ‚úì Payment Flow ‚Ä∫ should complete full payment cycle (234ms)
  ‚úì Payment Flow ‚Ä∫ should handle payment failures gracefully (189ms)

Performance Metrics:
  ‚óè Fast execution: All test suites under 3s
  ‚óè Memory usage: 45MB peak (within limits)
  ‚óè Coverage: 94% lines, 89% branches
  
Warnings:
  ‚ö†Ô∏è TODO: Add validation for international card formats (payment.validator.ts:156)
  ‚ö†Ô∏è FIXME: Optimize encryption for large transactions (encryption.service.ts:89)
  ‚ö†Ô∏è Deprecation: crypto.createCipher deprecated, use crypto.createCipherGCM

==================================================================
üìã SPECIFIC CHANGES MADE
==================================================================

Files changed: 3
Lines added: 187
Lines removed: 12

Modified files:
‚Ä¢ src/payment/payment.service.ts
‚Ä¢ src/validation/payment.validator.ts
‚Ä¢ src/security/encryption.service.ts

=== src/payment/payment.service.ts ===
@@ -1,4 +1,6 @@
 import { Injectable, BadRequestException } from '@nestjs/common';
+import { PaymentValidator } from '../validation/payment.validator';
+import { EncryptionService } from '../security/encryption.service';
 
 @Injectable()
 export class PaymentService {
@@ -8,6 +10,10 @@ export class PaymentService {
+  constructor(
+    private paymentValidator: PaymentValidator,
+    private encryptionService: EncryptionService
+  ) {}
+
   async processPayment(paymentData: PaymentDto): Promise<PaymentResult> {
-    // Basic validation
-    if (!paymentData.cardNumber || !paymentData.amount) {
-      throw new BadRequestException('Invalid payment data');
-    }
+    // Enhanced validation with new PaymentValidator
+    const validationResult = this.paymentValidator.validatePayment(paymentData);
+    if (!validationResult.isValid) {
+      throw new BadRequestException(validationResult.errors.join(', '));
+    }
+
+    // Encrypt sensitive data before processing
+    const encryptedData = await this.encryptionService.encryptPaymentData(paymentData);
     
-    return this.chargeCard(paymentData);
+    return this.chargeCard(encryptedData);
   }

=== src/validation/payment.validator.ts ===
@@ -0,0 +1,89 @@
+import { Injectable } from '@nestjs/common';
+
+export interface ValidationResult {
+  isValid: boolean;
+  errors: string[];
+}
+
+@Injectable()
+export class PaymentValidator {
+  
+  validatePayment(paymentData: any): ValidationResult {
+    const errors: string[] = [];
+    
+    // Validate card number
+    if (!this.isValidCardNumber(paymentData.cardNumber)) {
+      errors.push('Invalid card number format');
+    }
+    
+    // Validate expiration date
+    if (!this.isValidExpirationDate(paymentData.expiryMonth, paymentData.expiryYear)) {
+      errors.push('Card has expired or invalid expiration date');
+    }
+    
+    // Validate amount
+    if (!this.isValidAmount(paymentData.amount)) {
+      errors.push('Invalid payment amount');
+    }
+    
+    return {
+      isValid: errors.length === 0,
+      errors
+    };
+  }
+  
+  private isValidCardNumber(cardNumber: string): boolean {
+    if (!cardNumber || typeof cardNumber !== 'string') {
+      return false;
+    }
+    
+    // Remove spaces and dashes
+    const cleaned = cardNumber.replace(/[\s-]/g, '');
+    
+    // Check if all digits and reasonable length
+    if (!/^\d{13,19}$/.test(cleaned)) {
+      return false;
+    }
+    
+    // Luhn algorithm validation
+    return this.luhnCheck(cleaned);
+  }
+  
+  private luhnCheck(cardNumber: string): boolean {
+    let sum = 0;
+    let isEven = false;
+    
+    for (let i = cardNumber.length - 1; i >= 0; i--) {
+      let digit = parseInt(cardNumber[i]);
+      
+      if (isEven) {
+        digit *= 2;
+        if (digit > 9) {
+          digit -= 9;
+        }
+      }
+      
+      sum += digit;
+      isEven = !isEven;
+    }
+    
+    return sum % 10 === 0;
+  }
+  
+  private isValidExpirationDate(month: number, year: number): boolean {
+    const now = new Date();
+    const currentYear = now.getFullYear();
+    const currentMonth = now.getMonth() + 1;
+    
+    if (year < currentYear || (year === currentYear && month < currentMonth)) {
+      return false;
+    }
+    
+    return month >= 1 && month <= 12 && year >= currentYear && year <= currentYear + 20;
+  }
+  
+  private isValidAmount(amount: number): boolean {
+    return typeof amount === 'number' && amount > 0 && amount <= 100000;
+  }
+}

==================================================================
üéØ FILES TO ANALYZE
==================================================================
Focus your analysis on these specific files and improvements:

‚Ä¢ src/payment/payment.service.ts - Review dependency injection and error handling
‚Ä¢ src/validation/payment.validator.ts - Add missing test coverage for new methods  
‚Ä¢ src/security/encryption.service.ts - Address security concerns and performance
‚Ä¢ Integration test gaps - Payment flow with different validation scenarios

Recommend specific test methods and security improvements with examples.
```

---

## 3. PR Description Context

**Scenario:** New service with feature flags  
**File:** `pr-description.txt`

```
=================================================================
üìù PR DESCRIPTION CONTEXT - READY FOR GENERATION
=================================================================

PROJECT: Angular NX Monorepo
TARGET: notification-service
STATUS: ‚úÖ TESTS PASSING
FOCUS: PR description generation
TIMESTAMP: 7/30/2025, 3:30:45 PM

=================================================================
üîß WORKSPACE TECHNOLOGY STACK - USE THESE FRAMEWORKS ONLY
=================================================================
IMPORTANT: All code suggestions must use the frameworks detected in this workspace.
Do not recommend alternatives. Use only the technologies listed below:

‚Ä¢ TypeScript: 5.2 (configured)
‚Ä¢ Frontend: Angular 17.0
‚Ä¢ Testing: Jest 29.0, Cypress 13.0
‚Ä¢ Build: Nx 17.0
‚Ä¢ Package manager: yarn

‚ö†Ô∏è  DO NOT suggest different frameworks (e.g., if Jest is detected, do not suggest Jasmine)
‚ö†Ô∏è  DO NOT recommend changing the existing tech stack
‚ö†Ô∏è  USE the detected versions when providing code examples

=================================================================
üìù PR GENERATION REQUEST
=================================================================

## üìù Pull Request Description Request

Analyze the git diff and test results below to generate a comprehensive PR description.

**ANALYSIS STEPS:**
1. Examine the git diff to understand what was actually changed
2. Identify the main functionality being added/modified/removed
3. Extract any feature flags from the code changes
4. Detect breaking changes (interface modifications, method signature changes)
5. Note performance implications (new dependencies, heavy operations)
6. Reference actual test results and coverage numbers

**OUTPUT FORMAT:**
Generate a PR description using this structure:

```markdown
# Pull Request Title

## Summary
[Specific description based on actual code changes]

## Changes Made
- [Specific file]: [What changed and why]
- [Specific file]: [What changed and why]

## Feature Flags (if any detected)
- `flag-name`: [Purpose and testing instructions]

## Testing
- [X] Unit tests pass ([actual numbers from test output])
- [X] Integration tests pass
- [ ] Manual testing completed

## Breaking Changes (if any)
- [Specific change]: [Migration instructions]

## Additional Notes
[Performance implications, dependencies, etc.]
```

Base all content on the actual git diff and test results provided below.


==================================================================
üß™ TEST EXECUTION DETAILS
==================================================================

Test Suites: 0 failed, 8 passed, 8 total
Tests: 0 failed, 156 passed, 156 total
Time: 12.8s

PASS src/notification/notification.service.spec.ts (2.4s)
PASS src/notification/channels/email.channel.spec.ts (1.8s)
PASS src/notification/channels/sms.channel.spec.ts (1.6s)
PASS src/integration/notification-flow.spec.ts (3.2s)

==================================================================
üìã SPECIFIC CHANGES MADE
==================================================================

Files changed: 8
Lines added: 487
Lines removed: 45

Modified files:
‚Ä¢ src/notification/notification.service.ts
‚Ä¢ src/notification/interfaces/notification.interface.ts
‚Ä¢ src/notification/channels/email.channel.ts
‚Ä¢ src/notification/channels/sms.channel.ts
‚Ä¢ src/notification/channels/push.channel.ts
‚Ä¢ src/user/user.service.ts
‚Ä¢ src/config/notification.config.ts
‚Ä¢ package.json

=== src/notification/notification.service.ts ===
@@ -0,0 +1,234 @@
+import { Injectable } from '@nestjs/common';
+import { FlipperService } from '../flipper/flipper.service';
+
+@Injectable()
+export class NotificationService {
+  constructor(
+    private flipperService: FlipperService,
+    private emailChannel: EmailChannel,
+    private smsChannel: SmsChannel,
+    private pushChannel: PushChannel
+  ) {}
+
+  async sendNotification(notification: NotificationRequest): Promise<void> {
+    // Feature flag controlled notification channels
+    if (this.flipperService.flipperEnabled('email-notifications')) {
+      await this.emailChannel.send(notification);
+    }
+    
+    if (this.flipperService.eagerlyEnabled('sms-notifications')) {
+      await this.smsChannel.send(notification);
+    }
+    
+    if (this.flipperService.flipperEnabled('push-notifications')) {
+      await this.pushChannel.send(notification);
+    }
+    
+    // Queue processing with feature flag
+    if (this.flipperService.flipperEnabled('notification-queue')) {
+      await this.queueService.add('notification', notification);
+    } else {
+      await this.processImmediately(notification);
+    }
+  }
+}

=== src/config/notification.config.ts ===
@@ -5,8 +5,10 @@
 export interface NotificationConfig {
   enabled: boolean;
   template: string;
+  channels: NotificationChannel[]; // BREAKING: Required new field
+  metadata?: Record<string, any>;  // Optional metadata
 }

==================================================================
üéØ FILES TO ANALYZE
==================================================================
Focus your analysis on these specific changes:

‚Ä¢ src/notification/notification.service.ts - New service with feature flag integration
‚Ä¢ Feature flags: email-notifications, sms-notifications, push-notifications, notification-queue
‚Ä¢ Breaking change: NotificationConfig interface modified (new required field)
‚Ä¢ New dependencies: @nestjs/bull, redis, @sendgrid/mail, twilio
‚Ä¢ Performance: Queue processing and multi-channel delivery

Generate PR description based on this specific implementation.
```

## Changes Made
- Added new NotificationService with email, SMS, and push notification channels
- Implemented feature flag integration for controlled notification rollout
- Enhanced TypeScript implementation with strict type checking
- Created comprehensive test suite with 95% coverage
- Added notification queue management with Redis integration
- Implemented user preference management for notification types

## Testing
- [x] Unit tests pass (156/156)
- [x] TypeScript compilation successful
- [x] Integration tests pass (12/12)
- [x] E2E notification flow tests pass (8/8)
- [x] Performance tests under load (1000 notifications/sec)

## QA
**Feature Flags to Test:**
- [ ] `email-notifications` - Test with flag enabled
- [ ] `email-notifications` - Test with flag disabled
- [ ] `sms-notifications` - Test with flag enabled
- [ ] `sms-notifications` - Test with flag disabled
- [ ] `push-notifications` - Test with flag enabled
- [ ] `push-notifications` - Test with flag disabled
- [ ] `notification-queue` - Test with flag enabled
- [ ] `notification-queue` - Test with flag disabled
- [ ] `user-preferences` - Test with flag enabled
- [ ] `user-preferences` - Test with flag disabled

**Critical Testing Areas:**
- Test notification delivery with each flag combination
- Verify fallback behavior when flags are disabled
- Validate user preference integration with feature flags
- Test queue processing with notification-queue flag disabled

## Breaking Changes
- Modified NotificationConfig interface - added required 'channels' property
- Removed deprecated sendEmail method from UserService
- Changed notification event payload structure (added metadata field)

## Migration Guide
```typescript
// Old interface
interface NotificationConfig {
  enabled: boolean;
  template: string;
}

// New interface
interface NotificationConfig {
  enabled: boolean;
  template: string;
  channels: NotificationChannel[]; // Required new field
  metadata?: Record<string, any>;  // Optional metadata
}
```

## Dependencies
- Added @nestjs/bull for queue management
- Added redis dependency for notification queue
- Added @sendgrid/mail for email service
- Added twilio SDK for SMS notifications

## Performance Impact
- Notification processing: 1000+ notifications/second capacity
- Memory usage: +15MB for queue management
- Redis connection pool: 10 connections max
- Queue retention: 7 days for failed notifications

## Additional Notes
Analyzed 8 changed files with 487 additions and 45 deletions. This implementation provides a scalable foundation for multi-channel notifications with feature flag controls for safe rollout. The breaking changes are minimal and focused on improving type safety and extensibility.

The notification service integrates with existing user management and supports both immediate delivery and queued processing based on feature flag configuration. All notification channels can be independently controlled through feature flags, allowing for granular rollout strategies.

---

## üß© **Generated Based On Git Analysis:**

**Files Analyzed:**
- `src/notification/notification.service.ts` (new file, 234 lines)
- `src/notification/interfaces/notification.interface.ts` (new file, 67 lines)
- `src/notification/channels/email.channel.ts` (new file, 89 lines)
- `src/notification/channels/sms.channel.ts` (new file, 76 lines)
- `src/notification/channels/push.channel.ts` (new file, 82 lines)
- `src/user/user.service.ts` (modified, removed deprecated methods)
- `src/config/notification.config.ts` (modified, breaking changes)
- `package.json` (modified, new dependencies)

**Feature Flags Detected:**
```typescript
// From notification.service.ts
if (this.flipperService.flipperEnabled('email-notifications')) {
  await this.emailChannel.send(notification);
}

if (this.flipperService.eagerlyEnabled('sms-notifications')) {
  await this.smsChannel.send(notification);
}

// From queue processing
if (this.flipperService.flipperEnabled('notification-queue')) {
  await this.queueService.add('notification', notification);
} else {
  await this.processImmediately(notification);
}
```

**Breaking Change Analysis:**
- Interface modifications detected in notification.config.ts
- Method removal detected in user.service.ts
- New required dependencies in package.json
- Event payload structure changes in notification events
```

---

## What Gets Generated

**Failing Tests:**
- Complete error messages and stack traces
- All test failure details
- Git diff of changes that broke tests
- TypeScript compilation errors

**Passing Tests:**
- Test execution summary with timing
- Performance warnings and deprecation notices
- Git diff of successful changes
- Code coverage information

**PR Descriptions:**
- Analysis of git changes to generate summary
- Feature flag detection from code changes
- Breaking change detection
- QA checklist for detected feature flags

**File Contents:**
- No length limits - includes all relevant information
- Filters out noise (npm warnings, node_modules paths)
- Structured for AI assistant analysis with output format specifications
- Written to `.github/instructions/ai-utilities-context/` directory

## Prompt Improvements Made

**PR Description Prompts:**
‚úÖ **Specific analysis steps** - examines git diff for actual changes  
‚úÖ **Feature flag extraction** - finds flags in code changes automatically  
‚úÖ **Breaking change detection** - identifies interface/API modifications  
‚úÖ **Structured output format** - consistent markdown template  
‚úÖ **Real data references** - uses actual test numbers and file changes  
‚úÖ **Template integration** - works with project-specific PR templates